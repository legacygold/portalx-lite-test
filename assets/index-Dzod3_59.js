const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/basic-CMOiWqFD.js","assets/index-DPvFp-Nd.js","assets/w3m-modal-DqvS5FEQ.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var Of,Ge,tS,rS,qo,Cb,nS,sS,iS,Rw,km,Pm,Gl={},oS=[],IO=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Tf=Array.isArray;function mi(t,e){for(var r in e)t[r]=e[r];return t}function Dw(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function aS(t,e,r){var n,s,i,o={};for(i in e)i=="key"?n=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?Of.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return ad(t,o,n,s,null)}function ad(t,e,r,n,s){var i={type:t,props:e,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++tS,__i:-1,__u:0};return s==null&&Ge.vnode!=null&&Ge.vnode(i),i}function qu(t){return t.children}function dc(t,e){this.props=t,this.context=e}function _c(t,e){if(e==null)return t.__?_c(t.__,t.__i+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?_c(t):null}function cS(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return cS(t)}}function xb(t){(!t.__d&&(t.__d=!0)&&qo.push(t)&&!Nd.__r++||Cb!=Ge.debounceRendering)&&((Cb=Ge.debounceRendering)||nS)(Nd)}function Nd(){for(var t,e,r,n,s,i,o,a=1;qo.length;)qo.length>a&&qo.sort(sS),t=qo.shift(),a=qo.length,t.__d&&(r=void 0,n=void 0,s=(n=(e=t).__v).__e,i=[],o=[],e.__P&&((r=mi({},n)).__v=n.__v+1,Ge.vnode&&Ge.vnode(r),Uw(e.__P,r,n,e.__n,e.__P.namespaceURI,32&n.__u?[s]:null,i,s??_c(n),!!(32&n.__u),o),r.__v=n.__v,r.__.__k[r.__i]=r,hS(i,r,o),n.__e=n.__=null,r.__e!=s&&cS(r)));Nd.__r=0}function lS(t,e,r,n,s,i,o,a,c,l,u){var h,d,p,g,m,w,I,S=n&&n.__k||oS,v=e.length;for(c=SO(r,e,S,c,v),h=0;h<v;h++)(p=r.__k[h])!=null&&(d=p.__i==-1?Gl:S[p.__i]||Gl,p.__i=h,w=Uw(t,p,d,s,i,o,a,c,l,u),g=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&Bw(d.ref,null,p),u.push(p.ref,p.__c||g,p)),m==null&&g!=null&&(m=g),(I=!!(4&p.__u))||d.__k===p.__k?c=uS(p,c,t,I):typeof p.type=="function"&&w!==void 0?c=w:g&&(c=g.nextSibling),p.__u&=-7);return r.__e=m,c}function SO(t,e,r,n,s){var i,o,a,c,l,u=r.length,h=u,d=0;for(t.__k=new Array(s),i=0;i<s;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(c=i+d,(o=t.__k[i]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?ad(null,o,null,null,null):Tf(o)?ad(qu,{children:o},null,null,null):o.constructor==null&&o.__b>0?ad(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,(l=o.__i=CO(o,r,c,h))!=-1&&(h--,(a=r[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(s>u?d--:s<u&&d++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?d--:l==c+1?d++:(l>c?d--:d++,o.__u|=4))):t.__k[i]=null;if(h)for(i=0;i<u;i++)(a=r[i])!=null&&(2&a.__u)==0&&(a.__e==n&&(n=_c(a)),fS(a,a));return n}function uS(t,e,r,n){var s,i;if(typeof t.type=="function"){for(s=t.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=t,e=uS(s[i],e,r,n));return e}t.__e!=e&&(n&&(e&&t.type&&!e.parentNode&&(e=_c(t)),r.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function CO(t,e,r,n){var s,i,o,a=t.key,c=t.type,l=e[r],u=l!=null&&(2&l.__u)==0;if(l===null&&t.key==null||u&&a==l.key&&c==l.type)return r;if(n>(u?1:0)){for(s=r-1,i=r+1;s>=0||i<e.length;)if((l=e[o=s>=0?s--:i++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return o}return-1}function Ab(t,e,r){e[0]=="-"?t.setProperty(e,r??""):t[e]=r==null?"":typeof r!="number"||IO.test(e)?r:r+"px"}function mh(t,e,r,n,s){var i,o;e:if(e=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)r&&e in r||Ab(t.style,e,"");if(r)for(e in r)n&&r[e]==n[e]||Ab(t.style,e,r[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(iS,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=r,r?n?r.u=n.u:(r.u=Rw,t.addEventListener(e,i?Pm:km,i)):t.removeEventListener(e,i?Pm:km,i);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&r==1?"":r))}}function $b(t){return function(e){if(this.l){var r=this.l[e.type+t];if(e.t==null)e.t=Rw++;else if(e.t<r.u)return;return r(Ge.event?Ge.event(e):e)}}}function Uw(t,e,r,n,s,i,o,a,c,l){var u,h,d,p,g,m,w,I,S,v,b,C,N,P,R,O,M,j=e.type;if(e.constructor!=null)return null;128&r.__u&&(c=!!(32&r.__u),i=[a=e.__e=r.__e]),(u=Ge.__b)&&u(e);e:if(typeof j=="function")try{if(I=e.props,S="prototype"in j&&j.prototype.render,v=(u=j.contextType)&&n[u.__c],b=u?v?v.props.value:u.__:n,r.__c?w=(h=e.__c=r.__c).__=h.__E:(S?e.__c=h=new j(I,b):(e.__c=h=new dc(I,b),h.constructor=j,h.render=AO),v&&v.sub(h),h.props=I,h.state||(h.state={}),h.context=b,h.__n=n,d=h.__d=!0,h.__h=[],h._sb=[]),S&&h.__s==null&&(h.__s=h.state),S&&j.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=mi({},h.__s)),mi(h.__s,j.getDerivedStateFromProps(I,h.__s))),p=h.props,g=h.state,h.__v=e,d)S&&j.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),S&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(S&&j.getDerivedStateFromProps==null&&I!==p&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(I,b),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(I,h.__s,b)===!1||e.__v==r.__v){for(e.__v!=r.__v&&(h.props=I,h.state=h.__s,h.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.some(function(k){k&&(k.__=e)}),C=0;C<h._sb.length;C++)h.__h.push(h._sb[C]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(I,h.__s,b),S&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(p,g,m)})}if(h.context=b,h.props=I,h.__P=t,h.__e=!1,N=Ge.__r,P=0,S){for(h.state=h.__s,h.__d=!1,N&&N(e),u=h.render(h.props,h.state,h.context),R=0;R<h._sb.length;R++)h.__h.push(h._sb[R]);h._sb=[]}else do h.__d=!1,N&&N(e),u=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++P<25);h.state=h.__s,h.getChildContext!=null&&(n=mi(mi({},n),h.getChildContext())),S&&!d&&h.getSnapshotBeforeUpdate!=null&&(m=h.getSnapshotBeforeUpdate(p,g)),O=u,u!=null&&u.type===qu&&u.key==null&&(O=dS(u.props.children)),a=lS(t,Tf(O)?O:[O],e,r,n,s,i,o,a,c,l),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),w&&(h.__E=h.__=null)}catch(k){if(e.__v=null,c||i!=null)if(k.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else{for(M=i.length;M--;)Dw(i[M]);Rm(e)}else e.__e=r.__e,e.__k=r.__k,k.then||Rm(e);Ge.__e(k,e,r)}else i==null&&e.__v==r.__v?(e.__k=r.__k,e.__e=r.__e):a=e.__e=xO(r.__e,e,r,n,s,i,o,c,l);return(u=Ge.diffed)&&u(e),128&e.__u?void 0:a}function Rm(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Rm)}function hS(t,e,r){for(var n=0;n<r.length;n++)Bw(r[n],r[++n],r[++n]);Ge.__c&&Ge.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(i){i.call(s)})}catch(i){Ge.__e(i,s.__v)}})}function dS(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Tf(t)?t.map(dS):mi({},t)}function xO(t,e,r,n,s,i,o,a,c){var l,u,h,d,p,g,m,w=r.props,I=e.props,S=e.type;if(S=="svg"?s="http://www.w3.org/2000/svg":S=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(l=0;l<i.length;l++)if((p=i[l])&&"setAttribute"in p==!!S&&(S?p.localName==S:p.nodeType==3)){t=p,i[l]=null;break}}if(t==null){if(S==null)return document.createTextNode(I);t=document.createElementNS(s,S,I.is&&I),a&&(Ge.__m&&Ge.__m(e,i),a=!1),i=null}if(S==null)w===I||a&&t.data==I||(t.data=I);else{if(i=i&&Of.call(t.childNodes),w=r.props||Gl,!a&&i!=null)for(w={},l=0;l<t.attributes.length;l++)w[(p=t.attributes[l]).name]=p.value;for(l in w)if(p=w[l],l!="children"){if(l=="dangerouslySetInnerHTML")h=p;else if(!(l in I)){if(l=="value"&&"defaultValue"in I||l=="checked"&&"defaultChecked"in I)continue;mh(t,l,null,p,s)}}for(l in I)p=I[l],l=="children"?d=p:l=="dangerouslySetInnerHTML"?u=p:l=="value"?g=p:l=="checked"?m=p:a&&typeof p!="function"||w[l]===p||mh(t,l,p,w[l],s);if(u)a||h&&(u.__html==h.__html||u.__html==t.innerHTML)||(t.innerHTML=u.__html),e.__k=[];else if(h&&(t.innerHTML=""),lS(e.type=="template"?t.content:t,Tf(d)?d:[d],e,r,n,S=="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:r.__k&&_c(r,0),a,c),i!=null)for(l=i.length;l--;)Dw(i[l]);a||(l="value",S=="progress"&&g==null?t.removeAttribute("value"):g!=null&&(g!==t[l]||S=="progress"&&!g||S=="option"&&g!=w[l])&&mh(t,l,g,w[l],s),l="checked",m!=null&&m!=t[l]&&mh(t,l,m,w[l],s))}return t}function Bw(t,e,r){try{if(typeof t=="function"){var n=typeof t.__u=="function";n&&t.__u(),n&&e==null||(t.__u=t(e))}else t.current=e}catch(s){Ge.__e(s,r)}}function fS(t,e,r){var n,s;if(Ge.unmount&&Ge.unmount(t),(n=t.ref)&&(n.current&&n.current!=t.__e||Bw(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){Ge.__e(i,e)}n.base=n.__P=null}if(n=t.__k)for(s=0;s<n.length;s++)n[s]&&fS(n[s],e,r||typeof t.type!="function");r||Dw(t.__e),t.__c=t.__=t.__e=void 0}function AO(t,e,r){return this.constructor(t,r)}function Yc(t,e,r){var n,s,i,o;e==document&&(e=document.documentElement),Ge.__&&Ge.__(t,e),s=(n=!1)?null:e.__k,i=[],o=[],Uw(e,t=e.__k=aS(qu,null,[t]),s||Gl,Gl,e.namespaceURI,s?null:e.firstChild?Of.call(e.childNodes):null,i,s?s.__e:e.firstChild,n,o),hS(i,t,o)}Of=oS.slice,Ge={__e:function(t,e,r,n){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(t)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,n||{}),o=s.__d),o)return s.__E=s}catch(a){t=a}throw t}},tS=0,rS=function(t){return t!=null&&t.constructor==null},dc.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=mi({},this.state),typeof t=="function"&&(t=t(mi({},r),this.props)),t&&mi(r,t),t!=null&&this.__v&&(e&&this._sb.push(e),xb(this))},dc.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),xb(this))},dc.prototype.render=qu,qo=[],nS=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,sS=function(t,e){return t.__v.__b-e.__v.__b},Nd.__r=0,iS=/(PointerCapture)$|Capture$/i,Rw=0,km=$b(!1),Pm=$b(!0);var Yl,wt,xp,Nb,Dm=0,pS=[],Ct=Ge,Ob=Ct.__b,Tb=Ct.__r,kb=Ct.diffed,Pb=Ct.__c,Rb=Ct.unmount,Db=Ct.__;function Lw(t,e){Ct.__h&&Ct.__h(wt,t,Dm||e),Dm=0;var r=wt.__H||(wt.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function Um(t){return Dm=1,$O(mS,t)}function $O(t,e,r){var n=Lw(Yl++,2);if(n.t=t,!n.__c&&(n.__=[mS(void 0,e),function(a){var c=n.__N?n.__N[0]:n.__[0],l=n.t(c,a);c!==l&&(n.__N=[l,n.__[1]],n.__c.setState({}))}],n.__c=wt,!wt.__f)){var s=function(a,c,l){if(!n.__c.__H)return!0;var u=n.__c.__H.__.filter(function(d){return!!d.__c});if(u.every(function(d){return!d.__N}))return!i||i.call(this,a,c,l);var h=n.__c.props!==a;return u.forEach(function(d){if(d.__N){var p=d.__[0];d.__=d.__N,d.__N=void 0,p!==d.__[0]&&(h=!0)}}),i&&i.call(this,a,c,l)||h};wt.__f=!0;var i=wt.shouldComponentUpdate,o=wt.componentWillUpdate;wt.componentWillUpdate=function(a,c,l){if(this.__e){var u=i;i=void 0,s(a,c,l),i=u}o&&o.call(this,a,c,l)},wt.shouldComponentUpdate=s}return n.__N||n.__}function NO(t,e){var r=Lw(Yl++,3);!Ct.__s&&gS(r.__H,e)&&(r.__=t,r.u=e,wt.__H.__h.push(r))}function OO(t,e){var r=Lw(Yl++,7);return gS(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function TO(){for(var t;t=pS.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(cd),t.__H.__h.forEach(Bm),t.__H.__h=[]}catch(e){t.__H.__h=[],Ct.__e(e,t.__v)}}Ct.__b=function(t){wt=null,Ob&&Ob(t)},Ct.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Db&&Db(t,e)},Ct.__r=function(t){Tb&&Tb(t),Yl=0;var e=(wt=t.__c).__H;e&&(xp===wt?(e.__h=[],wt.__h=[],e.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(e.__h.forEach(cd),e.__h.forEach(Bm),e.__h=[],Yl=0)),xp=wt},Ct.diffed=function(t){kb&&kb(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(pS.push(e)!==1&&Nb===Ct.requestAnimationFrame||((Nb=Ct.requestAnimationFrame)||kO)(TO)),e.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),xp=wt=null},Ct.__c=function(t,e){e.some(function(r){try{r.__h.forEach(cd),r.__h=r.__h.filter(function(n){return!n.__||Bm(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],Ct.__e(n,r.__v)}}),Pb&&Pb(t,e)},Ct.unmount=function(t){Rb&&Rb(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{cd(n)}catch(s){e=s}}),r.__H=void 0,e&&Ct.__e(e,r.__v))};var Ub=typeof requestAnimationFrame=="function";function kO(t){var e,r=function(){clearTimeout(n),Ub&&cancelAnimationFrame(e),setTimeout(t)},n=setTimeout(r,35);Ub&&(e=requestAnimationFrame(r))}function cd(t){var e=wt,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),wt=e}function Bm(t){var e=wt;t.__c=t.__(),wt=e}function gS(t,e){return!t||t.length!==e.length||e.some(function(r,n){return r!==t[n]})}function mS(t,e){return typeof e=="function"?e(t):e}var PO=Symbol.for("preact-signals");function kf(){if(go>1)go--;else{for(var t,e=!1;Rl!==void 0;){var r=Rl;for(Rl=void 0,Lm++;r!==void 0;){var n=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&bS(r))try{r.c()}catch(s){e||(t=s,e=!0)}r=n}}if(Lm=0,go--,e)throw t}}function RO(t){if(go>0)return t();go++;try{return t()}finally{kf()}}var ze=void 0;function yS(t){var e=ze;ze=void 0;try{return t()}finally{ze=e}}var Rl=void 0,go=0,Lm=0,Od=0;function wS(t){if(ze!==void 0){var e=t.n;if(e===void 0||e.t!==ze)return e={i:0,S:t,p:ze.s,n:void 0,t:ze,e:void 0,x:void 0,r:e},ze.s!==void 0&&(ze.s.n=e),ze.s=e,t.n=e,32&ze.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=ze.s,e.n=void 0,ze.s.n=e,ze.s=e),e}}function ur(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}ur.prototype.brand=PO;ur.prototype.h=function(){return!0};ur.prototype.S=function(t){var e=this,r=this.t;r!==t&&t.e===void 0&&(t.x=r,this.t=t,r!==void 0?r.e=t:yS(function(){var n;(n=e.W)==null||n.call(e)}))};ur.prototype.U=function(t){var e=this;if(this.t!==void 0){var r=t.e,n=t.x;r!==void 0&&(r.x=n,t.e=void 0),n!==void 0&&(n.e=r,t.x=void 0),t===this.t&&(this.t=n,n===void 0&&yS(function(){var s;(s=e.Z)==null||s.call(e)}))}};ur.prototype.subscribe=function(t){var e=this;return ds(function(){var r=e.value,n=ze;ze=void 0;try{t(r)}finally{ze=n}},{name:"sub"})};ur.prototype.valueOf=function(){return this.value};ur.prototype.toString=function(){return this.value+""};ur.prototype.toJSON=function(){return this.value};ur.prototype.peek=function(){var t=ze;ze=void 0;try{return this.value}finally{ze=t}};Object.defineProperty(ur.prototype,"value",{get:function(){var t=wS(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(Lm>100)throw new Error("Cycle detected");this.v=t,this.i++,Od++,go++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{kf()}}}});function vt(t,e){return new ur(t,e)}function bS(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function vS(t){for(var e=t.s;e!==void 0;e=e.n){var r=e.S.n;if(r!==void 0&&(e.r=r),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function ES(t){for(var e=t.s,r=void 0;e!==void 0;){var n=e.p;e.i===-1?(e.S.U(e),n!==void 0&&(n.n=e.n),e.n!==void 0&&(e.n.p=n)):r=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=n}t.s=r}function xa(t,e){ur.call(this,void 0),this.x=t,this.s=void 0,this.g=Od-1,this.f=4,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}xa.prototype=new ur;xa.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Od))return!0;if(this.g=Od,this.f|=1,this.i>0&&!bS(this))return this.f&=-2,!0;var t=ze;try{vS(this),ze=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return ze=t,ES(this),this.f&=-2,!0};xa.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}ur.prototype.S.call(this,t)};xa.prototype.U=function(t){if(this.t!==void 0&&(ur.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};xa.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(xa.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=wS(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Ic(t,e){return new xa(t,e)}function _S(t){var e=t.u;if(t.u=void 0,typeof e=="function"){go++;var r=ze;ze=void 0;try{e()}catch(n){throw t.f&=-2,t.f|=8,Mw(t),n}finally{ze=r,kf()}}}function Mw(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,_S(t)}function DO(t){if(ze!==this)throw new Error("Out-of-order effect");ES(this),ze=t,this.f&=-2,8&this.f&&Mw(this),kf()}function jc(t,e){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=e?.name}jc.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}};jc.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,_S(this),vS(this),go++;var t=ze;return ze=this,DO.bind(this,t)};jc.prototype.N=function(){2&this.f||(this.f|=2,this.o=Rl,Rl=this)};jc.prototype.d=function(){this.f|=8,1&this.f||Mw(this)};jc.prototype.dispose=function(){this.d()};function ds(t,e){var r=new jc(t,e);try{r.c()}catch(s){throw r.d(),s}var n=r.d.bind(r);return n[Symbol.dispose]=n,n}var IS,Ap,SS=[];ds(function(){IS=this.N})();function Fc(t,e){Ge[t]=e.bind(null,Ge[t]||function(){})}function Td(t){Ap&&Ap(),Ap=t&&t.S()}function CS(t){var e=this,r=t.data,n=BO(r);n.value=r;var s=OO(function(){for(var a=e,c=e.__v;c=c.__;)if(c.__c){c.__c.__$f|=4;break}var l=Ic(function(){var p=n.value.value;return p===0?0:p===!0?"":p||""}),u=Ic(function(){return!Array.isArray(l.value)&&!rS(l.value)}),h=ds(function(){if(this.N=xS,u.value){var p=l.value;a.__v&&a.__v.__e&&a.__v.__e.nodeType===3&&(a.__v.__e.data=p)}}),d=e.__$u.d;return e.__$u.d=function(){h(),d.call(this)},[u,l]},[]),i=s[0],o=s[1];return i.value?o.peek():o.value}CS.displayName="ReactiveTextNode";Object.defineProperties(ur.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:CS},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});Fc("__b",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),typeof e.type=="string"){var r,n=e.props;for(var s in n)if(s!=="children"){var i=n[s];i instanceof ur&&(r||(e.__np=r={}),r[s]=i,n[s]=i.peek())}}t(e)});Fc("__r",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(e),e.type!==qu){Td();var r,n=e.__c;n&&(n.__$f&=-2,(r=n.__$u)===void 0&&(n.__$u=r=(function(s){var i;return ds(function(){i=this}),i.c=function(){n.__$f|=1,n.setState({})},i})())),Td(r)}t(e)});Fc("__e",function(t,e,r,n){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),Td(),t(e,r,n)});Fc("diffed",function(t,e){typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),Td();var r;if(typeof e.type=="string"&&(r=e.__e)){var n=e.__np,s=e.props;if(n){var i=r.U;if(i)for(var o in i){var a=i[o];a!==void 0&&!(o in n)&&(a.d(),i[o]=void 0)}else i={},r.U=i;for(var c in n){var l=i[c],u=n[c];l===void 0?(l=UO(r,c,u,s),i[c]=l):l.o(u,s)}}}t(e)});function UO(t,e,r,n){var s=e in t&&t.ownerSVGElement===void 0,i=vt(r);return{o:function(o,a){i.value=o,n=a},d:ds(function(){this.N=xS;var o=i.value.value;n[e]!==o&&(n[e]=o,s?t[e]=o:o?t.setAttribute(e,o):t.removeAttribute(e))})}}Fc("unmount",function(t,e){if(typeof e.type=="string"){var r=e.__e;if(r){var n=r.U;if(n){r.U=void 0;for(var s in n){var i=n[s];i&&i.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}t(e)});Fc("__h",function(t,e,r,n){(n<3||n===9)&&(e.__$f|=2),t(e,r,n)});dc.prototype.shouldComponentUpdate=function(t,e){var r=this.__$u,n=r&&r.s!==void 0;for(var s in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var i=2&this.__$f;if(!(n||i||4&this.__$f)||1&this.__$f)return!0}else if(!(n||4&this.__$f)||3&this.__$f)return!0;for(var o in t)if(o!=="__source"&&t[o]!==this.props[o])return!0;for(var a in this.props)if(!(a in t))return!0;return!1};function BO(t,e){return Um(function(){return vt(t,e)})[0]}var LO=function(t){queueMicrotask(function(){queueMicrotask(t)})};function MO(){RO(function(){for(var t;t=SS.shift();)IS.call(t)})}function xS(){SS.push(this)===1&&(Ge.requestAnimationFrame||LO)(MO)}var AS=function(t,e,r,n){var s;e[0]=0;for(var i=1;i<e.length;i++){var o=e[i++],a=e[i]?(e[0]|=o?1:2,r[e[i++]]):e[++i];o===3?n[0]=a:o===4?n[1]=Object.assign(n[1]||{},a):o===5?(n[1]=n[1]||{})[e[++i]]=a:o===6?n[1][e[++i]]+=a+"":o?(s=t.apply(a,AS(t,a,r,["",null])),n.push(s),a[0]?e[0]|=2:(e[i-2]=0,e[i]=s)):n.push(a)}return n},Bb=new Map;function jO(t){var e=Bb.get(this);return e||(e=new Map,Bb.set(this,e)),(e=AS(this,e.get(t)||(e.set(t,e=(function(r){for(var n,s,i=1,o="",a="",c=[0],l=function(d){i===1&&(d||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?c.push(0,d,o):i===3&&(d||o)?(c.push(3,d,o),i=2):i===2&&o==="..."&&d?c.push(4,d,0):i===2&&o&&!d?c.push(5,0,!0,o):i>=5&&((o||!d&&i===5)&&(c.push(i,0,o,s),i=6),d&&(c.push(i,d,0,s),i=6)),o=""},u=0;u<r.length;u++){u&&(i===1&&l(),l(u));for(var h=0;h<r[u].length;h++)n=r[u][h],i===1?n==="<"?(l(),c=[c],i=3):o+=n:i===4?o==="--"&&n===">"?(i=1,o=""):o=n+o[0]:a?n===a?a="":o+=n:n==='"'||n==="'"?a=n:n===">"?(l(),i=1):i&&(n==="="?(i=5,s=o,o=""):n==="/"&&(i<5||r[u][h+1]===">")?(l(),i===3&&(c=c[0]),i=c,(c=c[0]).push(2,0,i),i=0):n===" "||n==="	"||n===`
`||n==="\r"?(l(),i=2):o+=n),i===3&&o==="!--"&&(i=4,c=c[0])}return l(),c})(t)),e),arguments,[])).length>1?e:e[0]}var tt=jO.bind(aS),ls=(function(t){return t.AUTH_OPTIONS="AUTH_OPTIONS",t.HELP_PAGE="HELP_PAGE",t.PROFILE_PAGE="PROFILE_PAGE",t.HW_ACCOUNTS_FETCHER="HW_ACCOUNTS_FETCHER",t})({}),Zo=(function(t){return t.FIXED="FIXED",t.BLOCK="BLOCK",t.HIDDEN="HIDDEN",t})({});const $S={background:"#fcfcfcff","background-secondary":"#f8f8f8ff","foreground-strong":"#000000",foreground:"#161619ff","foreground-secondary":"#2d2d31ff",primary:"#3b82f6","primary-foreground":"#ffffff",transparent:"rgba(0, 0, 0, 0)",lighter:"#fcfcfc",light:"#f8f8f8","light-gray":"oklch(0.800 0.006 286.033)",gray:"oklch(0.600 0.006 286.033)",danger:"oklch(57.7% 0.245 27.325)",border:"rgba(0, 0, 0, 0.15)",shadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1)","border-radius":"0.5rem","font-family":"sans-serif"},FO={background:"oklch(0.333 0 89.876)","background-secondary":"oklch(0 0 0)","foreground-strong":"#fff",foreground:"oklch(0.985 0 0)","foreground-secondary":"oklch(0.97 0 0)",primary:"#e0e0e0","primary-foreground":"#1e1e1e",transparent:"rgba(0, 0, 0, 0)",lighter:"#fcfcfc",light:"#f8f8f8","light-gray":"oklch(0.800 0.006 286.033)",gray:"oklch(0.600 0.006 286.033)",danger:"oklch(57.7% 0.245 27.325)",border:"rgba(58,58,58,0.15)",shadow:"0 10px 15px -3px rgba(255, 255, 255, 0.1), 0 4px 6px -4px rgba(255, 255, 255, 0.1)","border-radius":"0.5rem","font-family":"sans-serif"};var bn=(function(t){return t.usedWalletsIds="@StellarWalletsKit/usedWalletsIds",t.activeAddress="@StellarWalletsKit/activeAddress",t.selectedModuleId="@StellarWalletsKit/selectedModuleId",t.hardwareWalletPaths="@StellarWalletsKit/hardwareWalletPaths",t.wcSessionPaths="@StellarWalletsKit/wcSessionPaths",t})({}),ld=(function(t){return t.PUBLIC="Public Global Stellar Network ; September 2015",t.TESTNET="Test SDF Network ; September 2015",t.FUTURENET="Test SDF Future Network ; October 2022",t.SANDBOX="Local Sandbox Stellar Network ; September 2022",t.STANDALONE="Standalone Network ; February 2017",t})({}),NS=(function(t){return t.HW_WALLET="HW_WALLET",t.HOT_WALLET="HOT_WALLET",t.BRIDGE_WALLET="BRIDGE_WALLET",t.AIR_GAPED_WALLET="AIR_GAPED_WALLET",t})({}),Gi=(function(t){return t.STATE_UPDATED="STATE_UPDATE",t.WALLET_SELECTED="WALLET_SELECTED",t.DISCONNECT="DISCONNECT",t})({});const Pf=globalThis.localStorage,kd=vt(Zo.FIXED),Rf=vt("Connect a Wallet"),OS=vt(!0),qO=vt(!0),zO=vt("Install");vt("https://horizon.stellar.org");const xs=vt(ld.PUBLIC),TS=vt($S),Df=vt(ls.AUTH_OPTIONS),ga=vt([ls.AUTH_OPTIONS]),gt=vt(Pf?.getItem(bn.activeAddress)||void 0),yi=vt(Pf?.getItem(bn.selectedModuleId)||void 0),kS=vt([]),Dl=vt([]),vn=Ic(()=>Dl.value.find(t=>t.productId===yi.value)),HO=Pf?.getItem(bn.hardwareWalletPaths),Zl=vt(JSON.parse(HO||"[]"));Ic(()=>{const t=Zl.value.find(({publicKey:e})=>e===gt.value);if(t)return`44'/148'/${t.index}'`});const VO=Pf?.getItem(bn.wcSessionPaths),ai=vt(JSON.parse(VO||"[]"));function WO(){ga.value=[],Zl.value=[],ai.value=[],gt.value=void 0,yi.value=void 0}function Uf(){const t=vt(null);let e="active",r=null;const n=new Set,s=new Set,i=new Set;ds(()=>{if(e==="active"&&t.value!==null){const a=t.value;t.value=null;for(const c of n)c(a)}});function o(){n.clear(),s.clear(),i.clear()}return{next(a){e==="active"&&(t.value=a)},error(a){if(e==="active"){e="error",r=a;for(const c of s)c(a);o()}},complete(){if(e==="active"){e="completed";for(const a of i)a();o()}},subscribe(a,c,l){return e==="error"?(c?.(r),()=>{}):e==="completed"?(l?.(),()=>{}):(a&&n.add(a),c&&s.add(c),l&&i.add(l),()=>{a&&n.delete(a),c&&s.delete(c),l&&i.delete(l)})},isCompleted(){return e==="completed"},hasError(){return e==="error"}}}const KO=Uf(),Pd=Uf(),Jl=Uf(),PS=Uf(),As=globalThis.localStorage,Lb=globalThis.document;ds(()=>{if(Lb)for(const[t,e]of Object.entries(TS.value))Lb.documentElement.style.setProperty(`--swk-${t}`,e)});ds(()=>{if(As&&vn.value)try{const t=As.getItem(bn.usedWalletsIds),e=t?new Set(JSON.parse(t)):new Set;e.has(vn.value.productId)&&e.delete(vn.value.productId),As.setItem(bn.usedWalletsIds,JSON.stringify([vn.value.productId,...e]))}catch(t){console.error(t)}});ds(()=>{As&&(gt.value?As.setItem(bn.activeAddress,gt.value):As.removeItem(bn.activeAddress),yi.value?As.setItem(bn.selectedModuleId,yi.value):As.removeItem(bn.selectedModuleId),typeof Zl.value<"u"&&As.setItem(bn.hardwareWalletPaths,JSON.stringify(Zl.value)),typeof ai.value<"u"&&As.setItem(bn.wcSessionPaths,JSON.stringify(ai.value)))});let $p;function jw(t){return[...t.v,(t.i?"!":"")+t.n].join(":")}function RS(t,e=","){return t.map(jw).join(e)}let Fw=typeof CSS<"u"&&CSS.escape||(t=>t.replace(/[!"'`*+.,;:\\/<=>?@#$%&^|~()[\]{}]/g,"\\$&").replace(/^\d/,"\\3$& "));function Sc(t){for(var e=9,r=t.length;r--;)e=Math.imul(e^t.charCodeAt(r),1597334677);return"#"+((e^e>>>9)>>>0).toString(36)}function qw(t,e="@media "){return e+st(t).map(r=>(typeof r=="string"&&(r={min:r}),r.raw||Object.keys(r).map(n=>`(${n}-width:${r[n]})`).join(" and "))).join(",")}function st(t=[]){return Array.isArray(t)?t:t==null?[]:[t]}function Mb(t){return t}function Bf(){}let ar={d:0,b:134217728,c:268435456,a:671088640,u:805306368,o:939524096};function DS(t){return t.match(/[-=:;]/g)?.length||0}function Mm(t){return Math.min(/(?:^|width[^\d]+)(\d+(?:.\d+)?)(p)?/.test(t)?Math.max(0,29.63*(+RegExp.$1/(RegExp.$2?15:1))**.137-43):0,15)<<22|Math.min(DS(t),15)<<18}let GO=["rst-c","st-ch","h-chi","y-lin","nk","sited","ecked","pty","ad-on","cus-w","ver","cus","cus-v","tive","sable","tiona","quire"];function zw({n:t,i:e,v:r=[]},n,s,i){t&&(t=jw({n:t,i:e,v:r})),i=[...st(i)];for(let a of r){let c=n.theme("screens",a);for(let l of st(c&&qw(c)||n.v(a))){var o;i.push(l),s|=c?67108864|Mm(l):a=="dark"?1073741824:l[0]=="@"?Mm(l):(o=l,1<<~(/:([a-z-]+)/.test(o)&&~GO.indexOf(RegExp.$1.slice(2,7))||-18))}}return{n:t,p:s,r:i,i:e}}let Hw=new Map;function jm(t){if(t.d){let e=[],r=Np(t.r.reduce((n,s)=>s[0]=="@"?(e.push(s),n):s?Np(n,i=>Np(s,o=>{let a=/(:merge\(.+?\))(:[a-z-]+|\\[.+])/.exec(o);if(a){let c=i.indexOf(a[1]);return~c?i.slice(0,c)+a[0]+i.slice(c+a[1].length):Op(i,o)}return Op(o,i)})):n,"&"),n=>Op(n,t.n?"."+Fw(t.n):""));return r&&e.push(r.replace(/:merge\((.+?)\)/g,"$1")),e.reduceRight((n,s)=>s+"{"+n+"}",t.d)}}function Np(t,e){return t.replace(/ *((?:\(.+?\)|\[.+?\]|[^,])+) *(,|$)/g,(r,n,s)=>e(n)+s)}function Op(t,e){return t.replace(/&/g,e)}let jb=new Intl.Collator("en",{numeric:!0});function US(t,e){for(var r=0,n=t.length;r<n;){let s=n+r>>1;0>=BS(t[s],e)?r=s+1:n=s}return n}function BS(t,e){let r=t.p&ar.o;return r==(e.p&ar.o)&&(r==ar.b||r==ar.o)?0:t.p-e.p||t.o-e.o||jb.compare(Fb(t.n),Fb(e.n))||jb.compare(qb(t.n),qb(e.n))}function Fb(t){return(t||"").split(/:/).pop().split("/").pop()||"\0"}function qb(t){return(t||"").replace(/\W/g,e=>String.fromCharCode(127+e.charCodeAt(0)))+"\0"}function Tp(t,e){return Math.round(parseInt(t,16)*e)}function fo(t,e={}){if(typeof t=="function")return t(e);let{opacityValue:r="1",opacityVariable:n}=e,s=n?`var(${n})`:r;if(t.includes("<alpha-value>"))return t.replace("<alpha-value>",s);if(t[0]=="#"&&(t.length==4||t.length==7)){let i=(t.length-1)/3,o=[17,1,.062272][i-1];return`rgba(${[Tp(t.substr(1,i),o),Tp(t.substr(1+i,i),o),Tp(t.substr(1+2*i,i),o),s]})`}return s=="1"?t:s=="0"?"#0000":t.replace(/^(rgb|hsl)(\([^)]+)\)$/,`$1a$2,${s})`)}function Vw(t,e,r,n,s=[]){return(function i(o,{n:a,p:c,r:l=[],i:u},h){let d=[],p="",g=0,m=0;for(let S in o||{}){var w,I;let v=o[S];if(S[0]=="@"){if(!v)continue;if(S[1]=="a"){d.push(...Gw(a,c,Xl(""+v),h,c,l,u,!0));continue}if(S[1]=="l"){for(let b of st(v))d.push(...i(b,{n:a,p:(w=ar[S[7]],c&-939524097|w),r:S[7]=="d"?[]:l,i:u},h));continue}if(S[1]=="i"){d.push(...st(v).map(b=>({p:-1,o:0,r:[],d:S+" "+b})));continue}if(S[1]=="k"){d.push({p:ar.d,o:0,r:[S],d:i(v,{p:ar.d},h).map(jm).join("")});continue}if(S[1]=="f"){d.push(...st(v).map(b=>({p:ar.d,o:0,r:[S],d:i(b,{p:ar.d},h).map(jm).join("")})));continue}}if(typeof v!="object"||Array.isArray(v))S=="label"&&v?a=v+Sc(JSON.stringify([c,u,o])):(v||v===0)&&(S=S.replace(/[A-Z]/g,b=>"-"+b.toLowerCase()),m+=1,g=Math.max(g,(I=S)[0]=="-"?0:DS(I)+(/^(?:(border-(?!w|c|sty)|[tlbr].{2,4}m?$|c.{7,8}$)|([fl].{5}l|g.{8}$|pl))/.test(I)?+!!RegExp.$1||-!!RegExp.$2:0)+1),p+=(p?";":"")+st(v).map(b=>h.s(S,Ww(""+b,h.theme)+(u?" !important":""))).join(";"));else if(S[0]=="@"||S.includes("&")){let b=c;S[0]=="@"&&(S=S.replace(/\bscreen\(([^)]+)\)/g,(C,N)=>{let P=h.theme("screens",N);return P?(b|=67108864,qw(P,"")):C}),b|=Mm(S)),d.push(...i(v,{n:a,p:b,r:[...l,S],i:u},h))}else d.push(...i(v,{p:c,r:[...l,S]},h))}return d.unshift({n:a,p:c,o:Math.max(0,15-m)+1.5*Math.min(g||15,15),r:l,d:p}),d.sort(BS)})(t,zw(e,r,n,s),r)}function Ww(t,e){return t.replace(/theme\((["'`])?(.+?)\1(?:\s*,\s*(["'`])?(.+?)\3)?\)/g,(r,n,s,i,o="")=>{let a=e(s,o);return typeof a=="function"&&/color|fill|stroke/i.test(s)?fo(a):""+st(a).filter(c=>Object(c)!==c)})}function Kw(t,e){let r,n=[];for(let s of t)s.d&&s.n?r?.p==s.p&&""+r.r==""+s.r?(r.c=[r.c,s.c].filter(Boolean).join(" "),r.d=r.d+";"+s.d):n.push(r={...s,n:s.n&&e}):n.push({...s,n:s.n&&e});return n}function Rd(t,e,r=ar.u,n,s){let i=[];for(let o of t)for(let a of(function(c,l,u,h,d){c={...c,i:c.i||d};let p=(function(g,m){let w=Hw.get(g.n);return w?w(g,m):m.r(g.n,g.v[0]=="dark")})(c,l);return p?typeof p=="string"?({r:h,p:u}=zw(c,l,u,h),Kw(Rd(Xl(p),l,u,h,c.i),c.n)):Array.isArray(p)?p.map(g=>{var m,w;return{o:0,...g,r:[...st(h),...st(g.r)],p:(m=u,w=g.p??u,m&-939524097|w)}}):Vw(p,c,l,u,h):[{c:jw(c),p:0,o:0,r:[]}]})(o,e,r,n,s))i.splice(US(i,a),0,a);return i}function Gw(t,e,r,n,s,i,o,a){return Kw((a?r.flatMap(c=>Rd([c],n,s,i,o)):Rd(r,n,s,i,o)).map(c=>c.p&ar.o&&(c.n||e==ar.b)?{...c,p:c.p&-939524097|e,o:0}:c),t)}function YO(t,e,r,n){var s;return s=(i,o)=>{let{n:a,p:c,r:l,i:u}=zw(i,o,e);return r&&Gw(a,e,r,o,c,l,u,n)},Hw.set(t,s),t}function kp(t,e,r){if(t[t.length-1]!="("){let n=[],s=!1,i=!1,o="";for(let a of t)if(!(a=="("||/[~@]$/.test(a))){if(a[0]=="!"&&(a=a.slice(1),s=!s),a.endsWith(":")){n[a=="dark:"?"unshift":"push"](a.slice(0,-1));continue}a[0]=="-"&&(a=a.slice(1),i=!i),a.endsWith("-")&&(a=a.slice(0,-1)),a&&a!="&"&&(o+=(o&&"-")+a)}o&&(i&&(o="-"+o),e[0].push({n:o,v:n.filter(ZO),i:s}))}}function ZO(t,e,r){return r.indexOf(t)==e}let zb=new Map;function Xl(t){let e=zb.get(t);if(!e){let r=[],n=[[]],s=0,i=0,o=null,a=0,c=(l,u=0)=>{s!=a&&(r.push(t.slice(s,a+u)),l&&kp(r,n)),s=a+1};for(;a<t.length;a++){let l=t[a];if(i)t[a-1]!="\\"&&(i+=+(l=="[")||-(l=="]"));else if(l=="[")i+=1;else if(o)t[a-1]!="\\"&&o.test(t.slice(a))&&(o=null,s=a+RegExp.lastMatch.length);else if(l=="/"&&t[a-1]!="\\"&&(t[a+1]=="*"||t[a+1]=="/"))o=t[a+1]=="*"?/^\*\//:/^[\r\n]/;else if(l=="(")c(),r.push(l);else if(l==":")t[a+1]!=":"&&c(!1,1);else if(/[\s,)]/.test(l)){c(!0);let u=r.lastIndexOf("(");if(l==")"){let h=r[u-1];if(/[~@]$/.test(h)){let d=n.shift();r.length=u,kp([...r,"#"],n);let{v:p}=n[0].pop();for(let g of d)g.v.splice(+(g.v[0]=="dark")-+(p[0]=="dark"),p.length);kp([...r,YO(h.length>1?h.slice(0,-1)+Sc(JSON.stringify([h,d])):h+"("+RS(d)+")",ar.a,d,/@$/.test(h))],n)}u=r.lastIndexOf("(",u-1)}r.length=u+1}else/[~@]/.test(l)&&t[a+1]=="("&&n.unshift([])}c(!0),zb.set(t,e=n[0])}return e}function LS(t,e,r){return e.reduce((n,s,i)=>n+r(s)+t[i+1],t[0])}function Yw(t,e){return Array.isArray(t)&&Array.isArray(t.raw)?LS(t,e,r=>Pp(r).trim()):e.filter(Boolean).reduce((r,n)=>r+Pp(n),t?Pp(t):"")}function Pp(t){let e,r="";if(t&&typeof t=="object")if(Array.isArray(t))(e=Yw(t[0],t.slice(1)))&&(r+=" "+e);else for(let n in t)t[n]&&(r+=" "+n);else t!=null&&typeof t!="boolean"&&(r+=" "+t);return r}function Dd(t,e){return Array.isArray(t)?Hb(LS(t,e,r=>r!=null&&typeof r!="boolean"?r:"")):typeof t=="string"?Hb(t):[t]}let JO=/ *(?:(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}))/g;function Hb(t){let e;t=t.replace(/\/\*[^]*?\*\/|\s\s+|\n/gm," ");let r=[{}],n=[r[0]],s=[];for(;e=JO.exec(t);)e[4]&&(r.shift(),s.shift()),e[3]?(s.unshift(e[3]),r.unshift({}),n.push(s.reduce((i,o)=>({[o]:i}),r[0]))):e[4]||(r[0][e[1]]&&(r.unshift({}),n.push(s.reduce((i,o)=>({[o]:i}),r[0]))),r[0][e[1]]=e[2]);return n}function Lf(t,...e){var r;let n=Dd(t,e),s=(n.find(i=>i.label)?.label||"css")+Sc(JSON.stringify(n));return r=(i,o)=>Kw(n.flatMap(a=>Vw(a,i,o,ar.o)),s),Hw.set(s,r),s}function te(t,e,r){return[t,Fm(e,r)]}function Fm(t,e){return typeof t=="function"?t:typeof t=="string"&&/^[\w-]+$/.test(t)?((r,n)=>({[t]:e?e(r,n):qm(r,1)})):r=>t||{[r[1]]:qm(r,2)}}function qm(t,e,r=t.slice(e).find(Boolean)||t.$$||t.input){return t.input[0]=="-"?`calc(${r} * -1)`:r}function se(t,e,r,n){return[t,XO(e,r,n)]}function XO(t,e,r){let n=typeof e=="string"?(s,i)=>({[e]:r?r(s,i):s._}):e||(({1:s,_:i},o,a)=>({[s||a]:i}));return(s,i)=>{let o=MS(t||s[1]),a=i.theme(o,s.$$)??po(s.$$,o,i);if(a!=null)return s._=qm(s,0,a),n(s,i,o)}}function Mt(t,e={},r){return[t,QO(e,r)]}function QO(t={},e){return(r,n)=>{let{section:s=MS(r[0]).replace("-","")+"Color"}=t,[i,o]=eT(r.$$);if(!i)return;let a=n.theme(s,i)||po(i,s,n);if(!a||typeof a=="object")return;let{opacityVariable:c=`--tw-${r[0].replace(/-$/,"")}-opacity`,opacitySection:l=s.replace("Color","Opacity"),property:u=s,selector:h}=t,d=n.theme(l,o||"DEFAULT")||o&&po(o,l,n),p=e||(({_:m})=>{let w=ud(u,m);return h?{[h]:w}:w});r._={value:fo(a,{opacityVariable:c||void 0,opacityValue:d||void 0}),color:m=>fo(a,m),opacityVariable:c||void 0,opacityValue:d||void 0};let g=p(r,n);if(!r.dark){let m=n.d(s,i,a);m&&m!==a&&(r._={value:fo(m,{opacityVariable:c||void 0,opacityValue:d||"1"}),color:w=>fo(m,w),opacityVariable:c||void 0,opacityValue:d||void 0},g={"&":g,[n.v("dark")]:p(r,n)})}return g}}function eT(t){return(t.match(/^(\[[^\]]+]|[^/]+?)(?:\/(.+))?$/)||[]).slice(1)}function ud(t,e){let r={};return typeof e=="string"?r[t]=e:(e.opacityVariable&&e.value.includes(e.opacityVariable)&&(r[e.opacityVariable]=e.opacityValue||"1"),r[t]=e.value),r}function po(t,e,r){if(t[0]=="["&&t.slice(-1)=="]"){if(t=Ql(Ww(t.slice(1,-1),r.theme)),!e)return t;if(!(/color|fill|stroke/i.test(e)&&!(/^color:/.test(t)||/^(#|((hsl|rgb)a?|hwb|lab|lch|color)\(|[a-z]+$)/.test(t))||/image/i.test(e)&&!(/^image:/.test(t)||/^[a-z-]+\(/.test(t))||/weight/i.test(e)&&!(/^(number|any):/.test(t)||/^\d+$/.test(t))||/position/i.test(e)&&/^(length|size):/.test(t)))return t.replace(/^[a-z-]+:/,"")}}function MS(t){return t.replace(/-./g,e=>e[1].toUpperCase())}function Ql(t){return t.includes("url(")?t.replace(/(.*?)(url\(.*?\))(.*?)/g,(e,r="",n,s="")=>Ql(r)+n+Ql(s)):t.replace(/(^|[^\\])_+/g,(e,r)=>r+" ".repeat(e.length-r.length)).replace(/\\_/g,"_").replace(/(calc|min|max|clamp)\(.+\)/g,e=>e.replace(/(-?\d*\.?\d(?!\b-.+[,)](?![^+\-/*])\D)(?:%|[a-z]+)?|\))([+\-/*])/g,"$1 $2 "))}function zo(t,...e){return RS(Xl(Yw(t,e))," ")}function jS({presets:t=[],...e}){let r={darkMode:void 0,darkColor:void 0,preflight:e.preflight!==!1&&[],theme:{},variants:st(e.variants),rules:st(e.rules),ignorelist:st(e.ignorelist),hash:void 0,stringify:(n,s)=>n+":"+s,finalize:[]};for(let n of st([...t,{darkMode:e.darkMode,darkColor:e.darkColor,preflight:e.preflight!==!1&&st(e.preflight),theme:e.theme,hash:e.hash,stringify:e.stringify,finalize:e.finalize}])){let{preflight:s,darkMode:i=r.darkMode,darkColor:o=r.darkColor,theme:a,variants:c,rules:l,ignorelist:u,hash:h=r.hash,stringify:d=r.stringify,finalize:p}=typeof n=="function"?n(r):n;r={preflight:r.preflight!==!1&&s!==!1&&[...r.preflight,...st(s)],darkMode:i,darkColor:o,theme:{...r.theme,...a,extend:{...r.theme.extend,...a?.extend}},variants:[...r.variants,...st(c)],rules:[...r.rules,...st(l)],ignorelist:[...r.ignorelist,...st(u)],hash:h,stringify:d,finalize:[...r.finalize,...st(p)]}}return r}function Vb(t,e,r,n,s,i){for(let o of e){let a=r.get(o);a||r.set(o,a=n(o));let c=a(t,s,i);if(c)return c}}function tT(t){var e;return zm(t[0],typeof(e=t[1])=="function"?e:()=>e)}function rT(t){var e,r;return Array.isArray(t)?zm(t[0],Fm(t[1],t[2])):zm(t,Fm(e,r))}function zm(t,e){return FS(t,(r,n,s,i)=>{let o=n.exec(r);if(o)return o.$$=r.slice(o[0].length),o.dark=i,e(o,s)})}function FS(t,e){let r=st(t).map(nT);return(n,s,i)=>{for(let o of r){let a=e(n,o,s,i);if(a)return a}}}function nT(t){return typeof t=="string"?RegExp("^"+t+(t.includes("$")||t.slice(-1)=="-"?"":"$")):t}function sT(t,e){let r=jS(t),n=(function({theme:c,darkMode:l,darkColor:u=Bf,variants:h,rules:d,hash:p,stringify:g,ignorelist:m,finalize:w}){let I=new Map,S=new Map,v=new Map,b=new Map,C=FS(m,(R,O)=>O.test(R));h.push(["dark",Array.isArray(l)||l=="class"?`${st(l)[1]||".dark"} &`:typeof l=="string"&&l!="media"?l:"@media (prefers-color-scheme:dark)"]);let N=typeof p=="function"?R=>p(R,Sc):p?Sc:Mb;N!==Mb&&w.push(R=>({...R,n:R.n&&N(R.n),d:R.d?.replace(/--(tw(?:-[\w-]+)?)\b/g,(O,M)=>"--"+N(M).replace("#",""))}));let P={theme:(function({extend:R={},...O}){let M={},j={get colors(){return k("colors")},theme:k,negative(){return{}},breakpoints(T){let f={};for(let y in T)typeof T[y]=="string"&&(f["screen-"+y]=T[y]);return f}};return k;function k(T,f,y,E){if(T){if({1:T,2:E}=/^(\S+?)(?:\s*\/\s*([^/]+))?$/.exec(T)||[,T],/[.[]/.test(T)){let L=[];T.replace(/\[([^\]]+)\]|([^.[]+)/g,(B,q,D=q)=>L.push(D)),T=L.shift(),y=f,f=L.join("-")}let _=M[T]||Object.assign(Object.assign(M[T]={},$(O,T)),$(R,T));if(f==null)return _;f||(f="DEFAULT");let A=_[f]??f.split("-").reduce((L,B)=>L?.[B],_)??y;return E?fo(A,{opacityValue:Ww(E,k)}):A}let x={};for(let _ of[...Object.keys(O),...Object.keys(R)])x[_]=k(_);return x}function $(T,f){let y=T[f];return typeof y=="function"&&(y=y(j)),y&&/color|fill|stroke/i.test(f)?(function E(x,_=[]){let A={};for(let L in x){let B=x[L],q=[..._,L];A[q.join("-")]=B,L=="DEFAULT"&&(q=_,A[_.join("-")]=B),typeof B=="object"&&Object.assign(A,E(B,q))}return A})(y):y}})(c),e:Fw,h:N,s(R,O){return g(R,O,P)},d(R,O,M){return u(R,O,P,M)},v(R){return I.has(R)||I.set(R,Vb(R,h,S,tT,P)||"&:"+R),I.get(R)},r(R,O){let M=JSON.stringify([R,O]);return v.has(M)||v.set(M,!C(R,P)&&Vb(R,d,b,rT,P,O)),v.get(M)},f(R){return w.reduce((O,M)=>M(O,P),R)}};return P})(r),s=new Map,i=[],o=new Set;e.resume(c=>s.set(c,c),(c,l)=>{e.insert(c,i.length,l),i.push(l),o.add(c)});function a(c){let l=n.f(c),u=jm(l);if(u&&!o.has(u)){o.add(u);let h=US(i,c);e.insert(u,h,c),i.splice(h,0,c)}return l.n}return Object.defineProperties(function(l){if(!s.size)for(let h of st(r.preflight))typeof h=="function"&&(h=h(n)),h&&(typeof h=="string"?Gw("",ar.b,Xl(h),n,ar.b,[],!1,!0):Vw(h,{},n,ar.b)).forEach(a);l=""+l;let u=s.get(l);if(!u){let h=new Set;for(let d of Rd(Xl(l),n))h.add(d.c).add(a(d));u=[...h].filter(Boolean).join(" "),s.set(l,u).set(u,u)}return u},Object.getOwnPropertyDescriptors({get target(){return e.target},theme:n.theme,config:r,snapshot(){let c=e.snapshot(),l=new Set(o),u=new Map(s),h=[...i];return()=>{c(),o=l,s=u,i=h}},clear(){e.clear(),o=new Set,s=new Map,i=[]},destroy(){this.clear(),e.destroy()}}))}function iT(t){let e=document.querySelector(t);return(!e||e.tagName!="STYLE")&&(e=document.createElement("style"),document.head.prepend(e)),e.dataset.twind="claimed",e}function oT(t){let e=t?.cssRules?t:iT(t).sheet;return{target:e,snapshot(){let r=Array.from(e.cssRules,n=>n.cssText);return()=>{this.clear(),r.forEach(this.insert)}},clear(){for(let r=e.cssRules.length;r--;)e.deleteRule(r)},destroy(){e.ownerNode?.remove()},insert(r,n){try{e.insertRule(r,n)}catch{e.insertRule(":root{}",n)}},resume:Bf}}function aT(t){let e=[];return{target:e,snapshot(){let r=[...e];return()=>{e.splice(0,e.length,...r)}},clear(){e.length=0},destroy(){this.clear()},insert(r,n,s){e.splice(n,0,r)},resume:Bf}}let Zw=new Proxy(Bf,{apply(t,e,r){return $p(r[0])},get(t,e){let r=$p[e];return typeof r=="function"?function(){return r.apply($p,arguments)}:r}}),cT=function(t,...e){(typeof this=="function"?this:Zw)(Lf({"@layer base":Dd(t,e)}))},lT=(function t(e){return new Proxy(function(n,...s){return Wb(e,"",n,s)},{get(r,n){return n==="bind"?t:n in r?r[n]:function(i,...o){return Wb(e,n,i,o)}}})})();function Wb(t,e,r,n){return{toString(){let s=Dd(r,n),i=Fw(e+Sc(JSON.stringify([e,s])));return(typeof t=="function"?t:Zw)(Lf({[`@keyframes ${i}`]:Dd(r,n)})),i}}}let uT=function(t,...e){return(typeof this=="function"?this:Zw)(Yw(t,e))};var hT=new Map([["align-self","-ms-grid-row-align"],["color-adjust","-webkit-print-color-adjust"],["column-gap","grid-column-gap"],["forced-color-adjust","-ms-high-contrast-adjust"],["gap","grid-gap"],["grid-template-columns","-ms-grid-columns"],["grid-template-rows","-ms-grid-rows"],["justify-self","-ms-grid-column-align"],["margin-inline-end","-webkit-margin-end"],["margin-inline-start","-webkit-margin-start"],["mask-border","-webkit-mask-box-image"],["mask-border-outset","-webkit-mask-box-image-outset"],["mask-border-slice","-webkit-mask-box-image-slice"],["mask-border-source","-webkit-mask-box-image-source"],["mask-border-repeat","-webkit-mask-box-image-repeat"],["mask-border-width","-webkit-mask-box-image-width"],["overflow-wrap","word-wrap"],["padding-inline-end","-webkit-padding-end"],["padding-inline-start","-webkit-padding-start"],["print-color-adjust","color-adjust"],["row-gap","grid-row-gap"],["scroll-margin-bottom","scroll-snap-margin-bottom"],["scroll-margin-left","scroll-snap-margin-left"],["scroll-margin-right","scroll-snap-margin-right"],["scroll-margin-top","scroll-snap-margin-top"],["scroll-margin","scroll-snap-margin"],["text-combine-upright","-ms-text-combine-horizontal"]]);function dT(t){return hT.get(t)}function fT(t){var e=/^(?:(text-(?:decoration$|e|or|si)|back(?:ground-cl|d|f)|box-d|mask(?:$|-[ispro]|-cl)|pr|hyphena|flex-d)|(tab-|column(?!-s)|text-align-l)|(ap)|u|hy)/i.exec(t);return e?e[1]?1:e[2]?2:e[3]?3:5:0}function pT(t,e){var r=/^(?:(pos)|(cli)|(background-i)|(flex(?:$|-b)|(?:max-|min-)?(?:block-s|inl|he|widt))|dis)/i.exec(t);return r?r[1]?/^sti/i.test(e)?1:0:r[2]?/^pat/i.test(e)?1:0:r[3]?/^image-/i.test(e)?1:0:r[4]?e[3]==="-"?2:0:/^(?:inline-)?grid$/i.test(e)?4:0:0}let gT=[["-webkit-",1],["-moz-",2],["-ms-",4]];function mT(){return({stringify:t})=>({stringify(e,r,n){let s="",i=dT(e);i&&(s+=t(i,r,n)+";");let o=fT(e),a=pT(e,r);for(let c of gT)o&c[1]&&(s+=t(c[0]+e,r,n)+";"),a&c[1]&&(s+=t(e,c[0]+r,n)+";");return s+t(e,r,n)}})}let Hm={screens:{sm:"640px",md:"768px",lg:"1024px",xl:"1280px","2xl":"1536px"},columns:{auto:"auto","3xs":"16rem","2xs":"18rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem"},spacing:{px:"1px",0:"0px",...cn(4,"rem",4,.5,.5),...cn(12,"rem",4,5),14:"3.5rem",...cn(64,"rem",4,16,4),72:"18rem",80:"20rem",96:"24rem"},durations:{75:"75ms",100:"100ms",150:"150ms",200:"200ms",300:"300ms",500:"500ms",700:"700ms",1e3:"1000ms"},animation:{none:"none",spin:"spin 1s linear infinite",ping:"ping 1s cubic-bezier(0,0,0.2,1) infinite",pulse:"pulse 2s cubic-bezier(0.4,0,0.6,1) infinite",bounce:"bounce 1s infinite"},aspectRatio:{auto:"auto",square:"1/1",video:"16/9"},backdropBlur:ke("blur"),backdropBrightness:ke("brightness"),backdropContrast:ke("contrast"),backdropGrayscale:ke("grayscale"),backdropHueRotate:ke("hueRotate"),backdropInvert:ke("invert"),backdropOpacity:ke("opacity"),backdropSaturate:ke("saturate"),backdropSepia:ke("sepia"),backgroundColor:ke("colors"),backgroundImage:{none:"none"},backgroundOpacity:ke("opacity"),backgroundSize:{auto:"auto",cover:"cover",contain:"contain"},blur:{none:"none",0:"0",sm:"4px",DEFAULT:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},brightness:{...cn(200,"",100,0,50),...cn(110,"",100,90,5),75:"0.75",125:"1.25"},borderColor:({theme:t})=>({DEFAULT:t("colors.gray.200","currentColor"),...t("colors")}),borderOpacity:ke("opacity"),borderRadius:{none:"0px",sm:"0.125rem",DEFAULT:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem","1/2":"50%",full:"9999px"},borderSpacing:ke("spacing"),borderWidth:{DEFAULT:"1px",...xn(8,"px")},boxShadow:{sm:"0 1px 2px 0 rgba(0,0,0,0.05)",DEFAULT:"0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px -1px rgba(0,0,0,0.1)",md:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1)",lg:"0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1)",xl:"0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1)","2xl":"0 25px 50px -12px rgba(0,0,0,0.25)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.05)",none:"0 0 #0000"},boxShadowColor:ke("colors"),caretColor:ke("colors"),accentColor:({theme:t})=>({auto:"auto",...t("colors")}),contrast:{...cn(200,"",100,0,50),75:"0.75",125:"1.25"},content:{none:"none"},divideColor:ke("borderColor"),divideOpacity:ke("borderOpacity"),divideWidth:ke("borderWidth"),dropShadow:{sm:"0 1px 1px rgba(0,0,0,0.05)",DEFAULT:["0 1px 2px rgba(0,0,0,0.1)","0 1px 1px rgba(0,0,0,0.06)"],md:["0 4px 3px rgba(0,0,0,0.07)","0 2px 2px rgba(0,0,0,0.06)"],lg:["0 10px 8px rgba(0,0,0,0.04)","0 4px 3px rgba(0,0,0,0.1)"],xl:["0 20px 13px rgba(0,0,0,0.03)","0 8px 5px rgba(0,0,0,0.08)"],"2xl":"0 25px 25px rgba(0,0,0,0.15)",none:"0 0 #0000"},fill:({theme:t})=>({...t("colors"),none:"none"}),grayscale:{DEFAULT:"100%",0:"0"},hueRotate:{0:"0deg",15:"15deg",30:"30deg",60:"60deg",90:"90deg",180:"180deg"},invert:{DEFAULT:"100%",0:"0"},flex:{1:"1 1 0%",auto:"1 1 auto",initial:"0 1 auto",none:"none"},flexBasis:({theme:t})=>({...t("spacing"),...Zc(2,6),...Zc(12,12),auto:"auto",full:"100%"}),flexGrow:{DEFAULT:1,0:0},flexShrink:{DEFAULT:1,0:0},fontFamily:{sans:'ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"'.split(","),serif:'ui-serif,Georgia,Cambria,"Times New Roman",Times,serif'.split(","),mono:'ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'.split(",")},fontSize:{xs:["0.75rem","1rem"],sm:["0.875rem","1.25rem"],base:["1rem","1.5rem"],lg:["1.125rem","1.75rem"],xl:["1.25rem","1.75rem"],"2xl":["1.5rem","2rem"],"3xl":["1.875rem","2.25rem"],"4xl":["2.25rem","2.5rem"],"5xl":["3rem","1"],"6xl":["3.75rem","1"],"7xl":["4.5rem","1"],"8xl":["6rem","1"],"9xl":["8rem","1"]},fontWeight:{thin:"100",extralight:"200",light:"300",normal:"400",medium:"500",semibold:"600",bold:"700",extrabold:"800",black:"900"},gap:ke("spacing"),gradientColorStops:ke("colors"),gridAutoColumns:{auto:"auto",min:"min-content",max:"max-content",fr:"minmax(0,1fr)"},gridAutoRows:{auto:"auto",min:"min-content",max:"max-content",fr:"minmax(0,1fr)"},gridColumn:{auto:"auto","span-full":"1 / -1"},gridRow:{auto:"auto","span-full":"1 / -1"},gridTemplateColumns:{none:"none"},gridTemplateRows:{none:"none"},height:({theme:t})=>({...t("spacing"),...Zc(2,6),min:"min-content",max:"max-content",fit:"fit-content",auto:"auto",full:"100%",screen:"100vh"}),inset:({theme:t})=>({...t("spacing"),...Zc(2,4),auto:"auto",full:"100%"}),keyframes:{spin:{from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}},ping:{"0%":{transform:"scale(1)",opacity:"1"},"75%,100%":{transform:"scale(2)",opacity:"0"}},pulse:{"0%,100%":{opacity:"1"},"50%":{opacity:".5"}},bounce:{"0%, 100%":{transform:"translateY(-25%)",animationTimingFunction:"cubic-bezier(0.8,0,1,1)"},"50%":{transform:"none",animationTimingFunction:"cubic-bezier(0,0,0.2,1)"}}},letterSpacing:{tighter:"-0.05em",tight:"-0.025em",normal:"0em",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeight:{...cn(10,"rem",4,3),none:"1",tight:"1.25",snug:"1.375",normal:"1.5",relaxed:"1.625",loose:"2"},margin:({theme:t})=>({auto:"auto",...t("spacing")}),maxHeight:({theme:t})=>({full:"100%",min:"min-content",max:"max-content",fit:"fit-content",screen:"100vh",...t("spacing")}),maxWidth:({theme:t,breakpoints:e})=>({...e(t("screens")),none:"none",0:"0rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem",full:"100%",min:"min-content",max:"max-content",fit:"fit-content",prose:"65ch"}),minHeight:{0:"0px",full:"100%",min:"min-content",max:"max-content",fit:"fit-content",screen:"100vh"},minWidth:{0:"0px",full:"100%",min:"min-content",max:"max-content",fit:"fit-content"},opacity:{...cn(100,"",100,0,10),5:"0.05",25:"0.25",75:"0.75",95:"0.95"},order:{first:"-9999",last:"9999",none:"0"},padding:ke("spacing"),placeholderColor:ke("colors"),placeholderOpacity:ke("opacity"),outlineColor:ke("colors"),outlineOffset:xn(8,"px"),outlineWidth:xn(8,"px"),ringColor:({theme:t})=>({...t("colors"),DEFAULT:"#3b82f6"}),ringOffsetColor:ke("colors"),ringOffsetWidth:xn(8,"px"),ringOpacity:({theme:t})=>({...t("opacity"),DEFAULT:"0.5"}),ringWidth:{DEFAULT:"3px",...xn(8,"px")},rotate:{...xn(2,"deg"),...xn(12,"deg",3),...xn(180,"deg",45)},saturate:cn(200,"",100,0,50),scale:{...cn(150,"",100,0,50),...cn(110,"",100,90,5),75:"0.75",125:"1.25"},scrollMargin:ke("spacing"),scrollPadding:ke("spacing"),sepia:{0:"0",DEFAULT:"100%"},skew:{...xn(2,"deg"),...xn(12,"deg",3)},space:ke("spacing"),stroke:({theme:t})=>({...t("colors"),none:"none"}),strokeWidth:cn(2),textColor:ke("colors"),textDecorationColor:ke("colors"),textDecorationThickness:{"from-font":"from-font",auto:"auto",...xn(8,"px")},textUnderlineOffset:{auto:"auto",...xn(8,"px")},textIndent:ke("spacing"),textOpacity:ke("opacity"),transitionDuration:({theme:t})=>({...t("durations"),DEFAULT:"150ms"}),transitionDelay:ke("durations"),transitionProperty:{none:"none",all:"all",DEFAULT:"color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter",colors:"color,background-color,border-color,text-decoration-color,fill,stroke",opacity:"opacity",shadow:"box-shadow",transform:"transform"},transitionTimingFunction:{DEFAULT:"cubic-bezier(0.4,0,0.2,1)",linear:"linear",in:"cubic-bezier(0.4,0,1,1)",out:"cubic-bezier(0,0,0.2,1)","in-out":"cubic-bezier(0.4,0,0.2,1)"},translate:({theme:t})=>({...t("spacing"),...Zc(2,4),full:"100%"}),width:({theme:t})=>({min:"min-content",max:"max-content",fit:"fit-content",screen:"100vw",...t("flexBasis")}),willChange:{scroll:"scroll-position"},zIndex:{...cn(50,"",1,0,10),auto:"auto"}};function Zc(t,e){let r={};do for(var n=1;n<t;n++)r[`${n}/${t}`]=Number((n/t*100).toFixed(6))+"%";while(++t<=e);return r}function xn(t,e,r=0){let n={};for(;r<=t;r=2*r||1)n[r]=r+e;return n}function cn(t,e="",r=1,n=0,s=1,i={}){for(;n<=t;n+=s)i[n]=n/r+e;return i}function ke(t){return({theme:e})=>e(t)}let yT={"*,::before,::after":{boxSizing:"border-box",borderWidth:"0",borderStyle:"solid",borderColor:"theme(borderColor.DEFAULT, currentColor)"},"::before,::after":{"--tw-content":"''"},html:{lineHeight:1.5,WebkitTextSizeAdjust:"100%",MozTabSize:"4",tabSize:4,fontFamily:`theme(fontFamily.sans, ${Hm.fontFamily.sans})`,fontFeatureSettings:"theme(fontFamily.sans[1].fontFeatureSettings, normal)"},body:{margin:"0",lineHeight:"inherit"},hr:{height:"0",color:"inherit",borderTopWidth:"1px"},"abbr:where([title])":{textDecoration:"underline dotted"},"h1,h2,h3,h4,h5,h6":{fontSize:"inherit",fontWeight:"inherit"},a:{color:"inherit",textDecoration:"inherit"},"b,strong":{fontWeight:"bolder"},"code,kbd,samp,pre":{fontFamily:`theme(fontFamily.mono, ${Hm.fontFamily.mono})`,fontFeatureSettings:"theme(fontFamily.mono[1].fontFeatureSettings, normal)",fontSize:"1em"},small:{fontSize:"80%"},"sub,sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sub:{bottom:"-0.25em"},sup:{top:"-0.5em"},table:{textIndent:"0",borderColor:"inherit",borderCollapse:"collapse"},"button,input,optgroup,select,textarea":{fontFamily:"inherit",fontSize:"100%",lineHeight:"inherit",color:"inherit",margin:"0",padding:"0"},"button,select":{textTransform:"none"},"button,[type='button'],[type='reset'],[type='submit']":{WebkitAppearance:"button",backgroundColor:"transparent",backgroundImage:"none"},":-moz-focusring":{outline:"auto"},":-moz-ui-invalid":{boxShadow:"none"},progress:{verticalAlign:"baseline"},"::-webkit-inner-spin-button,::-webkit-outer-spin-button":{height:"auto"},"[type='search']":{WebkitAppearance:"textfield",outlineOffset:"-2px"},"::-webkit-search-decoration":{WebkitAppearance:"none"},"::-webkit-file-upload-button":{WebkitAppearance:"button",font:"inherit"},summary:{display:"list-item"},"blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre":{margin:"0"},fieldset:{margin:"0",padding:"0"},legend:{padding:"0"},"ol,ul,menu":{listStyle:"none",margin:"0",padding:"0"},textarea:{resize:"vertical"},"input::placeholder,textarea::placeholder":{opacity:1,color:"theme(colors.gray.400, #9ca3af)"},'button,[role="button"]':{cursor:"pointer"},":disabled":{cursor:"default"},"img,svg,video,canvas,audio,iframe,embed,object":{display:"block",verticalAlign:"middle"},"img,video":{maxWidth:"100%",height:"auto"},"[hidden]":{display:"none"}},wT=[te("\\[([-\\w]+):(.+)]",({1:t,2:e},r)=>({"@layer overrides":{"&":{[t]:po(`[${e}]`,"",r)}}})),te("(group|peer)([~/][^-[]+)?",({input:t},{h:e})=>[{c:e(t)}]),se("aspect-","aspectRatio"),te("container",(t,{theme:e})=>{let{screens:r=e("screens"),center:n,padding:s}=e("container"),i={width:"100%",marginRight:n&&"auto",marginLeft:n&&"auto",...o("xs")};for(let a in r){let c=r[a];typeof c=="string"&&(i[qw(c)]={"&":{maxWidth:c,...o(a)}})}return i;function o(a){let c=s&&(typeof s=="string"?s:s[a]||s.DEFAULT);if(c)return{paddingRight:c,paddingLeft:c}}}),se("content-","content",({_:t})=>({"--tw-content":t,content:"var(--tw-content)"})),te("(?:box-)?decoration-(slice|clone)","boxDecorationBreak"),te("box-(border|content)","boxSizing",({1:t})=>t+"-box"),te("hidden",{display:"none"}),te("table-(auto|fixed)","tableLayout"),te(["(block|flex|table|grid|inline|contents|flow-root|list-item)","(inline-(block|flex|table|grid))","(table-(caption|cell|column|row|(column|row|footer|header)-group))"],"display"),"(float)-(left|right|none)","(clear)-(left|right|none|both)","(overflow(?:-[xy])?)-(auto|hidden|clip|visible|scroll)","(isolation)-(auto)",te("isolate","isolation"),te("object-(contain|cover|fill|none|scale-down)","objectFit"),se("object-","objectPosition"),te("object-(top|bottom|center|(left|right)(-(top|bottom))?)","objectPosition",yh),te("overscroll(-[xy])?-(auto|contain|none)",({1:t="",2:e})=>({["overscroll-behavior"+t]:e})),te("(static|fixed|absolute|relative|sticky)","position"),se("-?inset(-[xy])?(?:$|-)","inset",({1:t,_:e})=>({top:t!="-x"&&e,right:t!="-y"&&e,bottom:t!="-x"&&e,left:t!="-y"&&e})),se("-?(top|bottom|left|right)(?:$|-)","inset"),te("(visible|collapse)","visibility"),te("invisible",{visibility:"hidden"}),se("-?z-","zIndex"),te("flex-((row|col)(-reverse)?)","flexDirection",Kb),te("flex-(wrap|wrap-reverse|nowrap)","flexWrap"),se("(flex-(?:grow|shrink))(?:$|-)"),se("(flex)-"),se("grow(?:$|-)","flexGrow"),se("shrink(?:$|-)","flexShrink"),se("basis-","flexBasis"),se("-?(order)-"),"-?(order)-(\\d+)",se("grid-cols-","gridTemplateColumns"),te("grid-cols-(\\d+)","gridTemplateColumns",Jb),se("col-","gridColumn"),te("col-(span)-(\\d+)","gridColumn",Zb),se("col-start-","gridColumnStart"),te("col-start-(auto|\\d+)","gridColumnStart"),se("col-end-","gridColumnEnd"),te("col-end-(auto|\\d+)","gridColumnEnd"),se("grid-rows-","gridTemplateRows"),te("grid-rows-(\\d+)","gridTemplateRows",Jb),se("row-","gridRow"),te("row-(span)-(\\d+)","gridRow",Zb),se("row-start-","gridRowStart"),te("row-start-(auto|\\d+)","gridRowStart"),se("row-end-","gridRowEnd"),te("row-end-(auto|\\d+)","gridRowEnd"),te("grid-flow-((row|col)(-dense)?)","gridAutoFlow",t=>yh(Kb(t))),te("grid-flow-(dense)","gridAutoFlow"),se("auto-cols-","gridAutoColumns"),se("auto-rows-","gridAutoRows"),se("gap-x(?:$|-)","gap","columnGap"),se("gap-y(?:$|-)","gap","rowGap"),se("gap(?:$|-)","gap"),"(justify-(?:items|self))-",te("justify-","justifyContent",Gb),te("(content|items|self)-",t=>({["align-"+t[1]]:Gb(t)})),te("(place-(content|items|self))-",({1:t,$$:e})=>({[t]:("wun".includes(e[3])?"space-":"")+e})),se("p([xytrbl])?(?:$|-)","padding",La("padding")),se("-?m([xytrbl])?(?:$|-)","margin",La("margin")),se("-?space-(x|y)(?:$|-)","space",({1:t,_:e})=>({"&>:not([hidden])~:not([hidden])":{[`--tw-space-${t}-reverse`]:"0",["margin-"+{y:"top",x:"left"}[t]]:`calc(${e} * calc(1 - var(--tw-space-${t}-reverse)))`,["margin-"+{y:"bottom",x:"right"}[t]]:`calc(${e} * var(--tw-space-${t}-reverse))`}})),te("space-(x|y)-reverse",({1:t})=>({"&>:not([hidden])~:not([hidden])":{[`--tw-space-${t}-reverse`]:"1"}})),se("w-","width"),se("min-w-","minWidth"),se("max-w-","maxWidth"),se("h-","height"),se("min-h-","minHeight"),se("max-h-","maxHeight"),se("font-","fontWeight"),se("font-","fontFamily",({_:t})=>typeof(t=st(t))[1]=="string"?{fontFamily:Gn(t)}:{fontFamily:Gn(t[0]),...t[1]}),te("antialiased",{WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"}),te("subpixel-antialiased",{WebkitFontSmoothing:"auto",MozOsxFontSmoothing:"auto"}),te("italic","fontStyle"),te("not-italic",{fontStyle:"normal"}),te("(ordinal|slashed-zero|(normal|lining|oldstyle|proportional|tabular)-nums|(diagonal|stacked)-fractions)",({1:t,2:e="",3:r})=>e=="normal"?{fontVariantNumeric:"normal"}:{["--tw-"+(r?"numeric-fraction":"pt".includes(e[0])?"numeric-spacing":e?"numeric-figure":t)]:t,fontVariantNumeric:"var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)",...Yi({"--tw-ordinal":"var(--tw-empty,/*!*/ /*!*/)","--tw-slashed-zero":"var(--tw-empty,/*!*/ /*!*/)","--tw-numeric-figure":"var(--tw-empty,/*!*/ /*!*/)","--tw-numeric-spacing":"var(--tw-empty,/*!*/ /*!*/)","--tw-numeric-fraction":"var(--tw-empty,/*!*/ /*!*/)"})}),se("tracking-","letterSpacing"),se("leading-","lineHeight"),te("list-(inside|outside)","listStylePosition"),se("list-","listStyleType"),te("list-","listStyleType"),se("placeholder-opacity-","placeholderOpacity",({_:t})=>({"&::placeholder":{"--tw-placeholder-opacity":t}})),Mt("placeholder-",{property:"color",selector:"&::placeholder"}),te("text-(left|center|right|justify|start|end)","textAlign"),te("text-(ellipsis|clip)","textOverflow"),se("text-opacity-","textOpacity","--tw-text-opacity"),Mt("text-",{property:"color"}),se("text-","fontSize",({_:t})=>typeof t=="string"?{fontSize:t}:{fontSize:t[0],...typeof t[1]=="string"?{lineHeight:t[1]}:t[1]}),se("indent-","textIndent"),te("(overline|underline|line-through)","textDecorationLine"),te("no-underline",{textDecorationLine:"none"}),se("underline-offset-","textUnderlineOffset"),Mt("decoration-",{section:"textDecorationColor",opacityVariable:!1,opacitySection:"opacity"}),se("decoration-","textDecorationThickness"),te("decoration-","textDecorationStyle"),te("(uppercase|lowercase|capitalize)","textTransform"),te("normal-case",{textTransform:"none"}),te("truncate",{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),te("align-","verticalAlign"),te("whitespace-","whiteSpace"),te("break-normal",{wordBreak:"normal",overflowWrap:"normal"}),te("break-words",{overflowWrap:"break-word"}),te("break-all",{wordBreak:"break-all"}),te("break-keep",{wordBreak:"keep-all"}),Mt("caret-",{opacityVariable:!1,opacitySection:"opacity"}),Mt("accent-",{opacityVariable:!1,opacitySection:"opacity"}),te("bg-gradient-to-([trbl]|[tb][rl])","backgroundImage",({1:t})=>`linear-gradient(to ${Ho(t," ")},var(--tw-gradient-stops))`),Mt("from-",{section:"gradientColorStops",opacityVariable:!1,opacitySection:"opacity"},({_:t})=>({"--tw-gradient-from":t.value,"--tw-gradient-to":t.color({opacityValue:"0"}),"--tw-gradient-stops":"var(--tw-gradient-from),var(--tw-gradient-to)"})),Mt("via-",{section:"gradientColorStops",opacityVariable:!1,opacitySection:"opacity"},({_:t})=>({"--tw-gradient-to":t.color({opacityValue:"0"}),"--tw-gradient-stops":`var(--tw-gradient-from),${t.value},var(--tw-gradient-to)`})),Mt("to-",{section:"gradientColorStops",property:"--tw-gradient-to",opacityVariable:!1,opacitySection:"opacity"}),te("bg-(fixed|local|scroll)","backgroundAttachment"),te("bg-origin-(border|padding|content)","backgroundOrigin",({1:t})=>t+"-box"),te(["bg-(no-repeat|repeat(-[xy])?)","bg-repeat-(round|space)"],"backgroundRepeat"),te("bg-blend-","backgroundBlendMode"),te("bg-clip-(border|padding|content|text)","backgroundClip",({1:t})=>t+(t=="text"?"":"-box")),se("bg-opacity-","backgroundOpacity","--tw-bg-opacity"),Mt("bg-",{section:"backgroundColor"}),se("bg-","backgroundImage"),se("bg-","backgroundPosition"),te("bg-(top|bottom|center|(left|right)(-(top|bottom))?)","backgroundPosition",yh),se("bg-","backgroundSize"),se("rounded(?:$|-)","borderRadius"),se("rounded-([trbl]|[tb][rl])(?:$|-)","borderRadius",({1:t,_:e})=>{let r={t:["tl","tr"],r:["tr","br"],b:["bl","br"],l:["bl","tl"]}[t]||[t,t];return{[`border-${Ho(r[0])}-radius`]:e,[`border-${Ho(r[1])}-radius`]:e}}),te("border-(collapse|separate)","borderCollapse"),se("border-opacity(?:$|-)","borderOpacity","--tw-border-opacity"),te("border-(solid|dashed|dotted|double|none)","borderStyle"),se("border-spacing(-[xy])?(?:$|-)","borderSpacing",({1:t,_:e})=>({...Yi({"--tw-border-spacing-x":"0","--tw-border-spacing-y":"0"}),["--tw-border-spacing"+(t||"-x")]:e,["--tw-border-spacing"+(t||"-y")]:e,"border-spacing":"var(--tw-border-spacing-x) var(--tw-border-spacing-y)"})),Mt("border-([xytrbl])-",{section:"borderColor"},La("border","Color")),Mt("border-"),se("border-([xytrbl])(?:$|-)","borderWidth",La("border","Width")),se("border(?:$|-)","borderWidth"),se("divide-opacity(?:$|-)","divideOpacity",({_:t})=>({"&>:not([hidden])~:not([hidden])":{"--tw-divide-opacity":t}})),te("divide-(solid|dashed|dotted|double|none)",({1:t})=>({"&>:not([hidden])~:not([hidden])":{borderStyle:t}})),te("divide-([xy]-reverse)",({1:t})=>({"&>:not([hidden])~:not([hidden])":{["--tw-divide-"+t]:"1"}})),se("divide-([xy])(?:$|-)","divideWidth",({1:t,_:e})=>{let r={x:"lr",y:"tb"}[t];return{"&>:not([hidden])~:not([hidden])":{[`--tw-divide-${t}-reverse`]:"0",[`border-${Ho(r[0])}Width`]:`calc(${e} * calc(1 - var(--tw-divide-${t}-reverse)))`,[`border-${Ho(r[1])}Width`]:`calc(${e} * var(--tw-divide-${t}-reverse))`}}}),Mt("divide-",{property:"borderColor",selector:"&>:not([hidden])~:not([hidden])"}),se("ring-opacity(?:$|-)","ringOpacity","--tw-ring-opacity"),Mt("ring-offset-",{property:"--tw-ring-offset-color",opacityVariable:!1}),se("ring-offset(?:$|-)","ringOffsetWidth","--tw-ring-offset-width"),te("ring-inset",{"--tw-ring-inset":"inset"}),Mt("ring-",{property:"--tw-ring-color"}),se("ring(?:$|-)","ringWidth",({_:t},{theme:e})=>({...Yi({"--tw-ring-offset-shadow":"0 0 #0000","--tw-ring-shadow":"0 0 #0000","--tw-shadow":"0 0 #0000","--tw-shadow-colored":"0 0 #0000","&":{"--tw-ring-inset":"var(--tw-empty,/*!*/ /*!*/)","--tw-ring-offset-width":e("ringOffsetWidth","","0px"),"--tw-ring-offset-color":fo(e("ringOffsetColor","","#fff")),"--tw-ring-color":fo(e("ringColor","","#93c5fd"),{opacityVariable:"--tw-ring-opacity"}),"--tw-ring-opacity":e("ringOpacity","","0.5")}}),"--tw-ring-offset-shadow":"var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color)","--tw-ring-shadow":`var(--tw-ring-inset) 0 0 0 calc(${t} + var(--tw-ring-offset-width)) var(--tw-ring-color)`,boxShadow:"var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)"})),Mt("shadow-",{section:"boxShadowColor",opacityVariable:!1,opacitySection:"opacity"},({_:t})=>({"--tw-shadow-color":t.value,"--tw-shadow":"var(--tw-shadow-colored)"})),se("shadow(?:$|-)","boxShadow",({_:t})=>({...Yi({"--tw-ring-offset-shadow":"0 0 #0000","--tw-ring-shadow":"0 0 #0000","--tw-shadow":"0 0 #0000","--tw-shadow-colored":"0 0 #0000"}),"--tw-shadow":Gn(t),"--tw-shadow-colored":Gn(t).replace(/([^,]\s+)(?:#[a-f\d]+|(?:(?:hsl|rgb)a?|hwb|lab|lch|color|var)\(.+?\)|[a-z]+)(,|$)/g,"$1var(--tw-shadow-color)$2"),boxShadow:"var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)"})),se("(opacity)-"),te("mix-blend-","mixBlendMode"),...Yb(),...Yb("backdrop-"),se("transition(?:$|-)","transitionProperty",(t,{theme:e})=>({transitionProperty:Gn(t),transitionTimingFunction:t._=="none"?void 0:Gn(e("transitionTimingFunction","")),transitionDuration:t._=="none"?void 0:Gn(e("transitionDuration",""))})),se("duration(?:$|-)","transitionDuration","transitionDuration",Gn),se("ease(?:$|-)","transitionTimingFunction","transitionTimingFunction",Gn),se("delay(?:$|-)","transitionDelay","transitionDelay",Gn),se("animate(?:$|-)","animation",(t,{theme:e,h:r,e:n})=>{let s=Gn(t),i=s.split(" "),o=e("keyframes",i[0]);return o?{["@keyframes "+(i[0]=n(r(i[0])))]:o,animation:i.join(" ")}:{animation:s}}),"(transform)-(none)",te("transform",Vm),te("transform-(cpu|gpu)",({1:t})=>({"--tw-transform":qS(t=="gpu")})),se("scale(-[xy])?-","scale",({1:t,_:e})=>({["--tw-scale"+(t||"-x")]:e,["--tw-scale"+(t||"-y")]:e,...Vm()})),se("-?(rotate)-","rotate",Rp),se("-?(translate-[xy])-","translate",Rp),se("-?(skew-[xy])-","skew",Rp),te("origin-(center|((top|bottom)(-(left|right))?)|left|right)","transformOrigin",yh),"(appearance)-",se("(columns)-"),"(columns)-(\\d+)","(break-(?:before|after|inside))-",se("(cursor)-"),"(cursor)-",te("snap-(none)","scroll-snap-type"),te("snap-(x|y|both)",({1:t})=>({...Yi({"--tw-scroll-snap-strictness":"proximity"}),"scroll-snap-type":t+" var(--tw-scroll-snap-strictness)"})),te("snap-(mandatory|proximity)","--tw-scroll-snap-strictness"),te("snap-(?:(start|end|center)|align-(none))","scroll-snap-align"),te("snap-(normal|always)","scroll-snap-stop"),te("scroll-(auto|smooth)","scroll-behavior"),se("scroll-p([xytrbl])?(?:$|-)","padding",La("scroll-padding")),se("-?scroll-m([xytrbl])?(?:$|-)","scroll-margin",La("scroll-margin")),te("touch-(auto|none|manipulation)","touch-action"),te("touch-(pinch-zoom|pan-(?:(x|left|right)|(y|up|down)))",({1:t,2:e,3:r})=>({...Yi({"--tw-pan-x":"var(--tw-empty,/*!*/ /*!*/)","--tw-pan-y":"var(--tw-empty,/*!*/ /*!*/)","--tw-pinch-zoom":"var(--tw-empty,/*!*/ /*!*/)","--tw-touch-action":"var(--tw-pan-x) var(--tw-pan-y) var(--tw-pinch-zoom)"}),[`--tw-${e?"pan-x":r?"pan-y":t}`]:t,"touch-action":"var(--tw-touch-action)"})),te("outline-none",{outline:"2px solid transparent","outline-offset":"2px"}),te("outline",{outlineStyle:"solid"}),te("outline-(dashed|dotted|double)","outlineStyle"),se("-?(outline-offset)-"),Mt("outline-",{opacityVariable:!1,opacitySection:"opacity"}),se("outline-","outlineWidth"),"(pointer-events)-",se("(will-change)-"),"(will-change)-",["resize(?:-(none|x|y))?","resize",({1:t})=>({x:"horizontal",y:"vertical"})[t]||t||"both"],te("select-(none|text|all|auto)","userSelect"),Mt("fill-",{section:"fill",opacityVariable:!1,opacitySection:"opacity"}),Mt("stroke-",{section:"stroke",opacityVariable:!1,opacitySection:"opacity"}),se("stroke-","strokeWidth"),te("sr-only",{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",whiteSpace:"nowrap",clip:"rect(0,0,0,0)",borderWidth:"0"}),te("not-sr-only",{position:"static",width:"auto",height:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal",clip:"auto"})];function yh(t){return(typeof t=="string"?t:t[1]).replace(/-/g," ").trim()}function Kb(t){return(typeof t=="string"?t:t[1]).replace("col","column")}function Ho(t,e="-"){let r=[];for(let n of t)r.push({t:"top",r:"right",b:"bottom",l:"left"}[n]);return r.join(e)}function Gn(t){return t&&""+(t._||t)}function Gb({$$:t}){return({r:"flex-","":"flex-",w:"space-",u:"space-",n:"space-"}[t[3]||""]||"")+t}function La(t,e=""){return({1:r,_:n})=>{let s={x:"lr",y:"tb"}[r]||r+r;return s?{...ud(t+"-"+Ho(s[0])+e,n),...ud(t+"-"+Ho(s[1])+e,n)}:ud(t+e,n)}}function Yb(t=""){let e=["blur","brightness","contrast","grayscale","hue-rotate","invert",t&&"opacity","saturate","sepia",!t&&"drop-shadow"].filter(Boolean),r={};for(let n of e)r[`--tw-${t}${n}`]="var(--tw-empty,/*!*/ /*!*/)";return r={...Yi(r),[`${t}filter`]:e.map(n=>`var(--tw-${t}${n})`).join(" ")},[`(${t}filter)-(none)`,te(`${t}filter`,r),...e.map(n=>se(`${n[0]=="h"?"-?":""}(${t}${n})(?:$|-)`,n,({1:s,_:i})=>({[`--tw-${s}`]:st(i).map(o=>`${n}(${o})`).join(" "),...r})))]}function Rp({1:t,_:e}){return{["--tw-"+t]:e,...Vm()}}function Vm(){return{...Yi({"--tw-translate-x":"0","--tw-translate-y":"0","--tw-rotate":"0","--tw-skew-x":"0","--tw-skew-y":"0","--tw-scale-x":"1","--tw-scale-y":"1","--tw-transform":qS()}),transform:"var(--tw-transform)"}}function qS(t){return[t?"translate3d(var(--tw-translate-x),var(--tw-translate-y),0)":"translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y))","rotate(var(--tw-rotate))","skewX(var(--tw-skew-x))","skewY(var(--tw-skew-y))","scaleX(var(--tw-scale-x))","scaleY(var(--tw-scale-y))"].join(" ")}function Zb({1:t,2:e}){return`${t} ${e} / ${t} ${e}`}function Jb({1:t}){return`repeat(${t},minmax(0,1fr))`}function Yi(t){return{"@layer defaults":{"*,::before,::after":t,"::backdrop":t}}}let bT=[["sticky","@supports ((position: -webkit-sticky) or (position:sticky))"],["motion-reduce","@media (prefers-reduced-motion:reduce)"],["motion-safe","@media (prefers-reduced-motion:no-preference)"],["print","@media print"],["(portrait|landscape)",({1:t})=>`@media (orientation:${t})`],["contrast-(more|less)",({1:t})=>`@media (prefers-contrast:${t})`],["(first-(letter|line)|placeholder|backdrop|before|after)",({1:t})=>`&::${t}`],["(marker|selection)",({1:t})=>`& *::${t},&::${t}`],["file","&::file-selector-button"],["(first|last|only)",({1:t})=>`&:${t}-child`],["even","&:nth-child(2n)"],["odd","&:nth-child(odd)"],["open","&[open]"],["(aria|data)-",({1:t,$$:e},r)=>e&&`&[${t}-${r.theme(t,e)||po(e,"",r)||`${e}="true"`}]`],["((group|peer)(~[^-[]+)?)(-\\[(.+)]|[-[].+?)(\\/.+)?",({2:t,3:e="",4:r,5:n="",6:s=e},{e:i,h:o,v:a})=>{let c=Ql(n)||(r[0]=="["?r:a(r.slice(1)));return`${(c.includes("&")?c:"&"+c).replace(/&/g,`:merge(.${i(o(t+s))})`)}${t[0]=="p"?"~":" "}&`}],["(ltr|rtl)",({1:t})=>`[dir="${t}"] &`],["supports-",({$$:t},e)=>{if(t&&(t=e.theme("supports",t)||po(t,"",e)),t)return t.includes(":")||(t+=":var(--tw)"),/^\w*\s*\(/.test(t)||(t=`(${t})`),`@supports ${t.replace(/\b(and|or|not)\b/g," $1 ").trim()}`}],["max-",({$$:t},e)=>{if(t&&(t=e.theme("screens",t)||po(t,"",e)),typeof t=="string")return`@media not all and (min-width:${t})`}],["min-",({$$:t},e)=>(t&&(t=po(t,"",e)),t&&`@media (min-width:${t})`)],[/^\[(.+)]$/,({1:t})=>/[&@]/.test(t)&&Ql(t).replace(/[}]+$/,"").split("{")]];function vT({colors:t,disablePreflight:e}={}){return{preflight:e?void 0:yT,theme:{...Hm,colors:{inherit:"inherit",current:"currentColor",transparent:"transparent",black:"#000",white:"#fff",...t}},variants:bT,rules:wT,finalize(r){return r.n&&r.d&&r.r.some(n=>/^&::(before|after)$/.test(n))&&!/(^|;)content:/.test(r.d)?{...r,d:"content:var(--tw-content);"+r.d}:r}}}const ET=jS({preflight:!1,hash:!0,darkMode:"class",theme:{extend:{colors:{background:"var(--swk-background)","background-secondary":"var(--swk-background-secondary)","foreground-strong":"var(--swk-foreground-strong)",foreground:"var(--swk-foreground)","foreground-secondary":"var(--swk-foreground-secondary)",primary:"var(--swk-primary)","primary-foreground":"var(--swk-primary-foreground)",transparent:"var(--swk-transparent)",lighter:"var(--swk-lighter)",light:"var(--swk-light)","light-gray":"var(--swk-light-gray)",gray:"var(--swk-gray)",danger:"var(--swk-danger)",border:"var(--swk-border)"},boxShadow:{default:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1)"},borderRadius:{default:"var(--swk-border-radius)"},fontFamily:{default:"var(--swk-font-family)"}}},presets:[mT(),vT({disablePreflight:!0})]}),Mf=sT(ET,typeof document>"u"?aT():oT("style[data-library]")),ge=t=>Mf(`!(${t})`);uT.bind(Mf);cT.bind(Mf);lT.bind(Mf);const zS=Lf`
  .stellar-wallets-kit *,
  .stellar-wallets-kit ::after,
  .stellar-wallets-kit ::before,
  .stellar-wallets-kit ::backdrop,
  .stellar-wallets-kit ::file-selector-button {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border: 0 solid;
  }
  .stellar-wallets-kit :host {
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
    tab-size: 4;
    font-family:
      ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
      "Noto Color Emoji";
    font-feature-settings: normal;
    font-variation-settings: normal;
    -webkit-tap-highlight-color: transparent;
  }
  .stellar-wallets-kit hr {
    height: 0;
    color: inherit;
    border-top-width: 1px;
  }
  .stellar-wallets-kit abbr:where([title]) {
    -webkit-text-decoration: underline dotted;
    text-decoration: underline dotted;
  }
  .stellar-wallets-kit h1,
  .stellar-wallets-kit h2,
  .stellar-wallets-kit h3,
  .stellar-wallets-kit h4,
  .stellar-wallets-kit h5,
  .stellar-wallets-kit h6 {
    font-size: inherit;
    font-weight: inherit;
  }
  .stellar-wallets-kit a {
    color: inherit;
    -webkit-text-decoration: inherit;
    text-decoration: inherit;
  }
  .stellar-wallets-kit b,
  .stellar-wallets-kit strong {
    font-weight: bolder;
  }
  .stellar-wallets-kit code,
  .stellar-wallets-kit kbd,
  .stellar-wallets-kit samp,
  .stellar-wallets-kit pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-feature-settings: normal;
    font-variation-settings: normal;
    font-size: 1em;
  }
  .stellar-wallets-kit small {
    font-size: 80%;
  }
  .stellar-wallets-kit sub,
  .stellar-wallets-kit sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
  }
  .stellar-wallets-kit sub {
    bottom: -0.25em;
  }
  .stellar-wallets-kit sup {
    top: -0.5em;
  }
  .stellar-wallets-kit table {
    text-indent: 0;
    border-color: inherit;
    border-collapse: collapse;
  }
  .stellar-wallets-kit :-moz-focusring {
    outline: auto;
  }
  .stellar-wallets-kit progress {
    vertical-align: baseline;
  }
  .stellar-wallets-kit summary {
    display: list-item;
  }
  .stellar-wallets-kit ol,
  .stellar-wallets-kit ul,
  .stellar-wallets-kit menu {
    list-style: none;
  }
  .stellar-wallets-kit img,
  .stellar-wallets-kit svg,
  .stellar-wallets-kit video,
  .stellar-wallets-kit canvas,
  .stellar-wallets-kit audio,
  .stellar-wallets-kit iframe,
  .stellar-wallets-kit embed,
  .stellar-wallets-kit object {
    display: block;
    vertical-align: middle;
  }
  .stellar-wallets-kit img,
  .stellar-wallets-kit video {
    max-width: 100%;
    height: auto;
  }
  .stellar-wallets-kit button,
  .stellar-wallets-kit input,
  .stellar-wallets-kit select,
  .stellar-wallets-kit optgroup,
  .stellar-wallets-kit textarea,
  .stellar-wallets-kit ::file-selector-button {
    font: inherit;
    font-feature-settings: inherit;
    font-variation-settings: inherit;
    letter-spacing: inherit;
    color: inherit;
    border-radius: 0;
    background-color: transparent;
    opacity: 1;
  }
  .stellar-wallets-kit :where(select:is([multiple], [size])) optgroup {
    font-weight: bolder;
  }
  .stellar-wallets-kit :where(select:is([multiple], [size])) optgroup option {
    padding-inline-start: 20px;
  }
  .stellar-wallets-kit ::file-selector-button {
    margin-inline-end: 4px;
  }
  .stellar-wallets-kit ::placeholder {
    opacity: 1;
  }
  .stellar-wallets-kit textarea {
    resize: vertical;
  }
  .stellar-wallets-kit ::-webkit-search-decoration {
    -webkit-appearance: none;
  }
  .stellar-wallets-kit ::-webkit-date-and-time-value {
    min-height: 1lh;
    text-align: inherit;
  }
  .stellar-wallets-kit ::-webkit-datetime-edit {
    display: inline-flex;
  }
  .stellar-wallets-kit ::-webkit-datetime-edit-fields-wrapper {
    padding: 0;
  }
  .stellar-wallets-kit ::-webkit-datetime-edit,
  .stellar-wallets-kit ::-webkit-datetime-edit-year-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-month-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-day-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-hour-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-minute-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-second-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-millisecond-field,
  .stellar-wallets-kit ::-webkit-datetime-edit-meridiem-field {
    padding-block: 0;
  }
  .stellar-wallets-kit ::-webkit-calendar-picker-indicator {
    line-height: 1;
  }
  .stellar-wallets-kit :-moz-ui-invalid {
    box-shadow: none;
  }
  .stellar-wallets-kit button,
  .stellar-wallets-kit input:where([type="button"], [type="reset"], [type="submit"]),
  .stellar-wallets-kit ::file-selector-button {
    appearance: button;
  }
  .stellar-wallets-kit ::-webkit-inner-spin-button,
  .stellar-wallets-kit ::-webkit-outer-spin-button {
    height: auto;
  }
  .stellar-wallets-kit [hidden]:where(:not([hidden="until-found"])) {
    display: none !important;
  }
`;var Dt=(function(t){return t.xs="xs",t.sm="sm",t.md="md",t.lg="lg",t.xl="xl",t})({}),as=(function(t){return t.primary="primary",t.secondary="secondary",t.ghost="ghost",t.free="free",t})({}),xr=(function(t){return t.regular="regular",t.icon="icon",t})({});const _T="flex items-center justify-center font-semibold easy-in-out transition leading-none";function ma({size:t=Dt.md,mode:e=as.primary,shape:r=xr.regular,classes:n,styles:s,children:i,onClick:o}){const a=zo({"border-none bg-primary text-primary-foreground shadow-default hover:opacity-70 focus:opacity-90":e===as.primary,"border-none bg-background text-foreground shadow-default hover:opacity-70 focus:opacity-90":e===as.secondary,"bg-transparent text-foreground border-transparent border-1 hover:border-light-gray":e===as.ghost}),c=zo({"rounded-default":r===xr.regular,"rounded-full":r===xr.icon}),l=zo({"text-xs":t===Dt.xs,"text-sm":t!==Dt.xs}),u=zo({"px-2 py-1":r===xr.regular&&(t===Dt.xs||t===Dt.sm),"px-2.5 py-1.5":r===xr.regular&&t===Dt.md,"px-3 py-2":r===xr.regular&&t===Dt.lg,"px-3.5 py-2.5":r===xr.regular&&t===Dt.xl,"p-1":r===xr.icon&&t===Dt.xs,"p-1.5":r===xr.icon&&t===Dt.sm,"p-2":r===xr.icon&&t===Dt.md,"p-2.5":r===xr.icon&&t===Dt.lg,"p-3":r===xr.icon&&t===Dt.xl}),h=e===as.free?"":ge(zo("cursor-pointer",_T,a,c,l,u));return tt`
    <button onClick="${()=>o()}" type="button" style="${s}" class="${h} ${n}">
      ${i}
    </button>
  `}function Xb(){ga.value=[]}function Ud(t){Df.value=t,ga.value=[...ga.value,t]}function IT(){const t=ga.value;t.pop(),ga.value=t.slice(),Df.value=t[t.length-1]}function ST({children:t,isActive:e,duration:r=300}){const[n,s]=Um(e),[i,o]=Um(e);if(NO(()=>{if(e)o(!0),globalThis.requestAnimationFrame(()=>s(!0));else{s(!1);const c=globalThis.setTimeout(()=>o(!1),r);return()=>globalThis.clearTimeout(c)}},[e,r]),!i)return null;const a={position:n?"relative":"absolute",inset:0,transition:`opacity ${r}ms ease, transform ${r}ms ease, position ${r}ms ease`,opacity:n?1:0};return tt`<div style=${a}>${t}</div>`}function CT({currentRoute:t,pages:e,duration:r=300}){const n=Object.entries(e).map(([s,i])=>tt`
      <${ST} id=${s} key=${s} isActive=${t===s} duration=${r}>
        <${i} />
      <//>
    `);return tt`<div style=${{overflow:"scroll",position:"relative",width:"100%",height:"100%"}}>${n}</div>`}function xT(){Ud(ls.HELP_PAGE)}function AT(){IT()}const $T=Ic(()=>Df.value!==ls.AUTH_OPTIONS?ga.value.length<2?tt``:tt`
      <${ma} onClick=${()=>AT()}
                 size="${Dt.md}"
                 mode="${as.ghost}"
                 shape="${xr.icon}">
        
        <svg class="${ge("w-4 h-4")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7.82843 10.9999H20V12.9999H7.82843L13.1924 18.3638L11.7782 19.778L4 11.9999L11.7782 4.22168L13.1924 5.63589L7.82843 10.9999Z"></path></svg>
      <//>
    `:tt`
      <${ma} onClick=${()=>xT()}
                 size="${Dt.md}"
                 mode="${as.ghost}"
                 shape="${xr.icon}">
        <svg class="${ge("w-4 h-4")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM11 15H13V17H11V15ZM13 13.3551V14H11V12.5C11 11.9477 11.4477 11.5 12 11.5C12.8284 11.5 13.5 10.8284 13.5 10C13.5 9.17157 12.8284 8.5 12 8.5C11.2723 8.5 10.6656 9.01823 10.5288 9.70577L8.56731 9.31346C8.88637 7.70919 10.302 6.5 12 6.5C13.933 6.5 15.5 8.067 15.5 10C15.5 11.5855 14.4457 12.9248 13 13.3551Z"></path></svg>
      <//>
    `);function NT(){return tt`
    <header class="${ge("flex items-center px-3 py-2")}">
      <div class="${ge("w-3/12 flex justify-start")}">
        ${$T.value}
      </div>

      <div class="${ge("w-6/12 text-center")}">
        <h1 class="${ge("text-foreground-strong font-semibold")}">
          ${Rf.value}
        </h1>
      </div>

      <div class="${ge("w-3/12 flex justify-end")}">
        <${ma} onClick=${()=>Jl.next()}
                   size="${Dt.md}"
                   mode="${as.ghost}"
                   shape="${xr.icon}">

          <svg class="${ge("w-4 h-4")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z"></path></svg>
        <//>
      </div>
    </header>
  `}function OT(){return tt`
    <footer class="${ge("w-full text-center p-2 border-t-1 border-t-border")}">
      <p class="${ge("text-xs text-foreground")}">
        Powered by
        <a target="_blank" href="https://stellarwalletskit.dev/" class="${ge("font-semibold underline ml-1")}">
          Stellar Wallets Kit
        </a>
      </p>
    </footer>
  `}var HS=(function(t){return t.xs="w-6 h-6",t.sm="w-8 h-8",t.md="w-10 h-10",t.lg="w-12 h-12",t.xl="w-14 h-14",t})({});const TT="inline-block rounded-full outline -outline-offset-1 outline-black/5 dark:outline-white/10";function VS(t){return tt`
    <img alt="${t.alt}" src="${t.image}" class="${ge(zo(TT,t.size))}" />
  `}const kT=Ic(()=>{const t=kS.value.reduce((s,i)=>({available:i.isAvailable?[...s.available,i]:s.available,unavailable:i.isAvailable?s.unavailable:[...s.unavailable,i]}),{available:[],unavailable:[]});let e;try{const s=globalThis?.localStorage.getItem(bn.usedWalletsIds);e=s?JSON.parse(s):[]}catch(s){console.error(s),e=[]}const r=[],n=[];for(const s of t.available)e.find(i=>i===s.id)?r.push(s):n.push(s);return[...r.sort((s,i)=>e.indexOf(s.id)-e.indexOf(i.id)),...n,...t.unavailable]});async function PT(t){if(!t.isAvailable){globalThis.open(t.url,"_blank");return}if(yi.value=t.id,KO.next(t),t.type===NS.HW_WALLET)Ud(ls.HW_ACCOUNTS_FETCHER);else try{const{address:e}=await vn.value.getAddress();gt.value=e,Pd.next(e)}catch(e){Pd.next(e)}}function RT(){return Rf.value="Connect Wallet",tt`
    <ul class="${ge("w-full grid gap-2 px-2 py-4")}">
      ${kT.value.map(t=>tt`
          <li
            onClick="${()=>PT(t)}"
            class="${ge("px-2 py-2 cursor-pointer flex justify-between items-center bg-background hover:border-light-gray border-1 border-transparent rounded-default duration-150 ease active:bg-background active:border-gray")}"
          >
            <div class="${ge("flex items-center gap-2")}">
              <${VS} class="${ge("mr-2")}" alt="${t.name} icon" image="${t.icon}" size="${HS.sm}" />
              <p class="${ge("text-foreground font-semibold")}">${t.name}</p>
            </div>

            ${OS.value&&!t.isAvailable?tt`
                <div class="${ge("ml-4 flex items-center")}">
                  <small
                    class="${ge("inline-flex items-center border-1 border-border px-2 py-1 rounded-default text-foreground-secondary text-xs bg-background-secondary")}"
                  >
                    ${zO.value}

                    <svg class="${ge("w-4 h-4")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M16.0037 9.41421L7.39712 18.0208L5.98291 16.6066L14.5895 8H7.00373V6H18.0037V17H16.0037V9.41421Z"></path>
                    </svg>
                  </small>
                </div>
              `:""}
          </li>
        `)}
    </ul>
  `}function DT(){return tt`
    <section class="${ge("w-full p-4 pb-8 rounded-tl-default")}">
      <div class="${ge("w-full mb-6")}">
        <h3 class="${ge("text-foreground-strong font-semibold text-lg mb-2")}">What is a wallet?</h3>
        <p class="${ge("text-foreground text-sm")}">
          Wallets are used to send, receive, and store the keys you use to sign blockchain transactions.
        </p>
      </div>

      <div class="w-full">
        <h3 class="${ge("text-foreground-strong font-semibold text-lg mb-2")}">What is Stellar?</h3>
        <p class="${ge("text-foreground text-sm")}">
          Stellar is a decentralized, public blockchain that gives developers the tools to create experiences that are more
          like cash than crypto.
        </p>
      </div>
    </section>
  `}function hd(t){return{code:t?.error?.code||t?.code||-1,message:t?.error?.message||t?.message||typeof t=="string"&&t||"Unhandled error from the wallet",ext:t?.error?.ext||t?.ext}}function Jw(){vn.value?.disconnect&&vn.value.disconnect(),WO(),PS.next(),Jl.next()}const Wm=vt(!1);function UT(){if(!gt.value)throw new Error("Text to copy to the clipboard can't be undefined");navigator.clipboard.writeText(gt.value).then(()=>{Wm.value=!0,setTimeout(()=>{Wm.value=!1},2500)}).catch(t=>console.error(t))}function BT(){return Rf.value="",tt`
    <section class="${ge("w-full flex flex-col pb-8")}">
      <div class="${ge("w-full flex justify-center mb-4")}">
        <${VS} alt="${vn.value?.productName} icon" image="${vn.value?.productIcon}" size="${HS.xl}" />
      </div>
      
      <div class="${ge("w-full flex items-center justify-center mb-2")}">
        <h1 class="${ge("text-lg font-semibold text-foreground")}">
          ${gt.value&&`${gt.value.slice(0,6)}....${gt.value.slice(-6)}`}
        </h1>
      </div>
      
      <div class="${ge("w-full flex flex-col items-center justify-center gap-2")}">
        <${ma} mode="${as.ghost}" onClick="${UT}" size="${Dt.sm}">
          ${Wm.value?"Address copied!":tt`Copy address`} <svg class="${ge("w-4 h-4 ml-2")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z"></path></svg>
        <//>

        <${ma} mode="${as.ghost}" onClick="${Jw}" size="${Dt.sm}">
          Disconnect <svg class="${ge("w-4 h-4 ml-2")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 11H13V13H5V16L0 12L5 8V11ZM3.99927 18H6.70835C8.11862 19.2447 9.97111 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C9.97111 4 8.11862 4.75527 6.70835 6H3.99927C5.82368 3.57111 8.72836 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C8.72836 22 5.82368 20.4289 3.99927 18Z"></path></svg>
        <//>
      </div>
    </section>
  `}const Qb={error:null,loading:!0,accounts:[]};class LT extends dc{stateSignal=vt(Qb);componentWillMount(){Rf.value="Wallet Accounts",this.fetchAccounts()}async fetchAccounts(){const e=vn.value;this.stateSignal.value=Qb,e.disconnect&&(await e.disconnect(),await new Promise(r=>setTimeout(r,500)));try{const r=await e.getAddresses();this.stateSignal.value={...this.stateSignal.value,loading:!1,accounts:r}}catch(r){this.stateSignal.value={...this.stateSignal.value,error:r.message}}}async selectAccount(e){gt.value=e.publicKey,Pd.next(e.publicKey)}render(){const e=tt`
      <div class="${ge("py-8 w-full flex justify-center items-center text-foreground")}">
        <svg class="${ge("w-8 h-8 text-gray-200 animate-spin")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 3C16.9706 3 21 7.02944 21 12H19C19 8.13401 15.866 5 12 5V3Z"></path>
        </svg>
      </div>
    `,r=tt`    
      <ul class="${ge("w-full grid gap-2 px-2 py-4 text-foreground")}">
        ${Zl.value.map(({publicKey:s,index:i})=>tt`
            <li onClick=${()=>this.selectAccount({publicKey:s,index:i})}
                class="${ge("px-2 py-2 cursor-pointer flex justify-between items-center bg-background hover:border-light-gray border-1 border-transparent rounded-default duration-150 ease active:bg-background active:border-gray")}">
              ${s.slice(0,6)}....${s.slice(-6)}

              <span class="dialog-text">(44'/148'/${i}')</span>
            </li>
          `)}
      </ul>
    `,n=tt`
      <div class="${ge("w-full text-center text-foreground py-4")}">
        <div class="${ge("text-danger")}">
          <svg class="${ge("inline-block mx-auto w-8 h-8 mb-2")}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12.8659 3.00017L22.3922 19.5002C22.6684 19.9785 22.5045 20.5901 22.0262 20.8662C21.8742 20.954 21.7017 21.0002 21.5262 21.0002H2.47363C1.92135 21.0002 1.47363 20.5525 1.47363 20.0002C1.47363 19.8246 1.51984 19.6522 1.60761 19.5002L11.1339 3.00017C11.41 2.52187 12.0216 2.358 12.4999 2.63414C12.6519 2.72191 12.7782 2.84815 12.8659 3.00017ZM4.20568 19.0002H19.7941L11.9999 5.50017L4.20568 19.0002ZM10.9999 16.0002H12.9999V18.0002H10.9999V16.0002ZM10.9999 9.00017H12.9999V14.0002H10.9999V9.00017Z"></path>
          </svg>
        </div>
        
        <h3 class="${ge("text-sm font-semibold")}">
          Error while fetching accounts with reason:
        </h3>
        
        <p class="${ge("mb-4 text-sm")}">
          ${this.stateSignal.value.error}
        </p>
        
        <div class="${ge("w-full flex justify-center items-center")}">
          <${ma} onClick=${()=>this.fetchAccounts()} size="${Dt.md}">
            Retry
          <//>
        </div>
      </div>
    `;return this.stateSignal.value.error?n:this.stateSignal.value.loading?e:r}}const MT={[ls.AUTH_OPTIONS]:RT,[ls.HELP_PAGE]:DT,[ls.PROFILE_PAGE]:BT,[ls.HW_ACCOUNTS_FETCHER]:LT},jT=Lf`
  .glass {
    backdrop-filter: blur(10px);
    background-color: color-mix(in srgb, var(--swk-background) 25%, transparent);
  }
`;function ev(){const t=ge(zo([kd.value===Zo.FIXED?"fixed flex left-0 top-0 z-[999] w-full h-full":"inline-flex","font-default justify-center items-center"]));return tt`
    <section class="stellar-wallets-kit ${t} ${ge(zS)} ${ge(jT)}">
      ${kd.value===Zo.FIXED?tt`
          <div class="${ge("absolute left-0 top-0 z-0 w-full h-full bg-[rgba(0,0,0,0.5)]")}" onClick="${()=>Jl.next()}"></div>
        `:""}

      <section
        class="${ge("w-full h-fit relative max-w-[22rem] max-h-[39.4375rem] grid grid-cols-1 grid-rows-[auto_1fr_auto] bg-background rounded-default shadow-default transition-all duration-[0.5s] ease-in-out overflow-hidden max-h-[400px] overflow-y-scroll")}"
      >
        <div class="${ge("col-span-1 top-0 sticky z-50")} glass">
          <${NT} />
        </div>

        <div class="${ge("col-span-1 relative z-10")}">
          <${CT}
            currentRoute="${Df.value}"
            pages="${MT}"
            duration="${400}"
          />
        </div>

        <div class="${ge("col-span-1 bottom-0 sticky z-50")} glass">
          <${OT} />
        </div>
      </section>
    </section>
  `}async function FT(t){if(t&&t(),typeof Dl.value>"u")throw new Error("The kit hasn't been initiated.");!vn.value||!gt.value?await ir.authModal():await ir.profileModal()}function qT(t){const e=gt.value?`${gt.value.slice(0,4)}....${gt.value.slice(-6)}`:"Connect Wallet";return tt`
    <div class="${ge(zS)} ${ge("inline-block")}">      
      <${ma} styles=${t.styles} 
                 classes=${t.classes}
                 mode=${t.mode||as.primary}
                 shape=${t.shape||xr.regular}
                 size=${t.size}
                 onClick=${()=>FT(t.onClick)}>        
        ${t.children?t.children:e}
      <//>
    </div>
  `}class ir{static init(e){Dl.value=e.modules,e.selectedWalletId&&ir.setWallet(e.selectedWalletId),e.network&&ir.setNetwork(e.network),e.theme&&ir.setTheme(e.theme),e.authModal&&(typeof e.authModal.showInstallLabel<"u"&&(OS.value=e.authModal.showInstallLabel),typeof e.authModal.hideUnsupportedWallets<"u"&&(qO.value=e.authModal.hideUnsupportedWallets))}static get selectedModule(){if(!vn.value)throw{code:-3,message:"Please set the wallet first"};return vn.value}static setWallet(e){const r=Dl.value.find(n=>n.productId===e);if(!r)throw new Error(`Wallet id "${e}" is not and existing module`);yi.value=r.productId}static setNetwork(e){xs.value=e}static setTheme(e=$S){TS.value=e}static async getAddress(){if(!gt.value)throw{code:-1,message:"No wallet has been connected."};return{address:gt.value}}static signTransaction(e,r){return ir.selectedModule.signTransaction(e,{...r,networkPassphrase:r?.networkPassphrase||xs.value})}static signAuthEntry(e,r){return ir.selectedModule.signAuthEntry(e,{...r,networkPassphrase:r?.networkPassphrase||xs.value})}static signMessage(e,r){return ir.selectedModule.signMessage(e,{...r,networkPassphrase:r?.networkPassphrase||xs.value})}static getNetwork(){return ir.selectedModule.getNetwork()}static async disconnect(){Jw()}static on(e,r){switch(e){case Gi.STATE_UPDATED:{let n,s;return ds(()=>{(gt.value!==n||xs.value!==s)&&(n=gt.value,s=xs.value,r({eventType:Gi.STATE_UPDATED,payload:{address:gt.value,networkPassphrase:xs.value}}))})}case Gi.WALLET_SELECTED:{let n;return ds(()=>{yi.value!==n&&(n=yi.value,r({eventType:Gi.WALLET_SELECTED,payload:{id:yi.value}}))})}case Gi.DISCONNECT:return PS.subscribe(()=>{r({eventType:Gi.DISCONNECT,payload:{}})});default:throw new Error(`${e} event type is not supported`)}}static async refreshSupportedWallets(){const e=await Promise.all(Dl.value.map(async r=>{const n=new Promise(s=>setTimeout(()=>s(!1),1e3));return{id:r.productId,name:r.productName,type:r.moduleType,icon:r.productIcon,isAvailable:await Promise.race([n,r.isAvailable()]),url:r.productUrl}}));return kS.value=e,e}static async createButton(e,r={}){Yc(tt`
        <${qT}
          styles="${r.styles}"
          classes="${r.classes}"
          mode="${r.mode}"
          shape="${r.shape}"
          size="${r.size}"
          onClick="${()=>r.onClick&&r.onClick()}"
          children="${r.children}"
        />
      `,e)}static async authModal(e){Xb(),Ud(ls.AUTH_OPTIONS),kd.value=e?.container?Zo.BLOCK:Zo.FIXED,await ir.refreshSupportedWallets();const r=document.createElement("div");(e?.container||document.body).appendChild(r),Yc(tt`
        <${ev} />
      `,r);const n=[],s=()=>{for(const i of n)i();Yc(null,r),r.parentNode?.removeChild(r)};return new Promise((i,o)=>{const a=Pd.subscribe(l=>{typeof l=="string"?i({address:l}):o(hd(l))}),c=Jl.subscribe(()=>{o({code:-1,message:"The user closed the modal."})});n.push(a),n.push(c)}).then(i=>(s(),i)).catch(i=>{throw s(),i})}static async profileModal(e){if(!gt.value)throw{code:-1,message:"There is no active address, the user needs to authenticate first."};Xb(),Ud(ls.PROFILE_PAGE),kd.value=e?.container?Zo.BLOCK:Zo.FIXED;const r=document.createElement("div");(e?.container||document.body).appendChild(r),Yc(tt`
        <${ev} />
      `,r);const n=Jl.subscribe(()=>{n(),Yc(null,r),r.parentNode?.removeChild(r)})}}var $s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function WS(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return t[n]}})}),r}var wh={exports:{}},tv;function zT(){if(tv)return wh.exports;tv=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(C,N,P){return Function.prototype.apply.call(C,N,P)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:r=function(C){return Object.getOwnPropertyNames(C)};function n(b){console&&console.warn&&console.warn(b)}var s=Number.isNaN||function(C){return C!==C};function i(){i.init.call(this)}wh.exports=i,wh.exports.once=I,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||s(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(C){if(typeof C!="number"||C<0||s(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this};function c(b){return b._maxListeners===void 0?i.defaultMaxListeners:b._maxListeners}i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(C){for(var N=[],P=1;P<arguments.length;P++)N.push(arguments[P]);var R=C==="error",O=this._events;if(O!==void 0)R=R&&O.error===void 0;else if(!R)return!1;if(R){var M;if(N.length>0&&(M=N[0]),M instanceof Error)throw M;var j=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw j.context=M,j}var k=O[C];if(k===void 0)return!1;if(typeof k=="function")e(k,this,N);else for(var $=k.length,T=g(k,$),P=0;P<$;++P)e(T[P],this,N);return!0};function l(b,C,N,P){var R,O,M;if(a(N),O=b._events,O===void 0?(O=b._events=Object.create(null),b._eventsCount=0):(O.newListener!==void 0&&(b.emit("newListener",C,N.listener?N.listener:N),O=b._events),M=O[C]),M===void 0)M=O[C]=N,++b._eventsCount;else if(typeof M=="function"?M=O[C]=P?[N,M]:[M,N]:P?M.unshift(N):M.push(N),R=c(b),R>0&&M.length>R&&!M.warned){M.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(C)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=b,j.type=C,j.count=M.length,n(j)}return b}i.prototype.addListener=function(C,N){return l(this,C,N,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(C,N){return l(this,C,N,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(b,C,N){var P={fired:!1,wrapFn:void 0,target:b,type:C,listener:N},R=u.bind(P);return R.listener=N,P.wrapFn=R,R}i.prototype.once=function(C,N){return a(N),this.on(C,h(this,C,N)),this},i.prototype.prependOnceListener=function(C,N){return a(N),this.prependListener(C,h(this,C,N)),this},i.prototype.removeListener=function(C,N){var P,R,O,M,j;if(a(N),R=this._events,R===void 0)return this;if(P=R[C],P===void 0)return this;if(P===N||P.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete R[C],R.removeListener&&this.emit("removeListener",C,P.listener||N));else if(typeof P!="function"){for(O=-1,M=P.length-1;M>=0;M--)if(P[M]===N||P[M].listener===N){j=P[M].listener,O=M;break}if(O<0)return this;O===0?P.shift():m(P,O),P.length===1&&(R[C]=P[0]),R.removeListener!==void 0&&this.emit("removeListener",C,j||N)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(C){var N,P,R;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[C]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[C]),this;if(arguments.length===0){var O=Object.keys(P),M;for(R=0;R<O.length;++R)M=O[R],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=P[C],typeof N=="function")this.removeListener(C,N);else if(N!==void 0)for(R=N.length-1;R>=0;R--)this.removeListener(C,N[R]);return this};function d(b,C,N){var P=b._events;if(P===void 0)return[];var R=P[C];return R===void 0?[]:typeof R=="function"?N?[R.listener||R]:[R]:N?w(R):g(R,R.length)}i.prototype.listeners=function(C){return d(this,C,!0)},i.prototype.rawListeners=function(C){return d(this,C,!1)},i.listenerCount=function(b,C){return typeof b.listenerCount=="function"?b.listenerCount(C):p.call(b,C)},i.prototype.listenerCount=p;function p(b){var C=this._events;if(C!==void 0){var N=C[b];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function g(b,C){for(var N=new Array(C),P=0;P<C;++P)N[P]=b[P];return N}function m(b,C){for(;C+1<b.length;C++)b[C]=b[C+1];b.pop()}function w(b){for(var C=new Array(b.length),N=0;N<C.length;++N)C[N]=b[N].listener||b[N];return C}function I(b,C){return new Promise(function(N,P){function R(M){b.removeListener(C,O),P(M)}function O(){typeof b.removeListener=="function"&&b.removeListener("error",R),N([].slice.call(arguments))}v(b,C,O,{once:!0}),C!=="error"&&S(b,R,{once:!0})})}function S(b,C,N){typeof b.on=="function"&&v(b,"error",C,N)}function v(b,C,N,P){if(typeof b.on=="function")P.once?b.once(C,N):b.on(C,N);else if(typeof b.addEventListener=="function")b.addEventListener(C,function R(O){P.once&&b.removeEventListener(C,R),N(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return wh.exports}var mt=zT();const Hu=zu(mt);var Dp={};var Km=function(t,e){return Km=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Km(t,e)};function HT(t,e){Km(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Gm=function(){return Gm=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Gm.apply(this,arguments)};function VT(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function WT(t,e,r,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(s<3?o(i):s>3?o(e,r,i):o(e,r))||i);return s>3&&i&&Object.defineProperty(e,r,i),i}function KT(t,e){return function(r,n){e(r,n,t)}}function GT(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function YT(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function ZT(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function JT(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function XT(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ym(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function KS(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function QT(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(KS(arguments[e]));return t}function ek(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),s=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function eu(t){return this instanceof eu?(this.v=t,this):new eu(t)}function tk(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){n[d]&&(s[d]=function(p){return new Promise(function(g,m){i.push([d,p,g,m])>1||a(d,p)})})}function a(d,p){try{c(n[d](p))}catch(g){h(i[0][3],g)}}function c(d){d.value instanceof eu?Promise.resolve(d.value.v).then(l,u):h(i[0][2],d)}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,p){d(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}function rk(t){var e,r;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=t[s]?function(o){return(r=!r)?{value:eu(t[s](o)),done:s==="return"}:i?i(o):o}:i}}function nk(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ym=="function"?Ym(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}}function sk(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function ik(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function ok(t){return t&&t.__esModule?t:{default:t}}function ak(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function ck(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const lk=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Gm},__asyncDelegator:rk,__asyncGenerator:tk,__asyncValues:nk,__await:eu,__awaiter:YT,__classPrivateFieldGet:ak,__classPrivateFieldSet:ck,__createBinding:JT,__decorate:WT,__exportStar:XT,__extends:HT,__generator:ZT,__importDefault:ok,__importStar:ik,__makeTemplateObject:sk,__metadata:GT,__param:KT,__read:KS,__rest:VT,__spread:QT,__spreadArrays:ek,__values:Ym},Symbol.toStringTag,{value:"Module"})),jf=WS(lk);var Up={},Jc={},rv;function uk(){if(rv)return Jc;rv=1,Object.defineProperty(Jc,"__esModule",{value:!0}),Jc.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Jc.delay=t,Jc}var No={},Bp={},Oo={},nv;function hk(){return nv||(nv=1,Object.defineProperty(Oo,"__esModule",{value:!0}),Oo.ONE_THOUSAND=Oo.ONE_HUNDRED=void 0,Oo.ONE_HUNDRED=100,Oo.ONE_THOUSAND=1e3),Oo}var Lp={},sv;function dk(){return sv||(sv=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(Lp)),Lp}var iv;function GS(){return iv||(iv=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jf;e.__exportStar(hk(),t),e.__exportStar(dk(),t)})(Bp)),Bp}var ov;function fk(){if(ov)return No;ov=1,Object.defineProperty(No,"__esModule",{value:!0}),No.fromMiliseconds=No.toMiliseconds=void 0;const t=GS();function e(n){return n*t.ONE_THOUSAND}No.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return No.fromMiliseconds=r,No}var av;function pk(){return av||(av=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jf;e.__exportStar(uk(),t),e.__exportStar(fk(),t)})(Up)),Up}var Ma={},cv;function gk(){if(cv)return Ma;cv=1,Object.defineProperty(Ma,"__esModule",{value:!0}),Ma.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:s})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return Ma.Watch=t,Ma.default=t,Ma}var Mp={},Xc={},lv;function mk(){if(lv)return Xc;lv=1,Object.defineProperty(Xc,"__esModule",{value:!0}),Xc.IWatch=void 0;class t{}return Xc.IWatch=t,Xc}var uv;function yk(){return uv||(uv=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),jf.__exportStar(mk(),t)})(Mp)),Mp}var hv;function wk(){return hv||(hv=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jf;e.__exportStar(pk(),t),e.__exportStar(gk(),t),e.__exportStar(yk(),t),e.__exportStar(GS(),t)})(Dp)),Dp}var z=wk();let nn=class{},bk=class extends nn{constructor(e){super()}};const dv=z.FIVE_SECONDS,Aa={pulse:"heartbeat_pulse"};let vk=class YS extends bk{constructor(e){super(e),this.events=new mt.EventEmitter,this.interval=dv,this.interval=e?.interval||dv}static async init(e){const r=new YS(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),z.toMiliseconds(this.interval))}pulse(){this.events.emit(Aa.pulse)}};const Ek=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,_k=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Ik=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Sk(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Ck(t);return}return e}function Ck(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function bh(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Ik.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Ek.test(t)||_k.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Sk)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function xk(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Ht(t,...e){try{return xk(t(...e))}catch(r){return Promise.reject(r)}}function Ak(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function $k(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function dd(t){if(Ak(t))return String(t);if($k(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return dd(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Zm="base64:";function Nk(t){return typeof t=="string"?t:Zm+kk(t)}function Ok(t){return typeof t!="string"||!t.startsWith(Zm)?t:Tk(t.slice(Zm.length))}function Tk(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function kk(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Hr(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Pk(...t){return Hr(t.join(":"))}function vh(t){return t=Hr(t),t?t+":":""}function Rk(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function Dk(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Uk="memory",Bk=()=>{const t=new Map;return{name:Uk,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Lk(t={}){const e={mounts:{"":t.driver||Bk()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},n=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=Hr(u);for(const h of e.watchListeners)h(l,u)}},i=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await fv(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const d=new Map,p=g=>{let m=d.get(g.base);return m||(m={driver:g.driver,base:g.base,items:[]},d.set(g.base,m)),m};for(const g of l){const m=typeof g=="string",w=Hr(m?g:g.key),I=m?void 0:g.value,S=m||!g.options?u:{...u,...g.options},v=r(w);p(v).items.push({key:w,value:I,relativeKey:v.relativeKey,options:S})}return Promise.all([...d.values()].map(g=>h(g))).then(g=>g.flat())},c={hasItem(l,u={}){l=Hr(l);const{relativeKey:h,driver:d}=r(l);return Ht(d.hasItem,h,u)},getItem(l,u={}){l=Hr(l);const{relativeKey:h,driver:d}=r(l);return Ht(d.getItem,h,u).then(p=>bh(p))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?Ht(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(p=>({key:Pk(h.base,p.key),value:bh(p.value)}))):Promise.all(h.items.map(d=>Ht(h.driver.getItem,d.relativeKey,d.options).then(p=>({key:d.key,value:bh(p)})))))},getItemRaw(l,u={}){l=Hr(l);const{relativeKey:h,driver:d}=r(l);return d.getItemRaw?Ht(d.getItemRaw,h,u):Ht(d.getItem,h,u).then(p=>Ok(p))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Hr(l);const{relativeKey:d,driver:p}=r(l);p.setItem&&(await Ht(p.setItem,d,dd(u),h),p.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return Ht(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:dd(d.value),options:d.options})),u);h.driver.setItem&&await Promise.all(h.items.map(d=>Ht(h.driver.setItem,d.relativeKey,dd(d.value),d.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Hr(l);const{relativeKey:d,driver:p}=r(l);if(p.setItemRaw)await Ht(p.setItemRaw,d,u,h);else if(p.setItem)await Ht(p.setItem,d,Nk(u),h);else return;p.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Hr(l);const{relativeKey:h,driver:d}=r(l);d.removeItem&&(await Ht(d.removeItem,h,u),(u.removeMeta||u.removeMata)&&await Ht(d.removeItem,h+"$",u),d.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Hr(l);const{relativeKey:h,driver:d}=r(l),p=Object.create(null);if(d.getMeta&&Object.assign(p,await Ht(d.getMeta,h,u)),!u.nativeOnly){const g=await Ht(d.getItem,h+"$",u).then(m=>bh(m));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(p,g))}return p},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=vh(l);const h=n(l,!0);let d=[];const p=[];let g=!0;for(const w of h){w.driver.flags?.maxDepth||(g=!1);const I=await Ht(w.driver.getKeys,w.relativeBase,u);for(const S of I){const v=w.mountpoint+Hr(S);d.some(b=>v.startsWith(b))||p.push(v)}d=[w.mountpoint,...d.filter(S=>!S.startsWith(w.mountpoint))]}const m=u.maxDepth!==void 0&&!g;return p.filter(w=>(!m||Rk(w,u.maxDepth))&&Dk(w,l))},async clear(l,u={}){l=vh(l),await Promise.all(n(l,!1).map(async h=>{if(h.driver.clear)return Ht(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(d.map(p=>h.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>pv(l)))},async watch(l){return await i(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=vh(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(fv(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){l=vh(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await pv(e.mounts[l]),e.mountpoints=e.mountpoints.filter(h=>h!==l),delete e.mounts[l])},getMount(l=""){l=Hr(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Hr(l),n(l,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function fv(t,e,r){return t.watch?t.watch((n,s)=>e(n,r+s)):()=>{}}async function pv(t){typeof t.dispose=="function"&&await Ht(t.dispose)}function $a(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function ZS(t,e){let r;const n=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=$a(s),r.then(i=>{i.onclose=()=>r=void 0},()=>{}),r};return(s,i)=>n().then(o=>i(o.transaction(e,s).objectStore(e)))}let jp;function Vu(){return jp||(jp=ZS("keyval-store","keyval")),jp}function gv(t,e=Vu()){return e("readonly",r=>$a(r.get(t)))}function Mk(t,e,r=Vu()){return r("readwrite",n=>(n.put(e,t),$a(n.transaction)))}function jk(t,e=Vu()){return e("readwrite",r=>(r.delete(t),$a(r.transaction)))}function Fk(t=Vu()){return t("readwrite",e=>(e.clear(),$a(e.transaction)))}function qk(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},$a(t.transaction)}function zk(t=Vu()){return t("readonly",e=>{if(e.getAllKeys)return $a(e.getAllKeys());const r=[];return qk(e,n=>r.push(n.key)).then(()=>r)})}const Hk=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Vk=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Ls(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Vk(t)}catch{return t}}function Br(t){return typeof t=="string"?t:Hk(t)||""}const Wk="idb-keyval";var Kk=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let n;return t.dbName&&t.storeName&&(n=ZS(t.dbName,t.storeName)),{name:Wk,options:t,async hasItem(s){return!(typeof await gv(r(s),n)>"u")},async getItem(s){return await gv(r(s),n)??null},setItem(s,i){return Mk(r(s),i,n)},removeItem(s){return jk(r(s),n)},getKeys(){return zk(n)},clear(){return Fk(n)}}};const Gk="WALLET_CONNECT_V2_INDEXED_DB",Yk="keyvaluestorage";let Zk=class{constructor(){this.indexedDb=Lk({driver:Kk({dbName:Gk,storeName:Yk})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Br(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Fp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fd={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Fp<"u"&&Fp.localStorage?fd.exports=Fp.localStorage:typeof window<"u"&&window.localStorage?fd.exports=window.localStorage:fd.exports=new e})();function Jk(t){var e;return[t[0],Ls((e=t[1])!=null?e:"")]}let Xk=class{constructor(){this.localStorage=fd.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Jk)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Ls(r)}async setItem(e,r){this.localStorage.setItem(e,Br(r))}async removeItem(e){this.localStorage.removeItem(e)}};const Qk="wc_storage_version",mv=1,eP=async(t,e,r)=>{const n=Qk,s=await e.getItem(n);if(s&&s>=mv){r(e);return}const i=await t.getKeys();if(!i.length){r(e);return}const o=[];for(;i.length;){const a=i.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(n,mv),r(e),tP(t,o)},tP=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let JS=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Xk;this.storage=e;try{const r=new Zk;eP(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Qc={exports:{}},qp,yv;function Xw(){if(yv)return qp;yv=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}qp=e;function e(r,n,s){var i=s&&s.stringify||t,o=1;if(typeof r=="object"&&r!==null){var a=n.length+o;if(a===1)return r;var c=new Array(a);c[0]=i(r);for(var l=1;l<a;l++)c[l]=i(n[l]);return c.join(" ")}if(typeof r!="string")return r;var u=n.length;if(u===0)return r;for(var h="",d=1-o,p=-1,g=r&&r.length||0,m=0;m<g;){if(r.charCodeAt(m)===37&&m+1<g){switch(p=p>-1?p:0,r.charCodeAt(m+1)){case 100:case 102:if(d>=u||n[d]==null)break;p<m&&(h+=r.slice(p,m)),h+=Number(n[d]),p=m+2,m++;break;case 105:if(d>=u||n[d]==null)break;p<m&&(h+=r.slice(p,m)),h+=Math.floor(Number(n[d])),p=m+2,m++;break;case 79:case 111:case 106:if(d>=u||n[d]===void 0)break;p<m&&(h+=r.slice(p,m));var w=typeof n[d];if(w==="string"){h+="'"+n[d]+"'",p=m+2,m++;break}if(w==="function"){h+=n[d].name||"<anonymous>",p=m+2,m++;break}h+=i(n[d]),p=m+2,m++;break;case 115:if(d>=u)break;p<m&&(h+=r.slice(p,m)),h+=String(n[d]),p=m+2,m++;break;case 37:p<m&&(h+=r.slice(p,m)),h+="%",p=m+2,m++,d--;break}++d}++m}return p===-1?r:(p<g&&(h+=r.slice(p)),h)}return qp}var wv;function rP(){if(wv)return Qc.exports;wv=1;const t=Xw();Qc.exports=u;const e=T().console||{},r={mapHttpRequest:P,mapHttpResponse:P,wrapRequestSerializer:R,wrapResponseSerializer:R,wrapErrorSerializer:R,req:P,res:P,err:C,errWithCause:C};function n(f,y){return f==="silent"?1/0:y.levels.values[f]}const s=Symbol("pino.logFuncs"),i=Symbol("pino.hierarchy"),o={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function a(f,y){const E={logger:y,parent:f[i]};y[i]=E}function c(f,y,E){const x={};y.forEach(_=>{x[_]=E[_]?E[_]:e[_]||e[o[_]||"log"]||O}),f[s]=x}function l(f,y){return Array.isArray(f)?f.filter(function(x){return x!=="!stdSerializers.err"}):f===!0?Object.keys(y):!1}function u(f){f=f||{},f.browser=f.browser||{};const y=f.browser.transmit;if(y&&typeof y.send!="function")throw Error("pino: transmit option must have a send function");const E=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const x=f.serializers||{},_=l(f.browser.serialize,x);let A=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(A=!1);const L=Object.keys(f.customLevels||{}),B=["error","fatal","warn","info","debug","trace"].concat(L);typeof E=="function"&&B.forEach(function(G){E[G]=E}),(f.enabled===!1||f.browser.disabled)&&(f.level="silent");const q=f.level||"info",D=Object.create(E);D.log||(D.log=O),c(D,B,E),a({},D),Object.defineProperty(D,"levelVal",{get:H}),Object.defineProperty(D,"level",{get:W,set:ee});const F={transmit:y,serialize:_,asObject:f.browser.asObject,asObjectBindingsOnly:f.browser.asObjectBindingsOnly,formatters:f.browser.formatters,levels:B,timestamp:N(f),messageKey:f.messageKey||"msg",onChild:f.onChild||O};D.levels=h(f),D.level=q,D.isLevelEnabled=function(G){return this.levels.values[G]?this.levels.values[G]>=this.levels.values[this.level]:!1},D.setMaxListeners=D.getMaxListeners=D.emit=D.addListener=D.on=D.prependListener=D.once=D.prependOnceListener=D.removeListener=D.removeAllListeners=D.listeners=D.listenerCount=D.eventNames=D.write=D.flush=O,D.serializers=x,D._serialize=_,D._stdErrSerialize=A,D.child=function(...G){return K.call(this,F,...G)},y&&(D._logEvent=b());function H(){return n(this.level,this)}function W(){return this._level}function ee(G){if(G!=="silent"&&!this.levels.values[G])throw Error("unknown level "+G);this._level=G,g(this,F,D,"error"),g(this,F,D,"fatal"),g(this,F,D,"warn"),g(this,F,D,"info"),g(this,F,D,"debug"),g(this,F,D,"trace"),L.forEach(le=>{g(this,F,D,le)})}function K(G,le,ye){if(!le)throw new Error("missing bindings for child Pino");ye=ye||{},_&&le.serializers&&(ye.serializers=le.serializers);const ve=ye.serializers;if(_&&ve){var Ee=Object.assign({},x,ve),Ke=f.browser.serialize===!0?Object.keys(Ee):_;delete le.serializers,S([le],Ke,Ee,this._stdErrSerialize)}function gr(mr){this._childLevel=(mr._childLevel|0)+1,this.bindings=le,Ee&&(this.serializers=Ee,this._serialize=Ke),y&&(this._logEvent=b([].concat(mr._logEvent.bindings,le)))}gr.prototype=this;const Ot=new gr(this);return a(this,Ot),Ot.child=function(...mr){return K.call(this,G,...mr)},Ot.level=ye.level||this.level,G.onChild(Ot),Ot}return D}function h(f){const y=f.customLevels||{},E=Object.assign({},u.levels.values,y),x=Object.assign({},u.levels.labels,d(y));return{values:E,labels:x}}function d(f){const y={};return Object.keys(f).forEach(function(E){y[f[E]]=E}),y}u.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},u.stdSerializers=r,u.stdTimeFunctions=Object.assign({},{nullTime:M,epochTime:j,unixTime:k,isoTime:$});function p(f){const y=[];f.bindings&&y.push(f.bindings);let E=f[i];for(;E.parent;)E=E.parent,E.logger.bindings&&y.push(E.logger.bindings);return y.reverse()}function g(f,y,E,x){if(Object.defineProperty(f,x,{value:n(f.level,E)>n(x,E)?O:E[s][x],writable:!0,enumerable:!0,configurable:!0}),f[x]===O){if(!y.transmit)return;const A=y.transmit.level||f.level,L=n(A,E);if(n(x,E)<L)return}f[x]=w(f,y,E,x);const _=p(f);_.length!==0&&(f[x]=m(_,f[x]))}function m(f,y){return function(){return y.apply(this,[...f,...arguments])}}function w(f,y,E,x){return(function(_){return function(){const L=y.timestamp(),B=new Array(arguments.length),q=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var D=0;D<B.length;D++)B[D]=arguments[D];var F=!1;if(y.serialize&&(S(B,this._serialize,this.serializers,this._stdErrSerialize),F=!0),y.asObject||y.formatters?_.call(q,...I(this,x,B,L,y)):_.apply(q,B),y.transmit){const H=y.transmit.level||f._level,W=n(H,E),ee=n(x,E);if(ee<W)return;v(this,{ts:L,methodLevel:x,methodValue:ee,transmitValue:E.levels.values[y.transmit.level||f._level],send:y.transmit.send,val:n(f._level,E)},B,F)}}})(f[s][x])}function I(f,y,E,x,_){const{level:A,log:L=H=>H}=_.formatters||{},B=E.slice();let q=B[0];const D={};let F=(f._childLevel|0)+1;if(F<1&&(F=1),x&&(D.time=x),A){const H=A(y,f.levels.values[y]);Object.assign(D,H)}else D.level=f.levels.values[y];if(_.asObjectBindingsOnly){if(q!==null&&typeof q=="object")for(;F--&&typeof B[0]=="object";)Object.assign(D,B.shift());return[L(D),...B]}else{if(q!==null&&typeof q=="object"){for(;F--&&typeof B[0]=="object";)Object.assign(D,B.shift());q=B.length?t(B.shift(),B):void 0}else typeof q=="string"&&(q=t(B.shift(),B));return q!==void 0&&(D[_.messageKey]=q),[L(D)]}}function S(f,y,E,x){for(const _ in f)if(x&&f[_]instanceof Error)f[_]=u.stdSerializers.err(f[_]);else if(typeof f[_]=="object"&&!Array.isArray(f[_])&&y)for(const A in f[_])y.indexOf(A)>-1&&A in E&&(f[_][A]=E[A](f[_][A]))}function v(f,y,E,x=!1){const _=y.send,A=y.ts,L=y.methodLevel,B=y.methodValue,q=y.val,D=f._logEvent.bindings;x||S(E,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=A,f._logEvent.messages=E.filter(function(F){return D.indexOf(F)===-1}),f._logEvent.level.label=L,f._logEvent.level.value=B,_(L,f._logEvent,q),f._logEvent=b(D)}function b(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function C(f){const y={type:f.constructor.name,msg:f.message,stack:f.stack};for(const E in f)y[E]===void 0&&(y[E]=f[E]);return y}function N(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?M:j}function P(){return{}}function R(f){return f}function O(){}function M(){return!1}function j(){return Date.now()}function k(){return Math.round(Date.now()/1e3)}function $(){return new Date(Date.now()).toISOString()}function T(){function f(y){return typeof y<"u"&&y}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return Qc.exports.default=u,Qc.exports.pino=u,Qc.exports}var tc=rP();const XS=zu(tc),nP={level:"info"},Ff="custom_context",Qw=1e3*1024;var sP=Object.defineProperty,iP=(t,e,r)=>e in t?sP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,no=(t,e,r)=>iP(t,typeof e!="symbol"?e+"":e,r);let oP=class{constructor(e){no(this,"nodeValue"),no(this,"sizeInBytes"),no(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},bv=class{constructor(e){no(this,"lengthInNodes"),no(this,"sizeInBytes"),no(this,"head"),no(this,"tail"),no(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new oP(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};var aP=Object.defineProperty,cP=(t,e,r)=>e in t?aP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eh=(t,e,r)=>cP(t,typeof e!="symbol"?e+"":e,r);let QS=class{constructor(e,r=Qw){Eh(this,"logs"),Eh(this,"level"),Eh(this,"levelValue"),Eh(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=tc.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new bv(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===tc.levels.values.error?console.error(e):r===tc.levels.values.warn?console.warn(e):r===tc.levels.values.debug?console.debug(e):r===tc.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Br({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new bv(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Br({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var lP=Object.defineProperty,uP=(t,e,r)=>e in t?lP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hP=(t,e,r)=>uP(t,e+"",r);let dP=class{constructor(e,r=Qw){hP(this,"baseChunkLogger"),this.baseChunkLogger=new QS(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var fP=Object.defineProperty,pP=(t,e,r)=>e in t?fP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gP=(t,e,r)=>pP(t,e+"",r);let mP=class{constructor(e,r=Qw){gP(this,"baseChunkLogger"),this.baseChunkLogger=new QS(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var yP=Object.defineProperty,wP=Object.defineProperties,bP=Object.getOwnPropertyDescriptors,vv=Object.getOwnPropertySymbols,vP=Object.prototype.hasOwnProperty,EP=Object.prototype.propertyIsEnumerable,Ev=(t,e,r)=>e in t?yP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bd=(t,e)=>{for(var r in e||(e={}))vP.call(e,r)&&Ev(t,r,e[r]);if(vv)for(var r of vv(e))EP.call(e,r)&&Ev(t,r,e[r]);return t},Ld=(t,e)=>wP(t,bP(e));function _P(t){return Ld(Bd({},t),{level:t?.level||nP.level})}function IP(t,e,r=Ff){return t[r]=e,t}function sn(t,e=Ff){return t[e]||""}function SP(t,e,r=Ff){const n=sn(t,r);return n.trim()?`${n}/${e}`:e}function In(t,e,r=Ff){const n=SP(t,e,r),s=t.child({context:n});return IP(s,n,r)}function CP(t){var e,r;const n=new dP((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:XS(Ld(Bd({},t.opts),{level:"trace",browser:Ld(Bd({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function xP(t){var e;const r=new mP((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:XS(Ld(Bd({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function eC(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?CP(t):xP(t)}var AP=Object.defineProperty,$P=(t,e,r)=>e in t?AP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_v=(t,e,r)=>$P(t,typeof e!="symbol"?e+"":e,r);let NP=class extends nn{constructor(e){super(),this.opts=e,_v(this,"protocol","wc"),_v(this,"version",2)}};var OP=Object.defineProperty,TP=(t,e,r)=>e in t?OP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kP=(t,e,r)=>TP(t,e+"",r);let PP=class extends nn{constructor(e,r){super(),this.core=e,this.logger=r,kP(this,"records",new Map)}},RP=class{constructor(e,r){this.logger=e,this.core=r}},DP=class extends nn{constructor(e,r){super(),this.relayer=e,this.logger=r}},UP=class extends nn{constructor(e){super()}},BP=class{constructor(e,r,n,s){this.core=e,this.logger=r,this.name=n}},LP=class extends nn{constructor(e,r){super(),this.relayer=e,this.logger=r}},MP=class extends nn{constructor(e,r){super(),this.core=e,this.logger=r}},jP=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},FP=class{constructor(e,r){this.projectId=e,this.logger=r}},qP=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}};var zP=Object.defineProperty,HP=(t,e,r)=>e in t?zP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Iv=(t,e,r)=>HP(t,typeof e!="symbol"?e+"":e,r);let VP=class{constructor(e){this.opts=e,Iv(this,"protocol","wc"),Iv(this,"version",2)}},WP=class{constructor(e){this.client=e}};function KP(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tC(t,...e){if(!KP(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Sv(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function GP(t,e){tC(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ja=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const zp=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function YP(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function rC(t){return typeof t=="string"&&(t=YP(t)),tC(t),t}let ZP=class{clone(){return this._cloneInto()}};function JP(t){const e=n=>t().update(rC(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function nC(t=32){if(ja&&typeof ja.getRandomValues=="function")return ja.getRandomValues(new Uint8Array(t));if(ja&&typeof ja.randomBytes=="function")return ja.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function XP(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}let QP=class extends ZP{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zp(this.buffer)}update(e){Sv(this);const{view:r,buffer:n,blockLen:s}=this;e=rC(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=zp(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Sv(this),GP(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;XP(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=zp(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}};const _h=BigInt(2**32-1),Jm=BigInt(32);function sC(t,e=!1){return e?{h:Number(t&_h),l:Number(t>>Jm&_h)}:{h:Number(t>>Jm&_h)|0,l:Number(t&_h)|0}}function e8(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:i,l:o}=sC(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}const t8=(t,e)=>BigInt(t>>>0)<<Jm|BigInt(e>>>0),r8=(t,e,r)=>t>>>r,n8=(t,e,r)=>t<<32-r|e>>>r,s8=(t,e,r)=>t>>>r|e<<32-r,i8=(t,e,r)=>t<<32-r|e>>>r,o8=(t,e,r)=>t<<64-r|e>>>r-32,a8=(t,e,r)=>t>>>r-32|e<<64-r,c8=(t,e)=>e,l8=(t,e)=>t,u8=(t,e,r)=>t<<r|e>>>32-r,h8=(t,e,r)=>e<<r|t>>>32-r,d8=(t,e,r)=>e<<r-32|t>>>64-r,f8=(t,e,r)=>t<<r-32|e>>>64-r;function p8(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const g8=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),m8=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,y8=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),w8=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,b8=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),v8=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,_e={fromBig:sC,split:e8,toBig:t8,shrSH:r8,shrSL:n8,rotrSH:s8,rotrSL:i8,rotrBH:o8,rotrBL:a8,rotr32H:c8,rotr32L:l8,rotlSH:u8,rotlSL:h8,rotlBH:d8,rotlBL:f8,add:p8,add3L:g8,add3H:m8,add4L:y8,add4H:w8,add5H:v8,add5L:b8},[E8,_8]=_e.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),$i=new Uint32Array(80),Ni=new Uint32Array(80);let I8=class extends QP{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:p,Gl:g,Hh:m,Hl:w}=this;return[e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w]}set(e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=g|0,this.Hh=m|0,this.Hl=w|0}process(e,r){for(let v=0;v<16;v++,r+=4)$i[v]=e.getUint32(r),Ni[v]=e.getUint32(r+=4);for(let v=16;v<80;v++){const b=$i[v-15]|0,C=Ni[v-15]|0,N=_e.rotrSH(b,C,1)^_e.rotrSH(b,C,8)^_e.shrSH(b,C,7),P=_e.rotrSL(b,C,1)^_e.rotrSL(b,C,8)^_e.shrSL(b,C,7),R=$i[v-2]|0,O=Ni[v-2]|0,M=_e.rotrSH(R,O,19)^_e.rotrBH(R,O,61)^_e.shrSH(R,O,6),j=_e.rotrSL(R,O,19)^_e.rotrBL(R,O,61)^_e.shrSL(R,O,6),k=_e.add4L(P,j,Ni[v-7],Ni[v-16]),$=_e.add4H(k,N,M,$i[v-7],$i[v-16]);$i[v]=$|0,Ni[v]=k|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:p,Fl:g,Gh:m,Gl:w,Hh:I,Hl:S}=this;for(let v=0;v<80;v++){const b=_e.rotrSH(h,d,14)^_e.rotrSH(h,d,18)^_e.rotrBH(h,d,41),C=_e.rotrSL(h,d,14)^_e.rotrSL(h,d,18)^_e.rotrBL(h,d,41),N=h&p^~h&m,P=d&g^~d&w,R=_e.add5L(S,C,P,_8[v],Ni[v]),O=_e.add5H(R,I,b,N,E8[v],$i[v]),M=R|0,j=_e.rotrSH(n,s,28)^_e.rotrBH(n,s,34)^_e.rotrBH(n,s,39),k=_e.rotrSL(n,s,28)^_e.rotrBL(n,s,34)^_e.rotrBL(n,s,39),$=n&i^n&a^i&a,T=s&o^s&c^o&c;I=m|0,S=w|0,m=p|0,w=g|0,p=h|0,g=d|0,{h,l:d}=_e.add(l|0,u|0,O|0,M|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const f=_e.add3L(M,k,T);n=_e.add3H(f,O,j,$),s=f|0}({h:n,l:s}=_e.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=_e.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=_e.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=_e.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=_e.add(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:g}=_e.add(this.Fh|0,this.Fl|0,p|0,g|0),{h:m,l:w}=_e.add(this.Gh|0,this.Gl|0,m|0,w|0),{h:I,l:S}=_e.add(this.Hh|0,this.Hl|0,I|0,S|0),this.set(n,s,i,o,a,c,l,u,h,d,p,g,m,w,I,S)}roundClean(){$i.fill(0),Ni.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const S8=JP(()=>new I8);const e0=BigInt(0),iC=BigInt(1),C8=BigInt(2);function t0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function r0(t){if(!t0(t))throw new Error("Uint8Array expected")}function Hp(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const x8=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function n0(t){r0(t);let e="";for(let r=0;r<t.length;r++)e+=x8[t[r]];return e}function oC(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?e0:BigInt("0x"+t)}const Fs={_0:48,_9:57,A:65,F:70,a:97,f:102};function Cv(t){if(t>=Fs._0&&t<=Fs._9)return t-Fs._0;if(t>=Fs.A&&t<=Fs.F)return t-(Fs.A-10);if(t>=Fs.a&&t<=Fs.f)return t-(Fs.a-10)}function aC(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=Cv(t.charCodeAt(i)),a=Cv(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function A8(t){return oC(n0(t))}function pd(t){return r0(t),oC(n0(Uint8Array.from(t).reverse()))}function cC(t,e){return aC(t.toString(16).padStart(e*2,"0"))}function Xm(t,e){return cC(t,e).reverse()}function qs(t,e,r){let n;if(typeof e=="string")try{n=aC(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(t0(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function xv(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];r0(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const Vp=t=>typeof t=="bigint"&&e0<=t;function $8(t,e,r){return Vp(t)&&Vp(e)&&Vp(r)&&e<=t&&t<r}function el(t,e,r,n){if(!$8(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function N8(t){let e;for(e=0;t>e0;t>>=iC,e+=1);return e}const O8=t=>(C8<<BigInt(t-1))-iC,T8={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t0(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function s0(t,e,r={}){const n=(s,i,o)=>{const a=T8[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function Av(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const Zt=BigInt(0),bt=BigInt(1),Vo=BigInt(2),k8=BigInt(3),Qm=BigInt(4),$v=BigInt(5),Nv=BigInt(8);function Ut(t,e){const r=t%e;return r>=Zt?r:e+r}function P8(t,e,r){if(e<Zt)throw new Error("invalid exponent, negatives unsupported");if(r<=Zt)throw new Error("invalid modulus");if(r===bt)return Zt;let n=bt;for(;e>Zt;)e&bt&&(n=n*t%r),t=t*t%r,e>>=bt;return n}function gs(t,e,r){let n=t;for(;e-- >Zt;)n*=n,n%=r;return n}function Ov(t,e){if(t===Zt)throw new Error("invert: expected non-zero number");if(e<=Zt)throw new Error("invert: expected positive modulus, got "+e);let r=Ut(t,e),n=e,s=Zt,i=bt;for(;r!==Zt;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==bt)throw new Error("invert: does not exist");return Ut(s,e)}function R8(t){const e=(t-bt)/Vo;let r,n,s;for(r=t-bt,n=0;r%Vo===Zt;r/=Vo,n++);for(s=Vo;s<t&&P8(s,e,t)!==t-bt;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+bt)/Qm;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const i=(r+bt)/Vo;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const p=o.pow(l,bt<<BigInt(c-d-1));l=o.sqr(p),u=o.mul(u,p),h=o.mul(h,l),c=d}return u}}function D8(t){if(t%Qm===k8){const e=(t+bt)/Qm;return function(r,n){const s=r.pow(n,e);if(!r.eql(r.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%Nv===$v){const e=(t-$v)/Nv;return function(r,n){const s=r.mul(n,Vo),i=r.pow(s,e),o=r.mul(n,i),a=r.mul(r.mul(o,Vo),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return R8(t)}const U8=(t,e)=>(Ut(t,e)&bt)===bt,B8=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function L8(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=B8.reduce((n,s)=>(n[s]="function",n),e);return s0(t,r)}function M8(t,e,r){if(r<Zt)throw new Error("invalid exponent, negatives unsupported");if(r===Zt)return t.ONE;if(r===bt)return e;let n=t.ONE,s=e;for(;r>Zt;)r&bt&&(n=t.mul(n,s)),s=t.sqr(s),r>>=bt;return n}function j8(t,e){const r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function lC(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function uC(t,e,r=!1,n={}){if(t<=Zt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=lC(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:O8(s),ZERO:Zt,ONE:bt,create:c=>Ut(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Zt<=c&&c<t},is0:c=>c===Zt,isOdd:c=>(c&bt)===bt,neg:c=>Ut(-c,t),eql:(c,l)=>c===l,sqr:c=>Ut(c*c,t),add:(c,l)=>Ut(c+l,t),sub:(c,l)=>Ut(c-l,t),mul:(c,l)=>Ut(c*l,t),pow:(c,l)=>M8(a,c,l),div:(c,l)=>Ut(c*Ov(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ov(c,t),sqrt:n.sqrt||(c=>(o||(o=D8(t)),o(a,c))),invertBatch:c=>j8(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?Xm(c,i):cC(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?pd(c):A8(c)}});return Object.freeze(a)}const Tv=BigInt(0),Ih=BigInt(1);function Wp(t,e){const r=e.negate();return t?r:e}function hC(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Kp(t,e){hC(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function F8(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function q8(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Gp=new WeakMap,dC=new WeakMap;function Yp(t){return dC.get(t)||1}function z8(t,e){return{constTimeNegate:Wp,hasPrecomputes(r){return Yp(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>Tv;)n&Ih&&(s=s.add(i)),i=i.double(),n>>=Ih;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=Kp(n,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){const{windows:i,windowSize:o}=Kp(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let d=0;d<i;d++){const p=d*o;let g=Number(s&l);s>>=h,g>o&&(g-=u,s+=Ih);const m=p,w=p+Math.abs(g)-1,I=d%2!==0,S=g<0;g===0?c=c.add(Wp(I,n[m])):a=a.add(Wp(S,n[w]))}return{p:a,f:c}},wNAFUnsafe(r,n,s,i=t.ZERO){const{windows:o,windowSize:a}=Kp(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(s===Tv)break;let p=Number(s&c);if(s>>=u,p>a&&(p-=l,s+=Ih),p===0)continue;let g=n[d+Math.abs(p)-1];p<0&&(g=g.negate()),i=i.add(g)}return i},getPrecomputes(r,n,s){let i=Gp.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&Gp.set(n,s(i))),i},wNAFCached(r,n,s){const i=Yp(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=Yp(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){hC(n,e),dC.set(r,n),Gp.delete(r)}}}function H8(t,e,r,n){if(F8(r,t),q8(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,i=N8(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let p=0;p<n.length;p++){const g=n[p],m=Number(g>>BigInt(h)&BigInt(a));c[m]=c[m].add(r[p])}let d=s;for(let p=c.length-1,g=s;p>0;p--)g=g.add(c[p]),d=d.add(g);if(u=u.add(d),h!==0)for(let p=0;p<o;p++)u=u.double()}return u}function V8(t){return L8(t.Fp),s0(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lC(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Yn=BigInt(0),Lr=BigInt(1),Sh=BigInt(2),W8=BigInt(8),K8={zip215:!0};function G8(t){const e=V8(t);return s0(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Y8(t){const e=G8(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=Sh<<BigInt(a*8)-Lr,u=r.create,h=uC(e.n,e.nBitLength),d=e.uvRatio||((f,y)=>{try{return{isValid:!0,value:r.sqrt(f*r.inv(y))}}catch{return{isValid:!1,value:Yn}}}),p=e.adjustScalarBytes||(f=>f),g=e.domain||((f,y,E)=>{if(Hp("phflag",E),y.length||E)throw new Error("Contexts/pre-hash are not supported");return f});function m(f,y){el("coordinate "+f,y,Yn,l)}function w(f){if(!(f instanceof v))throw new Error("ExtendedPoint expected")}const I=Av((f,y)=>{const{ex:E,ey:x,ez:_}=f,A=f.is0();y==null&&(y=A?W8:r.inv(_));const L=u(E*y),B=u(x*y),q=u(_*y);if(A)return{x:Yn,y:Lr};if(q!==Lr)throw new Error("invZ was invalid");return{x:L,y:B}}),S=Av(f=>{const{a:y,d:E}=e;if(f.is0())throw new Error("bad point: ZERO");const{ex:x,ey:_,ez:A,et:L}=f,B=u(x*x),q=u(_*_),D=u(A*A),F=u(D*D),H=u(B*y),W=u(D*u(H+q)),ee=u(F+u(E*u(B*q)));if(W!==ee)throw new Error("bad point: equation left != right (1)");const K=u(x*_),G=u(A*L);if(K!==G)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(y,E,x,_){this.ex=y,this.ey=E,this.ez=x,this.et=_,m("x",y),m("y",E),m("z",x),m("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof v)throw new Error("extended point not allowed");const{x:E,y:x}=y||{};return m("x",E),m("y",x),new v(E,x,Lr,u(E*x))}static normalizeZ(y){const E=r.invertBatch(y.map(x=>x.ez));return y.map((x,_)=>x.toAffine(E[_])).map(v.fromAffine)}static msm(y,E){return H8(v,h,y,E)}_setWindowSize(y){N.setWindowSize(this,y)}assertValidity(){S(this)}equals(y){w(y);const{ex:E,ey:x,ez:_}=this,{ex:A,ey:L,ez:B}=y,q=u(E*B),D=u(A*_),F=u(x*B),H=u(L*_);return q===D&&F===H}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=e,{ex:E,ey:x,ez:_}=this,A=u(E*E),L=u(x*x),B=u(Sh*u(_*_)),q=u(y*A),D=E+x,F=u(u(D*D)-A-L),H=q+L,W=H-B,ee=q-L,K=u(F*W),G=u(H*ee),le=u(F*ee),ye=u(W*H);return new v(K,G,ye,le)}add(y){w(y);const{a:E,d:x}=e,{ex:_,ey:A,ez:L,et:B}=this,{ex:q,ey:D,ez:F,et:H}=y;if(E===BigInt(-1)){const wb=u((A-_)*(D+q)),bb=u((A+_)*(D-q)),Cp=u(bb-wb);if(Cp===Yn)return this.double();const vb=u(L*Sh*H),Eb=u(B*Sh*F),_b=Eb+vb,Ib=bb+wb,Sb=Eb-vb,bO=u(_b*Cp),vO=u(Ib*Sb),EO=u(_b*Sb),_O=u(Cp*Ib);return new v(bO,vO,_O,EO)}const W=u(_*q),ee=u(A*D),K=u(B*x*H),G=u(L*F),le=u((_+A)*(q+D)-W-ee),ye=G-K,ve=G+K,Ee=u(ee-E*W),Ke=u(le*ye),gr=u(ve*Ee),Ot=u(le*Ee),mr=u(ye*ve);return new v(Ke,gr,mr,Ot)}subtract(y){return this.add(y.negate())}wNAF(y){return N.wNAFCached(this,y,v.normalizeZ)}multiply(y){const E=y;el("scalar",E,Lr,n);const{p:x,f:_}=this.wNAF(E);return v.normalizeZ([x,_])[0]}multiplyUnsafe(y,E=v.ZERO){const x=y;return el("scalar",x,Yn,n),x===Yn?C:this.is0()||x===Lr?this:N.wNAFCachedUnsafe(this,x,v.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return N.unsafeLadder(this,n).is0()}toAffine(y){return I(this,y)}clearCofactor(){const{h:y}=e;return y===Lr?this:this.multiplyUnsafe(y)}static fromHex(y,E=!1){const{d:x,a:_}=e,A=r.BYTES;y=qs("pointHex",y,A),Hp("zip215",E);const L=y.slice(),B=y[A-1];L[A-1]=B&-129;const q=pd(L),D=E?l:r.ORDER;el("pointHex.y",q,Yn,D);const F=u(q*q),H=u(F-Lr),W=u(x*F-_);let{isValid:ee,value:K}=d(H,W);if(!ee)throw new Error("Point.fromHex: invalid y coordinate");const G=(K&Lr)===Lr,le=(B&128)!==0;if(!E&&K===Yn&&le)throw new Error("Point.fromHex: x=0 and x_0=1");return le!==G&&(K=u(-K)),v.fromAffine({x:K,y:q})}static fromPrivateKey(y){return O(y).point}toRawBytes(){const{x:y,y:E}=this.toAffine(),x=Xm(E,r.BYTES);return x[x.length-1]|=y&Lr?128:0,x}toHex(){return n0(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,Lr,u(e.Gx*e.Gy)),v.ZERO=new v(Yn,Lr,Lr,Yn);const{BASE:b,ZERO:C}=v,N=z8(v,a*8);function P(f){return Ut(f,n)}function R(f){return P(pd(f))}function O(f){const y=r.BYTES;f=qs("private key",f,y);const E=qs("hashed private key",i(f),2*y),x=p(E.slice(0,y)),_=E.slice(y,2*y),A=R(x),L=b.multiply(A),B=L.toRawBytes();return{head:x,prefix:_,scalar:A,point:L,pointBytes:B}}function M(f){return O(f).pointBytes}function j(f=new Uint8Array,...y){const E=xv(...y);return R(i(g(E,qs("context",f),!!s)))}function k(f,y,E={}){f=qs("message",f),s&&(f=s(f));const{prefix:x,scalar:_,pointBytes:A}=O(y),L=j(E.context,x,f),B=b.multiply(L).toRawBytes(),q=j(E.context,B,A,f),D=P(L+q*_);el("signature.s",D,Yn,n);const F=xv(B,Xm(D,r.BYTES));return qs("result",F,r.BYTES*2)}const $=K8;function T(f,y,E,x=$){const{context:_,zip215:A}=x,L=r.BYTES;f=qs("signature",f,2*L),y=qs("message",y),E=qs("publicKey",E,L),A!==void 0&&Hp("zip215",A),s&&(y=s(y));const B=pd(f.slice(L,2*L));let q,D,F;try{q=v.fromHex(E,A),D=v.fromHex(f.slice(0,L),A),F=b.multiplyUnsafe(B)}catch{return!1}if(!A&&q.isSmallOrder())return!1;const H=j(_,D.toRawBytes(),q.toRawBytes(),y);return D.add(q.multiplyUnsafe(H)).subtract(F).clearCofactor().equals(v.ZERO)}return b._setWindowSize(8),{CURVE:e,getPublicKey:M,sign:k,verify:T,ExtendedPoint:v,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>o(r.BYTES),precompute(f=8,y=v.BASE){return y._setWindowSize(f),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const i0=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),kv=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Z8=BigInt(1),Pv=BigInt(2);BigInt(3);const J8=BigInt(5),X8=BigInt(8);function Q8(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=i0,o=t*t%i*t%i,a=gs(o,Pv,i)*o%i,c=gs(a,Z8,i)*t%i,l=gs(c,J8,i)*c%i,u=gs(l,e,i)*l%i,h=gs(u,r,i)*u%i,d=gs(h,n,i)*h%i,p=gs(d,s,i)*d%i,g=gs(p,s,i)*d%i,m=gs(g,e,i)*l%i;return{pow_p_5_8:gs(m,Pv,i)*t%i,b2:o}}function e5(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function t5(t,e){const r=i0,n=Ut(e*e*e,r),s=Ut(n*n*e,r),i=Q8(t*s).pow_p_5_8;let o=Ut(t*n*i,r);const a=Ut(e*o*o,r),c=o,l=Ut(o*kv,r),u=a===t,h=a===Ut(-t,r),d=a===Ut(-t*kv,r);return u&&(o=c),(h||d)&&(o=l),U8(o,r)&&(o=Ut(-o,r)),{isValid:u||h,value:o}}const r5=uC(i0,void 0,!0),n5={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:r5,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:X8,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:S8,randomBytes:nC,adjustScalarBytes:e5,uvRatio:t5},fC=Y8(n5),s5="EdDSA",i5="JWT",Md=".",qf="base64url",pC="utf8",gC="utf8",o5=":",a5="did",c5="key",Rv="base58btc",l5="z",u5="K36",h5=32;function o0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function mC(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?o0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function yC(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));const r=mC(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return o0(r)}function d5(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,w=0,I=0,S=g.length;I!==S&&g[I]===0;)I++,m++;for(var v=(S-I)*u+1>>>0,b=new Uint8Array(v);I!==S;){for(var C=g[I],N=0,P=v-1;(C!==0||N<w)&&P!==-1;P--,N++)C+=256*b[P]>>>0,b[P]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=N,I++}for(var R=v-w;R!==v&&b[R]===0;)R++;for(var O=c.repeat(m);R<v;++R)O+=t.charAt(b[R]);return O}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var w=0,I=0;g[m]===c;)w++,m++;for(var S=(g.length-m)*l+1>>>0,v=new Uint8Array(S);g[m];){var b=r[g.charCodeAt(m)];if(b===255)return;for(var C=0,N=S-1;(b!==0||C<I)&&N!==-1;N--,C++)b+=a*v[N]>>>0,v[N]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");I=C,m++}if(g[m]!==" "){for(var P=S-I;P!==S&&v[P]===0;)P++;for(var R=new Uint8Array(w+(S-P)),O=w;P!==S;)R[O++]=v[P++];return R}}}function p(g){var m=d(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var f5=d5,p5=f5;const wC=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},g5=t=>new TextEncoder().encode(t),m5=t=>new TextDecoder().decode(t);let y5=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},w5=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bC(this,e)}},b5=class{constructor(e){this.decoders=e}or(e){return bC(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const bC=(t,e)=>new b5({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let v5=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new y5(e,r,n),this.decoder=new w5(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const zf=({name:t,prefix:e,encode:r,decode:n})=>new v5(t,e,r,n),Wu=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=p5(r,e);return zf({prefix:t,name:e,encode:n,decode:i=>wC(s(i))})},E5=(t,e,r,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},_5=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},hr=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>zf({prefix:e,name:t,encode(s){return _5(s,n,r)},decode(s){return E5(s,n,r,t)}}),I5=zf({prefix:"\0",name:"identity",encode:t=>m5(t),decode:t=>g5(t)});var S5=Object.freeze({__proto__:null,identity:I5});const C5=hr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var x5=Object.freeze({__proto__:null,base2:C5});const A5=hr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var $5=Object.freeze({__proto__:null,base8:A5});const N5=Wu({prefix:"9",name:"base10",alphabet:"0123456789"});var O5=Object.freeze({__proto__:null,base10:N5});const T5=hr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),k5=hr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var P5=Object.freeze({__proto__:null,base16:T5,base16upper:k5});const R5=hr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D5=hr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),U5=hr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),B5=hr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),L5=hr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M5=hr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),j5=hr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),F5=hr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),q5=hr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var z5=Object.freeze({__proto__:null,base32:R5,base32upper:D5,base32pad:U5,base32padupper:B5,base32hex:L5,base32hexupper:M5,base32hexpad:j5,base32hexpadupper:F5,base32z:q5});const H5=Wu({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),V5=Wu({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var W5=Object.freeze({__proto__:null,base36:H5,base36upper:V5});const K5=Wu({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),G5=Wu({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Y5=Object.freeze({__proto__:null,base58btc:K5,base58flickr:G5});const Z5=hr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),J5=hr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),X5=hr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Q5=hr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var e4=Object.freeze({__proto__:null,base64:Z5,base64pad:J5,base64url:X5,base64urlpad:Q5});const vC=Array.from(""),t4=vC.reduce((t,e,r)=>(t[r]=e,t),[]),r4=vC.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function n4(t){return t.reduce((e,r)=>(e+=t4[r],e),"")}function s4(t){const e=[];for(const r of t){const n=r4[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const i4=zf({prefix:"",name:"base256emoji",encode:n4,decode:s4});var o4=Object.freeze({__proto__:null,base256emoji:i4}),a4=EC,Dv=128,c4=-128,l4=Math.pow(2,31);function EC(t,e,r){e=e||[],r=r||0;for(var n=r;t>=l4;)e[r++]=t&255|Dv,t/=128;for(;t&c4;)e[r++]=t&255|Dv,t>>>=7;return e[r]=t|0,EC.bytes=r-n+1,e}var u4=ey,h4=128,Uv=127;function ey(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw ey.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&Uv)<<s:(o&Uv)*Math.pow(2,s),s+=7}while(o>=h4);return ey.bytes=i-n,r}var d4=Math.pow(2,7),f4=Math.pow(2,14),p4=Math.pow(2,21),g4=Math.pow(2,28),m4=Math.pow(2,35),y4=Math.pow(2,42),w4=Math.pow(2,49),b4=Math.pow(2,56),v4=Math.pow(2,63),E4=function(t){return t<d4?1:t<f4?2:t<p4?3:t<g4?4:t<m4?5:t<y4?6:t<w4?7:t<b4?8:t<v4?9:10},_4={encode:a4,decode:u4,encodingLength:E4},_C=_4;const Bv=(t,e,r=0)=>(_C.encode(t,e,r),e),Lv=t=>_C.encodingLength(t),ty=(t,e)=>{const r=e.byteLength,n=Lv(t),s=n+Lv(r),i=new Uint8Array(s+r);return Bv(t,i,0),Bv(r,i,n),i.set(e,s),new I4(t,r,e,i)};let I4=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const IC=({name:t,code:e,encode:r})=>new S4(t,e,r);let S4=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ty(this.code,r):r.then(n=>ty(this.code,n))}else throw Error("Unknown type, must be binary type")}};const SC=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),C4=IC({name:"sha2-256",code:18,encode:SC("SHA-256")}),x4=IC({name:"sha2-512",code:19,encode:SC("SHA-512")});var A4=Object.freeze({__proto__:null,sha256:C4,sha512:x4});const CC=0,$4="identity",xC=wC,N4=t=>ty(CC,xC(t)),O4={code:CC,name:$4,encode:xC,digest:N4};var T4=Object.freeze({__proto__:null,identity:O4});new TextEncoder,new TextDecoder;const Mv={...S5,...x5,...$5,...O5,...P5,...z5,...W5,...Y5,...e4,...o4};({...A4,...T4});function AC(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const jv=AC("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Zp=AC("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=mC(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),$C={utf8:jv,"utf-8":jv,hex:Mv.base16,latin1:Zp,ascii:Zp,binary:Zp,...Mv};function Hf(t,e="utf8"){const r=$C[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function qc(t,e="utf8"){const r=$C[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?o0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Fv(t){return Ls(Hf(qc(t,qf),pC))}function jd(t){return Hf(qc(Br(t),pC),qf)}function a0(t){const e=qc(u5,Rv),r=l5+Hf(yC([e,t]),Rv);return[a5,c5,r].join(o5)}function k4(t){return Hf(t,qf)}function P4(t){return qc(t,qf)}function R4(t){return qc([jd(t.header),jd(t.payload)].join(Md),gC)}function D4(t){return[jd(t.header),jd(t.payload),k4(t.signature)].join(Md)}function Cc(t){const e=t.split(Md),r=Fv(e[0]),n=Fv(e[1]),s=P4(e[2]),i=qc(e.slice(0,2).join(Md),gC);return{header:r,payload:n,signature:s,data:i}}function Fd(t=nC(h5)){const e=fC.getPublicKey(t);return{secretKey:yC([t,e]),publicKey:e}}async function NC(t,e,r,n,s=z.fromMiliseconds(Date.now())){const i={alg:s5,typ:i5},o=a0(n.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},l=R4({header:i,payload:c}),u=fC.sign(l,n.secretKey.slice(0,32));return D4({header:i,payload:c,signature:u})}var qv=function(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},U4=(function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t})(),B4=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),L4=(function(){function t(e,r,n,s){this.name=e,this.version=r,this.os=n,this.bot=s,this.type="bot-device"}return t})(),M4=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),j4=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),F4=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,q4=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,zv=3,z4=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",F4]],Hv=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function OC(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new j4:typeof navigator<"u"?V4(navigator.userAgent):K4()}function H4(t){return t!==""&&z4.reduce(function(e,r){var n=r[0],s=r[1];if(e)return e;var i=s.exec(t);return!!i&&[n,i]},!1)}function V4(t){var e=H4(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new M4;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<zv&&(s=qv(qv([],s,!0),G4(zv-s.length),!0)):s=[];var i=s.join("."),o=W4(t),a=q4.exec(t);return a&&a[1]?new L4(r,i,o,a[1]):new U4(r,i,o)}function W4(t){for(var e=0,r=Hv.length;e<r;e++){var n=Hv[e],s=n[0],i=n[1],o=i.exec(t);if(o)return s}return null}function K4(){var t=typeof process<"u"&&process.version;return t?new B4(process.version.slice(1)):null}function G4(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ze={},Vv;function TC(){if(Vv)return Ze;Vv=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.getLocalStorage=Ze.getLocalStorageOrThrow=Ze.getCrypto=Ze.getCryptoOrThrow=Ze.getLocation=Ze.getLocationOrThrow=Ze.getNavigator=Ze.getNavigatorOrThrow=Ze.getDocument=Ze.getDocumentOrThrow=Ze.getFromWindowOrThrow=Ze.getFromWindow=void 0;function t(d){let p;return typeof window<"u"&&typeof window[d]<"u"&&(p=window[d]),p}Ze.getFromWindow=t;function e(d){const p=t(d);if(!p)throw new Error(`${d} is not defined in Window`);return p}Ze.getFromWindowOrThrow=e;function r(){return e("document")}Ze.getDocumentOrThrow=r;function n(){return t("document")}Ze.getDocument=n;function s(){return e("navigator")}Ze.getNavigatorOrThrow=s;function i(){return t("navigator")}Ze.getNavigator=i;function o(){return e("location")}Ze.getLocationOrThrow=o;function a(){return t("location")}Ze.getLocation=a;function c(){return e("crypto")}Ze.getCryptoOrThrow=c;function l(){return t("crypto")}Ze.getCrypto=l;function u(){return e("localStorage")}Ze.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return Ze.getLocalStorage=h,Ze}var Jt=TC(),tl={},Wv;function Y4(){if(Wv)return tl;Wv=1,Object.defineProperty(tl,"__esModule",{value:!0}),tl.getWindowMetadata=void 0;const t=TC();function e(){let r,n;try{r=t.getDocumentOrThrow(),n=t.getLocationOrThrow()}catch{return null}function s(){const p=r.getElementsByTagName("link"),g=[];for(let m=0;m<p.length;m++){const w=p[m],I=w.getAttribute("rel");if(I&&I.toLowerCase().indexOf("icon")>-1){const S=w.getAttribute("href");if(S)if(S.toLowerCase().indexOf("https:")===-1&&S.toLowerCase().indexOf("http:")===-1&&S.indexOf("//")!==0){let v=n.protocol+"//"+n.host;if(S.indexOf("/")===0)v+=S;else{const b=n.pathname.split("/");b.pop();const C=b.join("/");v+=C+"/"+S}g.push(v)}else if(S.indexOf("//")===0){const v=n.protocol+S;g.push(v)}else g.push(S)}}return g}function i(...p){const g=r.getElementsByTagName("meta");for(let m=0;m<g.length;m++){const w=g[m],I=["itemprop","property","name"].map(S=>w.getAttribute(S)).filter(S=>S?p.includes(S):!1);if(I.length&&I){const S=w.getAttribute("content");if(S)return S}}return""}function o(){let p=i("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return i("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=n.origin,h=s();return{description:l,url:u,icons:h,name:c}}return tl.getWindowMetadata=e,tl}var kC=Y4();const Z4="0.1.1";function J4(){return Z4}let Et=class ry extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof ry){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),s=r.cause instanceof ry&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||s?["",n?`Details: ${n}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${J4()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return PC(this,e)}};function PC(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?PC(t.cause,e):e?null:t}const Fa=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function X4(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ya(t,...e){if(!X4(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Q4(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");tu(t.outputLen),tu(t.blockLen)}function xc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function RC(t,e){ya(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function eR(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ac(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Jp(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ms(t,e){return t<<32-e|t>>>e}const tR=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function rR(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function nR(t){for(let e=0;e<t.length;e++)t[e]=rR(t[e]);return t}const Kv=tR?t=>t:nR;function sR(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Vf(t){return typeof t=="string"&&(t=sR(t)),ya(t),t}function iR(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];ya(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}let c0=class{};function DC(t){const e=n=>t().update(Vf(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function oR(t=32){if(Fa&&typeof Fa.getRandomValues=="function")return Fa.getRandomValues(new Uint8Array(t));if(Fa&&typeof Fa.randomBytes=="function")return Uint8Array.from(Fa.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function aR(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function cR(t,e,r){return t&e^~t&r}function lR(t,e,r){return t&e^t&r^e&r}let uR=class extends c0{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Jp(this.buffer)}update(e){xc(this),e=Vf(e),ya(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Jp(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){xc(this),RC(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,Ac(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;aR(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Jp(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const Oi=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ch=BigInt(2**32-1),Gv=BigInt(32);function hR(t,e=!1){return e?{h:Number(t&Ch),l:Number(t>>Gv&Ch)}:{h:Number(t>>Gv&Ch)|0,l:Number(t&Ch)|0}}function dR(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=hR(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const fR=(t,e,r)=>t<<r|e>>>32-r,pR=(t,e,r)=>e<<r|t>>>32-r,gR=(t,e,r)=>e<<r-32|t>>>64-r,mR=(t,e,r)=>t<<r-32|e>>>64-r,yR=BigInt(0),rl=BigInt(1),wR=BigInt(2),bR=BigInt(7),vR=BigInt(256),ER=BigInt(113),UC=[],BC=[],LC=[];for(let t=0,e=rl,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],UC.push(2*(5*n+r)),BC.push((t+1)*(t+2)/2%64);let s=yR;for(let i=0;i<7;i++)e=(e<<rl^(e>>bR)*ER)%vR,e&wR&&(s^=rl<<(rl<<BigInt(i))-rl);LC.push(s)}const MC=dR(LC,!0),_R=MC[0],IR=MC[1],Yv=(t,e,r)=>r>32?gR(t,e,r):fR(t,e,r),Zv=(t,e,r)=>r>32?mR(t,e,r):pR(t,e,r);function SR(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Yv(l,u,1)^r[a],d=Zv(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=BC[o],c=Yv(s,i,a),l=Zv(s,i,a),u=UC[o];s=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=_R[n],t[1]^=IR[n]}Ac(r)}let CR=class jC extends c0{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,tu(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=eR(this.state)}clone(){return this._cloneInto()}keccak(){Kv(this.state32),SR(this.state32,this.rounds),Kv(this.state32),this.posOut=0,this.pos=0}update(e){xc(this),e=Vf(e),ya(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){xc(this,!1),ya(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return tu(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(RC(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ac(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new jC(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const xR=(t,e,r)=>DC(()=>new CR(e,t,r)),AR=xR(1,136,256/8),$R=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ti=new Uint32Array(64);let NR=class extends uR{constructor(e=32){super(64,e,8,!1),this.A=Oi[0]|0,this.B=Oi[1]|0,this.C=Oi[2]|0,this.D=Oi[3]|0,this.E=Oi[4]|0,this.F=Oi[5]|0,this.G=Oi[6]|0,this.H=Oi[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Ti[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=Ti[h-15],p=Ti[h-2],g=ms(d,7)^ms(d,18)^d>>>3,m=ms(p,17)^ms(p,19)^p>>>10;Ti[h]=m+Ti[h-7]+g+Ti[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=ms(a,6)^ms(a,11)^ms(a,25),p=u+d+cR(a,c,l)+$R[h]+Ti[h]|0,m=(ms(n,2)^ms(n,13)^ms(n,22))+lR(n,s,i)|0;u=l,l=c,c=a,a=o+p|0,o=i,i=s,s=n,n=p+m|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){Ac(Ti)}destroy(){this.set(0,0,0,0,0,0,0,0),Ac(this.buffer)}};const OR=DC(()=>new NR);const l0=BigInt(0),ny=BigInt(1);function Ku(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function u0(t){if(!Ku(t))throw new Error("Uint8Array expected")}function ru(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function xh(t){const e=t.toString(16);return e.length&1?"0"+e:e}function FC(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?l0:BigInt("0x"+t)}const qC=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",TR=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function nu(t){if(u0(t),qC)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=TR[t[r]];return e}const zs={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jv(t){if(t>=zs._0&&t<=zs._9)return t-zs._0;if(t>=zs.A&&t<=zs.F)return t-(zs.A-10);if(t>=zs.a&&t<=zs.f)return t-(zs.a-10)}function qd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(qC)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=Jv(t.charCodeAt(i)),a=Jv(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function ua(t){return FC(nu(t))}function zC(t){return u0(t),FC(nu(Uint8Array.from(t).reverse()))}function Gu(t,e){return qd(t.toString(16).padStart(e*2,"0"))}function HC(t,e){return Gu(t,e).reverse()}function Mn(t,e,r){let n;if(typeof e=="string")try{n=qd(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Ku(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function zd(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];u0(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const Xp=t=>typeof t=="bigint"&&l0<=t;function h0(t,e,r){return Xp(t)&&Xp(e)&&Xp(r)&&e<=t&&t<r}function fc(t,e,r,n){if(!h0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function kR(t){let e;for(e=0;t>l0;t>>=ny,e+=1);return e}const Wf=t=>(ny<<BigInt(t))-ny,Qp=t=>new Uint8Array(t),Xv=t=>Uint8Array.from(t);function PR(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Qp(t),s=Qp(t),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...h)=>r(s,n,...h),c=(h=Qp(0))=>{s=a(Xv([0]),h),n=a(),h.length!==0&&(s=a(Xv([1]),h),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){n=a();const p=n.slice();d.push(p),h+=n.length}return zd(...d)};return(h,d)=>{o(),c(h);let p;for(;!(p=d(l()));)c();return o(),p}}const RR={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ku(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Kf(t,e,r={}){const n=(s,i,o)=>{const a=RR[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function Qv(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}function DR(t,e){if(n1(t)>e)throw new r6({givenSize:n1(t),maxSize:e})}const Hs={zero:48,nine:57,A:65,F:70,a:97,f:102};function e1(t){if(t>=Hs.zero&&t<=Hs.nine)return t-Hs.zero;if(t>=Hs.A&&t<=Hs.F)return t-(Hs.A-10);if(t>=Hs.a&&t<=Hs.f)return t-(Hs.a-10)}function UR(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new n6({size:t.length,targetSize:n,type:"Bytes"});const s=new Uint8Array(n);for(let i=0;i<n;i++){const o=r==="right";s[o?i:n-i-1]=t[o?i:t.length-i-1]}return s}function VC(t,e){if(bo(t)>e)throw new WR({givenSize:bo(t),maxSize:e})}function BR(t,e){if(typeof e=="number"&&e>0&&e>bo(t)-1)throw new GC({offset:e,position:"start",size:bo(t)})}function LR(t,e,r){if(typeof e=="number"&&typeof r=="number"&&bo(t)!==r-e)throw new GC({offset:r,position:"end",size:bo(t)})}function WC(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const s=t.replace("0x","");if(s.length>n*2)throw new KR({size:Math.ceil(s.length/2),targetSize:n,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const MR="#__bigint";function d0(t,e,r){return JSON.stringify(t,(n,s)=>typeof s=="bigint"?s.toString()+MR:s,r)}const jR=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function FR(t,e={}){const{strict:r=!1}=e;if(!t)throw new t1(t);if(typeof t!="string")throw new t1(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new r1(t);if(!t.startsWith("0x"))throw new r1(t)}function qR(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function f0(t){return t instanceof Uint8Array?Hd(t):Array.isArray(t)?Hd(new Uint8Array(t)):t}function Hd(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=jR[t[s]];const n=`0x${r}`;return typeof e.size=="number"?(VC(n,e.size),KC(n,e.size)):n}function eg(t,e={}){const{signed:r,size:n}=e,s=BigInt(t);let i;n?r?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&r?-i-1n:0;if(i&&s>i||s<o){const l=typeof t=="bigint"?"n":"";throw new VR({max:i?`${i}${l}`:void 0,min:`${o}${l}`,signed:r,size:n,value:`${t}${l}`})}const c=`0x${(r&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?zR(c,n):c}function zR(t,e){return WC(t,{dir:"left",size:e})}function KC(t,e){return WC(t,{dir:"right",size:e})}function si(t,e,r,n={}){const{strict:s}=n;BR(t,e);const i=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&LR(i,e,r),i}function bo(t){return Math.ceil((t.length-2)/2)}function HR(t,e={}){const{strict:r=!1}=e;try{return FR(t,{strict:r}),!0}catch{return!1}}let VR=class extends Et{constructor({max:e,min:r,signed:n,size:s,value:i}){super(`Number \`${i}\` is not in safe${s?` ${s*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}},t1=class extends Et{constructor(e){super(`Value \`${typeof e=="object"?d0(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}},r1=class extends Et{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}},WR=class extends Et{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}},GC=class extends Et{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}},KR=class extends Et{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const GR=new TextEncoder;function YR(t){if(!(t instanceof Uint8Array)){if(!t)throw new Ah(t);if(typeof t!="object")throw new Ah(t);if(!("BYTES_PER_ELEMENT"in t))throw new Ah(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Ah(t)}}function ZR(t){return t instanceof Uint8Array?t:typeof t=="string"?XR(t):JR(t)}function JR(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function XR(t,e={}){const{size:r}=e;let n=t;r&&(VC(t,r),n=KC(t,r));let s=n.slice(2);s.length%2&&(s=`0${s}`);const i=s.length/2,o=new Uint8Array(i);for(let a=0,c=0;a<i;a++){const l=e1(s.charCodeAt(c++)),u=e1(s.charCodeAt(c++));if(l===void 0||u===void 0)throw new Et(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=l*16+u}return o}function QR(t,e={}){const{size:r}=e,n=GR.encode(t);return typeof r=="number"?(DR(n,r),e6(n,r)):n}function e6(t,e){return UR(t,{dir:"right",size:e})}function n1(t){return t.length}function t6(t){try{return YR(t),!0}catch{return!1}}let Ah=class extends Et{constructor(e){super(`Value \`${typeof e=="object"?d0(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}},r6=class extends Et{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}},n6=class extends Et{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}};function YC(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=AR(ZR(t));return r==="Bytes"?n:Hd(n)}let s6=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}};const i6={checksum:new s6(8192)},tg=i6.checksum;function ZC(t,e={}){const{compressed:r}=e,{prefix:n,x:s,y:i}=t;if(r===!1||typeof s=="bigint"&&typeof i=="bigint"){if(n!==4)throw new s1({prefix:n,cause:new h6});return}if(r===!0||typeof s=="bigint"&&typeof i>"u"){if(n!==3&&n!==2)throw new s1({prefix:n,cause:new u6});return}throw new l6({publicKey:t})}function o6(t){const e=(()=>{if(HR(t))return JC(t);if(t6(t))return a6(t);const{prefix:r,x:n,y:s}=t;return typeof n=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:n,y:s}:{prefix:r,x:n}})();return ZC(e),e}function a6(t){return JC(Hd(t))}function JC(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new d6({publicKey:t});if(t.length===130){const n=BigInt(si(t,0,32)),s=BigInt(si(t,32,64));return{prefix:4,x:n,y:s}}if(t.length===132){const n=Number(si(t,0,1)),s=BigInt(si(t,1,33)),i=BigInt(si(t,33,65));return{prefix:n,x:s,y:i}}const e=Number(si(t,0,1)),r=BigInt(si(t,1,33));return{prefix:e,x:r}}function c6(t,e={}){ZC(t);const{prefix:r,x:n,y:s}=t,{includePrefix:i=!0}=e;return qR(i?eg(r,{size:1}):"0x",eg(n,{size:32}),typeof s=="bigint"?eg(s,{size:32}):"0x")}let l6=class extends Et{constructor({publicKey:e}){super(`Value \`${d0(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}},s1=class extends Et{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}},u6=class extends Et{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}},h6=class extends Et{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}},d6=class extends Et{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${bo(f0(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const f6=/^0x[a-fA-F0-9]{40}$/;function XC(t,e={}){const{strict:r=!0}=e;if(!f6.test(t))throw new i1({address:t,cause:new m6});if(r){if(t.toLowerCase()===t)return;if(QC(t)!==t)throw new i1({address:t,cause:new y6})}}function QC(t){if(tg.has(t))return tg.get(t);XC(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=YC(QR(e),{as:"Bytes"}),n=e.split("");for(let i=0;i<40;i+=2)r[i>>1]>>4>=8&&n[i]&&(n[i]=n[i].toUpperCase()),(r[i>>1]&15)>=8&&n[i+1]&&(n[i+1]=n[i+1].toUpperCase());const s=`0x${n.join("")}`;return tg.set(t,s),s}function p6(t,e={}){const{checksum:r=!1}=e;return XC(t),r?QC(t):t}function g6(t,e={}){const r=YC(`0x${c6(t).slice(4)}`).substring(26);return p6(`0x${r}`,e)}let i1=class extends Et{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}},m6=class extends Et{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}},y6=class extends Et{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}},ex=class extends c0{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Q4(e);const n=Vf(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Ac(i)}update(e){return xc(this),this.iHash.update(e),this}digestInto(e){xc(this),ya(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const rx=(t,e,r)=>new ex(t,e).update(r).digest();rx.create=(t,e)=>new ex(t,e);const Qr=BigInt(0),Tr=BigInt(1),Jo=BigInt(2),w6=BigInt(3),nx=BigInt(4),sx=BigInt(5),ix=BigInt(8);function Kr(t,e){const r=t%e;return r>=Qr?r:e+r}function An(t,e,r){let n=t;for(;e-- >Qr;)n*=n,n%=r;return n}function sy(t,e){if(t===Qr)throw new Error("invert: expected non-zero number");if(e<=Qr)throw new Error("invert: expected positive modulus, got "+e);let r=Kr(t,e),n=e,s=Qr,i=Tr;for(;r!==Qr;){const a=n/r,c=n%r,l=s-i*a;n=r,r=c,s=i,i=l}if(n!==Tr)throw new Error("invert: does not exist");return Kr(s,e)}function ox(t,e){const r=(t.ORDER+Tr)/nx,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function b6(t,e){const r=(t.ORDER-sx)/ix,n=t.mul(e,Jo),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,Jo),s),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function v6(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Tr,r=0;for(;e%Jo===Qr;)e/=Jo,r++;let n=Jo;const s=p0(t);for(;o1(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return ox;let i=s.pow(n,e);const o=(e+Tr)/Jo;return function(c,l){if(c.is0(l))return l;if(o1(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,i),d=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let g=1,m=c.sqr(d);for(;!c.eql(m,c.ONE);)if(g++,m=c.sqr(m),g===u)throw new Error("Cannot find square root");const w=Tr<<BigInt(u-g-1),I=c.pow(h,w);u=g,h=c.sqr(I),d=c.mul(d,h),p=c.mul(p,I)}return p}}function E6(t){return t%nx===w6?ox:t%ix===sx?b6:v6(t)}const _6=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function I6(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=_6.reduce((n,s)=>(n[s]="function",n),e);return Kf(t,r)}function S6(t,e,r){if(r<Qr)throw new Error("invalid exponent, negatives unsupported");if(r===Qr)return t.ONE;if(r===Tr)return e;let n=t.ONE,s=e;for(;r>Qr;)r&Tr&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Tr;return n}function ax(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function o1(t,e){const r=(t.ORDER-Tr)/Jo,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function cx(t,e){e!==void 0&&tu(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function p0(t,e,r=!1,n={}){if(t<=Qr)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=cx(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:Wf(s),ZERO:Qr,ONE:Tr,create:c=>Kr(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Qr<=c&&c<t},is0:c=>c===Qr,isOdd:c=>(c&Tr)===Tr,neg:c=>Kr(-c,t),eql:(c,l)=>c===l,sqr:c=>Kr(c*c,t),add:(c,l)=>Kr(c+l,t),sub:(c,l)=>Kr(c-l,t),mul:(c,l)=>Kr(c*l,t),pow:(c,l)=>S6(a,c,l),div:(c,l)=>Kr(c*sy(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>sy(c,t),sqrt:n.sqrt||(c=>(o||(o=E6(t)),o(a,c))),toBytes:c=>r?HC(c,i):Gu(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?zC(c):ua(c)},invertBatch:c=>ax(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function lx(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ux(t){const e=lx(t);return e+Math.ceil(e/2)}function C6(t,e,r=!1){const n=t.length,s=lx(e),i=ux(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?zC(t):ua(t),a=Kr(o,e-Tr)+Tr;return r?HC(a,s):Gu(a,s)}const a1=BigInt(0),iy=BigInt(1);function rg(t,e){const r=e.negate();return t?r:e}function hx(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ng(t,e){hx(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=Wf(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function c1(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=iy);const l=e*n,u=l+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:l}}function x6(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function A6(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const sg=new WeakMap,dx=new WeakMap;function ig(t){return dx.get(t)||1}function $6(t,e){return{constTimeNegate:rg,hasPrecomputes(r){return ig(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>a1;)n&iy&&(s=s.add(i)),i=i.double(),n>>=iy;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=ng(n,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){let i=t.ZERO,o=t.BASE;const a=ng(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:g}=c1(s,c,a);s=l,h?o=o.add(rg(p,n[g])):i=i.add(rg(d,n[u]))}return{p:i,f:o}},wNAFUnsafe(r,n,s,i=t.ZERO){const o=ng(r,e);for(let a=0;a<o.windows&&s!==a1;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=c1(s,a,o);if(s=c,!u){const d=n[l];i=i.add(h?d.negate():d)}}return i},getPrecomputes(r,n,s){let i=sg.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&sg.set(n,s(i))),i},wNAFCached(r,n,s){const i=ig(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=ig(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){hx(n,e),dx.set(r,n),sg.delete(r)}}}function N6(t,e,r,n){x6(r,t),A6(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=kR(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Wf(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let m=0;m<i;m++){const w=n[m],I=Number(w>>BigInt(p)&l);u[I]=u[I].add(r[m])}let g=o;for(let m=u.length-1,w=o;m>0;m--)w=w.add(u[m]),g=g.add(w);if(d=d.add(g),p!==0)for(let m=0;m<c;m++)d=d.double()}return d}function fx(t){return I6(t.Fp),Kf(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...cx(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function l1(t){t.lowS!==void 0&&ru("lowS",t.lowS),t.prehash!==void 0&&ru("prehash",t.prehash)}function O6(t){const e=fx(t);Kf(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}let T6=class extends Error{constructor(e=""){super(e)}};const ci={Err:T6,_tlv:{encode:(t,e)=>{const{Err:r}=ci;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=xh(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?xh(s.length/2|128):"";return xh(t)+i+s+e},decode(t,e){const{Err:r}=ci;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=ci;if(t<di)throw new e("integer: negative integers are not allowed");let r=xh(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=ci;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ua(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=ci,s=Mn("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=ci,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}};function og(t,e){return nu(Gu(t,e))}const di=BigInt(0),Vt=BigInt(1);BigInt(2);const ag=BigInt(3),k6=BigInt(4);function P6(t){const e=O6(t),{Fp:r}=e,n=p0(e.n,e.nBitLength),s=e.toBytes||((v,b,C)=>{const N=b.toAffine();return zd(Uint8Array.from([4]),r.toBytes(N.x),r.toBytes(N.y))}),i=e.fromBytes||(v=>{const b=v.subarray(1),C=r.fromBytes(b.subarray(0,r.BYTES)),N=r.fromBytes(b.subarray(r.BYTES,2*r.BYTES));return{x:C,y:N}});function o(v){const{a:b,b:C}=e,N=r.sqr(v),P=r.mul(N,v);return r.add(r.add(P,r.mul(v,b)),C)}function a(v,b){const C=r.sqr(b),N=o(v);return r.eql(C,N)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,ag),k6),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(v){return h0(v,Vt,e.n)}function h(v){const{allowedPrivateKeyLengths:b,nByteLength:C,wrapPrivateKey:N,n:P}=e;if(b&&typeof v!="bigint"){if(Ku(v)&&(v=nu(v)),typeof v!="string"||!b.includes(v.length))throw new Error("invalid private key");v=v.padStart(C*2,"0")}let R;try{R=typeof v=="bigint"?v:ua(Mn("private key",v,C))}catch{throw new Error("invalid private key, expected hex or "+C+" bytes, got "+typeof v)}return N&&(R=Kr(R,P)),fc("private key",R,Vt,P),R}function d(v){if(!(v instanceof m))throw new Error("ProjectivePoint expected")}const p=Qv((v,b)=>{const{px:C,py:N,pz:P}=v;if(r.eql(P,r.ONE))return{x:C,y:N};const R=v.is0();b==null&&(b=R?r.ONE:r.inv(P));const O=r.mul(C,b),M=r.mul(N,b),j=r.mul(P,b);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(j,r.ONE))throw new Error("invZ was invalid");return{x:O,y:M}}),g=Qv(v=>{if(v.is0()){if(e.allowInfinityPoint&&!r.is0(v.py))return;throw new Error("bad point: ZERO")}const{x:b,y:C}=v.toAffine();if(!r.isValid(b)||!r.isValid(C))throw new Error("bad point: x or y not FE");if(!a(b,C))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class m{constructor(b,C,N){if(b==null||!r.isValid(b))throw new Error("x required");if(C==null||!r.isValid(C)||r.is0(C))throw new Error("y required");if(N==null||!r.isValid(N))throw new Error("z required");this.px=b,this.py=C,this.pz=N,Object.freeze(this)}static fromAffine(b){const{x:C,y:N}=b||{};if(!b||!r.isValid(C)||!r.isValid(N))throw new Error("invalid affine point");if(b instanceof m)throw new Error("projective point not allowed");const P=R=>r.eql(R,r.ZERO);return P(C)&&P(N)?m.ZERO:new m(C,N,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const C=ax(r,b.map(N=>N.pz));return b.map((N,P)=>N.toAffine(C[P])).map(m.fromAffine)}static fromHex(b){const C=m.fromAffine(i(Mn("pointHex",b)));return C.assertValidity(),C}static fromPrivateKey(b){return m.BASE.multiply(h(b))}static msm(b,C){return N6(m,n,b,C)}_setWindowSize(b){S.setWindowSize(this,b)}assertValidity(){g(this)}hasEvenY(){const{y:b}=this.toAffine();if(r.isOdd)return!r.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){d(b);const{px:C,py:N,pz:P}=this,{px:R,py:O,pz:M}=b,j=r.eql(r.mul(C,M),r.mul(R,P)),k=r.eql(r.mul(N,M),r.mul(O,P));return j&&k}negate(){return new m(this.px,r.neg(this.py),this.pz)}double(){const{a:b,b:C}=e,N=r.mul(C,ag),{px:P,py:R,pz:O}=this;let M=r.ZERO,j=r.ZERO,k=r.ZERO,$=r.mul(P,P),T=r.mul(R,R),f=r.mul(O,O),y=r.mul(P,R);return y=r.add(y,y),k=r.mul(P,O),k=r.add(k,k),M=r.mul(b,k),j=r.mul(N,f),j=r.add(M,j),M=r.sub(T,j),j=r.add(T,j),j=r.mul(M,j),M=r.mul(y,M),k=r.mul(N,k),f=r.mul(b,f),y=r.sub($,f),y=r.mul(b,y),y=r.add(y,k),k=r.add($,$),$=r.add(k,$),$=r.add($,f),$=r.mul($,y),j=r.add(j,$),f=r.mul(R,O),f=r.add(f,f),$=r.mul(f,y),M=r.sub(M,$),k=r.mul(f,T),k=r.add(k,k),k=r.add(k,k),new m(M,j,k)}add(b){d(b);const{px:C,py:N,pz:P}=this,{px:R,py:O,pz:M}=b;let j=r.ZERO,k=r.ZERO,$=r.ZERO;const T=e.a,f=r.mul(e.b,ag);let y=r.mul(C,R),E=r.mul(N,O),x=r.mul(P,M),_=r.add(C,N),A=r.add(R,O);_=r.mul(_,A),A=r.add(y,E),_=r.sub(_,A),A=r.add(C,P);let L=r.add(R,M);return A=r.mul(A,L),L=r.add(y,x),A=r.sub(A,L),L=r.add(N,P),j=r.add(O,M),L=r.mul(L,j),j=r.add(E,x),L=r.sub(L,j),$=r.mul(T,A),j=r.mul(f,x),$=r.add(j,$),j=r.sub(E,$),$=r.add(E,$),k=r.mul(j,$),E=r.add(y,y),E=r.add(E,y),x=r.mul(T,x),A=r.mul(f,A),E=r.add(E,x),x=r.sub(y,x),x=r.mul(T,x),A=r.add(A,x),y=r.mul(E,A),k=r.add(k,y),y=r.mul(L,A),j=r.mul(_,j),j=r.sub(j,y),y=r.mul(_,E),$=r.mul(L,$),$=r.add($,y),new m(j,k,$)}subtract(b){return this.add(b.negate())}is0(){return this.equals(m.ZERO)}wNAF(b){return S.wNAFCached(this,b,m.normalizeZ)}multiplyUnsafe(b){const{endo:C,n:N}=e;fc("scalar",b,di,N);const P=m.ZERO;if(b===di)return P;if(this.is0()||b===Vt)return this;if(!C||S.hasPrecomputes(this))return S.wNAFCachedUnsafe(this,b,m.normalizeZ);let{k1neg:R,k1:O,k2neg:M,k2:j}=C.splitScalar(b),k=P,$=P,T=this;for(;O>di||j>di;)O&Vt&&(k=k.add(T)),j&Vt&&($=$.add(T)),T=T.double(),O>>=Vt,j>>=Vt;return R&&(k=k.negate()),M&&($=$.negate()),$=new m(r.mul($.px,C.beta),$.py,$.pz),k.add($)}multiply(b){const{endo:C,n:N}=e;fc("scalar",b,Vt,N);let P,R;if(C){const{k1neg:O,k1:M,k2neg:j,k2:k}=C.splitScalar(b);let{p:$,f:T}=this.wNAF(M),{p:f,f:y}=this.wNAF(k);$=S.constTimeNegate(O,$),f=S.constTimeNegate(j,f),f=new m(r.mul(f.px,C.beta),f.py,f.pz),P=$.add(f),R=T.add(y)}else{const{p:O,f:M}=this.wNAF(b);P=O,R=M}return m.normalizeZ([P,R])[0]}multiplyAndAddUnsafe(b,C,N){const P=m.BASE,R=(M,j)=>j===di||j===Vt||!M.equals(P)?M.multiplyUnsafe(j):M.multiply(j),O=R(this,C).add(R(b,N));return O.is0()?void 0:O}toAffine(b){return p(this,b)}isTorsionFree(){const{h:b,isTorsionFree:C}=e;if(b===Vt)return!0;if(C)return C(m,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:C}=e;return b===Vt?this:C?C(m,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return ru("isCompressed",b),this.assertValidity(),s(m,this,b)}toHex(b=!0){return ru("isCompressed",b),nu(this.toRawBytes(b))}}m.BASE=new m(e.Gx,e.Gy,r.ONE),m.ZERO=new m(r.ZERO,r.ONE,r.ZERO);const{endo:w,nBitLength:I}=e,S=$6(m,w?Math.ceil(I/2):I);return{CURVE:e,ProjectivePoint:m,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function R6(t){const e=fx(t);return Kf(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function D6(t){const e=R6(t),{Fp:r,n,nByteLength:s,nBitLength:i}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(f){return Kr(f,n)}function l(f){return sy(f,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:p}=P6({...e,toBytes(f,y,E){const x=y.toAffine(),_=r.toBytes(x.x),A=zd;return ru("isCompressed",E),E?A(Uint8Array.from([y.hasEvenY()?2:3]),_):A(Uint8Array.from([4]),_,r.toBytes(x.y))},fromBytes(f){const y=f.length,E=f[0],x=f.subarray(1);if(y===o&&(E===2||E===3)){const _=ua(x);if(!h0(_,Vt,r.ORDER))throw new Error("Point is not on curve");const A=d(_);let L;try{L=r.sqrt(A)}catch(D){const F=D instanceof Error?": "+D.message:"";throw new Error("Point is not on curve"+F)}const B=(L&Vt)===Vt;return(E&1)===1!==B&&(L=r.neg(L)),{x:_,y:L}}else if(y===a&&E===4){const _=r.fromBytes(x.subarray(0,r.BYTES)),A=r.fromBytes(x.subarray(r.BYTES,2*r.BYTES));return{x:_,y:A}}else{const _=o,A=a;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+A+", got "+y)}}});function g(f){const y=n>>Vt;return f>y}function m(f){return g(f)?c(-f):f}const w=(f,y,E)=>ua(f.slice(y,E));class I{constructor(y,E,x){fc("r",y,Vt,n),fc("s",E,Vt,n),this.r=y,this.s=E,x!=null&&(this.recovery=x),Object.freeze(this)}static fromCompact(y){const E=s;return y=Mn("compactSignature",y,E*2),new I(w(y,0,E),w(y,E,2*E))}static fromDER(y){const{r:E,s:x}=ci.toSig(Mn("DER",y));return new I(E,x)}assertValidity(){}addRecoveryBit(y){return new I(this.r,this.s,y)}recoverPublicKey(y){const{r:E,s:x,recovery:_}=this,A=P(Mn("msgHash",y));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const L=_===2||_===3?E+e.n:E;if(L>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const B=(_&1)===0?"02":"03",q=u.fromHex(B+og(L,r.BYTES)),D=l(L),F=c(-A*D),H=c(x*D),W=u.BASE.multiplyAndAddUnsafe(q,F,H);if(!W)throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new I(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return qd(this.toDERHex())}toDERHex(){return ci.hexFromSig(this)}toCompactRawBytes(){return qd(this.toCompactHex())}toCompactHex(){const y=s;return og(this.r,y)+og(this.s,y)}}const S={isValidPrivateKey(f){try{return h(f),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const f=ux(e.n);return C6(e.randomBytes(f),e.n)},precompute(f=8,y=u.BASE){return y._setWindowSize(f),y.multiply(BigInt(3)),y}};function v(f,y=!0){return u.fromPrivateKey(f).toRawBytes(y)}function b(f){if(typeof f=="bigint")return!1;if(f instanceof u)return!0;const E=Mn("key",f).length,x=r.BYTES,_=x+1,A=2*x+1;if(!(e.allowedPrivateKeyLengths||s===_))return E===_||E===A}function C(f,y,E=!0){if(b(f)===!0)throw new Error("first arg must be private key");if(b(y)===!1)throw new Error("second arg must be public key");return u.fromHex(y).multiply(h(f)).toRawBytes(E)}const N=e.bits2int||function(f){if(f.length>8192)throw new Error("input is too large");const y=ua(f),E=f.length*8-i;return E>0?y>>BigInt(E):y},P=e.bits2int_modN||function(f){return c(N(f))},R=Wf(i);function O(f){return fc("num < 2^"+i,f,di,R),Gu(f,s)}function M(f,y,E=j){if(["recovered","canonical"].some(K=>K in E))throw new Error("sign() legacy options not supported");const{hash:x,randomBytes:_}=e;let{lowS:A,prehash:L,extraEntropy:B}=E;A==null&&(A=!0),f=Mn("msgHash",f),l1(E),L&&(f=Mn("prehashed msgHash",x(f)));const q=P(f),D=h(y),F=[O(D),O(q)];if(B!=null&&B!==!1){const K=B===!0?_(r.BYTES):B;F.push(Mn("extraEntropy",K))}const H=zd(...F),W=q;function ee(K){const G=N(K);if(!p(G))return;const le=l(G),ye=u.BASE.multiply(G).toAffine(),ve=c(ye.x);if(ve===di)return;const Ee=c(le*c(W+ve*D));if(Ee===di)return;let Ke=(ye.x===ve?0:2)|Number(ye.y&Vt),gr=Ee;return A&&g(Ee)&&(gr=m(Ee),Ke^=1),new I(ve,gr,Ke)}return{seed:H,k2sig:ee}}const j={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};function $(f,y,E=j){const{seed:x,k2sig:_}=M(f,y,E),A=e;return PR(A.hash.outputLen,A.nByteLength,A.hmac)(x,_)}u.BASE._setWindowSize(8);function T(f,y,E,x=k){const _=f;y=Mn("msgHash",y),E=Mn("publicKey",E);const{lowS:A,prehash:L,format:B}=x;if(l1(x),"strict"in x)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&B!=="compact"&&B!=="der")throw new Error("format must be compact or der");const q=typeof _=="string"||Ku(_),D=!q&&!B&&typeof _=="object"&&_!==null&&typeof _.r=="bigint"&&typeof _.s=="bigint";if(!q&&!D)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let F,H;try{if(D&&(F=new I(_.r,_.s)),q){try{B!=="compact"&&(F=I.fromDER(_))}catch(Ke){if(!(Ke instanceof ci.Err))throw Ke}!F&&B!=="der"&&(F=I.fromCompact(_))}H=u.fromHex(E)}catch{return!1}if(!F||A&&F.hasHighS())return!1;L&&(y=e.hash(y));const{r:W,s:ee}=F,K=P(y),G=l(ee),le=c(K*G),ye=c(W*G),ve=u.BASE.multiplyAndAddUnsafe(H,le,ye)?.toAffine();return ve?c(ve.x)===W:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:C,sign:$,verify:T,ProjectivePoint:u,Signature:I,utils:S}}function U6(t){return{hash:t,hmac:(e,...r)=>rx(t,e,iR(...r)),randomBytes:oR}}function B6(t,e){const r=n=>D6({...t,...U6(n)});return{...r(e),create:r}}const px=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),u1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),L6=BigInt(0),M6=BigInt(1),oy=BigInt(2),h1=(t,e)=>(t+e/oy)/e;function j6(t){const e=px,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=An(u,r,e)*u%e,d=An(h,r,e)*u%e,p=An(d,oy,e)*l%e,g=An(p,s,e)*p%e,m=An(g,i,e)*g%e,w=An(m,a,e)*m%e,I=An(w,c,e)*w%e,S=An(I,a,e)*m%e,v=An(S,r,e)*u%e,b=An(v,o,e)*g%e,C=An(b,n,e)*l%e,N=An(C,oy,e);if(!ay.eql(ay.sqr(N),t))throw new Error("Cannot find square root");return N}const ay=p0(px,void 0,void 0,{sqrt:j6}),F6=B6({a:L6,b:BigInt(7),Fp:ay,n:u1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=u1,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-M6*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=h1(i*t,e),c=h1(-n*t,e);let l=Kr(t-a*r-c*s,e),u=Kr(-a*n-c*i,e);const h=l>o,d=u>o;if(h&&(l=e-l),d&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},OR);function q6(t){if(t.length!==130&&t.length!==132)throw new H6({signature:t});const e=BigInt(si(t,0,32)),r=BigInt(si(t,32,64)),n=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return z6(s)}catch{throw new V6({value:s})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function z6(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new W6({value:t})}let H6=class extends Et{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${bo(f0(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}},V6=class extends Et{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}},W6=class extends Et{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}};function K6(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function gx(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Vd(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function g0(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function cy(t){if(!Array.isArray(t))throw new Error("array expected")}function Wd(t,e){if(!gx(!0,e))throw new Error(`${t}: array of strings expected`)}function G6(t,e){if(!gx(!1,e))throw new Error(`${t}: array of numbers expected`)}function Y6(...t){const e=i=>i,r=(i,o)=>a=>i(o(a)),n=t.map(i=>i.encode).reduceRight(r,e),s=t.map(i=>i.decode).reduce(r,e);return{encode:n,decode:s}}function Z6(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Wd("alphabet",e);const n=new Map(e.map((s,i)=>[s,i]));return{encode:s=>(cy(s),s.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${t}`);return e[i]})),decode:s=>(cy(s),s.map(i=>{Vd("alphabet.decode",i);const o=n.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${t}`);return o}))}}function J6(t=""){return Vd("join",t),{encode:e=>(Wd("join.decode",e),e.join(t)),decode:e=>(Vd("join.decode",e),e.split(t))}}function X6(t,e="="){return g0(t),Vd("padding",e),{encode(r){for(Wd("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Wd("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}const mx=(t,e)=>e===0?t:mx(e,t%e),Kd=(t,e)=>t+(e-mx(t,e)),cg=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function d1(t,e,r,n){if(cy(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Kd(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Kd(e,r)}`);let s=0,i=0;const o=cg[e],a=cg[r]-1,c=[];for(const l of t){if(g0(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=r;i-=r)c.push((s>>i-r&a)>>>0);const u=cg[i];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<r-i&a,!n&&i>=e)throw new Error("Excess padding");if(!n&&s>0)throw new Error(`Non-zero padding: ${s}`);return n&&i>0&&c.push(s>>>0),c}function Q6(t,e=!1){if(g0(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Kd(8,t)>32||Kd(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!K6(r))throw new Error("radix2.encode input should be Uint8Array");return d1(Array.from(r),8,t,!e)},decode:r=>(G6("radix2.decode",r),Uint8Array.from(d1(r,t,8,e)))}}const yx=Y6(Q6(5),Z6("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),X6(5),J6(""));function eD(t){return g6(tD(t))}function tD(t){const{payload:e,signature:r}=t,{r:n,s,yParity:i}=r,a=new F6.Signature(BigInt(n),BigInt(s)).addRecoveryBit(i).recoverPublicKey(f0(e).substring(2));return o6(a)}function rD(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,n=t.charAt(0),s=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0;const p=l.length;for(;d!==p&&l[d]===0;)d++,u++;const g=(p-d)*i+1>>>0,m=new Uint8Array(g);for(;d!==p;){let S=l[d],v=0;for(let b=g-1;(S!==0||v<h)&&b!==-1;b--,v++)S+=256*m[b]>>>0,m[b]=S%r>>>0,S=S/r>>>0;if(S!==0)throw new Error("Non-zero carry");h=v,d++}let w=g-h;for(;w!==g&&m[w]===0;)w++;let I=n.repeat(u);for(;w<g;++w)I+=t.charAt(m[w]);return I}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===n;)h++,u++;const p=(l.length-u)*s+1>>>0,g=new Uint8Array(p);for(;u<l.length;){const S=l.charCodeAt(u);if(S>255)return;let v=e[S];if(v===255)return;let b=0;for(let C=p-1;(v!==0||b<d)&&C!==-1;C--,b++)v+=r*g[C]>>>0,g[C]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=b,u++}let m=p-d;for(;m!==p&&g[m]===0;)m++;const w=new Uint8Array(h+(p-m));let I=h;for(;m!==p;)w[I++]=g[m++];return w}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var nD="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Yu=rD(nD);function sD(t){const e=t.length;let r=0,n=0;for(;n<e;){let s=t.charCodeAt(n++);if((s&4294967168)===0){r++;continue}else if((s&4294965248)===0)r+=2;else{if(s>=55296&&s<=56319&&n<e){const i=t.charCodeAt(n);(i&64512)===56320&&(++n,s=((s&1023)<<10)+(i&1023)+65536)}(s&4294901760)===0?r+=3:r+=4}}return r}function iD(t,e,r){const n=t.length;let s=r,i=0;for(;i<n;){let o=t.charCodeAt(i++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<n){const a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const oD=new TextEncoder,aD=50;function cD(t,e,r){oD.encodeInto(t,e.subarray(r))}function lD(t,e,r){t.length>aD?cD(t,e,r):iD(t,e,r)}const uD=4096;function wx(t,e,r){let n=e;const s=n+r,i=[];let o="";for(;n<s;){const a=t[n++];if((a&128)===0)i.push(a);else if((a&224)===192){const c=t[n++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,l=t[n++]&63;i.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[n++]&63,l=t[n++]&63,u=t[n++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=uD&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}const hD=new TextDecoder,dD=200;function fD(t,e,r){const n=t.subarray(e,e+r);return hD.decode(n)}function pD(t,e,r){return r>dD?fD(t,e,r):wx(t,e,r)}class $h{constructor(e,r){this.type=e,this.data=r}}class mn extends Error{constructor(e){super(e);const r=Object.create(mn.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:mn.name})}}const nl=4294967295;function gD(t,e,r){const n=r/4294967296,s=r;t.setUint32(e,n),t.setUint32(e+4,s)}function bx(t,e,r){const n=Math.floor(r/4294967296),s=r;t.setUint32(e,n),t.setUint32(e+4,s)}function vx(t,e){const r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function mD(t,e){const r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}const yD=-1,wD=4294967296-1,bD=17179869184-1;function vD({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=bD)if(e===0&&t<=wD){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,n=t&4294967295,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,e<<2|r&3),i.setUint32(4,n),s}else{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),bx(n,4,t),r}}function ED(t){const e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,s=Math.floor(n/1e9);return{sec:r+s,nsec:n-s*1e9}}function _D(t){if(t instanceof Date){const e=ED(t);return vD(e)}else return null}function ID(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),n=e.getUint32(4),s=(r&3)*4294967296+n,i=r>>>2;return{sec:s,nsec:i}}case 12:{const r=vx(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new mn(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function SD(t){const e=ID(t);return new Date(e.sec*1e3+e.nsec/1e6)}const CD={type:yD,encode:_D,decode:SD};class Gd{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(CD)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const s=this.builtInEncoders[n];if(s!=null){const i=s(e,r);if(i!=null){const o=-1-n;return new $h(o,i)}}}for(let n=0;n<this.encoders.length;n++){const s=this.encoders[n];if(s!=null){const i=s(e,r);if(i!=null){const o=n;return new $h(o,i)}}}return e instanceof $h?e:null}decode(e,r,n){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,n):new $h(r,e)}}Gd.defaultCodec=new Gd;function xD(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ly(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):xD(t)?new Uint8Array(t):Uint8Array.from(t)}const AD=100,$D=2048;let ND=class Ex{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Gd.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??AD,this.initialBufferSize=e?.initialBufferSize??$D,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Ex({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),n=new Uint8Array(r),s=new DataView(r);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=sD(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),lD(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const n=ly(e);this.writeU8a(n)}encodeArray(e,r){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let n=0;for(const s of r)e[s]!==void 0&&n++;return n}encodeMap(e,r){const n=Object.keys(e);this.sortKeys&&n.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const i of n){const o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),s=n.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(n);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),gD(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),bx(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function _x(t,e){return new ND(e).encodeSharedRef(t)}function lg(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const OD=16,TD=16;class kD{constructor(e=OD,r=TD){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){const s=this.caches[n-1];e:for(const i of s){const o=i.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return i.str}return null}store(e,r){const n=this.caches[e.length-1],s={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=s:n.push(s)}decode(e,r,n){const s=this.find(e,r,n);if(s!=null)return this.hit++,s;this.miss++;const i=wx(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,i),i}}const uy="array",Ul="map_key",Ix="map_value",PD=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new mn("The type of key must be string or number but "+typeof t)};class RD{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=uy,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Ul,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===uy){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===Ul||e.type===Ix){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const sl=-1,m0=new DataView(new ArrayBuffer(0)),DD=new Uint8Array(m0.buffer);try{m0.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const f1=new RangeError("Insufficient data"),UD=new kD;let BD=class Sx{constructor(e){this.totalPos=0,this.pos=0,this.view=m0,this.bytes=DD,this.headByte=sl,this.stack=new RD,this.entered=!1,this.extensionCodec=e?.extensionCodec??Gd.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??nl,this.maxBinLength=e?.maxBinLength??nl,this.maxArrayLength=e?.maxArrayLength??nl,this.maxMapLength=e?.maxMapLength??nl,this.maxExtLength=e?.maxExtLength??nl,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:UD,this.mapKeyConverter=e?.mapKeyConverter??PD}clone(){return new Sx({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=sl,this.stack.reset()}setBuffer(e){const r=ly(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===sl&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),n=ly(e),s=new Uint8Array(r.length+n.length);s.set(r),s.set(n,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:s,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${lg(s)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,s=-1;for await(const i of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new mn(`Unrecognized type byte: ${lg(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const s=n.top();if(s.type===uy)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,n.release(s);else continue e;else if(s.type===Ul){if(r==="__proto__")throw new mn("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=Ix;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,n.release(s);else{s.key=null,s.type=Ul;continue e}}return r}}readHeadByte(){return this.headByte===sl&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=sl}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new mn(`Unrecognized array type byte: ${lg(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new mn(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new mn(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new mn(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw f1;const n=this.pos+r;let s;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?s=this.keyDecoder.decode(this.bytes,n,e):s=pD(this.bytes,n,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Ul:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new mn(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw f1;const n=this.pos+r,s=this.bytes.subarray(n,n+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new mn(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=mD(this.view,this.pos);return this.pos+=8,e}readI64(){const e=vx(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Cx(t,e){return new BD(e).decode(t)}function y0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function xx(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?y0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Rs(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));const r=xx(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return y0(r)}function LD(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,w=0,I=0,S=g.length;I!==S&&g[I]===0;)I++,m++;for(var v=(S-I)*u+1>>>0,b=new Uint8Array(v);I!==S;){for(var C=g[I],N=0,P=v-1;(C!==0||N<w)&&P!==-1;P--,N++)C+=256*b[P]>>>0,b[P]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=N,I++}for(var R=v-w;R!==v&&b[R]===0;)R++;for(var O=c.repeat(m);R<v;++R)O+=t.charAt(b[R]);return O}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var w=0,I=0;g[m]===c;)w++,m++;for(var S=(g.length-m)*l+1>>>0,v=new Uint8Array(S);g[m];){var b=r[g.charCodeAt(m)];if(b===255)return;for(var C=0,N=S-1;(b!==0||C<I)&&N!==-1;N--,C++)b+=a*v[N]>>>0,v[N]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");I=C,m++}if(g[m]!==" "){for(var P=S-I;P!==S&&v[P]===0;)P++;for(var R=new Uint8Array(w+(S-P)),O=w;P!==S;)R[O++]=v[P++];return R}}}function p(g){var m=d(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var MD=LD,jD=MD;const FD=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},qD=t=>new TextEncoder().encode(t),zD=t=>new TextDecoder().decode(t);class HD{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class VD{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ax(this,e)}}class WD{constructor(e){this.decoders=e}or(e){return Ax(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ax=(t,e)=>new WD({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class KD{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new HD(e,r,n),this.decoder=new VD(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Gf=({name:t,prefix:e,encode:r,decode:n})=>new KD(t,e,r,n),Zu=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=jD(r,e);return Gf({prefix:t,name:e,encode:n,decode:i=>FD(s(i))})},GD=(t,e,r,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},YD=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},dr=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Gf({prefix:e,name:t,encode(s){return YD(s,n,r)},decode(s){return GD(s,n,r,t)}}),ZD=Gf({prefix:"\0",name:"identity",encode:t=>zD(t),decode:t=>qD(t)}),JD=Object.freeze(Object.defineProperty({__proto__:null,identity:ZD},Symbol.toStringTag,{value:"Module"})),XD=dr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),QD=Object.freeze(Object.defineProperty({__proto__:null,base2:XD},Symbol.toStringTag,{value:"Module"})),eU=dr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),tU=Object.freeze(Object.defineProperty({__proto__:null,base8:eU},Symbol.toStringTag,{value:"Module"})),rU=Zu({prefix:"9",name:"base10",alphabet:"0123456789"}),nU=Object.freeze(Object.defineProperty({__proto__:null,base10:rU},Symbol.toStringTag,{value:"Module"})),sU=dr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),iU=dr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),oU=Object.freeze(Object.defineProperty({__proto__:null,base16:sU,base16upper:iU},Symbol.toStringTag,{value:"Module"})),aU=dr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cU=dr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lU=dr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),uU=dr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hU=dr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),dU=dr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),fU=dr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),pU=dr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gU=dr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),mU=Object.freeze(Object.defineProperty({__proto__:null,base32:aU,base32hex:hU,base32hexpad:fU,base32hexpadupper:pU,base32hexupper:dU,base32pad:lU,base32padupper:uU,base32upper:cU,base32z:gU},Symbol.toStringTag,{value:"Module"})),yU=Zu({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wU=Zu({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),bU=Object.freeze(Object.defineProperty({__proto__:null,base36:yU,base36upper:wU},Symbol.toStringTag,{value:"Module"})),vU=Zu({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),EU=Zu({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),_U=Object.freeze(Object.defineProperty({__proto__:null,base58btc:vU,base58flickr:EU},Symbol.toStringTag,{value:"Module"})),IU=dr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),SU=dr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),CU=dr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xU=dr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),AU=Object.freeze(Object.defineProperty({__proto__:null,base64:IU,base64pad:SU,base64url:CU,base64urlpad:xU},Symbol.toStringTag,{value:"Module"})),$x=Array.from(""),$U=$x.reduce((t,e,r)=>(t[r]=e,t),[]),NU=$x.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function OU(t){return t.reduce((e,r)=>(e+=$U[r],e),"")}function TU(t){const e=[];for(const r of t){const n=NU[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const kU=Gf({prefix:"",name:"base256emoji",encode:OU,decode:TU}),PU=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:kU},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const p1={...JD,...QD,...tU,...nU,...oU,...mU,...bU,..._U,...AU,...PU};function Nx(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const g1=Nx("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ug=Nx("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=xx(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ox={utf8:g1,"utf-8":g1,hex:p1.base16,latin1:ug,ascii:ug,binary:ug,...p1};function ut(t,e="utf8"){const r=Ox[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?y0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Ye(t,e="utf8"){const r=Ox[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Tx={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var hg,m1;function kx(){if(m1)return hg;m1=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function n(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=n(a[u]).toUpperCase(),l+=" ",l+=n(a[u+1]).toUpperCase();else if(c===64)l+=n(a[u+1]).toUpperCase(),l+=n(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function i(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let d=0;d<a;d++)u[d]=d%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let d=0;d<c;d++){const p=o(u),g=new Date().getTime(),m=g-l;l=g,console.log("Hashed in "+m+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(m/1e3)*100)/100+" MB PER SECOND")}}return hg={normalizeInput:e,toHex:r,debugPrint:s,testSpeed:i},hg}var dg,y1;function RU(){if(y1)return dg;y1=1;const t=kx();function e(I,S,v){const b=I[S]+I[v];let C=I[S+1]+I[v+1];b>=4294967296&&C++,I[S]=b,I[S+1]=C}function r(I,S,v,b){let C=I[S]+v;v<0&&(C+=4294967296);let N=I[S+1]+b;C>=4294967296&&N++,I[S]=C,I[S+1]=N}function n(I,S){return I[S]^I[S+1]<<8^I[S+2]<<16^I[S+3]<<24}function s(I,S,v,b,C,N){const P=l[C],R=l[C+1],O=l[N],M=l[N+1];e(c,I,S),r(c,I,P,R);let j=c[b]^c[I],k=c[b+1]^c[I+1];c[b]=k,c[b+1]=j,e(c,v,b),j=c[S]^c[v],k=c[S+1]^c[v+1],c[S]=j>>>24^k<<8,c[S+1]=k>>>24^j<<8,e(c,I,S),r(c,I,O,M),j=c[b]^c[I],k=c[b+1]^c[I+1],c[b]=j>>>16^k<<16,c[b+1]=k>>>16^j<<16,e(c,v,b),j=c[S]^c[v],k=c[S+1]^c[v+1],c[S]=k>>>31^j<<1,c[S+1]=j>>>31^k<<1}const i=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(I){return I*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(I,S){let v=0;for(v=0;v<16;v++)c[v]=I.h[v],c[v+16]=i[v];for(c[24]=c[24]^I.t,c[25]=c[25]^I.t/4294967296,S&&(c[28]=~c[28],c[29]=~c[29]),v=0;v<32;v++)l[v]=n(I.b,4*v);for(v=0;v<12;v++)s(0,8,16,24,a[v*16+0],a[v*16+1]),s(2,10,18,26,a[v*16+2],a[v*16+3]),s(4,12,20,28,a[v*16+4],a[v*16+5]),s(6,14,22,30,a[v*16+6],a[v*16+7]),s(0,10,20,30,a[v*16+8],a[v*16+9]),s(2,12,22,24,a[v*16+10],a[v*16+11]),s(4,14,16,26,a[v*16+12],a[v*16+13]),s(6,8,18,28,a[v*16+14],a[v*16+15]);for(v=0;v<16;v++)I.h[v]=I.h[v]^c[v]^c[v+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function d(I,S,v,b){if(I===0||I>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(S&&S.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(v&&v.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(b&&b.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const C={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:I};h.fill(0),h[0]=I,S&&(h[1]=S.length),h[2]=1,h[3]=1,v&&h.set(v,32),b&&h.set(b,48);for(let N=0;N<16;N++)C.h[N]=i[N]^n(h,N*4);return S&&(p(C,S),C.c=128),C}function p(I,S){for(let v=0;v<S.length;v++)I.c===128&&(I.t+=I.c,u(I,!1),I.c=0),I.b[I.c++]=S[v]}function g(I){for(I.t+=I.c;I.c<128;)I.b[I.c++]=0;u(I,!0);const S=new Uint8Array(I.outlen);for(let v=0;v<I.outlen;v++)S[v]=I.h[v>>2]>>8*(v&3);return S}function m(I,S,v,b,C){v=v||64,I=t.normalizeInput(I),b&&(b=t.normalizeInput(b)),C&&(C=t.normalizeInput(C));const N=d(v,S,b,C);return p(N,I),g(N)}function w(I,S,v,b,C){const N=m(I,S,v,b,C);return t.toHex(N)}return dg={blake2b:m,blake2bHex:w,blake2bInit:d,blake2bUpdate:p,blake2bFinal:g},dg}var fg,w1;function DU(){if(w1)return fg;w1=1;const t=kx();function e(g,m){return g[m]^g[m+1]<<8^g[m+2]<<16^g[m+3]<<24}function r(g,m,w,I,S,v){o[g]=o[g]+o[m]+S,o[I]=n(o[I]^o[g],16),o[w]=o[w]+o[I],o[m]=n(o[m]^o[w],12),o[g]=o[g]+o[m]+v,o[I]=n(o[I]^o[g],8),o[w]=o[w]+o[I],o[m]=n(o[m]^o[w],7)}function n(g,m){return g>>>m^g<<32-m}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),i=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(g,m){let w=0;for(w=0;w<8;w++)o[w]=g.h[w],o[w+8]=s[w];for(o[12]^=g.t,o[13]^=g.t/4294967296,m&&(o[14]=~o[14]),w=0;w<16;w++)a[w]=e(g.b,4*w);for(w=0;w<10;w++)r(0,4,8,12,a[i[w*16+0]],a[i[w*16+1]]),r(1,5,9,13,a[i[w*16+2]],a[i[w*16+3]]),r(2,6,10,14,a[i[w*16+4]],a[i[w*16+5]]),r(3,7,11,15,a[i[w*16+6]],a[i[w*16+7]]),r(0,5,10,15,a[i[w*16+8]],a[i[w*16+9]]),r(1,6,11,12,a[i[w*16+10]],a[i[w*16+11]]),r(2,7,8,13,a[i[w*16+12]],a[i[w*16+13]]),r(3,4,9,14,a[i[w*16+14]],a[i[w*16+15]]);for(w=0;w<8;w++)g.h[w]^=o[w]^o[w+8]}function l(g,m){if(!(g>0&&g<=32))throw new Error("Incorrect output length, should be in [1, 32]");const w=m?m.length:0;if(m&&!(w>0&&w<=32))throw new Error("Incorrect key length, should be in [1, 32]");const I={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:g};return I.h[0]^=16842752^w<<8^g,w>0&&(u(I,m),I.c=64),I}function u(g,m){for(let w=0;w<m.length;w++)g.c===64&&(g.t+=g.c,c(g,!1),g.c=0),g.b[g.c++]=m[w]}function h(g){for(g.t+=g.c;g.c<64;)g.b[g.c++]=0;c(g,!0);const m=new Uint8Array(g.outlen);for(let w=0;w<g.outlen;w++)m[w]=g.h[w>>2]>>8*(w&3)&255;return m}function d(g,m,w){w=w||32,g=t.normalizeInput(g);const I=l(w,m);return u(I,g),h(I)}function p(g,m,w){const I=d(g,m,w);return t.toHex(I)}return fg={blake2s:d,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},fg}var pg,b1;function UU(){if(b1)return pg;b1=1;const t=RU(),e=DU();return pg={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},pg}var Px=UU(),BU={};const LU=":";function gd(t){const[e,r]=t.split(LU);return{namespace:e,reference:r}}function Rx(t,e){return t.includes(":")?[t]:e.chains||[]}var MU=Object.defineProperty,jU=Object.defineProperties,FU=Object.getOwnPropertyDescriptors,v1=Object.getOwnPropertySymbols,qU=Object.prototype.hasOwnProperty,zU=Object.prototype.propertyIsEnumerable,hy=(t,e,r)=>e in t?MU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,E1=(t,e)=>{for(var r in e||(e={}))qU.call(e,r)&&hy(t,r,e[r]);if(v1)for(var r of v1(e))zU.call(e,r)&&hy(t,r,e[r]);return t},HU=(t,e)=>jU(t,FU(e)),_1=(t,e,r)=>hy(t,typeof e!="symbol"?e+"":e,r);const VU="ReactNative",En={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},WU="js";function Yd(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function So(){return!Jt.getDocument()&&!!Jt.getNavigator()&&navigator.product===VU}function KU(){return So()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function GU(){return So()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function zc(){return!Yd()&&!!Jt.getNavigator()&&!!Jt.getDocument()}function Ju(){return So()?En.reactNative:Yd()?En.node:zc()?En.browser:En.unknown}function I1(){var t;try{return So()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function YU(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!=null&&r.set(n,String(s))}),r.toString()}function ZU(t){var e,r;const n=Dx();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),HU(E1(E1({},n),t),{url:t?.url||n.url,name:t?.name||n.name,description:t?.description||n.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(s){return console.warn("Error populating app metadata",s),t||n}}function Dx(){return kC.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function JU(){if(Ju()===En.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=OC();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function XU(){var t;const e=Ju();return e===En.browser?[e,((t=Jt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Ux(t,e,r){const n=JU(),s=XU();return[[t,e].join("-"),[WU,r].join("-"),n,s].join("/")}function QU({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:s,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=Ux(t,e,n),h={auth:s,ua:u,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=YU(l[1]||"",h);return l[0]+"?"+d}function Xo(t,e){return t.filter(r=>e.includes(r)).length===t.length}function dy(t){return Object.fromEntries(t.entries())}function fy(t){return new Map(Object.entries(t))}function Mo(t=z.FIVE_MINUTES,e){const r=z.toMiliseconds(t||z.FIVE_MINUTES);let n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),n=a,s=c})}}function Os(t,e,r){return new Promise(async(n,s)=>{const i=setTimeout(()=>s(new Error(r)),e);try{const o=await t;n(o)}catch(o){s(o)}clearTimeout(i)})}function Bx(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function eB(t){return Bx("topic",t)}function tB(t){return Bx("id",t)}function Lx(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Rt(t,e){return z.fromMiliseconds(Date.now()+z.toMiliseconds(t))}function Zi(t){return Date.now()>=z.toMiliseconds(t)}function Ve(t,e){return`${t}${e?`:${e}`:""}`}function ha(t=[],e=[]){return[...new Set([...t,...e])]}async function rB({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,i=s?.href;if(typeof i!="string")return;const o=nB(i,t,e),a=Ju();if(a===En.browser){if(!((n=Jt.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}sB(o)}else a===En.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function nB(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const i=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${i}${cB(n,!0)}`}else s=`${s}/wc?${n}`;return s}function sB(t){let e="_self";aB()?e="_top":(oB()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function iB(t,e){let r="";try{if(zc()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function S1(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function C1(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function w0(){return typeof process<"u"&&BU.IS_VITEST==="true"}function oB(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function aB(){try{return window.self!==window.top}catch{return!1}}function cB(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Mx(t){return Buffer.from(t,"base64").toString("utf-8")}function lB(t){return new Promise(e=>setTimeout(e,t))}let uB=class{constructor({limit:e}){_1(this,"limit"),_1(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const Nh=BigInt(2**32-1),x1=BigInt(32);function jx(t,e=!1){return e?{h:Number(t&Nh),l:Number(t>>x1&Nh)}:{h:Number(t>>x1&Nh)|0,l:Number(t&Nh)|0}}function Fx(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=jx(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const A1=(t,e,r)=>t>>>r,$1=(t,e,r)=>t<<32-r|e>>>r,Ji=(t,e,r)=>t>>>r|e<<32-r,Xi=(t,e,r)=>t<<32-r|e>>>r,xl=(t,e,r)=>t<<64-r|e>>>r-32,Al=(t,e,r)=>t>>>r-32|e<<64-r,hB=(t,e)=>e,dB=(t,e)=>t,fB=(t,e,r)=>t<<r|e>>>32-r,pB=(t,e,r)=>e<<r|t>>>32-r,gB=(t,e,r)=>e<<r-32|t>>>64-r,mB=(t,e,r)=>t<<r-32|e>>>64-r;function ns(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const b0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),v0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,yB=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),wB=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,bB=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),vB=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,qa=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Yf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ci(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function fs(t,...e){if(!Yf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zf(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ci(t.outputLen),Ci(t.blockLen)}function vo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function E0(t,e){fs(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function su(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Vn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function gg(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ys(t,e){return t<<32-e|t>>>e}const qx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function zx(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Xs=qx?t=>t:t=>zx(t);function EB(t){for(let e=0;e<t.length;e++)t[e]=zx(t[e]);return t}const Qi=qx?t=>t:EB,Hx=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",_B=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function pc(t){if(fs(t),Hx)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=_B[t[r]];return e}const Vs={_0:48,_9:57,A:65,F:70,a:97,f:102};function N1(t){if(t>=Vs._0&&t<=Vs._9)return t-Vs._0;if(t>=Vs.A&&t<=Vs.F)return t-(Vs.A-10);if(t>=Vs.a&&t<=Vs.f)return t-(Vs.a-10)}function Zd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Hx)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=N1(t.charCodeAt(i)),a=N1(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Vx(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function us(t){return typeof t=="string"&&(t=Vx(t)),fs(t),t}function so(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];fs(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}let Jf=class{};function Xu(t){const e=n=>t().update(us(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function IB(t){const e=(n,s)=>t(s).update(us(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function Na(t=32){if(qa&&typeof qa.getRandomValues=="function")return qa.getRandomValues(new Uint8Array(t));if(qa&&typeof qa.randomBytes=="function")return Uint8Array.from(qa.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const SB=BigInt(0),il=BigInt(1),CB=BigInt(2),xB=BigInt(7),AB=BigInt(256),$B=BigInt(113),Wx=[],Kx=[],Gx=[];for(let t=0,e=il,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],Wx.push(2*(5*n+r)),Kx.push((t+1)*(t+2)/2%64);let s=SB;for(let i=0;i<7;i++)e=(e<<il^(e>>xB)*$B)%AB,e&CB&&(s^=il<<(il<<BigInt(i))-il);Gx.push(s)}const Yx=Fx(Gx,!0),NB=Yx[0],OB=Yx[1],O1=(t,e,r)=>r>32?gB(t,e,r):fB(t,e,r),T1=(t,e,r)=>r>32?mB(t,e,r):pB(t,e,r);function TB(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=O1(l,u,1)^r[a],d=T1(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=Kx[o],c=O1(s,i,a),l=T1(s,i,a),u=Wx[o];s=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=NB[n],t[1]^=OB[n]}Vn(r)}let kB=class Zx extends Jf{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,Ci(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=su(this.state)}clone(){return this._cloneInto()}keccak(){Qi(this.state32),TB(this.state32,this.rounds),Qi(this.state32),this.posOut=0,this.pos=0}update(e){vo(this),e=us(e),fs(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){vo(this,!1),fs(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ci(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(E0(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Vn(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new Zx(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const PB=(t,e,r)=>Xu(()=>new kB(e,t,r)),RB=PB(1,136,256/8);function DB(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function UB(t,e,r){return t&e^~t&r}function BB(t,e,r){return t&e^t&r^e&r}let Jx=class extends Jf{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=gg(this.buffer)}update(e){vo(this),e=us(e),fs(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=gg(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){vo(this),E0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,Vn(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;DB(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=gg(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const ki=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),yr=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),wr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),LB=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pi=new Uint32Array(64);let MB=class extends Jx{constructor(e=32){super(64,e,8,!1),this.A=ki[0]|0,this.B=ki[1]|0,this.C=ki[2]|0,this.D=ki[3]|0,this.E=ki[4]|0,this.F=ki[5]|0,this.G=ki[6]|0,this.H=ki[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Pi[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=Pi[h-15],p=Pi[h-2],g=ys(d,7)^ys(d,18)^d>>>3,m=ys(p,17)^ys(p,19)^p>>>10;Pi[h]=m+Pi[h-7]+g+Pi[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=ys(a,6)^ys(a,11)^ys(a,25),p=u+d+UB(a,c,l)+LB[h]+Pi[h]|0,g=(ys(n,2)^ys(n,13)^ys(n,22))+BB(n,s,i)|0;u=l,l=c,c=a,a=o+p|0,o=i,i=s,s=n,n=p+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){Vn(Pi)}destroy(){this.set(0,0,0,0,0,0,0,0),Vn(this.buffer)}};const Xx=Fx(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),jB=Xx[0],FB=Xx[1],Ri=new Uint32Array(80),Di=new Uint32Array(80);let _0=class extends Jx{constructor(e=64){super(128,e,16,!1),this.Ah=wr[0]|0,this.Al=wr[1]|0,this.Bh=wr[2]|0,this.Bl=wr[3]|0,this.Ch=wr[4]|0,this.Cl=wr[5]|0,this.Dh=wr[6]|0,this.Dl=wr[7]|0,this.Eh=wr[8]|0,this.El=wr[9]|0,this.Fh=wr[10]|0,this.Fl=wr[11]|0,this.Gh=wr[12]|0,this.Gl=wr[13]|0,this.Hh=wr[14]|0,this.Hl=wr[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:p,Gl:g,Hh:m,Hl:w}=this;return[e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w]}set(e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=g|0,this.Hh=m|0,this.Hl=w|0}process(e,r){for(let v=0;v<16;v++,r+=4)Ri[v]=e.getUint32(r),Di[v]=e.getUint32(r+=4);for(let v=16;v<80;v++){const b=Ri[v-15]|0,C=Di[v-15]|0,N=Ji(b,C,1)^Ji(b,C,8)^A1(b,C,7),P=Xi(b,C,1)^Xi(b,C,8)^$1(b,C,7),R=Ri[v-2]|0,O=Di[v-2]|0,M=Ji(R,O,19)^xl(R,O,61)^A1(R,O,6),j=Xi(R,O,19)^Al(R,O,61)^$1(R,O,6),k=yB(P,j,Di[v-7],Di[v-16]),$=wB(k,N,M,Ri[v-7],Ri[v-16]);Ri[v]=$|0,Di[v]=k|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:p,Fl:g,Gh:m,Gl:w,Hh:I,Hl:S}=this;for(let v=0;v<80;v++){const b=Ji(h,d,14)^Ji(h,d,18)^xl(h,d,41),C=Xi(h,d,14)^Xi(h,d,18)^Al(h,d,41),N=h&p^~h&m,P=d&g^~d&w,R=bB(S,C,P,FB[v],Di[v]),O=vB(R,I,b,N,jB[v],Ri[v]),M=R|0,j=Ji(n,s,28)^xl(n,s,34)^xl(n,s,39),k=Xi(n,s,28)^Al(n,s,34)^Al(n,s,39),$=n&i^n&a^i&a,T=s&o^s&c^o&c;I=m|0,S=w|0,m=p|0,w=g|0,p=h|0,g=d|0,{h,l:d}=ns(l|0,u|0,O|0,M|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const f=b0(M,k,T);n=v0(f,O,j,$),s=f|0}({h:n,l:s}=ns(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ns(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ns(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ns(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=ns(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:g}=ns(this.Fh|0,this.Fl|0,p|0,g|0),{h:m,l:w}=ns(this.Gh|0,this.Gl|0,m|0,w|0),{h:I,l:S}=ns(this.Hh|0,this.Hl|0,I|0,S|0),this.set(n,s,i,o,a,c,l,u,h,d,p,g,m,w,I,S)}roundClean(){Vn(Ri,Di)}destroy(){Vn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},qB=class extends _0{constructor(){super(48),this.Ah=yr[0]|0,this.Al=yr[1]|0,this.Bh=yr[2]|0,this.Bl=yr[3]|0,this.Ch=yr[4]|0,this.Cl=yr[5]|0,this.Dh=yr[6]|0,this.Dl=yr[7]|0,this.Eh=yr[8]|0,this.El=yr[9]|0,this.Fh=yr[10]|0,this.Fl=yr[11]|0,this.Gh=yr[12]|0,this.Gl=yr[13]|0,this.Hh=yr[14]|0,this.Hl=yr[15]|0}};const br=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let zB=class extends _0{constructor(){super(32),this.Ah=br[0]|0,this.Al=br[1]|0,this.Bh=br[2]|0,this.Bl=br[3]|0,this.Ch=br[4]|0,this.Cl=br[5]|0,this.Dh=br[6]|0,this.Dl=br[7]|0,this.Eh=br[8]|0,this.El=br[9]|0,this.Fh=br[10]|0,this.Fl=br[11]|0,this.Gh=br[12]|0,this.Gl=br[13]|0,this.Hh=br[14]|0,this.Hl=br[15]|0}};const Xf=Xu(()=>new MB),HB=Xu(()=>new _0),VB=Xu(()=>new qB),WB=Xu(()=>new zB),KB=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Tt=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),ae=new Uint32Array(32);function Ui(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=ae[2*t],l=ae[2*t+1],u=ae[2*e],h=ae[2*e+1],d=ae[2*r],p=ae[2*r+1],g=ae[2*n],m=ae[2*n+1],w=b0(c,u,o);l=v0(w,l,h,a),c=w|0,{Dh:m,Dl:g}={Dh:m^l,Dl:g^c},{Dh:m,Dl:g}={Dh:hB(m,g),Dl:dB(m)},{h:p,l:d}=ns(p,d,m,g),{Bh:h,Bl:u}={Bh:h^p,Bl:u^d},{Bh:h,Bl:u}={Bh:Ji(h,u,24),Bl:Xi(h,u,24)},ae[2*t]=c,ae[2*t+1]=l,ae[2*e]=u,ae[2*e+1]=h,ae[2*r]=d,ae[2*r+1]=p,ae[2*n]=g,ae[2*n+1]=m}function Bi(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=ae[2*t],l=ae[2*t+1],u=ae[2*e],h=ae[2*e+1],d=ae[2*r],p=ae[2*r+1],g=ae[2*n],m=ae[2*n+1],w=b0(c,u,o);l=v0(w,l,h,a),c=w|0,{Dh:m,Dl:g}={Dh:m^l,Dl:g^c},{Dh:m,Dl:g}={Dh:Ji(m,g,16),Dl:Xi(m,g,16)},{h:p,l:d}=ns(p,d,m,g),{Bh:h,Bl:u}={Bh:h^p,Bl:u^d},{Bh:h,Bl:u}={Bh:xl(h,u,63),Bl:Al(h,u,63)},ae[2*t]=c,ae[2*t+1]=l,ae[2*e]=u,ae[2*e+1]=h,ae[2*r]=d,ae[2*r+1]=p,ae[2*n]=g,ae[2*n+1]=m}function GB(t,e={},r,n,s){if(Ci(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}let YB=class extends Jf{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Ci(e),Ci(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=su(this.buffer)}update(e){vo(this),e=us(e),fs(e);const{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(Qi(s),this.compress(s,0,!1),Qi(s),this.pos=0);const l=Math.min(r-this.pos,i-c),u=o+c;if(l===r&&!(u%4)&&c+l<i){const h=new Uint32Array(a,u,Math.floor((i-c)/4));Qi(h);for(let d=0;c+r<i;d+=s.length,c+=r)this.length+=r,this.compress(h,d,!1);Qi(h);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){vo(this),E0(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Vn(this.buffer.subarray(r)),Qi(n),this.compress(n,0,!0),Qi(n);const s=su(e);this.get().forEach((i,o)=>s[o]=Xs(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},ZB=class extends YB{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Tt[0]|0,this.v0h=Tt[1]|0,this.v1l=Tt[2]|0,this.v1h=Tt[3]|0,this.v2l=Tt[4]|0,this.v2h=Tt[5]|0,this.v3l=Tt[6]|0,this.v3h=Tt[7]|0,this.v4l=Tt[8]|0,this.v4h=Tt[9]|0,this.v5l=Tt[10]|0,this.v5h=Tt[11]|0,this.v6l=Tt[12]|0,this.v6h=Tt[13]|0,this.v7l=Tt[14]|0,this.v7h=Tt[15]|0,GB(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=us(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=us(i);const a=su(i);this.v4l^=Xs(a[0]),this.v4h^=Xs(a[1]),this.v5l^=Xs(a[2]),this.v5h^=Xs(a[3])}if(s!==void 0){s=us(s);const a=su(s);this.v6l^=Xs(a[0]),this.v6h^=Xs(a[1]),this.v7l^=Xs(a[2]),this.v7h^=Xs(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:d,v6l:p,v6h:g,v7l:m,v7h:w}=this;return[e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w]}set(e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=d|0,this.v6l=p|0,this.v6h=g|0,this.v7l=m|0,this.v7h=w|0}compress(e,r,n){this.get().forEach((c,l)=>ae[l]=c),ae.set(Tt,16);let{h:s,l:i}=jx(BigInt(this.length));ae[24]=Tt[8]^i,ae[25]=Tt[9]^s,n&&(ae[28]=~ae[28],ae[29]=~ae[29]);let o=0;const a=KB;for(let c=0;c<12;c++)Ui(0,4,8,12,e,r+2*a[o++]),Bi(0,4,8,12,e,r+2*a[o++]),Ui(1,5,9,13,e,r+2*a[o++]),Bi(1,5,9,13,e,r+2*a[o++]),Ui(2,6,10,14,e,r+2*a[o++]),Bi(2,6,10,14,e,r+2*a[o++]),Ui(3,7,11,15,e,r+2*a[o++]),Bi(3,7,11,15,e,r+2*a[o++]),Ui(0,5,10,15,e,r+2*a[o++]),Bi(0,5,10,15,e,r+2*a[o++]),Ui(1,6,11,12,e,r+2*a[o++]),Bi(1,6,11,12,e,r+2*a[o++]),Ui(2,7,8,13,e,r+2*a[o++]),Bi(2,7,8,13,e,r+2*a[o++]),Ui(3,4,9,14,e,r+2*a[o++]),Bi(3,4,9,14,e,r+2*a[o++]);this.v0l^=ae[0]^ae[16],this.v0h^=ae[1]^ae[17],this.v1l^=ae[2]^ae[18],this.v1h^=ae[3]^ae[19],this.v2l^=ae[4]^ae[20],this.v2h^=ae[5]^ae[21],this.v3l^=ae[6]^ae[22],this.v3h^=ae[7]^ae[23],this.v4l^=ae[8]^ae[24],this.v4h^=ae[9]^ae[25],this.v5l^=ae[10]^ae[26],this.v5h^=ae[11]^ae[27],this.v6l^=ae[12]^ae[28],this.v6h^=ae[13]^ae[29],this.v7l^=ae[14]^ae[30],this.v7h^=ae[15]^ae[31],Vn(ae)}destroy(){this.destroyed=!0,Vn(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const JB=IB(t=>new ZB(t)),XB="https://rpc.walletconnect.org/v1";function Qx(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(RB(r)).toString("hex")}async function QB(t,e,r,n,s,i){switch(r.t){case"eip191":return await eL(t,e,r.s);case"eip1271":return await tL(t,e,r.s,n,s,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function eL(t,e,r){const n=q6(r);return eD({payload:Qx(e),signature:n}).toLowerCase()===t.toLowerCase()}async function tL(t,e,r,n,s,i){const o=gd(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Qx(e)).substring(2),d=a+h+c+u+l,p=await fetch(`${i||XB}/?chainId=${n}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:rL(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:g}=await p.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function rL(){return Date.now()+Math.floor(Math.random()*1e3)}function nL(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const s=1+n*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const i=Buffer.from(t,"base64").slice(1,65);return Yu.encode(i)}function sL(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const s=JB(n,{dkLen:32});return Yu.encode(s)}function k1(t){const e=new Uint8Array(Xf(iL(t)));return Yu.encode(e)}function iL(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function P1(t){const e=Buffer.from(t,"base64"),r=Cx(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=_x(r),s=Buffer.from("TX"),i=Buffer.concat([s,Buffer.from(n)]),o=WB(i);return yx.encode(o).replace(/=+$/,"")}function mg(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function oL(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(mg(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(mg(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(mg(n.length)),s.push(n);const i=Buffer.concat(s),o=Xf(i);return Buffer.from(o).toString("hex").toUpperCase()}function aL(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const s=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&n.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return n}var cL=Object.defineProperty,lL=Object.defineProperties,uL=Object.getOwnPropertyDescriptors,R1=Object.getOwnPropertySymbols,hL=Object.prototype.hasOwnProperty,dL=Object.prototype.propertyIsEnumerable,D1=(t,e,r)=>e in t?cL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fL=(t,e)=>{for(var r in e||(e={}))hL.call(e,r)&&D1(t,r,e[r]);if(R1)for(var r of R1(e))dL.call(e,r)&&D1(t,r,e[r]);return t},pL=(t,e)=>lL(t,uL(e));const eA="did:pkh:",gL={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},mL=t=>t?gL[t]||t:"",Qf=t=>t?.split(":"),yL=t=>{const e=t&&Qf(t);if(e)return t.includes(eA)?e[3]:e[1]},wL=t=>{const e=t&&Qf(t);if(e)return t.includes(eA)?e[2]:e[0]},py=t=>{const e=t&&Qf(t);if(e)return e[2]+":"+e[3]},Jd=t=>{const e=t&&Qf(t);if(e)return e.pop()};async function U1(t){const{cacao:e,projectId:r}=t,{s:n,p:s}=e,i=tA(s,s.iss),o=Jd(s.iss);return await QB(o,i,n,py(s.iss),r)}const tA=(t,e)=>{const r=wL(e);if(!r)throw new Error("Invalid issuer: "+e);const n=`${t.domain} wants you to sign in with your ${mL(r)} account:`,s=Jd(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${yL(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,d=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,g=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,m=md(t.resources);if(m){const w=iu(m);i=AL(i,w)}return[n,s,"",i,"",o,a,c,l,u,h,d,p,g].filter(w=>w!=null).join(`
`)};function bL(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function vL(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function wa(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(s=>{const i=n[s];if(!Array.isArray(i))throw new Error(`Ability limits ${s} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function EL(t,e,r,n={}){return r?.sort((s,i)=>s.localeCompare(i)),{att:{[t]:_L(e,r,n)}}}function _L(t,e,r={}){e=e?.sort((s,i)=>s.localeCompare(i));const n=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...n)}function rA(t){return wa(t),`urn:recap:${bL(t).replace(/=/g,"")}`}function iu(t){const e=vL(t.replace("urn:recap:",""));return wa(e),e}function IL(t,e,r){const n=EL(t,e,r);return rA(n)}function SL(t){return t&&t.includes("urn:recap:")}function CL(t,e){const r=iu(t),n=iu(e),s=xL(r,n);return rA(s)}function xL(t,e){wa(t),wa(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,i)=>s.localeCompare(i)),n={att:{}};return r.forEach(s=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[s]=pL(fL({},n.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),n}function AL(t="",e){wa(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));n.push(u.join(", ").replace(".,","."))});const i=n.join(" "),o=`${r}${i}`;return`${t?t+" ":""}${o}`}function B1(t){var e;const r=iu(t);wa(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(s=>s.split("/")[1]):[]}function L1(t){const e=iu(t);wa(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(s=>{var i;(i=s?.[0])!=null&&i.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function md(t){if(!t)return;const e=t?.[t.length-1];return SL(e)?e:void 0}function nA(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function gy(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function yg(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Gr(t,...e){if(!nA(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function M1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function $L(t,e){Gr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function mo(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function $c(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function NL(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const OL=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function TL(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function my(t){if(typeof t=="string")t=TL(t);else if(nA(t))t=yy(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function kL(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function PL(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const RL=(t,e)=>{function r(n,...s){if(Gr(n),!OL)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Gr(l):Gr(l,t.nonceLength)}const i=t.tagLength;i&&s[1]!==void 0&&Gr(s[1]);const o=e(n,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Gr(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Gr(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Gr(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function j1(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!UL(e))throw new Error("invalid output, must be aligned");return e}function F1(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function DL(t,e,r){gy(r);const n=new Uint8Array(16),s=NL(n);return F1(s,0,BigInt(e),r),F1(s,8,BigInt(t),r),n}function UL(t){return t.byteOffset%4===0}function yy(t){return Uint8Array.from(t)}const sA=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),BL=sA("expand 16-byte k"),LL=sA("expand 32-byte k"),ML=mo(BL),jL=mo(LL);function Re(t,e){return t<<e|t>>>32-e}function wy(t){return t.byteOffset%4===0}const Oh=64,FL=16,iA=2**32-1,q1=new Uint32Array;function qL(t,e,r,n,s,i,o,a){const c=s.length,l=new Uint8Array(Oh),u=mo(l),h=wy(s)&&wy(i),d=h?mo(s):q1,p=h?mo(i):q1;for(let g=0;g<c;o++){if(t(e,r,n,u,o,a),o>=iA)throw new Error("arx: counter overflow");const m=Math.min(Oh,c-g);if(h&&m===Oh){const w=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let I=0,S;I<FL;I++)S=w+I,p[S]=d[S]^u[I];g+=Oh;continue}for(let w=0,I;w<m;w++)I=g+w,i[I]=s[I]^l[w];g+=m}}function zL(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=kL({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return yg(s),yg(o),gy(i),gy(r),(a,c,l,u,h=0)=>{Gr(a),Gr(c),Gr(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Gr(u),yg(h),h<0||h>=iA)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const p=[];let g=a.length,m,w;if(g===32)p.push(m=yy(a)),w=jL;else if(g===16&&r)m=new Uint8Array(32),m.set(a),m.set(a,16),w=ML,p.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);wy(c)||p.push(c=yy(c));const I=mo(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(w,I,mo(c.subarray(0,16)),I),c=c.subarray(16)}const S=16-s;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){const b=new Uint8Array(12);b.set(c,i?0:12-c.length),c=b,p.push(c)}const v=mo(c);return qL(t,w,I,v,l,u,h,o),$c(...p),u}}const Xt=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let HL=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=my(e),Gr(e,32);const r=Xt(e,0),n=Xt(e,2),s=Xt(e,4),i=Xt(e,6),o=Xt(e,8),a=Xt(e,10),c=Xt(e,12),l=Xt(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Xt(e,16+2*u)}process(e,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],p=o[6],g=o[7],m=o[8],w=o[9],I=Xt(e,r+0),S=Xt(e,r+2),v=Xt(e,r+4),b=Xt(e,r+6),C=Xt(e,r+8),N=Xt(e,r+10),P=Xt(e,r+12),R=Xt(e,r+14);let O=i[0]+(I&8191),M=i[1]+((I>>>13|S<<3)&8191),j=i[2]+((S>>>10|v<<6)&8191),k=i[3]+((v>>>7|b<<9)&8191),$=i[4]+((b>>>4|C<<12)&8191),T=i[5]+(C>>>1&8191),f=i[6]+((C>>>14|N<<2)&8191),y=i[7]+((N>>>11|P<<5)&8191),E=i[8]+((P>>>8|R<<8)&8191),x=i[9]+(R>>>5|s),_=0,A=_+O*a+M*(5*w)+j*(5*m)+k*(5*g)+$*(5*p);_=A>>>13,A&=8191,A+=T*(5*d)+f*(5*h)+y*(5*u)+E*(5*l)+x*(5*c),_+=A>>>13,A&=8191;let L=_+O*c+M*a+j*(5*w)+k*(5*m)+$*(5*g);_=L>>>13,L&=8191,L+=T*(5*p)+f*(5*d)+y*(5*h)+E*(5*u)+x*(5*l),_+=L>>>13,L&=8191;let B=_+O*l+M*c+j*a+k*(5*w)+$*(5*m);_=B>>>13,B&=8191,B+=T*(5*g)+f*(5*p)+y*(5*d)+E*(5*h)+x*(5*u),_+=B>>>13,B&=8191;let q=_+O*u+M*l+j*c+k*a+$*(5*w);_=q>>>13,q&=8191,q+=T*(5*m)+f*(5*g)+y*(5*p)+E*(5*d)+x*(5*h),_+=q>>>13,q&=8191;let D=_+O*h+M*u+j*l+k*c+$*a;_=D>>>13,D&=8191,D+=T*(5*w)+f*(5*m)+y*(5*g)+E*(5*p)+x*(5*d),_+=D>>>13,D&=8191;let F=_+O*d+M*h+j*u+k*l+$*c;_=F>>>13,F&=8191,F+=T*a+f*(5*w)+y*(5*m)+E*(5*g)+x*(5*p),_+=F>>>13,F&=8191;let H=_+O*p+M*d+j*h+k*u+$*l;_=H>>>13,H&=8191,H+=T*c+f*a+y*(5*w)+E*(5*m)+x*(5*g),_+=H>>>13,H&=8191;let W=_+O*g+M*p+j*d+k*h+$*u;_=W>>>13,W&=8191,W+=T*l+f*c+y*a+E*(5*w)+x*(5*m),_+=W>>>13,W&=8191;let ee=_+O*m+M*g+j*p+k*d+$*h;_=ee>>>13,ee&=8191,ee+=T*u+f*l+y*c+E*a+x*(5*w),_+=ee>>>13,ee&=8191;let K=_+O*w+M*m+j*g+k*p+$*d;_=K>>>13,K&=8191,K+=T*h+f*u+y*l+E*c+x*a,_+=K>>>13,K&=8191,_=(_<<2)+_|0,_=_+A|0,A=_&8191,_=_>>>13,L+=_,i[0]=A,i[1]=L,i[2]=B,i[3]=q,i[4]=D,i[5]=F,i[6]=H,i[7]=W,i[8]=ee,i[9]=K}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;$c(n)}update(e){M1(this),e=my(e),Gr(e);const{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){$c(this.h,this.r,this.buffer,this.pad)}digestInto(e){M1(this),$L(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function VL(t){const e=(n,s)=>t(s).update(my(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const WL=VL(t=>new HL(t));function KL(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],p=e[3],g=e[4],m=e[5],w=e[6],I=e[7],S=s,v=r[0],b=r[1],C=r[2],N=o,P=a,R=c,O=l,M=u,j=h,k=d,$=p,T=g,f=m,y=w,E=I,x=S,_=v,A=b,L=C;for(let q=0;q<i;q+=2)N=N+M|0,x=Re(x^N,16),T=T+x|0,M=Re(M^T,12),N=N+M|0,x=Re(x^N,8),T=T+x|0,M=Re(M^T,7),P=P+j|0,_=Re(_^P,16),f=f+_|0,j=Re(j^f,12),P=P+j|0,_=Re(_^P,8),f=f+_|0,j=Re(j^f,7),R=R+k|0,A=Re(A^R,16),y=y+A|0,k=Re(k^y,12),R=R+k|0,A=Re(A^R,8),y=y+A|0,k=Re(k^y,7),O=O+$|0,L=Re(L^O,16),E=E+L|0,$=Re($^E,12),O=O+$|0,L=Re(L^O,8),E=E+L|0,$=Re($^E,7),N=N+j|0,L=Re(L^N,16),y=y+L|0,j=Re(j^y,12),N=N+j|0,L=Re(L^N,8),y=y+L|0,j=Re(j^y,7),P=P+k|0,x=Re(x^P,16),E=E+x|0,k=Re(k^E,12),P=P+k|0,x=Re(x^P,8),E=E+x|0,k=Re(k^E,7),R=R+$|0,_=Re(_^R,16),T=T+_|0,$=Re($^T,12),R=R+$|0,_=Re(_^R,8),T=T+_|0,$=Re($^T,7),O=O+M|0,A=Re(A^O,16),f=f+A|0,M=Re(M^f,12),O=O+M|0,A=Re(A^O,8),f=f+A|0,M=Re(M^f,7);let B=0;n[B++]=o+N|0,n[B++]=a+P|0,n[B++]=c+R|0,n[B++]=l+O|0,n[B++]=u+M|0,n[B++]=h+j|0,n[B++]=d+k|0,n[B++]=p+$|0,n[B++]=g+T|0,n[B++]=m+f|0,n[B++]=w+y|0,n[B++]=I+E|0,n[B++]=S+x|0,n[B++]=v+_|0,n[B++]=b+A|0,n[B++]=C+L|0}const GL=zL(KL,{counterRight:!1,counterLength:4,allowShortKeys:!1}),YL=new Uint8Array(16),z1=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(YL.subarray(r))},ZL=new Uint8Array(32);function H1(t,e,r,n,s){const i=t(e,r,ZL),o=WL.create(i);s&&z1(o,s),z1(o,n);const a=DL(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return $c(i,a),c}const JL=t=>(e,r,n)=>({encrypt(s,i){const o=s.length;i=j1(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=H1(t,e,r,a,n);return i.set(c,o),$c(c),i},decrypt(s,i){i=j1(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=H1(t,e,r,o,n);if(!PL(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),$c(c),i}}),oA=RL({blockSize:64,nonceLength:12,tagLength:16},JL(GL));let aA=class extends Jf{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Zf(e);const n=us(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Vn(i)}update(e){return vo(this),this.iHash.update(e),this}digestInto(e){vo(this),fs(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const ep=(t,e,r)=>new aA(t,e).update(r).digest();ep.create=(t,e)=>new aA(t,e);function XL(t,e,r){return Zf(t),r===void 0&&(r=new Uint8Array(t.outputLen)),ep(t,us(r),us(e))}const wg=Uint8Array.from([0]),V1=Uint8Array.of();function QL(t,e,r,n=32){Zf(t),Ci(n);const s=t.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);r===void 0&&(r=V1);const o=new Uint8Array(i*s),a=ep.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)wg[0]=u+1,c.update(u===0?V1:l).update(r).update(wg).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),Vn(l,wg),o.slice(0,n)}const e9=(t,e,r,n,s)=>QL(t,XL(t,e,r),n,s),tp=Xf,I0=BigInt(0),by=BigInt(1);function Xd(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Qo(t,e,r=""){const n=Yf(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){const o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Th(t){const e=t.toString(16);return e.length&1?"0"+e:e}function cA(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?I0:BigInt("0x"+t)}function rp(t){return cA(pc(t))}function Qd(t){return fs(t),cA(pc(Uint8Array.from(t).reverse()))}function S0(t,e){return Zd(t.toString(16).padStart(e*2,"0"))}function C0(t,e){return S0(t,e).reverse()}function Ar(t,e,r){let n;if(typeof e=="string")try{n=Zd(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Yf(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const bg=t=>typeof t=="bigint"&&I0<=t;function t9(t,e,r){return bg(t)&&bg(e)&&bg(r)&&e<=t&&t<r}function vy(t,e,r,n){if(!t9(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function lA(t){let e;for(e=0;t>I0;t>>=by,e+=1);return e}const Qu=t=>(by<<BigInt(t))-by;function r9(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=d=>new Uint8Array(d),s=d=>Uint8Array.of(d);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...d)=>r(o,i,...d),u=(d=n(0))=>{o=l(s(0),d),i=l(),d.length!==0&&(o=l(s(1),d),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const p=[];for(;d<e;){i=l();const g=i.slice();p.push(g),d+=i.length}return so(...p)};return(d,p)=>{c(),u(d);let g;for(;!(g=p(h()));)u();return c(),g}}function np(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function W1(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const en=BigInt(0),kr=BigInt(1),ea=BigInt(2),uA=BigInt(3),hA=BigInt(4),dA=BigInt(5),n9=BigInt(7),fA=BigInt(8),s9=BigInt(9),pA=BigInt(16);function yn(t,e){const r=t%e;return r>=en?r:e+r}function ts(t,e,r){let n=t;for(;e-- >en;)n*=n,n%=r;return n}function K1(t,e){if(t===en)throw new Error("invert: expected non-zero number");if(e<=en)throw new Error("invert: expected positive modulus, got "+e);let r=yn(t,e),n=e,s=en,i=kr;for(;r!==en;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==kr)throw new Error("invert: does not exist");return yn(s,e)}function x0(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function gA(t,e){const r=(t.ORDER+kr)/hA,n=t.pow(e,r);return x0(t,n,e),n}function i9(t,e){const r=(t.ORDER-dA)/fA,n=t.mul(e,ea),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,ea),s),a=t.mul(i,t.sub(o,t.ONE));return x0(t,a,e),a}function o9(t){const e=Co(t),r=mA(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+n9)/pA;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,n);const h=a.mul(l,s),d=a.mul(l,i),p=a.eql(a.sqr(u),c),g=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(d,h,g);const m=a.eql(a.sqr(u),c),w=a.cmov(l,u,m);return x0(a,w,c),w}}function mA(t){if(t<uA)throw new Error("sqrt is not defined for small field");let e=t-kr,r=0;for(;e%ea===en;)e/=ea,r++;let n=ea;const s=Co(t);for(;G1(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return gA;let i=s.pow(n,e);const o=(e+kr)/ea;return function(a,c){if(a.is0(c))return c;if(G1(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,i),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(p++,g=a.sqr(g),p===l)throw new Error("Cannot find square root");const m=kr<<BigInt(l-p-1),w=a.pow(u,m);l=p,u=a.sqr(w),h=a.mul(h,u),d=a.mul(d,w)}return d}}function a9(t){return t%hA===uA?gA:t%fA===dA?i9:t%pA===s9?o9(t):mA(t)}const c9=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function l9(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=c9.reduce((n,s)=>(n[s]="function",n),e);return np(t,r),t}function u9(t,e,r){if(r<en)throw new Error("invalid exponent, negatives unsupported");if(r===en)return t.ONE;if(r===kr)return e;let n=t.ONE,s=e;for(;r>en;)r&kr&&(n=t.mul(n,s)),s=t.sqr(s),r>>=kr;return n}function yA(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function G1(t,e){const r=(t.ORDER-kr)/ea,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function wA(t,e){e!==void 0&&Ci(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Co(t,e,r=!1,n={}){if(t<=en)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(s=d.BITS),d.sqrt&&(i=d.sqrt),typeof d.isLE=="boolean"&&(r=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:l}=wA(t,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:Qu(c),ZERO:en,ONE:kr,allowedLengths:a,create:d=>yn(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return en<=d&&d<t},is0:d=>d===en,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&kr)===kr,neg:d=>yn(-d,t),eql:(d,p)=>d===p,sqr:d=>yn(d*d,t),add:(d,p)=>yn(d+p,t),sub:(d,p)=>yn(d-p,t),mul:(d,p)=>yn(d*p,t),pow:(d,p)=>u9(h,d,p),div:(d,p)=>yn(d*K1(p,t),t),sqrN:d=>d*d,addN:(d,p)=>d+p,subN:(d,p)=>d-p,mulN:(d,p)=>d*p,inv:d=>K1(d,t),sqrt:i||(d=>(u||(u=a9(t)),u(h,d))),toBytes:d=>r?C0(d,l):S0(d,l),fromBytes:(d,p=!0)=>{if(a){if(!a.includes(d.length)||d.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const m=new Uint8Array(l);m.set(d,r?0:m.length-d.length),d=m}if(d.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+d.length);let g=r?Qd(d):rp(d);if(o&&(g=yn(g,t)),!p&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:d=>yA(h,d),cmov:(d,p,g)=>g?p:d});return Object.freeze(h)}function bA(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function vA(t){const e=bA(t);return e+Math.ceil(e/2)}function h9(t,e,r=!1){const n=t.length,s=bA(e),i=vA(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?Qd(t):rp(t),a=yn(o,e-kr)+kr;return r?C0(a,s):S0(a,s)}const Nc=BigInt(0),ta=BigInt(1);function ef(t,e){const r=e.negate();return t?r:e}function vg(t,e){const r=yA(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function EA(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Eg(t,e){EA(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=Qu(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function Y1(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=ta);const l=e*n,u=l+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:l}}function d9(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function f9(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const _g=new WeakMap,_A=new WeakMap;function Ig(t){return _A.get(t)||1}function Z1(t){if(t!==Nc)throw new Error("invalid wNAF")}let p9=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>Nc;)r&ta&&(n=n.add(s)),s=s.double(),r>>=ta;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=Eg(r,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let l=1;l<s;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Eg(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:d,offsetF:p}=Y1(n,a,o);n=c,u?i=i.add(ef(d,r[p])):s=s.add(ef(h,r[l]))}return Z1(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){const i=Eg(e,this.bits);for(let o=0;o<i.windows&&n!==Nc;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Y1(n,o,i);if(n=a,!l){const h=r[c];s=s.add(u?h.negate():h)}}return Z1(n),s}getPrecomputes(e,r,n){let s=_g.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),_g.set(r,s))),s}cached(e,r,n){const s=Ig(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const i=Ig(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){EA(r,this.bits),_A.set(e,r),_g.delete(e)}hasCache(e){return Ig(e)!==1}};function g9(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>Nc||n>Nc;)r&ta&&(i=i.add(s)),n&ta&&(o=o.add(s)),s=s.double(),r>>=ta,n>>=ta;return{p1:i,p2:o}}function m9(t,e,r,n){d9(r,t),f9(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=lA(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Qu(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let m=0;m<i;m++){const w=n[m],I=Number(w>>BigInt(p)&l);u[I]=u[I].add(r[m])}let g=o;for(let m=u.length-1,w=o;m>0;m--)w=w.add(u[m]),g=g.add(w);if(d=d.add(g),p!==0)for(let m=0;m<c;m++)d=d.double()}return d}function J1(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return l9(e),e}else return Co(t,{isLE:r})}function y9(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Nc))throw new Error(`CURVE.${a} must be positive bigint`)}const s=J1(e.p,r.Fp,n),i=J1(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Vx("HashToScalar-");const ol=BigInt(0),za=BigInt(1),kh=BigInt(2);function w9(t){return np(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function b9(t){const e=w9(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||Na,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),p=a?kh**BigInt(254):kh**BigInt(447),g=a?BigInt(8)*kh**BigInt(251)-za:BigInt(4)*kh**BigInt(445)-za,m=p+g+za,w=k=>yn(k,r),I=S(h);function S(k){return C0(w(k),u)}function v(k){const $=Ar("u coordinate",k,u);return a&&($[31]&=127),w(Qd($))}function b(k){return Qd(s(Ar("scalar",k,u)))}function C(k,$){const T=R(v($),b(k));if(T===ol)throw new Error("invalid private or public key received");return S(T)}function N(k){return C(k,I)}function P(k,$,T){const f=w(k*($-T));return $=w($-f),T=w(T+f),{x_2:$,x_3:T}}function R(k,$){vy("u",k,ol,r),vy("scalar",$,p,m);const T=$,f=k;let y=za,E=ol,x=k,_=za,A=ol;for(let B=BigInt(l-1);B>=ol;B--){const q=T>>B&za;A^=q,{x_2:y,x_3:x}=P(A,y,x),{x_2:E,x_3:_}=P(A,E,_),A=q;const D=y+E,F=w(D*D),H=y-E,W=w(H*H),ee=F-W,K=x+_,G=x-_,le=w(G*D),ye=w(K*H),ve=le+ye,Ee=le-ye;x=w(ve*ve),_=w(f*w(Ee*Ee)),y=w(F*W),E=w(ee*(F+w(d*ee)))}({x_2:y,x_3:x}=P(A,y,x)),{x_2:E,x_3:_}=P(A,E,_);const L=i(E);return w(y*L)}const O={secretKey:u,publicKey:u,seed:u},M=(k=c(u))=>(fs(k,O.seed),k);function j(k){const $=M(k);return{secretKey:$,publicKey:N($)}}return{keygen:j,getSharedSecret:(k,$)=>C(k,$),getPublicKey:k=>N(k),scalarMult:C,scalarMultBase:N,utils:{randomSecretKey:M,randomPrivateKey:M},GuBytes:I.slice(),lengths:O}}const v9=BigInt(1),X1=BigInt(2),E9=BigInt(3),_9=BigInt(5);BigInt(8);const IA=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),I9={p:IA,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function S9(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=IA,o=t*t%i*t%i,a=ts(o,X1,i)*o%i,c=ts(a,v9,i)*t%i,l=ts(c,_9,i)*c%i,u=ts(l,e,i)*l%i,h=ts(u,r,i)*u%i,d=ts(h,n,i)*h%i,p=ts(d,s,i)*d%i,g=ts(p,s,i)*d%i,m=ts(g,e,i)*l%i;return{pow_p_5_8:ts(m,X1,i)*t%i,b2:o}}function C9(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const x9=Co(I9.p,{isLE:!0}),Ey=(()=>{const t=x9.ORDER;return b9({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=S9(e);return yn(ts(r,E9,t)*n,t)},adjustScalarBytes:C9})})(),Q1=(t,e)=>(t+(t>=0?e:-e)/SA)/e;function A9(t,e,r){const[[n,s],[i,o]]=e,a=Q1(o*t,r),c=Q1(-s*t,r);let l=t-a*n-c*i,u=-a*s-c*o;const h=l<wi,d=u<wi;h&&(l=-l),d&&(u=-u);const p=Qu(Math.ceil(lA(r)/2))+gc;if(l<wi||l>=p||u<wi||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}function _y(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Sg(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return Xd(r.lowS,"lowS"),Xd(r.prehash,"prehash"),r.format!==void 0&&_y(r.format),r}let $9=class extends Error{constructor(e=""){super(e)}};const li={Err:$9,_tlv:{encode:(t,e)=>{const{Err:r}=li;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=Th(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?Th(s.length/2|128):"";return Th(t)+i+s+e},decode(t,e){const{Err:r}=li;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=li;if(t<wi)throw new e("integer: negative integers are not allowed");let r=Th(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=li;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return rp(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=li,s=Ar("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=li,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},wi=BigInt(0),gc=BigInt(1),SA=BigInt(2),Ph=BigInt(3),N9=BigInt(4);function oc(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=Ar("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function O9(t,e={}){const r=y9("weierstrass",t,e),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;np(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=xA(n,s);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(k,$,T){const{x:f,y}=$.toAffine(),E=n.toBytes(f);if(Xd(T,"isCompressed"),T){u();const x=!n.isOdd(y);return so(CA(x),E)}else return so(Uint8Array.of(4),E,n.toBytes(y))}function d(k){Qo(k,void 0,"Point");const{publicKey:$,publicKeyUncompressed:T}=l,f=k.length,y=k[0],E=k.subarray(1);if(f===$&&(y===2||y===3)){const x=n.fromBytes(E);if(!n.isValid(x))throw new Error("bad point: is not on curve, wrong x");const _=m(x);let A;try{A=n.sqrt(_)}catch(B){const q=B instanceof Error?": "+B.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const L=n.isOdd(A);return(y&1)===1!==L&&(A=n.neg(A)),{x,y:A}}else if(f===T&&y===4){const x=n.BYTES,_=n.fromBytes(E.subarray(0,x)),A=n.fromBytes(E.subarray(x,x*2));if(!w(_,A))throw new Error("bad point: is not on curve");return{x:_,y:A}}else throw new Error(`bad point: got length ${f}, expected compressed=${$} or uncompressed=${T}`)}const p=e.toBytes||h,g=e.fromBytes||d;function m(k){const $=n.sqr(k),T=n.mul($,k);return n.add(n.add(T,n.mul(k,i.a)),i.b)}function w(k,$){const T=n.sqr($),f=m(k);return n.eql(T,f)}if(!w(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const I=n.mul(n.pow(i.a,Ph),N9),S=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(I,S)))throw new Error("bad curve params: a or b");function v(k,$,T=!1){if(!n.isValid($)||T&&n.is0($))throw new Error(`bad point coordinate ${k}`);return $}function b(k){if(!(k instanceof O))throw new Error("ProjectivePoint expected")}function C(k){if(!c||!c.basises)throw new Error("no endo");return A9(k,c.basises,s.ORDER)}const N=W1((k,$)=>{const{X:T,Y:f,Z:y}=k;if(n.eql(y,n.ONE))return{x:T,y:f};const E=k.is0();$==null&&($=E?n.ONE:n.inv(y));const x=n.mul(T,$),_=n.mul(f,$),A=n.mul(y,$);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x,y:_}}),P=W1(k=>{if(k.is0()){if(e.allowInfinityPoint&&!n.is0(k.Y))return;throw new Error("bad point: ZERO")}const{x:$,y:T}=k.toAffine();if(!n.isValid($)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!w($,T))throw new Error("bad point: equation left != right");if(!k.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(k,$,T,f,y){return T=new O(n.mul(T.X,k),T.Y,T.Z),$=ef(f,$),T=ef(y,T),$.add(T)}class O{constructor($,T,f){this.X=v("x",$),this.Y=v("y",T,!0),this.Z=v("z",f),Object.freeze(this)}static CURVE(){return i}static fromAffine($){const{x:T,y:f}=$||{};if(!$||!n.isValid(T)||!n.isValid(f))throw new Error("invalid affine point");if($ instanceof O)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(f)?O.ZERO:new O(T,f,n.ONE)}static fromBytes($){const T=O.fromAffine(g(Qo($,void 0,"point")));return T.assertValidity(),T}static fromHex($){return O.fromBytes(Ar("pointHex",$))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute($=8,T=!0){return j.createCache(this,$),T||this.multiply(Ph),this}assertValidity(){P(this)}hasEvenY(){const{y:$}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd($)}equals($){b($);const{X:T,Y:f,Z:y}=this,{X:E,Y:x,Z:_}=$,A=n.eql(n.mul(T,_),n.mul(E,y)),L=n.eql(n.mul(f,_),n.mul(x,y));return A&&L}negate(){return new O(this.X,n.neg(this.Y),this.Z)}double(){const{a:$,b:T}=i,f=n.mul(T,Ph),{X:y,Y:E,Z:x}=this;let _=n.ZERO,A=n.ZERO,L=n.ZERO,B=n.mul(y,y),q=n.mul(E,E),D=n.mul(x,x),F=n.mul(y,E);return F=n.add(F,F),L=n.mul(y,x),L=n.add(L,L),_=n.mul($,L),A=n.mul(f,D),A=n.add(_,A),_=n.sub(q,A),A=n.add(q,A),A=n.mul(_,A),_=n.mul(F,_),L=n.mul(f,L),D=n.mul($,D),F=n.sub(B,D),F=n.mul($,F),F=n.add(F,L),L=n.add(B,B),B=n.add(L,B),B=n.add(B,D),B=n.mul(B,F),A=n.add(A,B),D=n.mul(E,x),D=n.add(D,D),B=n.mul(D,F),_=n.sub(_,B),L=n.mul(D,q),L=n.add(L,L),L=n.add(L,L),new O(_,A,L)}add($){b($);const{X:T,Y:f,Z:y}=this,{X:E,Y:x,Z:_}=$;let A=n.ZERO,L=n.ZERO,B=n.ZERO;const q=i.a,D=n.mul(i.b,Ph);let F=n.mul(T,E),H=n.mul(f,x),W=n.mul(y,_),ee=n.add(T,f),K=n.add(E,x);ee=n.mul(ee,K),K=n.add(F,H),ee=n.sub(ee,K),K=n.add(T,y);let G=n.add(E,_);return K=n.mul(K,G),G=n.add(F,W),K=n.sub(K,G),G=n.add(f,y),A=n.add(x,_),G=n.mul(G,A),A=n.add(H,W),G=n.sub(G,A),B=n.mul(q,K),A=n.mul(D,W),B=n.add(A,B),A=n.sub(H,B),B=n.add(H,B),L=n.mul(A,B),H=n.add(F,F),H=n.add(H,F),W=n.mul(q,W),K=n.mul(D,K),H=n.add(H,W),W=n.sub(F,W),W=n.mul(q,W),K=n.add(K,W),F=n.mul(H,K),L=n.add(L,F),F=n.mul(G,K),A=n.mul(ee,A),A=n.sub(A,F),F=n.mul(ee,H),B=n.mul(G,B),B=n.add(B,F),new O(A,L,B)}subtract($){return this.add($.negate())}is0(){return this.equals(O.ZERO)}multiply($){const{endo:T}=e;if(!s.isValidNot0($))throw new Error("invalid scalar: out of range");let f,y;const E=x=>j.cached(this,x,_=>vg(O,_));if(T){const{k1neg:x,k1:_,k2neg:A,k2:L}=C($),{p:B,f:q}=E(_),{p:D,f:F}=E(L);y=q.add(F),f=R(T.beta,B,D,x,A)}else{const{p:x,f:_}=E($);f=x,y=_}return vg(O,[f,y])[0]}multiplyUnsafe($){const{endo:T}=e,f=this;if(!s.isValid($))throw new Error("invalid scalar: out of range");if($===wi||f.is0())return O.ZERO;if($===gc)return f;if(j.hasCache(this))return this.multiply($);if(T){const{k1neg:y,k1:E,k2neg:x,k2:_}=C($),{p1:A,p2:L}=g9(O,f,E,_);return R(T.beta,A,L,y,x)}else return j.unsafe(f,$)}multiplyAndAddUnsafe($,T,f){const y=this.multiplyUnsafe(T).add($.multiplyUnsafe(f));return y.is0()?void 0:y}toAffine($){return N(this,$)}isTorsionFree(){const{isTorsionFree:$}=e;return o===gc?!0:$?$(O,this):j.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:$}=e;return o===gc?this:$?$(O,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes($=!0){return Xd($,"isCompressed"),this.assertValidity(),p(O,this,$)}toHex($=!0){return pc(this.toBytes($))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes($=!0){return this.toBytes($)}_setWindowSize($){this.precompute($)}static normalizeZ($){return vg(O,$)}static msm($,T){return m9(O,s,$,T)}static fromPrivateKey($){return O.BASE.multiply(oc(s,$))}}O.BASE=new O(i.Gx,i.Gy,n.ONE),O.ZERO=new O(n.ZERO,n.ONE,n.ZERO),O.Fp=n,O.Fn=s;const M=s.BITS,j=new p9(O,e.endo?Math.ceil(M/2):M);return O.BASE.precompute(8),O}function CA(t){return Uint8Array.of(t?2:3)}function xA(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function T9(t,e={}){const{Fn:r}=t,n=e.randomBytes||Na,s=Object.assign(xA(t.Fp,r),{seed:vA(r.ORDER)});function i(d){try{return!!oc(r,d)}catch{return!1}}function o(d,p){const{publicKey:g,publicKeyUncompressed:m}=s;try{const w=d.length;return p===!0&&w!==g||p===!1&&w!==m?!1:!!t.fromBytes(d)}catch{return!1}}function a(d=n(s.seed)){return h9(Qo(d,s.seed,"seed"),r.ORDER)}function c(d,p=!0){return t.BASE.multiply(oc(r,d)).toBytes(p)}function l(d){const p=a(d);return{secretKey:p,publicKey:c(p)}}function u(d){if(typeof d=="bigint")return!1;if(d instanceof t)return!0;const{secretKey:p,publicKey:g,publicKeyUncompressed:m}=s;if(r.allowedLengths||p===g)return;const w=Ar("key",d).length;return w===g||w===m}function h(d,p,g=!0){if(u(d)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const m=oc(r,d);return t.fromHex(p).multiply(m).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:d=>oc(r,d),precompute(d=8,p=t.BASE){return p.precompute(d,!1)}},lengths:s})}function k9(t,e,r={}){Zf(e),np(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||Na,s=r.hmac||((T,...f)=>ep(e,T,so(...f))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:p}=T9(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},m="compact";function w(T){const f=a>>gc;return T>f}function I(T,f){if(!o.isValidNot0(f))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return f}function S(T,f){_y(f);const y=p.signature,E=f==="compact"?y:f==="recovered"?y+1:void 0;return Qo(T,E,`${f} signature`)}class v{constructor(f,y,E){this.r=I("r",f),this.s=I("s",y),E!=null&&(this.recovery=E),Object.freeze(this)}static fromBytes(f,y=m){S(f,y);let E;if(y==="der"){const{r:L,s:B}=li.toSig(Qo(f));return new v(L,B)}y==="recovered"&&(E=f[0],y="compact",f=f.subarray(1));const x=o.BYTES,_=f.subarray(0,x),A=f.subarray(x,x*2);return new v(o.fromBytes(_),o.fromBytes(A),E)}static fromHex(f,y){return this.fromBytes(Zd(f),y)}addRecoveryBit(f){return new v(this.r,this.s,f)}recoverPublicKey(f){const y=i.ORDER,{r:E,s:x,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*SA<y&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=_===2||_===3?E+a:E;if(!i.isValid(A))throw new Error("recovery id 2 or 3 invalid");const L=i.toBytes(A),B=t.fromBytes(so(CA((_&1)===0),L)),q=o.inv(A),D=C(Ar("msgHash",f)),F=o.create(-D*q),H=o.create(x*q),W=t.BASE.multiplyUnsafe(F).add(B.multiplyUnsafe(H));if(W.is0())throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return w(this.s)}toBytes(f=m){if(_y(f),f==="der")return Zd(li.hexFromSig(this));const y=o.toBytes(this.r),E=o.toBytes(this.s);if(f==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return so(Uint8Array.of(this.recovery),y,E)}return so(y,E)}toHex(f){return pc(this.toBytes(f))}assertValidity(){}static fromCompact(f){return v.fromBytes(Ar("sig",f),"compact")}static fromDER(f){return v.fromBytes(Ar("sig",f),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return pc(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return pc(this.toBytes("compact"))}}const b=r.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const f=rp(T),y=T.length*8-c;return y>0?f>>BigInt(y):f},C=r.bits2int_modN||function(T){return o.create(b(T))},N=Qu(c);function P(T){return vy("num < 2^"+c,T,wi,N),o.toBytes(T)}function R(T,f){return Qo(T,void 0,"message"),f?Qo(e(T),void 0,"prehashed message"):T}function O(T,f,y){if(["recovered","canonical"].some(H=>H in y))throw new Error("sign() legacy options not supported");const{lowS:E,prehash:x,extraEntropy:_}=Sg(y,g);T=R(T,x);const A=C(T),L=oc(o,f),B=[P(L),P(A)];if(_!=null&&_!==!1){const H=_===!0?n(p.secretKey):_;B.push(Ar("extraEntropy",H))}const q=so(...B),D=A;function F(H){const W=b(H);if(!o.isValidNot0(W))return;const ee=o.inv(W),K=t.BASE.multiply(W).toAffine(),G=o.create(K.x);if(G===wi)return;const le=o.create(ee*o.create(D+G*L));if(le===wi)return;let ye=(K.x===G?0:2)|Number(K.y&gc),ve=le;return E&&w(le)&&(ve=o.neg(le),ye^=1),new v(G,ve,ye)}return{seed:q,k2sig:F}}function M(T,f,y={}){T=Ar("message",T);const{seed:E,k2sig:x}=O(T,f,y);return r9(e.outputLen,o.BYTES,s)(E,x)}function j(T){let f;const y=typeof T=="string"||Yf(T),E=!y&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!y&&!E)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(E)f=new v(T.r,T.s);else if(y){try{f=v.fromBytes(Ar("sig",T),"der")}catch(x){if(!(x instanceof li.Err))throw x}if(!f)try{f=v.fromBytes(Ar("sig",T),"compact")}catch{return!1}}return f||!1}function k(T,f,y,E={}){const{lowS:x,prehash:_,format:A}=Sg(E,g);if(y=Ar("publicKey",y),f=R(Ar("message",f),_),"strict"in E)throw new Error("options.strict was renamed to lowS");const L=A===void 0?j(T):v.fromBytes(Ar("sig",T),A);if(L===!1)return!1;try{const B=t.fromBytes(y);if(x&&L.hasHighS())return!1;const{r:q,s:D}=L,F=C(f),H=o.inv(D),W=o.create(F*H),ee=o.create(q*H),K=t.BASE.multiplyUnsafe(W).add(B.multiplyUnsafe(ee));return K.is0()?!1:o.create(K.x)===q}catch{return!1}}function $(T,f,y={}){const{prehash:E}=Sg(y,g);return f=R(f,E),v.fromBytes(T,"recovered").recoverPublicKey(f).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:p,Point:t,sign:M,verify:k,recoverPublicKey:$,Signature:v,hash:e})}function P9(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=Co(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function R9(t){const{CURVE:e,curveOpts:r}=P9(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function D9(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,wA(r.Fn.ORDER,r.Fn.BITS))})}function U9(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=R9(t),i=O9(e,r),o=k9(i,n,s);return D9(t,o)}function Iy(t,e){const r=n=>U9({...t,hash:n});return{...r(e),create:r}}const AA={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},$A={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},NA={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},B9=Co(AA.p),L9=Co($A.p),M9=Co(NA.p),j9=Iy({...AA,Fp:B9,lowS:!1},Xf);Iy({...$A,Fp:L9,lowS:!1},VB),Iy({...NA,Fp:M9,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},HB);const F9=j9,OA="base10",Pr="base16",Yr="base64pad",io="base64url",eh="utf8",TA=0,Ei=1,th=2,q9=0,eE=1,Bl=12,A0=32;function z9(){const t=Ey.utils.randomPrivateKey(),e=Ey.getPublicKey(t);return{privateKey:Ye(t,Pr),publicKey:Ye(e,Pr)}}function Sy(){const t=Na(A0);return Ye(t,Pr)}function H9(t,e){const r=Ey.getSharedSecret(ut(t,Pr),ut(e,Pr)),n=e9(tp,r,void 0,void 0,A0);return Ye(n,Pr)}function yd(t){const e=tp(ut(t,Pr));return Ye(e,Pr)}function Fn(t){const e=tp(ut(t,eh));return Ye(e,Pr)}function kA(t){return ut(`${t}`,OA)}function ba(t){return Number(Ye(t,OA))}function PA(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function RA(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function V9(t){const e=kA(typeof t.type<"u"?t.type:TA);if(ba(e)===Ei&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ut(t.senderPublicKey,Pr):void 0,n=typeof t.iv<"u"?ut(t.iv,Pr):Na(Bl),s=ut(t.symKey,Pr),i=oA(s,n).encrypt(ut(t.message,eh)),o=DA({type:e,sealed:i,iv:n,senderPublicKey:r});return t.encoding===io?PA(o):o}function W9(t){const e=ut(t.symKey,Pr),{sealed:r,iv:n}=ou({encoded:t.encoded,encoding:t.encoding}),s=oA(e,n).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Ye(s,eh)}function K9(t,e){const r=kA(th),n=Na(Bl),s=ut(t,eh),i=DA({type:r,sealed:s,iv:n});return e===io?PA(i):i}function G9(t,e){const{sealed:r}=ou({encoded:t,encoding:e});return Ye(r,eh)}function DA(t){if(ba(t.type)===th)return Ye(Rs([t.type,t.sealed]),Yr);if(ba(t.type)===Ei){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ye(Rs([t.type,t.senderPublicKey,t.iv,t.sealed]),Yr)}return Ye(Rs([t.type,t.iv,t.sealed]),Yr)}function ou(t){const e=(t.encoding||Yr)===io?RA(t.encoded):t.encoded,r=ut(e,Yr),n=r.slice(q9,eE),s=eE;if(ba(n)===Ei){const c=s+A0,l=c+Bl,u=r.slice(s,c),h=r.slice(c,l),d=r.slice(l);return{type:n,sealed:d,iv:h,senderPublicKey:u}}if(ba(n)===th){const c=r.slice(s),l=Na(Bl);return{type:n,sealed:c,iv:l}}const i=s+Bl,o=r.slice(s,i),a=r.slice(i);return{type:n,sealed:a,iv:o}}function Y9(t,e){const r=ou({encoded:t,encoding:e?.encoding});return UA({type:ba(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Ye(r.senderPublicKey,Pr):void 0,receiverPublicKey:e?.receiverPublicKey})}function UA(t){const e=t?.type||TA;if(e===Ei){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function tE(t){return t.type===Ei&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function rE(t){return t.type===th}function Z9(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Rs([new Uint8Array([4]),e,r])}function J9(t,e){const[r,n,s]=t.split("."),i=Buffer.from(RA(s),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${r}.${n}`,l=tp(c),u=Z9(e);if(!F9.verify(Rs([o,a]),l,u))throw new Error("Invalid signature");return Cc(t).payload}const X9="irn";function tf(t){return t?.relay||{protocol:X9}}function ac(t){const e=Tx[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Q9=Object.defineProperty,eM=Object.defineProperties,tM=Object.getOwnPropertyDescriptors,nE=Object.getOwnPropertySymbols,rM=Object.prototype.hasOwnProperty,nM=Object.prototype.propertyIsEnumerable,sE=(t,e,r)=>e in t?Q9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cg=(t,e)=>{for(var r in e||(e={}))rM.call(e,r)&&sE(t,r,e[r]);if(nE)for(var r of nE(e))nM.call(e,r)&&sE(t,r,e[r]);return t},sM=(t,e)=>eM(t,tM(e));function iM(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(n)){const i=s.replace(n,""),o=t[s];r[i]=o}}),r}function iE(t){if(!t.includes("wc:")){const l=Mx(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),s=t.substring(e+1,r).split("@"),i=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:oM(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:iM(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function oM(t){return t.startsWith("//")?t.substring(2):t}function aM(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(s=>{const i=s,o=r+e+i;t[i]&&(n[o]=t[i])}),n}function oE(t){const e=new URLSearchParams,r=Cg(Cg(sM(Cg({},aM(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!==void 0&&e.append(n,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Rh(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var cM=Object.defineProperty,lM=Object.defineProperties,uM=Object.getOwnPropertyDescriptors,aE=Object.getOwnPropertySymbols,hM=Object.prototype.hasOwnProperty,dM=Object.prototype.propertyIsEnumerable,cE=(t,e,r)=>e in t?cM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fM=(t,e)=>{for(var r in e||(e={}))hM.call(e,r)&&cE(t,r,e[r]);if(aE)for(var r of aE(e))dM.call(e,r)&&cE(t,r,e[r]);return t},pM=(t,e)=>lM(t,uM(e));function Hc(t){const e=[];return t.forEach(r=>{const[n,s]=r.split(":");e.push(`${n}:${s}`)}),e}function BA(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Hc(r.accounts))}),[...new Set(e)]}function gM(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function mM(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function yM(t,e){const r=[];return Object.values(t).forEach(n=>{Hc(n.accounts).includes(e)&&r.push(...n.methods)}),r}function wM(t,e){const r=[];return Object.values(t).forEach(n=>{Hc(n.accounts).includes(e)&&r.push(...n.events)}),r}function LA(t){return t.includes(":")}function bM(t){return LA(t)?t.split(":")[0]:t}function lE(t){var e,r,n;const s={};if(!au(t))return s;for(const[i,o]of Object.entries(t)){const a=LA(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],u=bM(i);s[u]=pM(fM({},s[u]),{chains:ha(a,(e=s[u])==null?void 0:e.chains),methods:ha(c,(r=s[u])==null?void 0:r.methods),events:ha(l,(n=s[u])==null?void 0:n.events)})}return s}function vM(t){const e={};return t?.forEach(r=>{var n;const[s,i]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(n=e[s].chains)==null||n.push(`${s}:${i}`)}),e}function uE(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=vM(e);for(const[n,s]of Object.entries(r))s.methods?s.methods=ha(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function EM(t,e){var r,n,s,i,o,a;const c=lE(t),l=lE(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:ha((r=c[d])==null?void 0:r.chains,(n=l[d])==null?void 0:n.chains),methods:ha((s=c[d])==null?void 0:s.methods,(i=l[d])==null?void 0:i.methods),events:ha((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const _M={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},IM={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function re(t,e){const{message:r,code:n}=IM[t];return{message:e?`${r} ${e}`:r,code:n}}function pt(t,e){const{message:r,code:n}=_M[t];return{message:e?`${r} ${e}`:r,code:n}}function Oc(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function au(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Gt(t){return typeof t>"u"}function At(t,e){return e&&Gt(t)?!0:typeof t=="string"&&!!t.trim().length}function $0(t,e){return typeof t=="number"&&!isNaN(t)}function SM(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),s=Object.keys(r);let i=!0;return Xo(s,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Hc(a),h=r[o];(!Xo(Rx(o,h),u)||!Xo(h.methods,c)||!Xo(h.events,l))&&(i=!1)}),i):!1}function rf(t){return At(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function CM(t){if(At(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&rf(r)}}return!1}function xM(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(At(t,!1)){if(e(t))return!0;const r=Mx(t);return e(r)}}catch{}return!1}function AM(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function $M(t){return t?.topic}function NM(t,e){let r=null;return At(t?.publicKey,!1)||(r=re("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function hE(t){let e=!0;return Oc(t)?t.length&&(e=t.every(r=>At(r,!1))):e=!1,e}function OM(t,e,r){let n=null;return Oc(e)&&e.length?e.forEach(s=>{n||rf(s)||(n=pt("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):rf(t)||(n=pt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function TM(t,e,r){let n=null;return Object.entries(t).forEach(([s,i])=>{if(n)return;const o=OM(s,Rx(s,i),`${e} ${r}`);o&&(n=o)}),n}function kM(t,e){let r=null;return Oc(t)?t.forEach(n=>{r||CM(n)||(r=pt("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=pt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function PM(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const s=kM(n?.accounts,`${e} namespace`);s&&(r=s)}),r}function RM(t,e){let r=null;return hE(t?.methods)?hE(t?.events)||(r=pt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=pt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function MA(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const s=RM(n,`${e}, namespace`);s&&(r=s)}),r}function DM(t,e,r){let n=null;if(t&&au(t)){const s=MA(t,e);s&&(n=s);const i=TM(t,e,r);i&&(n=i)}else n=re("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function xg(t,e){let r=null;if(t&&au(t)){const n=MA(t,e);n&&(r=n);const s=PM(t,e);s&&(r=s)}else r=re("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function jA(t){return At(t.protocol,!0)}function UM(t,e){let r=!1;return t?t&&Oc(t)&&t.length&&t.forEach(n=>{r=jA(n)}):r=!0,r}function BM(t){return typeof t=="number"}function Vr(t){return typeof t<"u"&&typeof t!==null}function LM(t){return!(!t||typeof t!="object"||!t.code||!$0(t.code)||!t.message||!At(t.message,!1))}function MM(t){return!(Gt(t)||!At(t.method,!1))}function jM(t){return!(Gt(t)||Gt(t.result)&&Gt(t.error)||!$0(t.id)||!At(t.jsonrpc,!1))}function FM(t){return!(Gt(t)||!At(t.name,!1))}function dE(t,e){return!(!rf(e)||!BA(t).includes(e))}function qM(t,e,r){return At(r,!1)?yM(t,e).includes(r):!1}function zM(t,e,r){return At(r,!1)?wM(t,e).includes(r):!1}function fE(t,e,r){let n=null;const s=HM(t),i=VM(e),o=Object.keys(s),a=Object.keys(i),c=pE(Object.keys(t)),l=pE(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(n=re("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Xo(o,a)||(n=re("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const d=Hc(e[h].accounts);d.includes(h)||(n=re("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{n||(Xo(s[h].methods,i[h].methods)?Xo(s[h].events,i[h].events)||(n=re("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=re("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function HM(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function pE(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function VM(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:Hc(t[r].accounts)?.forEach(s=>{e[s]={accounts:t[r].accounts.filter(i=>i.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}),e}function WM(t,e){return $0(t)&&t<=e.max&&t>=e.min}function gE(){const t=Ju();return new Promise(e=>{switch(t){case En.browser:e(KM());break;case En.reactNative:e(GM());break;case En.node:e(YM());break;default:e(!0)}})}function KM(){return zc()&&navigator?.onLine}async function GM(){return So()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function YM(){return!0}function ZM(t){switch(Ju()){case En.browser:JM(t);break;case En.reactNative:XM(t);break}}function JM(t){!So()&&zc()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function XM(t){So()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function QM(){var t;return zc()&&Jt.getDocument()?((t=Jt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const Ag={};let al=class{static get(e){return Ag[e]}static set(e,r){Ag[e]=r}static delete(e){delete Ag[e]}};function e7(t){const e=Yu.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function t7({publicKey:t,signature:e,payload:r}){var n;const s=Cy(r.method),i=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=s7(r.address),a=r.era==="00"?new Uint8Array([0]):Cy(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${n7(r.tip)}`),h=o7(u),d=new Uint8Array([0,...t,o,...e,...a,...l,...h,...s]),p=i7(d.length+1);return new Uint8Array([...p,i,...d])}function r7(t){const e=Cy(t),r=Px.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function Cy(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function n7(t){return t.startsWith("0x")?t.slice(2):t}function s7(t){const e=Yu.decode(t)[0];return e===42?0:e===60?2:1}function i7(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function o7(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function a7(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=e7(t.transaction.address),n=t7({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(n).toString("hex");return r7(s)}function FA({logger:t,name:e}){const r=typeof t=="string"?eC({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}const c7="PARSE_ERROR",l7="INVALID_REQUEST",u7="METHOD_NOT_FOUND",h7="INVALID_PARAMS",qA="INTERNAL_ERROR",N0="SERVER_ERROR",d7=[-32700,-32600,-32601,-32602,-32603],Ll={[c7]:{code:-32700,message:"Parse error"},[l7]:{code:-32600,message:"Invalid Request"},[u7]:{code:-32601,message:"Method not found"},[h7]:{code:-32602,message:"Invalid params"},[qA]:{code:-32603,message:"Internal error"},[N0]:{code:-32e3,message:"Server error"}},zA=N0;function f7(t){return d7.includes(t)}function mE(t){return Object.keys(Ll).includes(t)?Ll[t]:Ll[zA]}function p7(t){const e=Object.values(Ll).find(r=>r.code===t);return e||Ll[zA]}function O0(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var $g={};var xy=function(t,e){return xy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},xy(t,e)};function g7(t,e){xy(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ay=function(){return Ay=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ay.apply(this,arguments)};function m7(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function y7(t,e,r,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(s<3?o(i):s>3?o(e,r,i):o(e,r))||i);return s>3&&i&&Object.defineProperty(e,r,i),i}function w7(t,e){return function(r,n){e(r,n,t)}}function b7(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function v7(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})}function E7(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _7(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function I7(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function $y(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function HA(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function S7(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(HA(arguments[e]));return t}function C7(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),s=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function cu(t){return this instanceof cu?(this.v=t,this):new cu(t)}function x7(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){n[d]&&(s[d]=function(p){return new Promise(function(g,m){i.push([d,p,g,m])>1||a(d,p)})})}function a(d,p){try{c(n[d](p))}catch(g){h(i[0][3],g)}}function c(d){d.value instanceof cu?Promise.resolve(d.value.v).then(l,u):h(i[0][2],d)}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,p){d(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}function A7(t){var e,r;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=t[s]?function(o){return(r=!r)?{value:cu(t[s](o)),done:s==="return"}:i?i(o):o}:i}}function $7(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof $y=="function"?$y(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}}function N7(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function O7(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function T7(t){return t&&t.__esModule?t:{default:t}}function k7(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function P7(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const R7=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ay},__asyncDelegator:A7,__asyncGenerator:x7,__asyncValues:$7,__await:cu,__awaiter:v7,__classPrivateFieldGet:k7,__classPrivateFieldSet:P7,__createBinding:_7,__decorate:y7,__exportStar:I7,__extends:g7,__generator:E7,__importDefault:T7,__importStar:O7,__makeTemplateObject:N7,__metadata:b7,__param:w7,__read:HA,__rest:m7,__spread:S7,__spreadArrays:C7,__values:$y},Symbol.toStringTag,{value:"Module"})),D7=WS(R7);var Ws={},yE;function U7(){if(yE)return Ws;yE=1,Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.isBrowserCryptoAvailable=Ws.getSubtleCrypto=Ws.getBrowerCrypto=void 0;function t(){return $s?.crypto||$s?.msCrypto||{}}Ws.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}Ws.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Ws.isBrowserCryptoAvailable=r,Ws}var Ks={},wE;function B7(){if(wE)return Ks;wE=1,Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.isBrowser=Ks.isNode=Ks.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ks.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ks.isNode=e;function r(){return!t()&&!e()}return Ks.isBrowser=r,Ks}var bE;function L7(){return bE||(bE=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=D7;e.__exportStar(U7(),t),e.__exportStar(B7(),t)})($g)),$g}var VA=L7();function Kt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Nr(t=6){return BigInt(Kt(t))}function Nt(t,e,r){return{id:r||Kt(),jsonrpc:"2.0",method:t,params:e}}function xi(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Oa(t,e,r){return{id:t,jsonrpc:"2.0",error:M7(e)}}function M7(t,e){return typeof t>"u"?mE(qA):(typeof t=="string"&&(t=Object.assign(Object.assign({},mE(N0)),{message:t})),f7(t.code)&&(t=p7(t.code)),t)}class j7{}class F7 extends j7{constructor(){super()}}class WA extends F7{constructor(e){super()}}const q7="^https?:",z7="^wss?:";function H7(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function KA(t,e){const r=H7(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function vE(t){return KA(t,q7)}function nf(t){return KA(t,z7)}function GA(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function YA(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Vc(t){return YA(t)&&"method"in t}function xo(t){return YA(t)&&(Bt(t)||dt(t))}function Bt(t){return"result"in t}function dt(t){return"error"in t}let V7=class extends WA{constructor(e){super(e),this.events=new mt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Nt(e.method,e.params||[],e.id||Nr().toString()),r)}async requestStrict(e,r){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(i){s(i)}this.events.on(`${e.id}`,i=>{dt(i)?s(i.error):n(i.result)});try{await this.connection.send(e,r)}catch(i){s(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),xo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const W7=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),K7=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",EE=t=>t.split("?")[0],_E=10,G7=W7();let Y7=class{constructor(e){if(this.url=e,this.events=new mt.EventEmitter,this.registering=!1,!nf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Br(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!nf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const s=VA.isReactNative()?void 0:{rejectUnauthorized:!GA(e)},i=new G7(e,[],s);K7()?i.onerror=o=>{const a=o;n(this.emitError(a.error))}:i.on("error",o=>{n(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),r(i)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ls(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),s=n.message||n.toString(),i=Oa(e,s);this.events.emit("payload",i)}parseError(e,r=this.url){return O0(e,EE(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>_E&&this.events.setMaxListeners(_E)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${EE(this.url)}`));return this.events.emit("register_error",r),r}};var Z7={};const ZA="wc",JA=2,Ny="core",Ms=`${ZA}@2:${Ny}:`,J7={logger:"error"},X7={database:":memory:"},Q7="crypto",IE="client_ed25519_seed",ej=z.ONE_DAY,tj="keychain",rj="0.3",nj="messages",sj="0.3",ij=z.SIX_HOURS,oj="publisher",XA="irn",aj="error",QA="wss://relay.walletconnect.org",cj="relayer",xt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},lj="_subscription",$n={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},uj=.1,Oy="2.23.0",rt={link_mode:"link_mode",relay:"relay"},wd={inbound:"inbound",outbound:"outbound"},hj="0.3",dj="WALLETCONNECT_CLIENT_ID",SE="WALLETCONNECT_LINK_MODE_APPS",fn={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},fj="subscription",pj="0.3",gj="pairing",mj="0.3",cl={wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}},Wo={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Zn={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},yj="history",wj="0.3",bj="expirer",Un={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},vj="0.3",Ej="verify-api",_j="https://verify.walletconnect.com",e$="https://verify.walletconnect.org",Ml=e$,Ij=`${Ml}/v3`,Sj=[_j,e$],Cj="echo",xj="https://echo.walletconnect.com",Ss={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Qs={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Jn={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},To={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},ko={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},ll={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Aj=.1,$j="event-client",Nj=86400,Oj="https://pulse.walletconnect.org/batch";function Tj(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,w=0,I=0,S=g.length;I!==S&&g[I]===0;)I++,m++;for(var v=(S-I)*u+1>>>0,b=new Uint8Array(v);I!==S;){for(var C=g[I],N=0,P=v-1;(C!==0||N<w)&&P!==-1;P--,N++)C+=256*b[P]>>>0,b[P]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=N,I++}for(var R=v-w;R!==v&&b[R]===0;)R++;for(var O=c.repeat(m);R<v;++R)O+=t.charAt(b[R]);return O}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var w=0,I=0;g[m]===c;)w++,m++;for(var S=(g.length-m)*l+1>>>0,v=new Uint8Array(S);g[m];){var b=r[g.charCodeAt(m)];if(b===255)return;for(var C=0,N=S-1;(b!==0||C<I)&&N!==-1;N--,C++)b+=a*v[N]>>>0,v[N]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");I=C,m++}if(g[m]!==" "){for(var P=S-I;P!==S&&v[P]===0;)P++;for(var R=new Uint8Array(w+(S-P)),O=w;P!==S;)R[O++]=v[P++];return R}}}function p(g){var m=d(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var kj=Tj,Pj=kj;const t$=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Rj=t=>new TextEncoder().encode(t),Dj=t=>new TextDecoder().decode(t);let Uj=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Bj=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return r$(this,e)}},Lj=class{constructor(e){this.decoders=e}or(e){return r$(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const r$=(t,e)=>new Lj({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Mj=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new Uj(e,r,n),this.decoder=new Bj(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const sp=({name:t,prefix:e,encode:r,decode:n})=>new Mj(t,e,r,n),rh=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=Pj(r,e);return sp({prefix:t,name:e,encode:n,decode:i=>t$(s(i))})},jj=(t,e,r,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Fj=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},fr=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>sp({prefix:e,name:t,encode(s){return Fj(s,n,r)},decode(s){return jj(s,n,r,t)}}),qj=sp({prefix:"\0",name:"identity",encode:t=>Dj(t),decode:t=>Rj(t)});var zj=Object.freeze({__proto__:null,identity:qj});const Hj=fr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Vj=Object.freeze({__proto__:null,base2:Hj});const Wj=fr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Kj=Object.freeze({__proto__:null,base8:Wj});const Gj=rh({prefix:"9",name:"base10",alphabet:"0123456789"});var Yj=Object.freeze({__proto__:null,base10:Gj});const Zj=fr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Jj=fr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Xj=Object.freeze({__proto__:null,base16:Zj,base16upper:Jj});const Qj=fr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),eF=fr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),tF=fr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rF=fr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nF=fr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sF=fr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),iF=fr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oF=fr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),aF=fr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var cF=Object.freeze({__proto__:null,base32:Qj,base32upper:eF,base32pad:tF,base32padupper:rF,base32hex:nF,base32hexupper:sF,base32hexpad:iF,base32hexpadupper:oF,base32z:aF});const lF=rh({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),uF=rh({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var hF=Object.freeze({__proto__:null,base36:lF,base36upper:uF});const dF=rh({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fF=rh({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var pF=Object.freeze({__proto__:null,base58btc:dF,base58flickr:fF});const gF=fr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),mF=fr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),yF=fr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wF=fr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var bF=Object.freeze({__proto__:null,base64:gF,base64pad:mF,base64url:yF,base64urlpad:wF});const n$=Array.from(""),vF=n$.reduce((t,e,r)=>(t[r]=e,t),[]),EF=n$.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _F(t){return t.reduce((e,r)=>(e+=vF[r],e),"")}function IF(t){const e=[];for(const r of t){const n=EF[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const SF=sp({prefix:"",name:"base256emoji",encode:_F,decode:IF});var CF=Object.freeze({__proto__:null,base256emoji:SF}),xF=s$,CE=128,AF=-128,$F=Math.pow(2,31);function s$(t,e,r){e=e||[],r=r||0;for(var n=r;t>=$F;)e[r++]=t&255|CE,t/=128;for(;t&AF;)e[r++]=t&255|CE,t>>>=7;return e[r]=t|0,s$.bytes=r-n+1,e}var NF=Ty,OF=128,xE=127;function Ty(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Ty.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&xE)<<s:(o&xE)*Math.pow(2,s),s+=7}while(o>=OF);return Ty.bytes=i-n,r}var TF=Math.pow(2,7),kF=Math.pow(2,14),PF=Math.pow(2,21),RF=Math.pow(2,28),DF=Math.pow(2,35),UF=Math.pow(2,42),BF=Math.pow(2,49),LF=Math.pow(2,56),MF=Math.pow(2,63),jF=function(t){return t<TF?1:t<kF?2:t<PF?3:t<RF?4:t<DF?5:t<UF?6:t<BF?7:t<LF?8:t<MF?9:10},FF={encode:xF,decode:NF,encodingLength:jF},i$=FF;const AE=(t,e,r=0)=>(i$.encode(t,e,r),e),$E=t=>i$.encodingLength(t),ky=(t,e)=>{const r=e.byteLength,n=$E(t),s=n+$E(r),i=new Uint8Array(s+r);return AE(t,i,0),AE(r,i,n),i.set(e,s),new qF(t,r,e,i)};let qF=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const o$=({name:t,code:e,encode:r})=>new zF(t,e,r);let zF=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ky(this.code,r):r.then(n=>ky(this.code,n))}else throw Error("Unknown type, must be binary type")}};const a$=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),HF=o$({name:"sha2-256",code:18,encode:a$("SHA-256")}),VF=o$({name:"sha2-512",code:19,encode:a$("SHA-512")});var WF=Object.freeze({__proto__:null,sha256:HF,sha512:VF});const c$=0,KF="identity",l$=t$,GF=t=>ky(c$,l$(t)),YF={code:c$,name:KF,encode:l$,digest:GF};var ZF=Object.freeze({__proto__:null,identity:YF});new TextEncoder,new TextDecoder;const NE={...zj,...Vj,...Kj,...Yj,...Xj,...cF,...hF,...pF,...bF,...CF};({...WF,...ZF});function u$(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function JF(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?u$(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function h$(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const OE=h$("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ng=h$("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=JF(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),XF={utf8:OE,"utf-8":OE,hex:NE.base16,latin1:Ng,ascii:Ng,binary:Ng,...NE};function QF(t,e="utf8"){const r=XF[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?u$(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var eq=Object.defineProperty,tq=(t,e,r)=>e in t?eq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ws=(t,e,r)=>tq(t,typeof e!="symbol"?e+"":e,r);let rq=class{constructor(e,r){this.core=e,this.logger=r,ws(this,"keychain",new Map),ws(this,"name",tj),ws(this,"version",rj),ws(this,"initialized",!1),ws(this,"storagePrefix",Ms),ws(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),ws(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),ws(this,"set",async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()}),ws(this,"get",n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:i}=re("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return s}),ws(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=In(r,this.name)}get context(){return sn(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,dy(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?fy(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}};var nq=Object.defineProperty,sq=(t,e,r)=>e in t?nq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jt=(t,e,r)=>sq(t,typeof e!="symbol"?e+"":e,r);let iq=class{constructor(e,r,n){this.core=e,this.logger=r,jt(this,"name",Q7),jt(this,"keychain"),jt(this,"randomSessionIdentifier",Sy()),jt(this,"initialized",!1),jt(this,"clientId"),jt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),jt(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),jt(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const s=await this.getClientSeed(),i=Fd(s),o=a0(i.publicKey);return this.clientId=o,o}),jt(this,"generateKeyPair",()=>{this.isInitialized();const s=z9();return this.setPrivateKey(s.publicKey,s.privateKey)}),jt(this,"signJWT",async s=>{this.isInitialized();const i=await this.getClientSeed(),o=Fd(i),a=this.randomSessionIdentifier;return await NC(a,s,ej,o)}),jt(this,"generateSharedKey",(s,i,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=H9(a,i);return this.setSymKey(c,o)}),jt(this,"setSymKey",async(s,i)=>{this.isInitialized();const o=i||yd(s);return await this.keychain.set(o,s),o}),jt(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),jt(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),jt(this,"encode",async(s,i,o)=>{this.isInitialized();const a=UA(o),c=Br(i);if(rE(a))return K9(c,o?.encoding);if(tE(a)){const d=a.senderPublicKey,p=a.receiverPublicKey;s=await this.generateSharedKey(d,p)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return V9({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),jt(this,"decode",async(s,i,o)=>{this.isInitialized();const a=Y9(i,o);if(rE(a)){const c=G9(i,o?.encoding);return Ls(c)}if(tE(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=W9({symKey:c,encoded:i,encoding:o?.encoding});return Ls(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),jt(this,"getPayloadType",(s,i=Yr)=>{const o=ou({encoded:s,encoding:i});return ba(o.type)}),jt(this,"getPayloadSenderPublicKey",(s,i=Yr)=>{const o=ou({encoded:s,encoding:i});return o.senderPublicKey?Ye(o.senderPublicKey,Pr):void 0}),this.core=e,this.logger=In(r,this.name),this.keychain=n||new rq(this.core,this.logger)}get context(){return sn(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(IE)}catch{e=Sy(),await this.keychain.set(IE,e)}return QF(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}};var oq=Object.defineProperty,aq=Object.defineProperties,cq=Object.getOwnPropertyDescriptors,TE=Object.getOwnPropertySymbols,lq=Object.prototype.hasOwnProperty,uq=Object.prototype.propertyIsEnumerable,Py=(t,e,r)=>e in t?oq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hq=(t,e)=>{for(var r in e||(e={}))lq.call(e,r)&&Py(t,r,e[r]);if(TE)for(var r of TE(e))uq.call(e,r)&&Py(t,r,e[r]);return t},dq=(t,e)=>aq(t,cq(e)),ln=(t,e,r)=>Py(t,typeof e!="symbol"?e+"":e,r);let fq=class extends RP{constructor(e,r){super(e,r),this.logger=e,this.core=r,ln(this,"messages",new Map),ln(this,"messagesWithoutClientAck",new Map),ln(this,"name",nj),ln(this,"version",sj),ln(this,"initialized",!1),ln(this,"storagePrefix",Ms),ln(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),ln(this,"set",async(n,s,i)=>{this.isInitialized();const o=Fn(s);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(n,a),i===wd.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,dq(hq({},c),{[o]:s}))}return await this.persist(),o}),ln(this,"get",n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s}),ln(this,"getWithoutAck",n=>{this.isInitialized();const s={};for(const i of n){const o=this.messagesWithoutClientAck.get(i)||{};s[i]=Object.values(o)}return s}),ln(this,"has",(n,s)=>{this.isInitialized();const i=this.get(n),o=Fn(s);return typeof i[o]<"u"}),ln(this,"ack",async(n,s)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;const o=Fn(s);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),ln(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=In(e,this.name),this.core=r}get context(){return sn(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,dy(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,dy(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?fy(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?fy(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}};var pq=Object.defineProperty,gq=Object.defineProperties,mq=Object.getOwnPropertyDescriptors,kE=Object.getOwnPropertySymbols,yq=Object.prototype.hasOwnProperty,wq=Object.prototype.propertyIsEnumerable,Ry=(t,e,r)=>e in t?pq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ha=(t,e)=>{for(var r in e||(e={}))yq.call(e,r)&&Ry(t,r,e[r]);if(kE)for(var r of kE(e))wq.call(e,r)&&Ry(t,r,e[r]);return t},PE=(t,e)=>gq(t,mq(e)),Nn=(t,e,r)=>Ry(t,typeof e!="symbol"?e+"":e,r);let bq=class extends DP{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Nn(this,"events",new mt.EventEmitter),Nn(this,"name",oj),Nn(this,"queue",new Map),Nn(this,"publishTimeout",z.toMiliseconds(z.ONE_MINUTE)),Nn(this,"initialPublishTimeout",z.toMiliseconds(z.ONE_SECOND*15)),Nn(this,"needsTransportRestart",!1),Nn(this,"publish",async(n,s,i)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:i}});const h=i?.ttl||ij,d=i?.prompt||!1,p=i?.tag||0,g=i?.id||Nr().toString(),m=ac(tf().protocol),w={id:g,method:i?.publishMethod||m.publish,params:Ha({topic:n,message:s,ttl:h,prompt:d,tag:p,attestation:i?.attestation},i?.tvf)},I=`Failed to publish payload, please try again. id:${g} tag:${p}`;try{Gt((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),Gt((c=w.params)==null?void 0:c.tag)&&((l=w.params)==null||delete l.tag);const S=new Promise(async v=>{const b=({id:N})=>{var P;((P=w.id)==null?void 0:P.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(xt.publish,b),v())};this.relayer.events.on(xt.publish,b);const C=Os(new Promise((N,P)=>{this.rpcPublish(w,i).then(N).catch(R=>{this.logger.warn(R,R?.message),P(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${p}`);try{await C,this.events.removeListener(xt.publish,b)}catch(N){this.queue.set(g,{request:w,opts:i,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:n,message:s,opts:i}}),await Os(S,this.publishTimeout,I)}catch(S){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(S),(u=i?.internal)!=null&&u.throwOnFailedPublish)throw S}finally{this.queue.delete(g)}}),Nn(this,"publishCustom",async n=>{var s,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:u={}}=n,{attestation:h,tvf:d,publishMethod:p,prompt:g,tag:m,ttl:w=z.FIVE_MINUTES}=u,I=u.id||Nr().toString(),S=ac(tf().protocol),v=p||S.publish,b={id:I,method:v,params:Ha(PE(Ha({},l),{ttl:w,prompt:g,tag:m,attestation:h}),d)},C=`Failed to publish custom payload, please try again. id:${I} tag:${m}`;try{Gt((s=b.params)==null?void 0:s.prompt)&&((i=b.params)==null||delete i.prompt),Gt((o=b.params)==null?void 0:o.tag)&&((a=b.params)==null||delete a.tag);const N=new Promise(async P=>{const R=({id:M})=>{var j;((j=b.id)==null?void 0:j.toString())===M.toString()&&(this.removeRequestFromQueue(M),this.relayer.events.removeListener(xt.publish,R),P())};this.relayer.events.on(xt.publish,R);const O=Os(new Promise((M,j)=>{this.rpcPublish(b,u).then(M).catch(k=>{this.logger.warn(k,k?.message),j(k)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${I} tag:${m}`);try{await O,this.events.removeListener(xt.publish,R)}catch(M){this.queue.set(I,{request:b,opts:u,attempt:1}),this.logger.warn(M,M?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:I,payload:l,opts:u}}),await Os(N,this.publishTimeout,C)}catch(N){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(N),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw N}finally{this.queue.delete(I)}}),Nn(this,"on",(n,s)=>{this.events.on(n,s)}),Nn(this,"once",(n,s)=>{this.events.once(n,s)}),Nn(this,"off",(n,s)=>{this.events.off(n,s)}),Nn(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.relayer=e,this.logger=In(r,this.name),this.registerEventListeners()}get context(){return sn(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(xt.publish,Ha(Ha({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const s=e.attempt+1;this.queue.set(r,PE(Ha({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Aa.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(xt.connection_stalled);return}this.checkQueue()}),this.relayer.on(xt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}};var vq=Object.defineProperty,Eq=(t,e,r)=>e in t?vq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Va=(t,e,r)=>Eq(t,typeof e!="symbol"?e+"":e,r);let _q=class{constructor(){Va(this,"map",new Map),Va(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Va(this,"get",e=>this.map.get(e)||[]),Va(this,"exists",(e,r)=>this.get(e).includes(r)),Va(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const s=n.filter(i=>i!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Va(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var Iq=Object.defineProperty,Sq=Object.defineProperties,Cq=Object.getOwnPropertyDescriptors,RE=Object.getOwnPropertySymbols,xq=Object.prototype.hasOwnProperty,Aq=Object.prototype.propertyIsEnumerable,Dy=(t,e,r)=>e in t?Iq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ul=(t,e)=>{for(var r in e||(e={}))xq.call(e,r)&&Dy(t,r,e[r]);if(RE)for(var r of RE(e))Aq.call(e,r)&&Dy(t,r,e[r]);return t},Og=(t,e)=>Sq(t,Cq(e)),Je=(t,e,r)=>Dy(t,typeof e!="symbol"?e+"":e,r);let $q=class extends LP{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Je(this,"subscriptions",new Map),Je(this,"topicMap",new _q),Je(this,"events",new mt.EventEmitter),Je(this,"name",fj),Je(this,"version",pj),Je(this,"pending",new Map),Je(this,"cached",[]),Je(this,"initialized",!1),Je(this,"storagePrefix",Ms),Je(this,"subscribeTimeout",z.toMiliseconds(z.ONE_MINUTE)),Je(this,"initialSubscribeTimeout",z.toMiliseconds(z.ONE_SECOND*15)),Je(this,"clientId"),Je(this,"batchSubscribeTopicsLimit",500),Je(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Je(this,"subscribe",async(n,s)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const o=tf(s),a={topic:n,relay:o,transportType:s?.transportType};(i=s?.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Je(this,"unsubscribe",async(n,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)}),Je(this,"isSubscribed",n=>new Promise(s=>{s(this.topicMap.topics.includes(n))})),Je(this,"isKnownTopic",n=>new Promise(s=>{s(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),Je(this,"on",(n,s)=>{this.events.on(n,s)}),Je(this,"once",(n,s)=>{this.events.once(n,s)}),Je(this,"off",(n,s)=>{this.events.off(n,s)}),Je(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),Je(this,"start",async()=>{await this.onConnect()}),Je(this,"stop",async()=>{await this.onDisconnect()}),Je(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Je(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(s=>{n.push(s)}),await this.batchSubscribe(n)}),Je(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Aa.pulse,async()=>{await this.checkPending()}),this.events.on(fn.created,async n=>{const s=fn.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()}),this.events.on(fn.deleted,async n=>{const s=fn.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()})}),this.relayer=e,this.logger=In(r,this.name),this.clientId=""}get context(){return sn(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const s=tf(n);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const i=pt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,n){var s,i;const o=await this.getSubscriptionId(e);if((s=n?.internal)!=null&&s.skipSubscribe)return o;(!n||n?.transportType===rt.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ac(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{if(n?.transportType===rt.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},z.toMiliseconds(z.ONE_SECOND)),o;const l=new Promise(async h=>{const d=p=>{p.topic===e&&(this.events.removeListener(fn.created,d),h(p.id))};this.events.on(fn.created,d);try{const p=await Os(new Promise((g,m)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w?.message),m(w)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(fn.created,d),h(p)}catch{}}),u=await Os(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(xt.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:ac(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Os(new Promise(s=>{this.relayer.request(n).catch(i=>this.logger.warn(i)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(xt.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:ac(r.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let s;try{s=await await Os(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(xt.connection_stalled)}return s}rpcUnsubscribe(e,r,n){const s={method:ac(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,Og(ul({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,ul({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,ul({},r)),this.topicMap.set(r.topic,e),this.events.emit(fn.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=re("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(fn.deleted,Og(ul({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(fn.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(fn.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=re("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Og(ul({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await lB(z.toMiliseconds(z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Fn(e+await this.getClientId())}};var Nq=Object.defineProperty,DE=Object.getOwnPropertySymbols,Oq=Object.prototype.hasOwnProperty,Tq=Object.prototype.propertyIsEnumerable,Uy=(t,e,r)=>e in t?Nq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,UE=(t,e)=>{for(var r in e||(e={}))Oq.call(e,r)&&Uy(t,r,e[r]);if(DE)for(var r of DE(e))Tq.call(e,r)&&Uy(t,r,e[r]);return t},De=(t,e,r)=>Uy(t,typeof e!="symbol"?e+"":e,r);let kq=class extends UP{constructor(e){var r;super(e),De(this,"protocol","wc"),De(this,"version",2),De(this,"core"),De(this,"logger"),De(this,"events",new mt.EventEmitter),De(this,"provider"),De(this,"messages"),De(this,"subscriber"),De(this,"publisher"),De(this,"name",cj),De(this,"transportExplicitlyClosed",!1),De(this,"initialized",!1),De(this,"connectionAttemptInProgress",!1),De(this,"relayUrl"),De(this,"projectId"),De(this,"packageName"),De(this,"bundleId"),De(this,"hasExperiencedNetworkDisruption",!1),De(this,"pingTimeout"),De(this,"heartBeatTimeout",z.toMiliseconds(z.THIRTY_SECONDS+z.FIVE_SECONDS)),De(this,"reconnectTimeout"),De(this,"connectPromise"),De(this,"reconnectInProgress",!1),De(this,"requestsInFlight",[]),De(this,"connectTimeout",z.toMiliseconds(z.ONE_SECOND*15)),De(this,"request",async n=>{var s,i;this.logger.debug("Publishing Request Payload");const o=n.id||Nr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(s=n.params)==null?void 0:s.topic},"relayer.request - publishing...");const a=`${o}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),De(this,"resetPingTimeout",()=>{Yd()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,s,i,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null?void 0:i.terminate)==null||o.call(i)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),De(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),De(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(xt.connect)}),De(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),De(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(xt.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),De(this,"registerProviderListeners",()=>{this.provider.on($n.payload,this.onPayloadHandler),this.provider.on($n.connect,this.onConnectHandler),this.provider.on($n.disconnect,this.onDisconnectHandler),this.provider.on($n.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=FA({logger:(r=e.logger)!=null?r:aj,name:this.name}),this.messages=new fq(this.logger,e.core),this.subscriber=new $q(this,this.logger),this.publisher=new bq(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||QA,KU()?this.packageName=I1():GU()&&(this.bundleId=I1()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return sn(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:rt.relay},wd.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,s,i;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(fn.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(fn.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,UE({internal:{throwOnFailedPublish:o}},r)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Os(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await gE())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,s)=>n.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const s=Rt(z.FIVE_MINUTES),i={topic:n,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(xt.message,e),await this.recordMessageEvent(e,wd.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,s)=>{const i=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once($n.disconnect,i),await Os(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off($n.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once($n.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off($n.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const s=n;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,z.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,s,i;if(Yd())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new V7(new Y7(QU({sdkVersion:Oy,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:s}=e;await this.messages.set(n,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,n);return s&&this.logger.warn(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Vc(e)){if(!e.method.endsWith(lj))return;const r=e.params,{topic:n,message:s,publishedAt:i,attestation:o}=r.data,a={topic:n,message:s,publishedAt:i,transportType:rt.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(UE({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else xo(e)&&this.events.emit(xt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,wd.inbound),this.events.emit(xt.message,e))}async acknowledgePayload(e){const r=xi(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off($n.payload,this.onPayloadHandler),this.provider.off($n.connect,this.onConnectHandler),this.provider.off($n.disconnect,this.onDisconnectHandler),this.provider.off($n.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await gE();ZM(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Aa.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&QM())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(xt.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},z.toMiliseconds(uj)))))}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function Pq(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function BE(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function LE(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Rq="[object RegExp]",Dq="[object String]",Uq="[object Number]",Bq="[object Boolean]",ME="[object Arguments]",Lq="[object Symbol]",Mq="[object Date]",jq="[object Map]",Fq="[object Set]",qq="[object Array]",zq="[object Function]",Hq="[object ArrayBuffer]",Tg="[object Object]",Vq="[object Error]",Wq="[object DataView]",Kq="[object Uint8Array]",Gq="[object Uint8ClampedArray]",Yq="[object Uint16Array]",Zq="[object Uint32Array]",Jq="[object BigUint64Array]",Xq="[object Int8Array]",Qq="[object Int16Array]",ez="[object Int32Array]",tz="[object BigInt64Array]",rz="[object Float32Array]",nz="[object Float64Array]";function sz(){}function jE(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function iz(t,e,r){return $l(t,e,void 0,void 0,void 0,void 0,r)}function $l(t,e,r,n,s,i,o){const a=o(t,e,r,n,s,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return jl(t,e,i,o)}return jl(t,e,i,o)}function jl(t,e,r,n){if(Object.is(t,e))return!0;let s=LE(t),i=LE(e);if(s===ME&&(s=Tg),i===ME&&(i=Tg),s!==i)return!1;switch(s){case Dq:return t.toString()===e.toString();case Uq:{const c=t.valueOf(),l=e.valueOf();return Pq(c,l)}case Bq:case Mq:case Lq:return Object.is(t.valueOf(),e.valueOf());case Rq:return t.source===e.source&&t.flags===e.flags;case zq:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case jq:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!$l(l,e.get(c),c,t,e,r,n))return!1;return!0}case Fq:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(p=>$l(h,p,void 0,t,e,r,n));if(d===-1)return!1;l.splice(d,1)}return!0}case qq:case Kq:case Gq:case Yq:case Zq:case Jq:case Xq:case Qq:case ez:case tz:case rz:case nz:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!$l(t[c],e[c],c,t,e,r,n))return!1;return!0}case Hq:return t.byteLength!==e.byteLength?!1:jl(new Uint8Array(t),new Uint8Array(e),r,n);case Wq:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:jl(new Uint8Array(t),new Uint8Array(e),r,n);case Vq:return t.name===e.name&&t.message===e.message;case Tg:{if(!(jl(t.constructor,e.constructor,r,n)||jE(t)&&jE(e)))return!1;const c=[...Object.keys(t),...BE(t)],l=[...Object.keys(e),...BE(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!$l(d,p,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function oz(t,e){return iz(t,e,sz)}var az=Object.defineProperty,FE=Object.getOwnPropertySymbols,cz=Object.prototype.hasOwnProperty,lz=Object.prototype.propertyIsEnumerable,By=(t,e,r)=>e in t?az(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qE=(t,e)=>{for(var r in e||(e={}))cz.call(e,r)&&By(t,r,e[r]);if(FE)for(var r of FE(e))lz.call(e,r)&&By(t,r,e[r]);return t},Mr=(t,e,r)=>By(t,typeof e!="symbol"?e+"":e,r);let Ta=class extends BP{constructor(e,r,n,s=Ms,i=void 0){super(e,r,n,s),this.core=e,this.logger=r,this.name=n,Mr(this,"map",new Map),Mr(this,"version",hj),Mr(this,"cached",[]),Mr(this,"initialized",!1),Mr(this,"getKey"),Mr(this,"storagePrefix",Ms),Mr(this,"recentlyDeleted",[]),Mr(this,"recentlyDeletedLimit",200),Mr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Gt(o)?this.map.set(this.getKey(o),o):AM(o)?this.map.set(o.id,o):$M(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Mr(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Mr(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Mr(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>oz(a[c],o[c]))):this.values)),Mr(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=qE(qE({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Mr(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=In(r,this.name),this.storagePrefix=s,this.getKey=i}get context(){return sn(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=re("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:n}=re("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=re("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}};var uz=Object.defineProperty,hz=(t,e,r)=>e in t?uz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xe=(t,e,r)=>hz(t,typeof e!="symbol"?e+"":e,r);let dz=class{constructor(e,r){this.core=e,this.logger=r,xe(this,"name",gj),xe(this,"version",mj),xe(this,"events",new Hu),xe(this,"pairings"),xe(this,"initialized",!1),xe(this,"storagePrefix",Ms),xe(this,"ignoredPayloadTypes",[Ei]),xe(this,"registeredMethods",[]),xe(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),xe(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),xe(this,"create",async n=>{this.isInitialized();const s=Sy(),i=await this.core.crypto.setSymKey(s),o=Rt(z.FIVE_MINUTES),a={protocol:XA},c={topic:i,expiry:o,relay:a,active:!1,methods:n?.methods},l=oE({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:s,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(Wo.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n?.transportType,internal:n?.internal}),{topic:i,uri:l}}),xe(this,"pair",async n=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[Ss.pairing_started]}});this.isValidPair(n,s);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=iE(n.uri);s.props.properties.topic=i,s.addTrace(Ss.pairing_uri_validation_success),s.addTrace(Ss.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(i)){if(u=this.pairings.get(i),s.addTrace(Ss.existing_pairing),u.active)throw s.setError(Qs.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);s.addTrace(Ss.pairing_not_expired)}const h=c||Rt(z.FIVE_MINUTES),d={topic:i,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(i,h),await this.pairings.set(i,d),s.addTrace(Ss.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(Wo.create,d),s.addTrace(Ss.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),s.addTrace(Ss.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Qs.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(p){throw s.setError(Qs.subscribe_pairing_topic_failure),p}return s.addTrace(Ss.subscribe_pairing_topic_success),d}),xe(this,"activate",async({topic:n})=>{this.isInitialized();const s=Rt(z.FIVE_MINUTES);this.core.expirer.set(n,s),await this.pairings.update(n,{active:!0,expiry:s})}),xe(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=n;if(this.pairings.keys.includes(s)){const i=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Mo();this.events.once(Ve("pairing_ping",i),({error:l})=>{l?c(l):a()}),await o()}}),xe(this,"updateExpiry",async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})}),xe(this,"updateMetadata",async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})}),xe(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),xe(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",pt("USER_DISCONNECTED")),await this.deletePairing(s))}),xe(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:s,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(s);return oE({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),xe(this,"sendRequest",async(n,s,i)=>{const o=Nt(s,i),a=await this.core.crypto.encode(n,o),c=cl[s].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),xe(this,"sendResult",async(n,s,i)=>{const o=xi(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=cl[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),xe(this,"sendError",async(n,s,i)=>{const o=Oa(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=cl[c]?cl[c].res:cl.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),xe(this,"deletePairing",async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,pt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])}),xe(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(s=>Zi(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))}),xe(this,"onRelayEventRequest",async n=>{const{topic:s,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,i);default:return await this.onUnknownRpcMethodRequest(s,i)}}),xe(this,"onRelayEventResponse",async n=>{const{topic:s,payload:i}=n,o=(await this.core.history.get(s,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,i);default:return this.onUnknownRpcMethodResponse(o)}}),xe(this,"onPairingPingRequest",async(n,s)=>{const{id:i}=s;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(Wo.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),xe(this,"onPairingPingResponse",(n,s)=>{const{id:i}=s;setTimeout(()=>{Bt(s)?this.events.emit(Ve("pairing_ping",i),{}):dt(s)&&this.events.emit(Ve("pairing_ping",i),{error:s.error})},500)}),xe(this,"onPairingDeleteRequest",async(n,s)=>{const{id:i}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Wo.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),xe(this,"onUnknownRpcMethodRequest",async(n,s)=>{const{id:i,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=pt("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),xe(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(pt("WC_METHOD_UNSUPPORTED",n))}),xe(this,"isValidPair",(n,s)=>{var i;if(!Vr(n)){const{message:a}=re("MISSING_OR_INVALID",`pair() params: ${n}`);throw s.setError(Qs.malformed_pairing_uri),new Error(a)}if(!xM(n.uri)){const{message:a}=re("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw s.setError(Qs.malformed_pairing_uri),new Error(a)}const o=iE(n?.uri);if(!((i=o?.relay)!=null&&i.protocol)){const{message:a}=re("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Qs.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=re("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Qs.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&z.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(Qs.pairing_expired);const{message:a}=re("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),xe(this,"isValidPing",async n=>{if(!Vr(n)){const{message:i}=re("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),xe(this,"isValidDisconnect",async n=>{if(!Vr(n)){const{message:i}=re("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),xe(this,"isValidPairingTopic",async n=>{if(!At(n,!1)){const{message:s}=re("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=re("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(Zi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=re("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}}),this.core=e,this.logger=In(r,this.name),this.pairings=new Ta(this.core,this.logger,this.name,this.storagePrefix)}get context(){return sn(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(xt.message,async e=>{const{topic:r,message:n,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==rt.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const i=await this.core.crypto.decode(r,n);Vc(i)?(this.core.history.set(r,i),await this.onRelayEventRequest({topic:r,payload:i})):xo(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id)),await this.core.relayer.messages.ack(r,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(Un.expired,async e=>{const{topic:r}=Lx(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Wo.expire,{topic:r}))})}};var fz=Object.defineProperty,pz=(t,e,r)=>e in t?fz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qt=(t,e,r)=>pz(t,typeof e!="symbol"?e+"":e,r);let gz=class extends PP{constructor(e,r){super(e,r),this.core=e,this.logger=r,Qt(this,"records",new Map),Qt(this,"events",new mt.EventEmitter),Qt(this,"name",yj),Qt(this,"version",wj),Qt(this,"cached",[]),Qt(this,"initialized",!1),Qt(this,"storagePrefix",Ms),Qt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Qt(this,"set",(n,s,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:i}),this.records.has(s.id))return;const o={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:i,expiry:Rt(z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Zn.created,o)}),Qt(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=dt(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.persist(),this.events.emit(Zn.updated,s))}),Qt(this,"get",async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s))),Qt(this,"delete",(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(i=>{if(i.topic===n){if(typeof s<"u"&&i.id!==s)return;this.records.delete(i.id),this.events.emit(Zn.deleted,i)}}),this.persist()}),Qt(this,"exists",async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1)),Qt(this,"on",(n,s)=>{this.events.on(n,s)}),Qt(this,"once",(n,s)=>{this.events.once(n,s)}),Qt(this,"off",(n,s)=>{this.events.off(n,s)}),Qt(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=In(r,this.name)}get context(){return sn(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Nt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=re("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Zn.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=re("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Zn.created,e=>{const r=Zn.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Zn.updated,e=>{const r=Zn.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Zn.deleted,e=>{const r=Zn.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Aa.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Zn.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}};var mz=Object.defineProperty,yz=(t,e,r)=>e in t?mz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vr=(t,e,r)=>yz(t,typeof e!="symbol"?e+"":e,r);let wz=class extends MP{constructor(e,r){super(e,r),this.core=e,this.logger=r,vr(this,"expirations",new Map),vr(this,"events",new mt.EventEmitter),vr(this,"name",bj),vr(this,"version",vj),vr(this,"cached",[]),vr(this,"initialized",!1),vr(this,"storagePrefix",Ms),vr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),vr(this,"has",n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}}),vr(this,"set",(n,s)=>{this.isInitialized();const i=this.formatTarget(n),o={target:i,expiry:s};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(Un.created,{target:i,expiration:o})}),vr(this,"get",n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)}),vr(this,"del",n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),i=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Un.deleted,{target:s,expiration:i})}}),vr(this,"on",(n,s)=>{this.events.on(n,s)}),vr(this,"once",(n,s)=>{this.events.once(n,s)}),vr(this,"off",(n,s)=>{this.events.off(n,s)}),vr(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=In(r,this.name)}get context(){return sn(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return eB(e);if(typeof e=="number")return tB(e);const{message:r}=re("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Un.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=re("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=re("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;z.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Un.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Aa.pulse,()=>this.checkExpirations()),this.events.on(Un.created,e=>{const r=Un.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Un.expired,e=>{const r=Un.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Un.deleted,e=>{const r=Un.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}};var bz=Object.defineProperty,vz=(t,e,r)=>e in t?bz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_t=(t,e,r)=>vz(t,typeof e!="symbol"?e+"":e,r);let Ez=class extends jP{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,_t(this,"name",Ej),_t(this,"abortController"),_t(this,"isDevEnv"),_t(this,"verifyUrlV3",Ij),_t(this,"storagePrefix",Ms),_t(this,"version",JA),_t(this,"publicKey"),_t(this,"fetchPromise"),_t(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&z.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),_t(this,"register",async s=>{if(!zc()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const l=Jt.getDocument(),u=this.startAbortTimer(z.ONE_SECOND*5),h=await new Promise((d,p)=>{const g=()=>{window.removeEventListener("message",w),l.body.removeChild(m),p("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const m=l.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",g,{signal:this.abortController.signal});const w=I=>{if(I.data&&typeof I.data=="string")try{const S=JSON.parse(I.data);if(S.type==="verify_attestation"){if(Cc(S.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(m),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",w),d(S.attestation===null?"":S.attestation)}}catch(S){this.logger.warn(S)}};l.body.appendChild(m),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),_t(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=s;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(Cc(i).payload.id!==a)return;const l=await this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),_t(this,"fetchAttestation",async(s,i)=>{this.logger.debug(`resolving attestation: ${s} from url: ${i}`);const o=this.startAbortTimer(z.ONE_SECOND*5),a=await fetch(`${i}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),_t(this,"getVerifyUrl",s=>{let i=s||Ml;return Sj.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${Ml}`),i=Ml),i}),_t(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(z.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await i.json()}catch(s){this.logger.warn(s)}}),_t(this,"persistPublicKey",async s=>{this.logger.debug(s,"persisting public key to local storage"),await this.store.setItem(this.storeKey,s),this.publicKey=s}),_t(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),_t(this,"isValidJwtAttestation",async s=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(s,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),_t(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),_t(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),_t(this,"validateAttestation",(s,i)=>{const o=J9(s,i.publicKey),a={hasExpired:z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=In(r,this.name),this.abortController=new AbortController,this.isDevEnv=w0(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return sn(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),z.toMiliseconds(e))}};var _z=Object.defineProperty,Iz=(t,e,r)=>e in t?_z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zE=(t,e,r)=>Iz(t,typeof e!="symbol"?e+"":e,r);let Sz=class extends FP{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,zE(this,"context",Cj),zE(this,"registerDeviceToken",async n=>{const{clientId:s,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${xj}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:i,always_raw:a})})}),this.logger=In(r,this.context)}};var Cz=Object.defineProperty,HE=Object.getOwnPropertySymbols,xz=Object.prototype.hasOwnProperty,Az=Object.prototype.propertyIsEnumerable,Ly=(t,e,r)=>e in t?Cz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hl=(t,e)=>{for(var r in e||(e={}))xz.call(e,r)&&Ly(t,r,e[r]);if(HE)for(var r of HE(e))Az.call(e,r)&&Ly(t,r,e[r]);return t},Ft=(t,e,r)=>Ly(t,typeof e!="symbol"?e+"":e,r);let $z=class extends qP{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,Ft(this,"context",$j),Ft(this,"storagePrefix",Ms),Ft(this,"storageVersion",Aj),Ft(this,"events",new Map),Ft(this,"shouldPersist",!1),Ft(this,"init",async()=>{if(!w0())try{const s={eventId:C1(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Ux(this.core.relayer.protocol,this.core.relayer.version,Oy)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ft(this,"createEvent",s=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=C1(),u=this.core.projectId||"",h=Date.now(),d=hl({eventId:l,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),Ft(this,"getEvent",s=>{const{eventId:i,topic:o}=s;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return hl(hl({},a),this.setMethods(a.eventId))}),Ft(this,"deleteEvent",s=>{const{eventId:i}=s;this.events.delete(i),this.shouldPersist=!0}),Ft(this,"setEventListeners",()=>{this.core.heartbeat.on(Aa.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{z.fromMiliseconds(Date.now())-z.fromMiliseconds(s.timestamp)>Nj&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ft(this,"setMethods",s=>({addTrace:i=>this.addTrace(s,i),setError:i=>this.setError(s,i)})),Ft(this,"addTrace",(s,i)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(i),this.events.set(s,o),this.shouldPersist=!0)}),Ft(this,"setError",(s,i)=>{const o=this.events.get(s);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ft(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ft(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(i=>{this.events.set(i.eventId,hl(hl({},i),this.setMethods(i.eventId)))})}catch(s){this.logger.warn(s)}}),Ft(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[i,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const i of s)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Ft(this,"sendEvent",async s=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Oj}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Oy}${i}`,{method:"POST",body:JSON.stringify(s)})}),Ft(this,"getAppDomain",()=>Dx().url),this.logger=In(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var Nz=Object.defineProperty,VE=Object.getOwnPropertySymbols,Oz=Object.prototype.hasOwnProperty,Tz=Object.prototype.propertyIsEnumerable,My=(t,e,r)=>e in t?Nz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,WE=(t,e)=>{for(var r in e||(e={}))Oz.call(e,r)&&My(t,r,e[r]);if(VE)for(var r of VE(e))Tz.call(e,r)&&My(t,r,e[r]);return t},Qe=(t,e,r)=>My(t,typeof e!="symbol"?e+"":e,r);let kz=class d$ extends NP{constructor(e){var r;super(e),Qe(this,"protocol",ZA),Qe(this,"version",JA),Qe(this,"name",Ny),Qe(this,"relayUrl"),Qe(this,"projectId"),Qe(this,"customStoragePrefix"),Qe(this,"events",new mt.EventEmitter),Qe(this,"logger"),Qe(this,"heartbeat"),Qe(this,"relayer"),Qe(this,"crypto"),Qe(this,"storage"),Qe(this,"history"),Qe(this,"expirer"),Qe(this,"pairing"),Qe(this,"verify"),Qe(this,"echoClient"),Qe(this,"linkModeSupportedApps"),Qe(this,"eventClient"),Qe(this,"initialized",!1),Qe(this,"logChunkController"),Qe(this,"on",(a,c)=>this.events.on(a,c)),Qe(this,"once",(a,c)=>this.events.once(a,c)),Qe(this,"off",(a,c)=>this.events.off(a,c)),Qe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Qe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:rt.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||QA,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=_P({level:typeof e?.logger=="string"&&e.logger?e.logger:J7.logger,name:Ny}),{logger:i,chunkLoggerController:o}=eC({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=In(i,this.name),this.heartbeat=new vk,this.crypto=new iq(this,this.logger,e?.keychain),this.history=new gz(this,this.logger),this.expirer=new wz(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new JS(WE(WE({},X7),e?.storageOptions)),this.relayer=new kq({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new dz(this,this.logger),this.verify=new Ez(this,this.logger,this.storage),this.echoClient=new Sz(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new $z(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new d$(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(dj,n),r}get context(){return sn(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(SE,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(SE)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&Z7.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const Pz=kz,f$="wc",p$=2,g$="client",T0=`${f$}@${p$}:${g$}:`,kg={name:g$,logger:"error"},KE="WALLETCONNECT_DEEPLINK_CHOICE",Rz="proposal",GE="Proposal expired",Dz="session",Wa=z.SEVEN_DAYS,Uz="engine",er={wc_sessionPropose:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1119}}},Pg={min:z.FIVE_MINUTES,max:z.SEVEN_DAYS},bs={idle:"IDLE",active:"ACTIVE"},Bz={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},Lz="request",Mz=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],jz="wc",Fz="auth",qz="authKeys",zz="pairingTopics",Hz="requests",ip=`${jz}@${1.5}:${Fz}:`,bd=`${ip}:PUB_KEY`;var Vz=Object.defineProperty,Wz=Object.defineProperties,Kz=Object.getOwnPropertyDescriptors,YE=Object.getOwnPropertySymbols,Gz=Object.prototype.hasOwnProperty,Yz=Object.prototype.propertyIsEnumerable,jy=(t,e,r)=>e in t?Vz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,je=(t,e)=>{for(var r in e||(e={}))Gz.call(e,r)&&jy(t,r,e[r]);if(YE)for(var r of YE(e))Yz.call(e,r)&&jy(t,r,e[r]);return t},tr=(t,e)=>Wz(t,Kz(e)),Y=(t,e,r)=>jy(t,typeof e!="symbol"?e+"":e,r);let Zz=class extends WP{constructor(e){super(e),Y(this,"name",Uz),Y(this,"events",new Hu),Y(this,"initialized",!1),Y(this,"requestQueue",{state:bs.idle,queue:[]}),Y(this,"sessionRequestQueue",{state:bs.idle,queue:[]}),Y(this,"emittedSessionRequests",new uB({limit:500})),Y(this,"requestQueueDelay",z.ONE_SECOND),Y(this,"expectedPairingMethodMap",new Map),Y(this,"recentlyDeletedMap",new Map),Y(this,"recentlyDeletedLimit",200),Y(this,"relayMessageCache",[]),Y(this,"pendingSessions",new Map),Y(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(er)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay)))}),Y(this,"connect",async r=>{var n;this.isInitialized(),await this.confirmOnlineStateOrThrow();const s=tr(je({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s),s.optionalNamespaces=EM(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:d}=s,p=((n=h?.[0])==null?void 0:n.ttl)||er.wc_sessionPropose.req.ttl||z.FIVE_MINUTES;this.validateRequestExpiry(p);let g=i,m,w=!1;try{if(g){const O=this.client.core.pairing.pairings.get(g);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),w=O.active}}catch(O){throw this.client.logger.error(`connect() -> pairing.get(${g}) failed`),O}if(!g||!w){const{topic:O,uri:M}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});g=O,m=M}if(!g){const{message:O}=re("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(O)}const I=await this.client.core.crypto.generateKeyPair(),S=Rt(p),v=je(tr(je(je({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:XA}],proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:S,pairingTopic:g},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Kt()}),(h||d)&&{requests:{authentication:h?.map(O=>{const{domain:M,chains:j,nonce:k,uri:$,exp:T,nbf:f,type:y,statement:E,requestId:x,resources:_,signatureTypes:A}=O;return{domain:M,chains:j,nonce:k,type:y??"caip122",aud:$,version:"1",iat:new Date().toISOString(),exp:T,nbf:f,statement:E,requestId:x,resources:_,signatureTypes:A}}),walletPay:d}}),b=Ve("session_connect",v.id),{reject:C,resolve:N,done:P}=Mo(p,GE),R=({id:O})=>{O===v.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(v.id),this.events.emit(b,{error:{message:GE,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(b,({error:O,session:M})=>{this.client.events.off("proposal_expire",R),O?C(O):M&&N(M)}),await this.setProposal(v.id,v),await this.sendProposeSession({proposal:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:v.id}}}).catch(O=>{throw this.deleteProposal(v.id),O}),{uri:m,approval:P}}),Y(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),Y(this,"approve",async r=>{var n,s,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r?.id)==null?void 0:n.toString(),trace:[Jn.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(M){throw o.setError(To.no_internet_connection),M}try{await this.isValidProposalId(r?.id)}catch(M){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(To.proposal_not_found),M}try{await this.isValidApprove(r)}catch(M){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(To.session_approve_namespace_validation_failure),M}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d,proposalRequestsResponses:p}=r,g=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:m,proposer:w,requiredNamespaces:I,optionalNamespaces:S}=g;let v=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:m});v||(v=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:Jn.session_approve_started,properties:{topic:m,trace:[Jn.session_approve_started,Jn.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),C=w.publicKey,N=await this.client.core.crypto.generateSharedKey(b,C),P=tr(je(je(je({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:Rt(Wa)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{proposalRequestsResponses:p}),R=rt.relay;v.addTrace(Jn.subscribing_session_topic);try{await this.client.core.relayer.subscribe(N,{transportType:R,internal:{skipSubscribe:!0}})}catch(M){throw v.setError(To.subscribe_session_topic_failure),M}v.addTrace(Jn.subscribe_session_topic_success);const O=tr(je({},P),{topic:N,requiredNamespaces:I,optionalNamespaces:S,pairingTopic:m,acknowledged:!1,self:P.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:b,transportType:rt.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(N,O),v.addTrace(Jn.store_session);try{await this.sendApproveSession({sessionTopic:N,proposal:g,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:P,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:je({correlationId:a},this.getTVFApproveParams(O))}}),v.addTrace(Jn.session_approve_publish_success)}catch(M){throw this.client.logger.error(M),this.client.session.delete(N,pt("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(N),M}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:w.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(N,Rt(Wa)),{topic:N,acknowledged:()=>Promise.resolve(this.client.session.get(N))}}),Y(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:s}=r;let i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:s,rpcOpts:er.wc_sessionPropose.reject}),await this.deleteProposal(n)}),Y(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:s}=r,{done:i,resolve:o,reject:a}=Mo(z.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Kt(),l=Nr().toString(),u=this.client.session.get(n).namespaces;return this.events.once(Ve("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:s}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:u}),a(h)}),{acknowledged:i}}),Y(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,s=Kt(),{done:i,resolve:o,reject:a}=Mo(z.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(Ve("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Rt(Wa)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),Y(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:n,request:s,topic:i,expiry:o=er.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(i);a?.transportType===rt.relay&&await this.confirmOnlineStateOrThrow();const c=Kt(),l=Nr().toString(),{done:u,resolve:h,reject:d}=Mo(o,"Request expired. Please try again.");this.events.once(Ve("session_request",c),({error:w,result:I})=>{w?d(w):h(I)});const p="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:p,params:{request:tr(je({},s),{expiryTimestamp:Rt(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),await u();const m={request:tr(je({},s),{expiryTimestamp:Rt(o)}),chainId:n};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:p,params:m,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,m)}).catch(I=>d(I)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),w()}),new Promise(async w=>{var I;if(!((I=a.sessionConfig)!=null&&I.disableDeepLink)){const S=await iB(this.client.core.storage,KE);await rB({id:c,topic:i,wcDeepLink:S})}w()}),u()]).then(w=>w[2])}),Y(this,"respond",async r=>{var n,s;this.isInitialized();const i=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((s=(n=r?.response)==null?void 0:n.id)==null?void 0:s.toString()),trace:[Jn.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw i.addTrace(h?.message),i.setError(To.session_request_response_validation_failure),h}i.addTrace(Jn.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,l=this.client.session.get(o);l.transportType===rt.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{i.addTrace(Jn.session_request_response_publish_started),Bt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):dt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(r)}catch(h){throw i.addTrace(h?.message),i.setError(To.session_request_response_publish_failure),h}}),Y(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:n}=r;if(this.client.session.keys.includes(n)){const s=Kt(),i=Nr().toString(),{done:o,resolve:a,reject:c}=Mo(z.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(Ve("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),Y(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:s,chainId:i}=r,o=Nr().toString(),a=Kt();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),Y(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:pt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:s}=re("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(s)}}),Y(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>SM(n,r)))),Y(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),Y(this,"authenticate",async(r,n)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=i?rt.link_mode:rt.relay;o===rt.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:p,nbf:g,methods:m=[],expiry:w}=r,I=[...r.resources||[]],{topic:S,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:S,uri:v}});const b=await this.client.core.crypto.generateKeyPair(),C=yd(b);if(await Promise.all([this.client.auth.authKeys.set(bd,{responseTopic:C,publicKey:b}),this.client.auth.pairingTopics.set(C,{topic:C,pairingTopic:S})]),await this.client.core.relayer.subscribe(C,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${S}`),m.length>0){const{namespace:_}=gd(a[0]);let A=IL(_,"request",m);md(I)&&(A=CL(A,I.pop())),I.push(A)}const N=w&&w>er.wc_sessionAuthenticate.req.ttl?w:er.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:g,resources:I},requester:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:Rt(N)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},O={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:S,proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:Rt(er.wc_sessionPropose.req.ttl),id:Kt()},{done:M,resolve:j,reject:k}=Mo(N,"Request expired"),$=Kt(),T=Ve("session_connect",O.id),f=Ve("session_request",$),y=async({error:_,session:A})=>{this.events.off(f,E),_?k(_):A&&j({session:A})},E=async _=>{var A,L,B;if(await this.deletePendingAuthRequest($,{message:"fulfilled",code:0}),_.error){const K=pt("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===K.code?void 0:(this.events.off(T,y),k(_.error.message))}await this.deleteProposal(O.id),this.events.off(T,y);const{cacaos:q,responder:D}=_.result,F=[],H=[];for(const K of q){await U1({cacao:K,projectId:this.client.core.projectId})||(this.client.logger.error(K,"Signature verification failed"),k(pt("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:G}=K,le=md(G.resources),ye=[py(G.iss)],ve=Jd(G.iss);if(le){const Ee=B1(le),Ke=L1(le);F.push(...Ee),ye.push(...Ke)}for(const Ee of ye)H.push(`${Ee}:${ve}`)}const W=await this.client.core.crypto.generateSharedKey(b,D.publicKey);let ee;F.length>0&&(ee={topic:W,acknowledged:!0,self:{publicKey:b,metadata:this.client.metadata},peer:D,controller:D.publicKey,expiry:Rt(Wa),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:S,namespaces:uE([...new Set(F)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(W,{transportType:o}),await this.client.session.set(W,ee),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:D.metadata}),ee=this.client.session.get(W)),(A=this.client.metadata.redirect)!=null&&A.linkMode&&(L=D.metadata.redirect)!=null&&L.linkMode&&(B=D.metadata.redirect)!=null&&B.universal&&n&&(this.client.core.addLinkModeSupportedApp(D.metadata.redirect.universal),this.client.session.update(W,{transportType:rt.link_mode})),j({auths:q,session:ee})};this.events.once(T,y),this.events.once(f,E);let x;try{if(i){const _=Nt("wc_sessionAuthenticate",P,$);this.client.core.history.set(S,_);const A=await this.client.core.crypto.encode("",_,{type:th,encoding:io});x=Rh(n,S,A)}else await Promise.all([this.sendRequest({topic:S,method:"wc_sessionAuthenticate",params:P,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:$}),this.sendRequest({topic:S,method:"wc_sessionPropose",params:O,expiry:er.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:O.id})])}catch(_){throw this.events.off(T,y),this.events.off(f,E),_}return await this.setProposal(O.id,O),await this.setAuthRequest($,{request:tr(je({},P),{verifyContext:{}}),pairingTopic:S,transportType:o}),{uri:x??v,response:M}}),Y(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:s}=r,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[ko.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw i.setError(ll.no_internet_connection),w}const o=this.getPendingAuthRequest(n);if(!o)throw i.setError(ll.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||rt.relay;a===rt.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=yd(c),h={type:Ei,receiverPublicKey:c,senderPublicKey:l},d=[],p=[];for(const w of s){if(!await U1({cacao:w,projectId:this.client.core.projectId})){i.setError(ll.invalid_cacao);const C=pt("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:u,error:C,encodeOpts:h}),new Error(C.message)}i.addTrace(ko.cacaos_verified);const{p:I}=w,S=md(I.resources),v=[py(I.iss)],b=Jd(I.iss);if(S){const C=B1(S),N=L1(S);d.push(...C),v.push(...N)}for(const C of v)p.push(`${C}:${b}`)}const g=await this.client.core.crypto.generateSharedKey(l,c);i.addTrace(ko.create_authenticated_session_topic);let m;if(d?.length>0){m={topic:g,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Rt(Wa),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:uE([...new Set(d)],[...new Set(p)]),transportType:a},i.addTrace(ko.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(w){throw i.setError(ll.subscribe_authenticated_session_topic_failure),w}i.addTrace(ko.subscribe_authenticated_session_topic_success),await this.client.session.set(g,m),i.addTrace(ko.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(ko.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:n,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw i.setError(ll.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:m}}),Y(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:s}=r,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===rt.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=yd(o),l={type:Ei,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:s,encodeOpts:l,rpcOpts:er.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),Y(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:s}=r;return tA(n,s)}),Y(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),Y(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),Y(this,"deleteSession",async r=>{var n;const{topic:s,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,pt("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(KE).catch(l=>this.client.logger.warn(l)),s===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=bs.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===s).map(l=>this.deletePendingSessionRequest(l.id,pt("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),Y(this,"deleteProposal",async(r,n)=>{if(n)try{const s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(To.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,pt("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),Y(this,"deletePendingSessionRequest",async(r,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==r),s&&(this.sessionRequestQueue.state=bs.idle,this.client.events.emit("session_request_expire",{id:r}))}),Y(this,"deletePendingAuthRequest",async(r,n,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)])}),Y(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),Y(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,Rt(er.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),Y(this,"setAuthRequest",async(r,n)=>{const{request:s,pairingTopic:i,transportType:o=rt.relay}=n;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:i,verifyContext:s.verifyContext,transportType:o})}),Y(this,"setPendingSessionRequest",async r=>{const{id:n,topic:s,params:i,verifyContext:o}=r,a=i.request.expiryTimestamp||Rt(er.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:s,params:i,verifyContext:o})}),Y(this,"sendRequest",async r=>{const{topic:n,method:s,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:d={}}=r,p=Nt(s,i,c);let g;const m=!!u;try{const S=m?io:Yr;g=await this.client.core.crypto.encode(n,p,{encoding:S})}catch(S){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),S}let w;if(Mz.includes(s)){const S=Fn(JSON.stringify(p)),v=Fn(g);w=await this.client.core.verify.register({id:v,decryptedId:S})}const I=je(je({},er[s].req),d);if(I.attestation=w,o&&(I.ttl=o),a&&(I.id=a),this.client.core.history.set(n,p),m){const S=Rh(u,n,g);await global.Linking.openURL(S,this.client.name)}else I.tvf=tr(je({},h),{correlationId:p.id}),l?(I.internal=tr(je({},I.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,g,I)):this.client.core.relayer.publish(n,g,I).catch(S=>this.client.logger.error(S));return p.id}),Y(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:s}=r,i=Nt("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);const o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:Yr}),a=Fn(JSON.stringify(i)),c=Fn(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:tr(je({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),Y(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:s,proposal:i,sessionSettleRequest:o,publishOpts:a}=r,c=xi(i.id,s),l=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Yr}),u=Nt("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(n,u,{encoding:Yr});this.client.core.history.set(n,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:tr(je({},a),{publishMethod:"wc_approveSession"})})}),Y(this,"sendResult",async r=>{const{id:n,topic:s,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=xi(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=h?io:Yr;u=await this.client.core.crypto.encode(s,l,tr(je({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),g}let d,p;try{d=await this.client.core.history.get(s,n);const g=d.request;try{p=this.getTVFParams(n,g.params,i)}catch(m){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${m?.message}`)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${n}) failed`),g}if(h){const g=Rh(c,s,u);await global.Linking.openURL(g,this.client.name)}else{const g=d.request.method,m=er[g].res;m.tvf=tr(je({},p),{correlationId:n}),o?(m.internal=tr(je({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,m)):this.client.core.relayer.publish(s,u,m).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),Y(this,"sendError",async r=>{const{id:n,topic:s,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Oa(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?io:Yr;u=await this.client.core.crypto.encode(s,l,tr(je({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),p}let d;try{d=await this.client.core.history.get(s,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),p}if(h){const p=Rh(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=a||er[p].res;this.client.core.relayer.publish(s,u,g)}await this.client.core.history.resolve(l)}),Y(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(s=>{let i=!1;Zi(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Zi(s.expiryTimestamp)&&n.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...n.map(s=>this.deleteProposal(s))])}),Y(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),Y(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),Y(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===bs.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=bs.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=bs.idle}),Y(this,"processRequest",async r=>{const{topic:n,payload:s,attestation:i,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:s,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,s);case"wc_sessionPing":return await this.onSessionPingRequest(n,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),Y(this,"onRelayEventResponse",async r=>{const{topic:n,payload:s,transportType:i}=r,o=(await this.client.core.history.get(n,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),Y(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:s}=re("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),Y(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:s}=r,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(s)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),Y(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:s,attestation:i,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Qs.proposal_listener_not_found)),this.isValidConnect(je({},s.params));const u=a.expiryTimestamp||Rt(er.wc_sessionPropose.req.ttl),h=je({id:c,pairingTopic:n,expiryTimestamp:u,attestation:i,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:i,hash:Fn(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(Ss.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:er.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),Y(this,"onSessionProposeResponse",async(r,n,s)=>{const{id:i}=n;if(Bt(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:u,pairingTopic:r,proposalId:i,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(dt(n)){await this.deleteProposal(i);const o=Ve("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),Y(this,"onSessionSettleRequest",async(r,n)=>{const{id:s,params:i}=n;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d,proposalRequestsResponses:p}=n.params,g=[...this.pendingSessions.values()].find(I=>I.sessionTopic===r);if(!g)return this.client.logger.error(`Pending session not found for topic ${r}`);const m=this.client.proposal.get(g.proposalId),w=tr(je(je(je({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:g.pairingTopic,requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces,controller:a.publicKey,self:{publicKey:g.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:rt.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:g.pairingTopic,metadata:w.peer.metadata}),this.pendingSessions.delete(g.proposalId),this.deleteProposal(g.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:n.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:w}),this.events.emit(Ve("session_connect",g.proposalId),{session:w})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),Y(this,"onSessionSettleResponse",async(r,n)=>{const{id:s}=n;Bt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ve("session_approve",s),{})):dt(n)&&(await this.client.session.delete(r,pt("USER_DISCONNECTED")),this.events.emit(Ve("session_approve",s),{error:n.error}))}),Y(this,"onSessionUpdateRequest",async(r,n)=>{const{params:s,id:i}=n;try{const o=`${r}_session_update`,a=al.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:r,error:pt("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(je({topic:r},s));try{al.set(o,i),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:r,result:!0})}catch(c){throw al.delete(o),c}this.client.events.emit("session_update",{id:i,topic:r,params:s})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),Y(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),Y(this,"onSessionUpdateResponse",(r,n)=>{const{id:s}=n,i=Ve("session_update",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bt(n)?this.events.emit(Ve("session_update",s),{}):dt(n)&&this.events.emit(Ve("session_update",s),{error:n.error})}),Y(this,"onSessionExtendRequest",async(r,n)=>{const{id:s}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Rt(Wa)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),Y(this,"onSessionExtendResponse",(r,n)=>{const{id:s}=n,i=Ve("session_extend",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bt(n)?this.events.emit(Ve("session_extend",s),{}):dt(n)&&this.events.emit(Ve("session_extend",s),{error:n.error})}),Y(this,"onSessionPingRequest",async(r,n)=>{const{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),Y(this,"onSessionPingResponse",(r,n)=>{const{id:s}=n,i=Ve("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Bt(n)?this.events.emit(Ve("session_ping",s),{}):dt(n)&&this.events.emit(Ve("session_ping",s),{error:n.error})},500)}),Y(this,"onSessionDeleteRequest",async(r,n)=>{const{id:s}=n;try{await this.isValidDisconnect({topic:r,reason:n.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:pt("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:s})}catch(i){this.client.logger.error(i)}}),Y(this,"onSessionRequest",async r=>{var n,s,i;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:d}=a;try{await this.isValidRequest(je({topic:o},d));const p=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:Fn(JSON.stringify(Nt("wc_sessionRequest",d,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),m={id:h,topic:o,params:d,verifyContext:g};await this.setPendingSessionRequest(m),u===rt.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((s=p.peer.metadata.redirect)==null?void 0:s.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),Y(this,"onSessionRequestResponse",(r,n)=>{const{id:s}=n,i=Ve("session_request",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bt(n)?this.events.emit(Ve("session_request",s),{result:n.result}):dt(n)&&this.events.emit(Ve("session_request",s),{error:n.error})}),Y(this,"onSessionEventRequest",async(r,n)=>{const{id:s,params:i}=n;try{const o=`${r}_session_event_${i.event.name}`,a=al.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(je({topic:r},i)),this.client.events.emit("session_event",{id:s,topic:r,params:i}),al.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),Y(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:s}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Bt(n)?this.events.emit(Ve("session_request",s),{result:n.result}):dt(n)&&this.events.emit(Ve("session_request",s),{error:n.error})}),Y(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:s,payload:i,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=i.params,d=await this.getVerifyContext({attestationId:o,hash:Fn(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:s,id:i.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:p,pairingTopic:s,transportType:c}),c===rt.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(i.params.requester.metadata,c),p={type:Ei,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:l,encodeOpts:p,rpcOpts:er.wc_sessionAuthenticate.autoReject,appLink:d})}}),Y(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),Y(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=bs.idle,this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay))}),Y(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===r&&i.request.method==="wc_sessionRequest").forEach(i=>{this.events.emit(Ve("session_request",i.request.id),{error:n})})}),Y(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===bs.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),Y(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=bs.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),Y(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:Nt("wc_sessionPropose",tr(je({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),Y(this,"isValidConnect",async r=>{if(!Vr(r)){const{message:l}=re("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Gt(n)||await this.isValidPairingTopic(n),!UM(c)){const{message:l}=re("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(s&&!Gt(s)&&au(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(i&&!Gt(i)&&au(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),o&&!Gt(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Gt(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),Y(this,"validateNamespaces",(r,n)=>{const s=DM(r,"connect()",n);if(s)throw new Error(s.message)}),Y(this,"isValidApprove",async r=>{if(!Vr(r))throw new Error(re("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:s,relayProtocol:i,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=xg(s,"approve()");if(l)throw new Error(l.message);const u=fE(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!At(i,!0)){const{message:h}=re("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(o&&!Gt(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Gt(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),Y(this,"isValidReject",async r=>{if(!Vr(r)){const{message:i}=re("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(i)}const{id:n,reason:s}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!LM(s)){const{message:i}=re("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),Y(this,"isValidSessionSettleRequest",r=>{if(!Vr(r)){const{message:l}=re("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:n,controller:s,namespaces:i,expiry:o}=r;if(!jA(n)){const{message:l}=re("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=NM(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=xg(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Zi(o)){const{message:l}=re("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),Y(this,"isValidUpdate",async r=>{if(!Vr(r)){const{message:c}=re("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:s}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const i=this.client.session.get(n),o=xg(s,"update()");if(o)throw new Error(o.message);const a=fE(i.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),Y(this,"isValidExtend",async r=>{if(!Vr(r)){const{message:s}=re("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),Y(this,"isValidRequest",async r=>{if(!Vr(r)){const{message:c}=re("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:s,chainId:i,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!dE(a,i)){const{message:c}=re("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!MM(s)){const{message:c}=re("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!qM(a,i,s.method)){const{message:c}=re("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),Y(this,"isValidRespond",async r=>{var n;if(!Vr(r)){const{message:a}=re("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:s,response:i}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(n=r?.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!jM(i)){const{message:a}=re("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(a)}const o=this.client.pendingRequest.get(i.id);if(o.topic!==s){const{message:a}=re("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${o.topic}, received topic: ${s}`);throw new Error(a)}}),Y(this,"isValidPing",async r=>{if(!Vr(r)){const{message:s}=re("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),Y(this,"isValidEmit",async r=>{if(!Vr(r)){const{message:a}=re("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:s,chainId:i}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!dE(o,i)){const{message:a}=re("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!FM(s)){const{message:a}=re("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!zM(o,i,s.name)){const{message:a}=re("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),Y(this,"isValidDisconnect",async r=>{if(!Vr(r)){const{message:s}=re("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),Y(this,"isValidAuthenticate",r=>{const{chains:n,uri:s,domain:i,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!At(s,!1))throw new Error("uri is required parameter");if(!At(i,!1))throw new Error("domain is required parameter");if(!At(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>gd(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=gd(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),Y(this,"getVerifyContext",async r=>{const{attestationId:n,hash:s,encryptedId:i,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Ml,validation:"UNKNOWN",origin:o.url||""}};try{if(a===rt.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:s,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),Y(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((s,i)=>{if(s==null){const{message:o}=re("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[i]}`);throw new Error(o)}})}),Y(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),Y(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(o)}}}),Y(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:s}=re("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(s)}}),Y(this,"isLinkModeEnabled",(r,n)=>{var s,i,o,a,c,l,u,h,d;return!r||n!==rt.link_mode?!1:((i=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r?.redirect)==null?void 0:u.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((d=r?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),Y(this,"getAppLinkIfEnabled",(r,n)=>{var s;return this.isLinkModeEnabled(r,n)?(s=r?.redirect)==null?void 0:s.universal:void 0}),Y(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=S1(r,"topic")||"",s=decodeURIComponent(S1(r,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:rt.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:s,sessionExists:i})}),Y(this,"registerLinkModeListeners",async()=>{var r;if(w0()||So()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await n.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),Y(this,"getTVFApproveParams",r=>{try{const n=BA(r.namespaces),s=gM(r.namespaces),i=mM(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:n,approvedMethods:s,approvedEvents:i,sessionProperties:o,scopedProperties:a}}catch(n){return this.client.logger.warn(n,"Error getting TVF approve params"),{}}}),Y(this,"getTVFParams",(r,n,s)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),Y(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const s=r?.data||((n=r?.[0])==null?void 0:n.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),Y(this,"extractTxHashesFromResult",(r,n)=>{var s;try{if(!n)return[];const i=r.method,o=Bz[i];if(i==="sui_signTransaction")return[sL(n.transactionBytes)];if(i==="near_signTransaction")return[k1(n)];if(i==="near_signTransactions")return n.map(c=>k1(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(s=n.tx_json)==null?void 0:s.hash];if(i==="polkadot_signTransaction")return[a7({transaction:r.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return Oc(n)?n.map(c=>P1(c)):[P1(n)];if(i==="cosmos_signDirect")return[oL(n)];if(i==="wallet_sendCalls")return aL(n);if(typeof n=="string")return[n];const a=n[o.key];if(Oc(a))return i==="solana_signAllTransactions"?a.map(c=>nL(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn(i,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,s]of Object.entries(r))for(const i of s)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=re("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(xt.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:s,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(bd)?this.client.auth.authKeys.get(bd):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:i===rt.link_mode?io:Yr});Vc(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:i,encryptedId:Fn(n)})):xo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:i}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:i})),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${n}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Un.expired,async e=>{const{topic:r,id:n}=Lx(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,re("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,re("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Wo.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Wo.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!At(e,!1)){const{message:r}=re("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=re("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Zi(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=re("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!At(e,!1)){const{message:r}=re("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=re("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Zi(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=re("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=re("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(At(e,!1)){const{message:r}=re("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=re("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!BM(e)){const{message:r}=re("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=re("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Zi(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=re("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!WM(e,Pg)){const{message:r}=re("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Pg.min} and ${Pg.max}`);throw new Error(r)}}},Jz=class extends Ta{constructor(e,r){super(e,r,Rz,T0),this.core=e,this.logger=r}},Xz=class extends Ta{constructor(e,r){super(e,r,Dz,T0),this.core=e,this.logger=r}},Qz=class extends Ta{constructor(e,r){super(e,r,Lz,T0,n=>n.id),this.core=e,this.logger=r}},eH=class extends Ta{constructor(e,r){super(e,r,qz,ip,()=>bd),this.core=e,this.logger=r}},tH=class extends Ta{constructor(e,r){super(e,r,zz,ip),this.core=e,this.logger=r}},rH=class extends Ta{constructor(e,r){super(e,r,Hz,ip,n=>n.id),this.core=e,this.logger=r}};var nH=Object.defineProperty,sH=(t,e,r)=>e in t?nH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rg=(t,e,r)=>sH(t,typeof e!="symbol"?e+"":e,r);class iH{constructor(e,r){this.core=e,this.logger=r,Rg(this,"authKeys"),Rg(this,"pairingTopics"),Rg(this,"requests"),this.authKeys=new eH(this.core,this.logger),this.pairingTopics=new tH(this.core,this.logger),this.requests=new rH(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var oH=Object.defineProperty,aH=(t,e,r)=>e in t?oH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ae=(t,e,r)=>aH(t,typeof e!="symbol"?e+"":e,r);let cH=class m$ extends VP{constructor(e){super(e),Ae(this,"protocol",f$),Ae(this,"version",p$),Ae(this,"name",kg.name),Ae(this,"metadata"),Ae(this,"core"),Ae(this,"logger"),Ae(this,"events",new mt.EventEmitter),Ae(this,"engine"),Ae(this,"session"),Ae(this,"proposal"),Ae(this,"pendingRequest"),Ae(this,"auth"),Ae(this,"signConfig"),Ae(this,"on",(n,s)=>this.events.on(n,s)),Ae(this,"once",(n,s)=>this.events.once(n,s)),Ae(this,"off",(n,s)=>this.events.off(n,s)),Ae(this,"removeListener",(n,s)=>this.events.removeListener(n,s)),Ae(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),Ae(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"update",async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"request",async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"find",n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),Ae(this,"authenticate",async(n,s)=>{try{return await this.engine.authenticate(n,s)}catch(i){throw this.logger.error(i.message),i}}),Ae(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),Ae(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||kg.name,this.metadata=ZU(e?.metadata),this.signConfig=e?.signConfig;const r=FA({logger:e?.logger||kg.logger,name:this.name});this.logger=r,this.core=e?.core||new Pz(e),this.session=new Xz(this.core,this.logger),this.proposal=new Jz(this.core,this.logger),this.pendingRequest=new Qz(this.core,this.logger),this.engine=new Zz(this),this.auth=new iH(this.core,this.logger)}static async init(e){const r=new m$(e);return await r.initialize(),r}get context(){return sn(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const lH=cH,uH="modulepreload",hH=function(t){return"/portalx-lite-test/"+t},ZE={},sf=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){let c=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(r.map(l=>{if(l=hH(l),l in ZE)return;ZE[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":uH,u||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((p,g)=>{d.addEventListener("load",p),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};var JE={};const X={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",BASE_ACCOUNT:"baseAccount",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos",sui:"Sui",stacks:"Stacks"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],SOLANA_SPL_TOKEN_ADDRESSES:{SOL:"So11111111111111111111111111111111111111112"},HTTP_STATUS_CODES:{SERVER_ERROR:500,TOO_MANY_REQUESTS:429,SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof process<"u"&&typeof JE<"u"?JE.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",REMOTE_FEATURES_ALERTS:{MULTI_WALLET_NOT_ENABLED:{DEFAULT:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com."},CONNECTIONS_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnections hook."},CONNECTION_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnection hook."}}},IS_DEVELOPMENT:typeof process<"u"&&!1,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://localhost:*","http://127.0.0.1:*","https://127.0.0.1:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"]},y$={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return t?.filter(r=>r.chainNamespace===e)||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){if(!e)return;const r=t.find(s=>s.caipNetworkId===e);if(r)return r.name;const[n]=e.split(":");return X.CHAIN_NAME_MAP?.[n]||void 0}},w$=["eip155","solana","polkadot","bip122","cosmos","sui","stacks"];var dH=20,fH=1,va=1e6,XE=1e6,pH=-7,gH=21,mH=!1,nh="[big.js] ",ka=nh+"Invalid ",op=ka+"decimal places",yH=ka+"rounding mode",b$=nh+"Division by zero",We={},Ds=void 0,wH=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function v$(){function t(e){var r=this;if(!(r instanceof t))return e===Ds?v$():new t(e);if(e instanceof t)r.s=e.s,r.e=e.e,r.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(ka+"value");e=e===0&&1/e<0?"-0":String(e)}bH(r,e)}r.constructor=t}return t.prototype=We,t.DP=dH,t.RM=fH,t.NE=pH,t.PE=gH,t.strict=mH,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function bH(t,e){var r,n,s;if(!wH.test(e))throw Error(ka+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),s=e.length,n=0;n<s&&e.charAt(n)=="0";)++n;if(n==s)t.c=[t.e=0];else{for(;s>0&&e.charAt(--s)=="0";);for(t.e=r-n-1,t.c=[],r=0;n<=s;)t.c[r++]=+e.charAt(n++)}return t}function Pa(t,e,r,n){var s=t.c;if(r===Ds&&(r=t.constructor.RM),r!==0&&r!==1&&r!==2&&r!==3)throw Error(yH);if(e<1)n=r===3&&(n||!!s[0])||e===0&&(r===1&&s[0]>=5||r===2&&(s[0]>5||s[0]===5&&(n||s[1]!==Ds))),s.length=1,n?(t.e=t.e-e+1,s[0]=1):s[0]=t.e=0;else if(e<s.length){if(n=r===1&&s[e]>=5||r===2&&(s[e]>5||s[e]===5&&(n||s[e+1]!==Ds||s[e-1]&1))||r===3&&(n||!!s[0]),s.length=e,n){for(;++s[--e]>9;)if(s[e]=0,e===0){++t.e,s.unshift(1);break}}for(e=s.length;!s[--e];)s.pop()}return t}function Ra(t,e,r){var n=t.e,s=t.c.join(""),i=s.length;if(e)s=s.charAt(0)+(i>1?"."+s.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)s="0"+s;s="0."+s}else if(n>0)if(++n>i)for(n-=i;n--;)s+="0";else n<i&&(s=s.slice(0,n)+"."+s.slice(n));else i>1&&(s=s.charAt(0)+"."+s.slice(1));return t.s<0&&r?"-"+s:s}We.abs=function(){var t=new this.constructor(this);return t.s=1,t};We.cmp=function(t){var e,r=this,n=r.c,s=(t=new r.constructor(t)).c,i=r.s,o=t.s,a=r.e,c=t.e;if(!n[0]||!s[0])return n[0]?i:s[0]?-o:0;if(i!=o)return i;if(e=i<0,a!=c)return a>c^e?1:-1;for(o=(a=n.length)<(c=s.length)?a:c,i=-1;++i<o;)if(n[i]!=s[i])return n[i]>s[i]^e?1:-1;return a==c?0:a>c^e?1:-1};We.div=function(t){var e=this,r=e.constructor,n=e.c,s=(t=new r(t)).c,i=e.s==t.s?1:-1,o=r.DP;if(o!==~~o||o<0||o>va)throw Error(op);if(!s[0])throw Error(b$);if(!n[0])return t.s=i,t.c=[t.e=0],t;var a,c,l,u,h,d=s.slice(),p=a=s.length,g=n.length,m=n.slice(0,a),w=m.length,I=t,S=I.c=[],v=0,b=o+(I.e=e.e-t.e)+1;for(I.s=i,i=b<0?0:b,d.unshift(0);w++<a;)m.push(0);do{for(l=0;l<10;l++){if(a!=(w=m.length))u=a>w?1:-1;else for(h=-1,u=0;++h<a;)if(s[h]!=m[h]){u=s[h]>m[h]?1:-1;break}if(u<0){for(c=w==a?s:d;w;){if(m[--w]<c[w]){for(h=w;h&&!m[--h];)m[h]=9;--m[h],m[w]+=10}m[w]-=c[w]}for(;!m[0];)m.shift()}else break}S[v++]=u?l:++l,m[0]&&u?m[w]=n[p]||0:m=[n[p]]}while((p++<g||m[0]!==Ds)&&i--);return!S[0]&&v!=1&&(S.shift(),I.e--,b--),v>b&&Pa(I,b,r.RM,m[0]!==Ds),I};We.eq=function(t){return this.cmp(t)===0};We.gt=function(t){return this.cmp(t)>0};We.gte=function(t){return this.cmp(t)>-1};We.lt=function(t){return this.cmp(t)<0};We.lte=function(t){return this.cmp(t)<1};We.minus=We.sub=function(t){var e,r,n,s,i=this,o=i.constructor,a=i.s,c=(t=new o(t)).s;if(a!=c)return t.s=-c,i.plus(t);var l=i.c.slice(),u=i.e,h=t.c,d=t.e;if(!l[0]||!h[0])return h[0]?t.s=-c:l[0]?t=new o(i):t.s=1,t;if(a=u-d){for((s=a<0)?(a=-a,n=l):(d=u,n=h),n.reverse(),c=a;c--;)n.push(0);n.reverse()}else for(r=((s=l.length<h.length)?l:h).length,a=c=0;c<r;c++)if(l[c]!=h[c]){s=l[c]<h[c];break}if(s&&(n=l,l=h,h=n,t.s=-t.s),(c=(r=h.length)-(e=l.length))>0)for(;c--;)l[e++]=0;for(c=e;r>a;){if(l[--r]<h[r]){for(e=r;e&&!l[--e];)l[e]=9;--l[e],l[r]+=10}l[r]-=h[r]}for(;l[--c]===0;)l.pop();for(;l[0]===0;)l.shift(),--d;return l[0]||(t.s=1,l=[d=0]),t.c=l,t.e=d,t};We.mod=function(t){var e,r=this,n=r.constructor,s=r.s,i=(t=new n(t)).s;if(!t.c[0])throw Error(b$);return r.s=t.s=1,e=t.cmp(r)==1,r.s=s,t.s=i,e?new n(r):(s=n.DP,i=n.RM,n.DP=n.RM=0,r=r.div(t),n.DP=s,n.RM=i,this.minus(r.times(t)))};We.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};We.plus=We.add=function(t){var e,r,n,s=this,i=s.constructor;if(t=new i(t),s.s!=t.s)return t.s=-t.s,s.minus(t);var o=s.e,a=s.c,c=t.e,l=t.c;if(!a[0]||!l[0])return l[0]||(a[0]?t=new i(s):t.s=s.s),t;if(a=a.slice(),e=o-c){for(e>0?(c=o,n=l):(e=-e,n=a),n.reverse();e--;)n.push(0);n.reverse()}for(a.length-l.length<0&&(n=l,l=a,a=n),e=l.length,r=0;e;a[e]%=10)r=(a[--e]=a[e]+l[e]+r)/10|0;for(r&&(a.unshift(r),++c),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=c,t};We.pow=function(t){var e=this,r=new e.constructor("1"),n=r,s=t<0;if(t!==~~t||t<-XE||t>XE)throw Error(ka+"exponent");for(s&&(t=-t);t&1&&(n=n.times(e)),t>>=1,!!t;)e=e.times(e);return s?r.div(n):n};We.prec=function(t,e){if(t!==~~t||t<1||t>va)throw Error(ka+"precision");return Pa(new this.constructor(this),t,e)};We.round=function(t,e){if(t===Ds)t=0;else if(t!==~~t||t<-va||t>va)throw Error(op);return Pa(new this.constructor(this),t+this.e+1,e)};We.sqrt=function(){var t,e,r,n=this,s=n.constructor,i=n.s,o=n.e,a=new s("0.5");if(!n.c[0])return new s(n);if(i<0)throw Error(nh+"No square root");i=Math.sqrt(+Ra(n,!0,!0)),i===0||i===1/0?(e=n.c.join(""),e.length+o&1||(e+="0"),i=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),t=new s((i==1/0?"5e":(i=i.toExponential()).slice(0,i.indexOf("e")+1))+o)):t=new s(i+""),o=t.e+(s.DP+=4);do r=t,t=a.times(r.plus(n.div(r)));while(r.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return Pa(t,(s.DP-=4)+t.e+1,s.RM)};We.times=We.mul=function(t){var e,r=this,n=r.constructor,s=r.c,i=(t=new n(t)).c,o=s.length,a=i.length,c=r.e,l=t.e;if(t.s=r.s==t.s?1:-1,!s[0]||!i[0])return t.c=[t.e=0],t;for(t.e=c+l,o<a&&(e=s,s=i,i=e,l=o,o=a,a=l),e=new Array(l=o+a);l--;)e[l]=0;for(c=a;c--;){for(a=0,l=o+c;l>c;)a=e[l]+i[c]*s[l-c-1]+a,e[l--]=a%10,a=a/10|0;e[l]=a}for(a?++t.e:e.shift(),c=e.length;!e[--c];)e.pop();return t.c=e,t};We.toExponential=function(t,e){var r=this,n=r.c[0];if(t!==Ds){if(t!==~~t||t<0||t>va)throw Error(op);for(r=Pa(new r.constructor(r),++t,e);r.c.length<t;)r.c.push(0)}return Ra(r,!0,!!n)};We.toFixed=function(t,e){var r=this,n=r.c[0];if(t!==Ds){if(t!==~~t||t<0||t>va)throw Error(op);for(r=Pa(new r.constructor(r),t+r.e+1,e),t=t+r.e+1;r.c.length<t;)r.c.push(0)}return Ra(r,!1,!!n)};We[Symbol.for("nodejs.util.inspect.custom")]=We.toJSON=We.toString=function(){var t=this,e=t.constructor;return Ra(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};We.toNumber=function(){var t=+Ra(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(nh+"Imprecise conversion");return t};We.toPrecision=function(t,e){var r=this,n=r.constructor,s=r.c[0];if(t!==Ds){if(t!==~~t||t<1||t>va)throw Error(ka+"precision");for(r=Pa(new n(r),t,e);r.c.length<t;)r.c.push(0)}return Ra(r,t<=r.e||r.e<=n.NE||r.e>=n.PE,!!s)};We.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(nh+"valueOf disallowed");return Ra(t,t.e<=e.NE||t.e>=e.PE,!0)};var Li=v$();const vH={bigNumber(t){return t?new Li(t):new Li(0)},multiply(t,e){if(t===void 0||e===void 0)return new Li(0);const r=new Li(t),n=new Li(e);return r.times(n)},toFixed(t,e=2){return t===void 0||t===""?new Li(0).toFixed(e):new Li(t).toFixed(e)},formatNumberToLocalString(t,e=2){return t===void 0||t===""?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"})},parseLocalStringToNumber(t){if(t===void 0||t==="")return 0;const e=t.replace(/,/gu,"");return new Li(e).toNumber()}},EH=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],_H=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],IH=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],SH={getERC20Abi:t=>X.USDT_CONTRACT_ADDRESSES.includes(t)?IH:EH,getSwapAbi:()=>_H},or={validateCaipAddress(t){if(t.split(":")?.length!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[r,n,s]=e;if(!r||!n||!s)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:r,chainId:n,address:s}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[r,n]=e;if(!r||!n)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:r,chainId:n}}},fi={RPC_ERROR_CODE:{USER_REJECTED_REQUEST:4001,USER_REJECTED_METHODS:5002,USER_REJECTED:5e3},PROVIDER_RPC_ERROR_NAME:{PROVIDER_RPC:"ProviderRpcError",USER_REJECTED_REQUEST:"UserRejectedRequestError"},isRpcProviderError(t){try{if(typeof t=="object"&&t!==null){const e=t,r=typeof e.message=="string",n=typeof e.code=="number";return r&&n}return!1}catch{return!1}},isUserRejectedMessage(t){return t.toLowerCase().includes("user rejected")||t.toLowerCase().includes("user cancelled")||t.toLowerCase().includes("user canceled")},isUserRejectedRequestError(t){if(fi.isRpcProviderError(t)){const e=t.code===fi.RPC_ERROR_CODE.USER_REJECTED_REQUEST,r=t.code===fi.RPC_ERROR_CODE.USER_REJECTED_METHODS;return e||r||fi.isUserRejectedMessage(t.message)}return t instanceof Error?fi.isUserRejectedMessage(t.message):!1}};let CH=class extends Error{constructor(e,r){super(r.message,{cause:e}),this.name=fi.PROVIDER_RPC_ERROR_NAME.PROVIDER_RPC,this.code=r.code}},E$=class extends CH{constructor(e){super(e,{code:fi.RPC_ERROR_CODE.USER_REJECTED_REQUEST,message:"User rejected the request"}),this.name=fi.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST}};const pe={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",RECENT_WALLET:"@appkit/recent_wallet",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections",DISCONNECTED_CONNECTOR_IDS:"@appkit/disconnected_connector_ids",HISTORY_TRANSACTIONS_CACHE:"@appkit/history_transactions_cache",TOKEN_PRICE_CACHE:"@appkit/token_price_cache",RECENT_EMAILS:"@appkit/recent_emails",LATEST_APPKIT_VERSION:"@appkit/latest_version"};function Dg(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const he={setItem(t,e){Nl()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(Nl())return localStorage.getItem(t)||void 0},removeItem(t){Nl()&&localStorage.removeItem(t)},clear(){Nl()&&localStorage.clear()}};function Nl(){return typeof window<"u"&&typeof localStorage<"u"}function of(t,e){return e==="light"?{"--w3m-accent":t?.["--w3m-accent"]||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":t?.["--w3m-accent"]||"hsla(230, 100%, 67%, 1)","--w3m-background":"#202020"}}const xH=Symbol(),QE=Object.getPrototypeOf,Fy=new WeakMap,AH=t=>t&&(Fy.has(t)?Fy.get(t):QE(t)===Object.prototype||QE(t)===Array.prototype),$H=t=>AH(t)&&t[xH]||null,e_=(t,e=!0)=>{Fy.set(t,e)},af={},k0=t=>typeof t=="object"&&t!==null,NH=t=>k0(t)&&!sh.has(t)&&(Array.isArray(t)||!(Symbol.iterator in t))&&!(t instanceof WeakMap)&&!(t instanceof WeakSet)&&!(t instanceof Error)&&!(t instanceof Number)&&!(t instanceof Date)&&!(t instanceof String)&&!(t instanceof RegExp)&&!(t instanceof ArrayBuffer)&&!(t instanceof Promise),_$=(t,e)=>{const r=qy.get(t);if(r?.[0]===e)return r[1];const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));return e_(n,!0),qy.set(t,[e,n]),Reflect.ownKeys(t).forEach(s=>{if(Object.getOwnPropertyDescriptor(n,s))return;const i=Reflect.get(t,s),{enumerable:o}=Reflect.getOwnPropertyDescriptor(t,s),a={value:i,enumerable:o,configurable:!0};if(sh.has(i))e_(i,!1);else if(Eo.has(i)){const[c,l]=Eo.get(i);a.value=_$(c,l())}Object.defineProperty(n,s,a)}),Object.preventExtensions(n)},OH=(t,e,r,n)=>({deleteProperty(s,i){const o=Reflect.get(s,i);r(i);const a=Reflect.deleteProperty(s,i);return a&&n(["delete",[i],o]),a},set(s,i,o,a){const c=!t()&&Reflect.has(s,i),l=Reflect.get(s,i,a);if(c&&(t_(l,o)||lu.has(o)&&t_(l,lu.get(o))))return!0;r(i),k0(o)&&(o=$H(o)||o);const u=!Eo.has(o)&&kH(o)?it(o):o;return e(i,u),Reflect.set(s,i,u,a),n(["set",[i],o,l]),!0}}),Eo=new WeakMap,sh=new WeakSet,qy=new WeakMap,vd=[1],lu=new WeakMap;let t_=Object.is,TH=(t,e)=>new Proxy(t,e),kH=NH,PH=_$,RH=OH;function it(t={}){if(!k0(t))throw new Error("object required");const e=lu.get(t);if(e)return e;let r=vd[0];const n=new Set,s=(w,I=++vd[0])=>{r!==I&&(i=r=I,n.forEach(S=>S(w,I)))};let i=r;const o=(w=vd[0])=>(i!==w&&(i=w,c.forEach(([I])=>{const S=I[1](w);S>r&&(r=S)})),r),a=w=>(I,S)=>{const v=[...I];v[1]=[w,...v[1]],s(v,S)},c=new Map,l=(w,I)=>{const S=!sh.has(I)&&Eo.get(I);if(S){if((af?"production":void 0)!=="production"&&c.has(w))throw new Error("prop listener already exists");if(n.size){const v=S[2](a(w));c.set(w,[S,v])}else c.set(w,[S])}},u=w=>{var I;const S=c.get(w);S&&(c.delete(w),(I=S[1])==null||I.call(S))},h=w=>(n.add(w),n.size===1&&c.forEach(([S,v],b)=>{if((af?"production":void 0)!=="production"&&v)throw new Error("remove already exists");const C=S[2](a(b));c.set(b,[S,C])}),()=>{n.delete(w),n.size===0&&c.forEach(([S,v],b)=>{v&&(v(),c.set(b,[S]))})});let d=!0;const p=RH(()=>d,l,u,s),g=TH(t,p);lu.set(t,g);const m=[t,o,h];return Eo.set(g,m),Reflect.ownKeys(t).forEach(w=>{const I=Object.getOwnPropertyDescriptor(t,w);"value"in I&&I.writable&&(g[w]=t[w])}),d=!1,g}function cr(t,e,r){const n=Eo.get(t);(af?"production":void 0)!=="production"&&!n&&console.warn("Please use proxy object");let s;const i=[],o=n[2];let a=!1;const l=o(u=>{i.push(u),s||(s=Promise.resolve().then(()=>{s=void 0,a&&e(i.splice(0))}))});return a=!0,()=>{a=!1,l()}}function uu(t){const e=Eo.get(t);(af?"production":void 0)!=="production"&&!e&&console.warn("Please use proxy object");const[r,n]=e;return PH(r,n())}function hu(t){return sh.add(t),t}function DH(){return{proxyStateMap:Eo,refSet:sh,snapCache:qy,versionHolder:vd,proxyCache:lu}}function lr(t,e,r,n){let s=t[e];return cr(t,()=>{const i=t[e];Object.is(s,i)||r(s=i)})}const{proxyStateMap:UH,snapCache:BH}=DH(),Dh=t=>UH.has(t);function LH(t){const e=[];let r=0;const n=new Map,s=new WeakMap,i=()=>{const l=BH.get(a),u=l?.[1];if(u&&!s.has(u)){const h=new Map(n);s.set(u,h)}},o=l=>s.get(l)||n,a={data:e,index:r,epoch:0,get size(){return Dh(this)||i(),o(this).size},get(l){const h=o(this).get(l);if(h===void 0){this.epoch;return}return this.data[h]},has(l){const u=o(this);return this.epoch,u.has(l)},set(l,u){if(!Dh(this))throw new Error("Cannot perform mutations on a snapshot");const h=n.get(l);return h===void 0?(n.set(l,this.index),this.data[this.index++]=u):this.data[h]=u,this.epoch++,this},delete(l){if(!Dh(this))throw new Error("Cannot perform mutations on a snapshot");const u=n.get(l);return u===void 0?!1:(delete this.data[u],n.delete(l),this.epoch++,!0)},clear(){if(!Dh(this))throw new Error("Cannot perform mutations on a snapshot");this.data.length=0,this.index=0,this.epoch++,n.clear()},forEach(l){this.epoch,o(this).forEach((h,d)=>{l(this.data[h],d,this)})},*entries(){this.epoch;const l=o(this);for(const[u,h]of l)yield[u,this.data[h]]},*keys(){this.epoch;const l=o(this);for(const u of l.keys())yield u},*values(){this.epoch;const l=o(this);for(const u of l.values())yield this.data[u]},[Symbol.iterator](){return this.entries()},get[Symbol.toStringTag](){return"Map"},toJSON(){return new Map(this.entries())}},c=it(a);return Object.defineProperties(c,{size:{enumerable:!1},index:{enumerable:!1},epoch:{enumerable:!1},data:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(c),c}var r_={};const Ug=(typeof process<"u"&&typeof r_<"u"?r_.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",I$=[{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],MH="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",Te={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:Ug,SECURE_SITE_DASHBOARD:`${Ug}/dashboard`,SECURE_SITE_FAVICON:`${Ug}/images/favicon.png`,SOLANA_NATIVE_TOKEN_ADDRESS:"So11111111111111111111111111111111111111111",RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],SUGGESTED_TOKENS_BY_CHAIN:{"eip155:42161":["USD0"]},BALANCE_SUPPORTED_CHAINS:[X.CHAIN.EVM,X.CHAIN.SOLANA],SEND_PARAMS_SUPPORTED_CHAINS:[X.CHAIN.EVM],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:[X.CHAIN.EVM],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:[X.CHAIN.EVM,X.CHAIN.SOLANA],PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES:[X.CHAIN.EVM,X.CHAIN.SOLANA],ACTIVITY_ENABLED_CHAIN_NAMESPACES:[X.CHAIN.EVM],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x",sui:"0x",stacks:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app",WEB:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:[X.CHAIN.EVM,X.CHAIN.SOLANA],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0,multiWallet:!1,emailCapture:!1,payWithExchange:!1,payments:!1,reownAuthentication:!1},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1,emailCapture:!1,reownAuthentication:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1,reownAuthentication:!1},DEFAULT_SOCIALS:["google","x","farcaster","discord","apple","github","facebook"],DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"},SIWX_DEFAULTS:{signOutOnDisconnect:!0}},J={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5,transactionsHistory:15e3,tokenPrice:15e3,latestAppKitVersion:6048e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=J.getActiveNamespace(),e=J.getActiveCaipNetworkId(),r=e?e.split(":")[1]:void 0,n=r?isNaN(Number(r))?r:Number(r):void 0;return{namespace:t,caipNetworkId:e,chainId:n}},setWalletConnectDeepLink({name:t,href:e}){try{he.setItem(pe.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=he.getItem(pe.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{he.removeItem(pe.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{he.setItem(pe.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{he.setItem(pe.ACTIVE_CAIP_NETWORK_ID,t),J.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return he.getItem(pe.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{he.removeItem(pe.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=Dg(t);he.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=J.getRecentWallets();e.find(n=>n.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),he.setItem(pe.RECENT_WALLETS,JSON.stringify(e)),he.setItem(pe.RECENT_WALLET,JSON.stringify(t)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=he.getItem(pe.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},getRecentWallet(){try{const t=he.getItem(pe.RECENT_WALLET);return t?JSON.parse(t):null}catch{console.info("Unable to get AppKit recent")}return null},deleteRecentWallet(){try{he.removeItem(pe.RECENT_WALLET)}catch{console.info("Unable to delete AppKit recent")}},setConnectedConnectorId(t,e){try{const r=Dg(t);he.setItem(r,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return he.getItem(pe.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=Dg(t);return he.getItem(e)}catch{console.info("Unable to get connected connector id in namespace",t)}},setConnectedSocialProvider(t){try{he.setItem(pe.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return he.getItem(pe.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{he.removeItem(pe.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return he.getItem(pe.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){return he.getItem(pe.ACTIVE_CAIP_NETWORK_ID)?.split(":")?.[1]},setConnectionStatus(t){try{he.setItem(pe.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return he.getItem(pe.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=he.getItem(pe.CONNECTED_NAMESPACES);return t?.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));he.setItem(pe.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=J.getConnectedNamespaces();e.includes(t)||(e.push(t),J.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=J.getConnectedNamespaces(),r=e.indexOf(t);r>-1&&(e.splice(r,1),J.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return he.getItem(pe.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{he.setItem(pe.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{he.removeItem(pe.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=he.getItem(pe.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=J.getBalanceCache();he.setItem(pe.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const r=J.getBalanceCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.portfolio))return r.balance;J.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=J.getBalanceCache();e[t.caipAddress]=t,he.setItem(pe.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=he.getItem(pe.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=J.getBalanceCache();he.setItem(pe.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const r=J.getNativeBalanceCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.nativeBalance))return r;console.info("Discarding cache for address",t),J.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=J.getNativeBalanceCache();e[t.caipAddress]=t,he.setItem(pe.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=he.getItem(pe.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const r=J.getEnsCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.ens))return r.ens;J.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=J.getEnsCache();e[t.address]=t,he.setItem(pe.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=J.getEnsCache();he.setItem(pe.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=he.getItem(pe.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const r=J.getIdentityCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.identity))return r.identity;J.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=J.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},he.setItem(pe.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=J.getIdentityCache();he.setItem(pe.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},clearAddressCache(){try{he.removeItem(pe.PORTFOLIO_CACHE),he.removeItem(pe.NATIVE_BALANCE_CACHE),he.removeItem(pe.ENS_CACHE),he.removeItem(pe.IDENTITY_CACHE),he.removeItem(pe.HISTORY_TRANSACTIONS_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{he.setItem(pe.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=he.getItem(pe.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){try{const r=J.getConnections(),n=r[e]??[],s=new Map;for(const o of n)s.set(o.connectorId,{...o});for(const o of t){const a=s.get(o.connectorId),c=o.connectorId===X.CONNECTOR_ID.AUTH;if(a&&!c){const l=new Set(a.accounts.map(h=>h.address.toLowerCase())),u=o.accounts.filter(h=>!l.has(h.address.toLowerCase()));a.accounts.push(...u)}else s.set(o.connectorId,{...o})}const i={...r,[e]:Array.from(s.values())};he.setItem(pe.CONNECTIONS,JSON.stringify(i))}catch(r){console.error("Unable to sync connections to storage",r)}},getConnections(){try{const t=he.getItem(pe.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}},deleteAddressFromConnection({connectorId:t,address:e,namespace:r}){try{const n=J.getConnections(),s=n[r]??[],i=new Map(s.map(a=>[a.connectorId,a])),o=i.get(t);o&&(o.accounts.filter(c=>c.address.toLowerCase()!==e.toLowerCase()).length===0?i.delete(t):i.set(t,{...o,accounts:o.accounts.filter(c=>c.address.toLowerCase()!==e.toLowerCase())})),he.setItem(pe.CONNECTIONS,JSON.stringify({...n,[r]:Array.from(i.values())}))}catch{console.error(`Unable to remove address "${e}" from connector "${t}" in namespace "${r}"`)}},getDisconnectedConnectorIds(){try{const t=he.getItem(pe.DISCONNECTED_CONNECTOR_IDS);return t?JSON.parse(t):{}}catch{console.info("Unable to get disconnected connector ids")}return{}},addDisconnectedConnectorId(t,e){try{const r=J.getDisconnectedConnectorIds(),n=r[e]??[];n.push(t),he.setItem(pe.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...r,[e]:Array.from(new Set(n))}))}catch{console.error(`Unable to set disconnected connector id "${t}" for namespace "${e}"`)}},removeDisconnectedConnectorId(t,e){try{const r=J.getDisconnectedConnectorIds();let n=r[e]??[];n=n.filter(s=>s.toLowerCase()!==t.toLowerCase()),he.setItem(pe.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...r,[e]:Array.from(new Set(n))}))}catch{console.error(`Unable to remove disconnected connector id "${t}" for namespace "${e}"`)}},isConnectorDisconnected(t,e){try{return(J.getDisconnectedConnectorIds()[e]??[]).some(s=>s.toLowerCase()===t.toLowerCase())}catch{console.info(`Unable to get disconnected connector id "${t}" for namespace "${e}"`)}return!1},getTransactionsCache(){try{const t=he.getItem(pe.HISTORY_TRANSACTIONS_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get transactions cache")}return{}},getTransactionsCacheForAddress({address:t,chainId:e=""}){try{const n=J.getTransactionsCache()[t]?.[e];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.transactionsHistory))return n.transactions;J.removeTransactionsCache({address:t,chainId:e})}catch{console.info("Unable to get transactions cache")}},updateTransactionsCache({address:t,chainId:e="",timestamp:r,transactions:n}){try{const s=J.getTransactionsCache();s[t]={...s[t],[e]:{timestamp:r,transactions:n}},he.setItem(pe.HISTORY_TRANSACTIONS_CACHE,JSON.stringify(s))}catch{console.info("Unable to update transactions cache",{address:t,chainId:e,timestamp:r,transactions:n})}},removeTransactionsCache({address:t,chainId:e}){try{const r=J.getTransactionsCache(),n=r?.[t]||{},{[e]:s,...i}=n;he.setItem(pe.HISTORY_TRANSACTIONS_CACHE,JSON.stringify({...r,[t]:i}))}catch{console.info("Unable to remove transactions cache",{address:t,chainId:e})}},getTokenPriceCache(){try{const t=he.getItem(pe.TOKEN_PRICE_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get token price cache")}return{}},getTokenPriceCacheForAddresses(t){try{const r=J.getTokenPriceCache()[t.join(",")];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.tokenPrice))return r.tokenPrice;J.removeTokenPriceCache(t)}catch{console.info("Unable to get token price cache for addresses",t)}},updateTokenPriceCache(t){try{const e=J.getTokenPriceCache();e[t.addresses.join(",")]={timestamp:t.timestamp,tokenPrice:t.tokenPrice},he.setItem(pe.TOKEN_PRICE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update token price cache",t)}},removeTokenPriceCache(t){try{const e=J.getTokenPriceCache();he.setItem(pe.TOKEN_PRICE_CACHE,JSON.stringify({...e,[t.join(",")]:void 0}))}catch{console.info("Unable to remove token price cache",t)}},getLatestAppKitVersion(){try{const t=this.getLatestAppKitVersionCache(),e=t?.version;return e&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.latestAppKitVersion)?e:void 0}catch{console.info("Unable to get latest AppKit version")}},getLatestAppKitVersionCache(){try{const t=he.getItem(pe.LATEST_APPKIT_VERSION);return t?JSON.parse(t):{}}catch{console.info("Unable to get latest AppKit version cache")}return{}},updateLatestAppKitVersion(t){try{const e=J.getLatestAppKitVersionCache();e.timestamp=t.timestamp,e.version=t.version,he.setItem(pe.LATEST_APPKIT_VERSION,JSON.stringify(e))}catch{console.info("Unable to update latest AppKit version on local storage",t)}}},ue={isMobile(){return this.isClient()?!!(window?.matchMedia&&typeof window.matchMedia=="function"&&window.matchMedia("(pointer:coarse)")?.matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t?.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window?.navigator.userAgent.toLowerCase();return ue.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window?.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window?.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=Te.TEN_SEC_MS:!0},isAllowedRetry(t,e=Te.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return window?.self!==window?.top}catch{return!1}},isSafeApp(){if(ue.isClient()&&window.self!==window.top)try{const t=window?.location?.ancestorOrigins?.[0],e="https://app.safe.global";if(t){const r=new URL(t),n=new URL(e);return r.hostname===n.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+Te.FOUR_MINUTES_MS},getNetworkId(t){return t?.split(":")[1]},getPlainAddress(t){return t?.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let r;return(...n)=>{function s(){t(...n)}r&&clearTimeout(r),r=setTimeout(s,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,r=null){if(ue.isHttpUrl(t))return this.formatUniversalUrl(t,e);let n=t,s=r;n.includes("://")||(n=t.replaceAll("/","").replaceAll(":",""),n=`${n}://`),n.endsWith("/")||(n=`${n}/`),s&&!s?.endsWith("/")&&(s=`${s}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const i=encodeURIComponent(e);return{redirect:`${n}wc?uri=${i}`,redirectUniversalLink:s?`${s}wc?uri=${i}`:void 0,href:n}},formatUniversalUrl(t,e){if(!ue.isHttpUrl(t))return this.formatNativeUrl(t,e);let r=t;r.endsWith("/")||(r=`${r}/`);const n=encodeURIComponent(e);return{redirect:`${r}wc?uri=${n}`,href:r}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?J.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,r){window?.open(t,this.getOpenTargetForPlatform(e),r||"noreferrer noopener")},returnOpenHref(t,e,r){return window?.open(t,this.getOpenTargetForPlatform(e),r||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){if(typeof window>"u")return!1;const t=window?.matchMedia&&typeof window.matchMedia=="function"?window.matchMedia("(display-mode: standalone)")?.matches:!1,e=window?.navigator?.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((r,n)=>{const s=new Image;s.onload=r,s.onerror=n,s.crossOrigin="anonymous",s.src=t});return Promise.race([e,ue.wait(2e3)])},parseBalance(t,e){let r="0.000";if(typeof t=="string"){const c=Number(t);if(!isNaN(c)){const l=(Math.floor(c*1e3)/1e3).toFixed(3);l&&(r=l)}}const[n,s]=r.split("."),i=n||"0",o=s||"000";return{formattedText:`${i}.${o}${e?` ${e}`:""}`,value:i,decimals:o,symbol:e}},getApiUrl(){return X.W3M_API_URL},getBlockchainApiUrl(){return X.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return X.PULSE_API_URL},getUUID(){return crypto?.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){return typeof t=="string"?t:typeof t?.issues?.[0]?.message=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const r={};return e&&t&&(t.forEach((n,s)=>{r[n]=s}),e.sort((n,s)=>{const i=r[n.id],o=r[s.id];return i!==void 0&&o!==void 0?i-o:i!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const r of t)e+=r.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[r,n]=e.split(".");return{dollars:r,pennies:n}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);default:return!1}},uniqueBy(t,e){const r=new Set;return t.filter(n=>{const s=n[e];return r.has(s)?!1:(r.add(s),!0)})},generateSdkVersion(t,e,r){const s=t.length===0?Te.ADAPTER_TYPES.UNIVERSAL:t.map(i=>i.adapterType).join(",");return`${e}-${s}-${r}`},createAccount(t,e,r,n,s){return{namespace:t,address:e,type:r,publicKey:n,path:s}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),r=e[0];return e.filter(Boolean).length===3&&r in X.CHAIN_NAME_MAP},getAccount(t){return t?typeof t=="string"?{address:t,chainId:void 0}:{address:t.address,chainId:t.chainId}:{address:void 0,chainId:void 0}},isMac(){const t=window?.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window?.location.href)}`,r="state=";if(new URL(t).host==="auth.magic.link"){const s="provider_authorization_url=",i=t.substring(t.indexOf(s)+s.length),o=this.injectIntoUrl(decodeURIComponent(i),r,e);return t.replace(i,encodeURIComponent(o))}return this.injectIntoUrl(t,r,e)},injectIntoUrl(t,e,r){const n=t.indexOf(e);if(n===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const s=t.indexOf("&",n),i=e.length,o=s!==-1?s:t.length,a=t.substring(0,n+i),c=t.substring(n+i,o),l=t.substring(s),u=c+r;return a+u+l}},Ed={STORAGE_KEY:"@appkit-wallet/",SMART_ACCOUNT_ENABLED_NETWORKS:"SMART_ACCOUNT_ENABLED_NETWORKS"},pi={SAFE_RPC_METHODS:["eth_accounts","eth_blockNumber","eth_call","eth_chainId","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getAccount","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockReceipts","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_maxPriorityFeePerGas","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_sendRawTransaction","eth_syncing","eth_uninstallFilter","wallet_getCapabilities","wallet_getCallsStatus","eth_getUserOperationReceipt","eth_estimateUserOperationGas","eth_getUserOperationByHash","eth_supportedEntryPoints","wallet_getAssets"],NOT_SAFE_RPC_METHODS:["personal_sign","eth_signTypedData_v4","eth_sendTransaction","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction","wallet_sendCalls","wallet_grantPermissions","wallet_revokePermissions","eth_sendUserOperation"],GET_CHAIN_ID:"eth_chainId",RPC_METHOD_NOT_ALLOWED_MESSAGE:"Requested RPC call is not allowed",RPC_METHOD_NOT_ALLOWED_UI_MESSAGE:"Action not allowed",ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},jH={set(t,e){Bg.isClient&&localStorage.setItem(`${Ed.STORAGE_KEY}${t}`,e)},get(t){return Bg.isClient?localStorage.getItem(`${Ed.STORAGE_KEY}${t}`):null},delete(t,e){Bg.isClient&&(e?localStorage.removeItem(t):localStorage.removeItem(`${Ed.STORAGE_KEY}${t}`))}},Bg={isClient:typeof window<"u"};function FH(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function n_(t){return FH(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const S$="2.40.0";let Lg={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${S$}`},ot=class zy extends Error{constructor(e,r={}){const n=r.cause instanceof zy?r.cause.details:r.cause?.message?r.cause.message:r.details,s=r.cause instanceof zy&&r.cause.docsPath||r.docsPath,i=Lg.getDocsUrl?.({...r,docsPath:s}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...n?[`Details: ${n}`]:[],...Lg.version?[`Version: ${Lg.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=S$}walk(e){return C$(this,e)}};function C$(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?C$(t.cause,e):e?null:t}let Lce=class extends ot{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset "${e}" is out-of-bounds (size: ${n}).`,{name:"SliceOffsetOutOfBoundsError"})}},x$=class extends ot{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}};class Fce extends ot{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} is expected to be ${r} ${n} long, but is ${e} ${n} long.`,{name:"InvalidBytesLengthError"})}}function P0(t,{dir:e,size:r=32}={}){return typeof t=="string"?qH(t,{dir:e,size:r}):zH(t,{dir:e,size:r})}function qH(t,{dir:e,size:r=32}={}){if(r===null)return t;const n=t.replace("0x","");if(n.length>r*2)throw new x$({size:Math.ceil(n.length/2),targetSize:r,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function zH(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new x$({size:t.length,targetSize:r,type:"bytes"});const n=new Uint8Array(r);for(let s=0;s<r;s++){const i=e==="right";n[i?s:r-s-1]=t[i?s:t.length-s-1]}return n}let HH=class extends ot{constructor({max:e,min:r,signed:n,size:s,value:i}){super(`Number "${i}" is not in safe ${s?`${s*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}};class zce extends ot{constructor(e){super(`Bytes value "${e}" is not a valid boolean. The bytes array must contain a single byte of either a 0 or 1 value.`,{name:"InvalidBytesBooleanError"})}}class VH extends ot{constructor(e){super(`Hex value "${e}" is not a valid boolean. The hex value must be "0x0" (false) or "0x1" (true).`,{name:"InvalidHexBooleanError"})}}let WH=class extends ot{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}};function Mg(t,{dir:e="left"}={}){let r=typeof t=="string"?t.replace("0x",""):t,n=0;for(let s=0;s<r.length-1&&r[e==="left"?s:r.length-s-1].toString()==="0";s++)n++;return r=e==="left"?r.slice(n):r.slice(0,r.length-n),typeof t=="string"?(r.length===1&&e==="right"&&(r=`${r}0`),`0x${r.length%2===1?`0${r}`:r}`):r}function ap(t,{size:e}){if(n_(t)>e)throw new WH({givenSize:n_(t),maxSize:e})}function KH(t,e={}){const{signed:r}=e;e.size&&ap(t,{size:e.size});const n=BigInt(t);if(!r)return n;const s=(t.length-2)/2,i=(1n<<BigInt(s)*8n-1n)-1n;return n<=i?n:n-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Vce(t,e={}){let r=t;if(e.size&&(ap(r,{size:e.size}),r=Mg(r)),Mg(r)==="0x00")return!1;if(Mg(r)==="0x01")return!0;throw new VH(r)}function Wce(t,e={}){return Number(KH(t,e))}const GH=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function s_(t,e={}){return typeof t=="number"||typeof t=="bigint"?ZH(t,e):typeof t=="string"?$$(t,e):typeof t=="boolean"?YH(t,e):A$(t,e)}function YH(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(ap(r,{size:e.size}),P0(r,{size:e.size})):r}function A$(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=GH[t[s]];const n=`0x${r}`;return typeof e.size=="number"?(ap(n,{size:e.size}),P0(n,{dir:"right",size:e.size})):n}function ZH(t,e={}){const{signed:r,size:n}=e,s=BigInt(t);let i;n?r?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&r?-i-1n:0;if(i&&s>i||s<o){const c=typeof t=="bigint"?"n":"";throw new HH({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:r,size:n,value:`${t}${c}`})}const a=`0x${(r&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?P0(a,{size:n}):a}const JH=new TextEncoder;function $$(t,e={}){const r=JH.encode(t);return A$(r,e)}let XH=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}};const da=(t,e,r)=>JSON.stringify(t,(n,s)=>typeof s=="bigint"?s.toString():s,r),Gce={gwei:9,wei:18},QH={ether:-9,wei:9};function R0(t,e){let r=t.toString();const n=r.startsWith("-");n&&(r=r.slice(1)),r=r.padStart(e,"0");let[s,i]=[r.slice(0,r.length-e),r.slice(r.length-e)];return i=i.replace(/(0+)$/,""),`${n?"-":""}${s||"0"}${i?`.${i}`:""}`}function cf(t,e="wei"){return R0(t,QH[e])}const Yce=t=>t,D0=t=>t;class Fl extends ot{constructor({body:e,cause:r,details:n,headers:s,status:i,url:o}){super("HTTP request failed.",{cause:r,details:n,metaMessages:[i&&`Status: ${i}`,`URL: ${D0(o)}`,e&&`Request body: ${da(e)}`].filter(Boolean),name:"HttpRequestError"}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.body=e,this.headers=s,this.status=i,this.url=o}}class N$ extends ot{constructor({body:e,error:r,url:n}){super("RPC Request failed.",{cause:r,details:r.message,metaMessages:[`URL: ${D0(n)}`,`Request body: ${da(e)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=r.code,this.data=r.data,this.url=n}}class i_ extends ot{constructor({body:e,url:r}){super("The request took too long to respond.",{details:"The request timed out.",metaMessages:[`URL: ${D0(r)}`,`Request body: ${da(e)}`],name:"TimeoutError"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=r}}const eV=-1;class on extends ot{constructor(e,{code:r,docsPath:n,metaMessages:s,name:i,shortMessage:o}){super(o,{cause:e,docsPath:n,metaMessages:s||e?.metaMessages,name:i||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=i||e.name,this.code=e instanceof N$?e.code:r??eV}}class Sn extends on{constructor(e,r){super(e,r),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=r.data}}class du extends on{constructor(e){super(e,{code:du.code,name:"ParseRpcError",shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."})}}Object.defineProperty(du,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class fu extends on{constructor(e){super(e,{code:fu.code,name:"InvalidRequestRpcError",shortMessage:"JSON is not a valid request object."})}}Object.defineProperty(fu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class pu extends on{constructor(e,{method:r}={}){super(e,{code:pu.code,name:"MethodNotFoundRpcError",shortMessage:`The method${r?` "${r}"`:""} does not exist / is not available.`})}}Object.defineProperty(pu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class gu extends on{constructor(e){super(e,{code:gu.code,name:"InvalidParamsRpcError",shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(gu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class Tc extends on{constructor(e){super(e,{code:Tc.code,name:"InternalRpcError",shortMessage:"An internal error was received."})}}Object.defineProperty(Tc,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class mu extends on{constructor(e){super(e,{code:mu.code,name:"InvalidInputRpcError",shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(mu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class yu extends on{constructor(e){super(e,{code:yu.code,name:"ResourceNotFoundRpcError",shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}}Object.defineProperty(yu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class wu extends on{constructor(e){super(e,{code:wu.code,name:"ResourceUnavailableRpcError",shortMessage:"Requested resource not available."})}}Object.defineProperty(wu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class kc extends on{constructor(e){super(e,{code:kc.code,name:"TransactionRejectedRpcError",shortMessage:"Transaction creation failed."})}}Object.defineProperty(kc,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class ra extends on{constructor(e,{method:r}={}){super(e,{code:ra.code,name:"MethodNotSupportedRpcError",shortMessage:`Method${r?` "${r}"`:""} is not supported.`})}}Object.defineProperty(ra,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class Pc extends on{constructor(e){super(e,{code:Pc.code,name:"LimitExceededRpcError",shortMessage:"Request exceeds defined limit."})}}Object.defineProperty(Pc,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class bu extends on{constructor(e){super(e,{code:bu.code,name:"JsonRpcVersionUnsupportedError",shortMessage:"Version of JSON-RPC protocol is not supported."})}}Object.defineProperty(bu,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class fa extends Sn{constructor(e){super(e,{code:fa.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(fa,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class vu extends Sn{constructor(e){super(e,{code:vu.code,name:"UnauthorizedProviderError",shortMessage:"The requested method and/or account has not been authorized by the user."})}}Object.defineProperty(vu,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class Eu extends Sn{constructor(e,{method:r}={}){super(e,{code:Eu.code,name:"UnsupportedProviderMethodError",shortMessage:`The Provider does not support the requested method${r?` " ${r}"`:""}.`})}}Object.defineProperty(Eu,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class _u extends Sn{constructor(e){super(e,{code:_u.code,name:"ProviderDisconnectedError",shortMessage:"The Provider is disconnected from all chains."})}}Object.defineProperty(_u,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class Iu extends Sn{constructor(e){super(e,{code:Iu.code,name:"ChainDisconnectedError",shortMessage:"The Provider is not connected to the requested chain."})}}Object.defineProperty(Iu,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class Su extends Sn{constructor(e){super(e,{code:Su.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(Su,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});class Cu extends Sn{constructor(e){super(e,{code:Cu.code,name:"UnsupportedNonOptionalCapabilityError",shortMessage:"This Wallet does not support a capability that was not marked as optional."})}}Object.defineProperty(Cu,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});class xu extends Sn{constructor(e){super(e,{code:xu.code,name:"UnsupportedChainIdError",shortMessage:"This Wallet does not support the requested chain ID."})}}Object.defineProperty(xu,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});class Au extends Sn{constructor(e){super(e,{code:Au.code,name:"DuplicateIdError",shortMessage:"There is already a bundle submitted with this ID."})}}Object.defineProperty(Au,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});class $u extends Sn{constructor(e){super(e,{code:$u.code,name:"UnknownBundleIdError",shortMessage:"This bundle id is unknown / has not been submitted"})}}Object.defineProperty($u,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});class Nu extends Sn{constructor(e){super(e,{code:Nu.code,name:"BundleTooLargeError",shortMessage:"The call bundle is too large for the Wallet to process."})}}Object.defineProperty(Nu,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});class Ou extends Sn{constructor(e){super(e,{code:Ou.code,name:"AtomicReadyWalletRejectedUpgradeError",shortMessage:"The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."})}}Object.defineProperty(Ou,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});class Tu extends Sn{constructor(e){super(e,{code:Tu.code,name:"AtomicityNotSupportedError",shortMessage:"The wallet does not support atomic execution but the request requires it."})}}Object.defineProperty(Tu,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});class tV extends on{constructor(e){super(e,{name:"UnknownRpcError",shortMessage:"An unknown RPC error occurred."})}}class U0 extends ot{constructor({cause:e,message:r}={}){const n=r?.replace("execution reverted: ","")?.replace("execution reverted","");super(`Execution reverted ${n?`with reason: ${n}`:"for an unknown reason"}.`,{cause:e,name:"ExecutionRevertedError"})}}Object.defineProperty(U0,"code",{enumerable:!0,configurable:!0,writable:!0,value:3});Object.defineProperty(U0,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted/});class rV extends ot{constructor({cause:e,maxFeePerGas:r}={}){super(`The fee cap (\`maxFeePerGas\`${r?` = ${cf(r)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:e,name:"FeeCapTooHighError"})}}Object.defineProperty(rV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class nV extends ot{constructor({cause:e,maxFeePerGas:r}={}){super(`The fee cap (\`maxFeePerGas\`${r?` = ${cf(r)}`:""} gwei) cannot be lower than the block base fee.`,{cause:e,name:"FeeCapTooLowError"})}}Object.defineProperty(nV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas less than block base fee|fee cap less than block base fee|transaction is outdated/});class sV extends ot{constructor({cause:e,nonce:r}={}){super(`Nonce provided for the transaction ${r?`(${r}) `:""}is higher than the next one expected.`,{cause:e,name:"NonceTooHighError"})}}Object.defineProperty(sV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too high/});class iV extends ot{constructor({cause:e,nonce:r}={}){super([`Nonce provided for the transaction ${r?`(${r}) `:""}is lower than the current nonce of the account.`,"Try increasing the nonce or find the latest nonce with `getTransactionCount`."].join(`
`),{cause:e,name:"NonceTooLowError"})}}Object.defineProperty(iV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too low|transaction already imported|already known/});class oV extends ot{constructor({cause:e,nonce:r}={}){super(`Nonce provided for the transaction ${r?`(${r}) `:""}exceeds the maximum allowed nonce.`,{cause:e,name:"NonceMaxValueError"})}}Object.defineProperty(oV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce has max value/});class aV extends ot{constructor({cause:e}={}){super(["The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account."].join(`
`),{cause:e,metaMessages:["This error could arise when the account does not have enough funds to:"," - pay for the total gas fee,"," - pay for the value to send."," ","The cost of the transaction is calculated as `gas * gas fee + value`, where:"," - `gas` is the amount of gas needed for transaction to execute,"," - `gas fee` is the gas fee,"," - `value` is the amount of ether to send to the recipient."],name:"InsufficientFundsError"})}}Object.defineProperty(aV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/insufficient funds|exceeds transaction sender account balance/});class cV extends ot{constructor({cause:e,gas:r}={}){super(`The amount of gas ${r?`(${r}) `:""}provided for the transaction exceeds the limit allowed for the block.`,{cause:e,name:"IntrinsicGasTooHighError"})}}Object.defineProperty(cV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too high|gas limit reached/});class lV extends ot{constructor({cause:e,gas:r}={}){super(`The amount of gas ${r?`(${r}) `:""}provided for the transaction is too low.`,{cause:e,name:"IntrinsicGasTooLowError"})}}Object.defineProperty(lV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too low/});class uV extends ot{constructor({cause:e}){super("The transaction type is not supported for this chain.",{cause:e,name:"TransactionTypeNotSupportedError"})}}Object.defineProperty(uV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/transaction type not valid/});class hV extends ot{constructor({cause:e,maxPriorityFeePerGas:r,maxFeePerGas:n}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${r?` = ${cf(r)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${n?` = ${cf(n)} gwei`:""}).`].join(`
`),{cause:e,name:"TipAboveFeeCapError"})}}Object.defineProperty(hV,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});class Zce extends ot{constructor({cause:e}){super(`An error occurred while executing: ${e?.shortMessage}`,{cause:e,name:"UnknownNodeError"})}}const Jce=[{inputs:[{components:[{name:"target",type:"address"},{name:"allowFailure",type:"bool"},{name:"callData",type:"bytes"}],name:"calls",type:"tuple[]"}],name:"aggregate3",outputs:[{components:[{name:"success",type:"bool"},{name:"returnData",type:"bytes"}],name:"returnData",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],Xce=[{name:"query",type:"function",stateMutability:"view",inputs:[{type:"tuple[]",name:"queries",components:[{type:"address",name:"sender"},{type:"string[]",name:"urls"},{type:"bytes",name:"data"}]}],outputs:[{type:"bool[]",name:"failures"},{type:"bytes[]",name:"responses"}]},{name:"HttpError",type:"error",inputs:[{type:"uint16",name:"status"},{type:"string",name:"message"}]}],O$=[{inputs:[{name:"dns",type:"bytes"}],name:"DNSDecodingFailed",type:"error"},{inputs:[{name:"ens",type:"string"}],name:"DNSEncodingFailed",type:"error"},{inputs:[],name:"EmptyAddress",type:"error"},{inputs:[{name:"status",type:"uint16"},{name:"message",type:"string"}],name:"HttpError",type:"error"},{inputs:[],name:"InvalidBatchGatewayResponse",type:"error"},{inputs:[{name:"errorData",type:"bytes"}],name:"ResolverError",type:"error"},{inputs:[{name:"name",type:"bytes"},{name:"resolver",type:"address"}],name:"ResolverNotContract",type:"error"},{inputs:[{name:"name",type:"bytes"}],name:"ResolverNotFound",type:"error"},{inputs:[{name:"primary",type:"string"},{name:"primaryAddress",type:"bytes"}],name:"ReverseAddressMismatch",type:"error"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"UnsupportedResolverProfile",type:"error"}],Qce=[...O$,{name:"resolveWithGateways",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes"},{name:"data",type:"bytes"},{name:"gateways",type:"string[]"}],outputs:[{name:"",type:"bytes"},{name:"address",type:"address"}]}],ele=[...O$,{name:"reverseWithGateways",type:"function",stateMutability:"view",inputs:[{type:"bytes",name:"reverseName"},{type:"uint256",name:"coinType"},{type:"string[]",name:"gateways"}],outputs:[{type:"string",name:"resolvedName"},{type:"address",name:"resolver"},{type:"address",name:"reverseResolver"}]}],tle=[{name:"text",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"key",type:"string"}],outputs:[{name:"",type:"string"}]}],rle=[{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"}],outputs:[{name:"",type:"address"}]},{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"coinType",type:"uint256"}],outputs:[{name:"",type:"bytes"}]}],nle=[{name:"isValidSignature",type:"function",stateMutability:"view",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}]}],sle=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}],Uh=[{type:"event",name:"Approval",inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"event",name:"Transfer",inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"name",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"totalSupply",stateMutability:"view",inputs:[],outputs:[{type:"uint256"}]},{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}];function dV(){let t=()=>{},e=()=>{};return{promise:new Promise((n,s)=>{t=n,e=s}),resolve:t,reject:e}}const jg=new Map;function fV({fn:t,id:e,shouldSplitBatch:r,wait:n=0,sort:s}){const i=async()=>{const u=c();o();const h=u.map(({args:d})=>d);h.length!==0&&t(h).then(d=>{s&&Array.isArray(d)&&d.sort(s);for(let p=0;p<u.length;p++){const{resolve:g}=u[p];g?.([d[p],d])}}).catch(d=>{for(let p=0;p<u.length;p++){const{reject:g}=u[p];g?.(d)}})},o=()=>jg.delete(e),a=()=>c().map(({args:u})=>u),c=()=>jg.get(e)||[],l=u=>jg.set(e,[...c(),u]);return{flush:o,async schedule(u){const{promise:h,resolve:d,reject:p}=dV();return r?.([...a(),u])&&i(),c().length>0?(l({args:u,resolve:d,reject:p}),h):(l({args:u,resolve:d,reject:p}),setTimeout(i,n),h)}}}async function T$(t){return new Promise(e=>setTimeout(e,t))}function pV(t,{delay:e=100,retryCount:r=2,shouldRetry:n=()=>!0}={}){return new Promise((s,i)=>{const o=async({count:a=0}={})=>{const c=async({error:l})=>{const u=typeof e=="function"?e({count:a,error:l}):e;u&&await T$(u),o({count:a+1})};try{const l=await t();s(l)}catch(l){if(a<r&&await n({count:a,error:l}))return c({error:l});i(l)}};o()})}const Hy=256;let Bh=Hy,Lh;function gV(t=11){if(!Lh||Bh+t>Hy*2){Lh="",Bh=0;for(let e=0;e<Hy;e++)Lh+=(256+Math.random()*256|0).toString(16).substring(1)}return Lh.substring(Bh,Bh+++t)}const Mh=new XH(8192);function mV(t,{enabled:e=!0,id:r}){if(!e||!r)return t();if(Mh.get(r))return Mh.get(r);const n=t().finally(()=>Mh.delete(r));return Mh.set(r,n),n}function yV(t,e={}){return async(r,n={})=>{const{dedupe:s=!1,methods:i,retryDelay:o=150,retryCount:a=3,uid:c}={...e,...n},{method:l}=r;if(i?.exclude?.includes(l))throw new ra(new Error("method not supported"),{method:l});if(i?.include&&!i.include.includes(l))throw new ra(new Error("method not supported"),{method:l});const u=s?$$(`${c}.${da(r)}`):void 0;return mV(()=>pV(async()=>{try{return await t(r)}catch(h){const d=h;switch(d.code){case du.code:throw new du(d);case fu.code:throw new fu(d);case pu.code:throw new pu(d,{method:r.method});case gu.code:throw new gu(d);case Tc.code:throw new Tc(d);case mu.code:throw new mu(d);case yu.code:throw new yu(d);case wu.code:throw new wu(d);case kc.code:throw new kc(d);case ra.code:throw new ra(d,{method:r.method});case Pc.code:throw new Pc(d);case bu.code:throw new bu(d);case fa.code:throw new fa(d);case vu.code:throw new vu(d);case Eu.code:throw new Eu(d);case _u.code:throw new _u(d);case Iu.code:throw new Iu(d);case Su.code:throw new Su(d);case Cu.code:throw new Cu(d);case xu.code:throw new xu(d);case Au.code:throw new Au(d);case $u.code:throw new $u(d);case Nu.code:throw new Nu(d);case Ou.code:throw new Ou(d);case Tu.code:throw new Tu(d);case 5e3:throw new fa(d);default:throw h instanceof ot?h:new tV(d)}}},{delay:({count:h,error:d})=>{if(d&&d instanceof Fl){const p=d?.headers?.get("Retry-After");if(p?.match(/\d/))return Number.parseInt(p,10)*1e3}return~~(1<<h)*o},retryCount:a,shouldRetry:({error:h})=>wV(h)}),{enabled:s,id:u})}}function wV(t){return"code"in t&&typeof t.code=="number"?t.code===-1||t.code===Pc.code||t.code===Tc.code:t instanceof Fl&&t.status?t.status===403||t.status===408||t.status===413||t.status===429||t.status===500||t.status===502||t.status===503||t.status===504:!0}function bV(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}function vV(t,{errorInstance:e=new Error("timed out"),timeout:r,signal:n}){return new Promise((s,i)=>{(async()=>{let o;try{const a=new AbortController;r>0&&(o=setTimeout(()=>{n&&a.abort()},r)),s(await t({signal:a?.signal||null}))}catch(a){a?.name==="AbortError"&&i(e),i(a)}finally{clearTimeout(o)}})()})}function EV(){return{current:0,take(){return this.current++},reset(){this.current=0}}}const o_=EV();function _V(t,e={}){return{async request(r){const{body:n,fetchFn:s=e.fetchFn??fetch,onRequest:i=e.onRequest,onResponse:o=e.onResponse,timeout:a=e.timeout??1e4}=r,c={...e.fetchOptions??{},...r.fetchOptions??{}},{headers:l,method:u,signal:h}=c;try{const d=await vV(async({signal:g})=>{const m={...c,body:Array.isArray(n)?da(n.map(v=>({jsonrpc:"2.0",id:v.id??o_.take(),...v}))):da({jsonrpc:"2.0",id:n.id??o_.take(),...n}),headers:{"Content-Type":"application/json",...l},method:u||"POST",signal:h||(a>0?g:null)},w=new Request(t,m),I=await i?.(w,m)??{...m,url:t};return await s(I.url??t,I)},{errorInstance:new i_({body:n,url:t}),timeout:a,signal:!0});o&&await o(d);let p;if(d.headers.get("Content-Type")?.startsWith("application/json"))p=await d.json();else{p=await d.text();try{p=JSON.parse(p||"{}")}catch(g){if(d.ok)throw g;p={error:p}}}if(!d.ok)throw new Fl({body:n,details:da(p.error)||d.statusText,headers:d.headers,status:d.status,url:t});return p}catch(d){throw d instanceof Fl||d instanceof i_?d:new Fl({body:n,cause:d,url:t})}}}}function k$({key:t,methods:e,name:r,request:n,retryCount:s=3,retryDelay:i=150,timeout:o,type:a},c){const l=gV();return{config:{key:t,methods:e,name:r,request:n,retryCount:s,retryDelay:i,timeout:o,type:a},request:yV(n,{methods:e,retryCount:s,retryDelay:i,uid:l}),value:c}}function a_(t,e={}){const{key:r="fallback",name:n="Fallback",rank:s=!1,shouldThrow:i=IV,retryCount:o,retryDelay:a}=e;return(({chain:c,pollingInterval:l=4e3,timeout:u,...h})=>{let d=t,p=()=>{};const g=k$({key:r,name:n,async request({method:m,params:w}){let I;const S=async(v=0)=>{const b=d[v]({...h,chain:c,retryCount:0,timeout:u});try{const C=await b.request({method:m,params:w});return p({method:m,params:w,response:C,transport:b,status:"success"}),C}catch(C){if(p({error:C,method:m,params:w,transport:b,status:"error"}),i(C)||v===d.length-1||(I??=d.slice(v+1).some(N=>{const{include:P,exclude:R}=N({chain:c}).config.methods||{};return P?P.includes(m):R?!R.includes(m):!0}),!I))throw C;return S(v+1)}};return S()},retryCount:o,retryDelay:a,type:"fallback"},{onResponse:m=>p=m,transports:d.map(m=>m({chain:c,retryCount:0}))});if(s){const m=typeof s=="object"?s:{};SV({chain:c,interval:m.interval??l,onTransports:w=>d=w,ping:m.ping,sampleCount:m.sampleCount,timeout:m.timeout,transports:d,weights:m.weights})}return g})}function IV(t){return!!("code"in t&&typeof t.code=="number"&&(t.code===kc.code||t.code===fa.code||U0.nodeMessage.test(t.message)||t.code===5e3))}function SV({chain:t,interval:e=4e3,onTransports:r,ping:n,sampleCount:s=10,timeout:i=1e3,transports:o,weights:a={}}){const{stability:c=.7,latency:l=.3}=a,u=[],h=async()=>{const d=await Promise.all(o.map(async m=>{const w=m({chain:t,retryCount:0,timeout:i}),I=Date.now();let S,v;try{await(n?n({transport:w}):w.request({method:"net_listening"})),v=1}catch{v=0}finally{S=Date.now()}return{latency:S-I,success:v}}));u.push(d),u.length>s&&u.shift();const p=Math.max(...u.map(m=>Math.max(...m.map(({latency:w})=>w)))),g=o.map((m,w)=>{const I=u.map(N=>N[w].latency),v=1-I.reduce((N,P)=>N+P,0)/I.length/p,b=u.map(N=>N[w].success),C=b.reduce((N,P)=>N+P,0)/b.length;return C===0?[0,w]:[l*v+c*C,w]}).sort((m,w)=>w[0]-m[0]);r(g.map(([,m])=>o[m])),await T$(e),h()};h()}class CV extends ot{constructor(){super("No URL was provided to the Transport. Please provide a valid RPC URL to the Transport.",{docsPath:"/docs/clients/intro",name:"UrlRequiredError"})}}function jh(t,e={}){const{batch:r,fetchFn:n,fetchOptions:s,key:i="http",methods:o,name:a="HTTP JSON-RPC",onFetchRequest:c,onFetchResponse:l,retryDelay:u,raw:h}=e;return({chain:d,retryCount:p,timeout:g})=>{const{batchSize:m=1e3,wait:w=0}=typeof r=="object"?r:{},I=e.retryCount??p,S=g??e.timeout??1e4,v=t||d?.rpcUrls.default.http[0];if(!v)throw new CV;const b=_V(v,{fetchFn:n,fetchOptions:s,onRequest:c,onResponse:l,timeout:S});return k$({key:i,methods:o,name:a,async request({method:C,params:N}){const P={method:C,params:N},{schedule:R}=fV({id:v,wait:w,shouldSplitBatch(k){return k.length>m},fn:k=>b.request({body:k}),sort:(k,$)=>k.id-$.id}),O=async k=>r?R(k):[await b.request({body:k})],[{error:M,result:j}]=await O(P);if(h)return{error:M,result:j};if(M)throw new N$({body:P,error:M,url:v});return j},retryCount:I,retryDelay:u,timeout:S,type:"http"},{fetchOptions:s,url:v})}}async function dl(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class ih{constructor({baseUrl:e,clientId:r}){this.baseUrl=e,this.clientId=r}async get({headers:e,signal:r,cache:n,...s}){const i=this.createUrl(s);return(await dl(i,{method:"GET",headers:e,signal:r,cache:n})).json()}async getBlob({headers:e,signal:r,...n}){const s=this.createUrl(n);return(await dl(s,{method:"GET",headers:e,signal:r})).blob()}async post({body:e,headers:r,signal:n,...s}){const i=this.createUrl(s);return(await dl(i,{method:"POST",headers:r,body:e?JSON.stringify(e):void 0,signal:n})).json()}async put({body:e,headers:r,signal:n,...s}){const i=this.createUrl(s);return(await dl(i,{method:"PUT",headers:r,body:e?JSON.stringify(e):void 0,signal:n})).json()}async delete({body:e,headers:r,signal:n,...s}){const i=this.createUrl(s);return(await dl(i,{method:"DELETE",headers:r,body:e?JSON.stringify(e):void 0,signal:n})).json()}createUrl({path:e,params:r}){const n=new URL(e,this.baseUrl);return r&&Object.entries(r).forEach(([s,i])=>{i&&n.searchParams.append(s,i)}),this.clientId&&n.searchParams.append("clientId",this.clientId),n}sendBeacon({body:e,...r}){const n=this.createUrl(r);return navigator.sendBeacon(n.toString(),e?JSON.stringify(e):void 0)}}const Vy={getFeatureValue(t,e){const r=e?.[t];return r===void 0?Te.DEFAULT_FEATURES[t]:r},filterSocialsByPlatform(t){if(!t||!t.length)return t;let e=t;return ue.isTelegram()&&(ue.isIos()&&(e=e.filter(r=>r!=="google")),ue.isMac()&&(e=e.filter(r=>r!=="x")),ue.isAndroid()&&(e=e.filter(r=>!["facebook","x"].includes(r)))),ue.isMobile()&&(e=e.filter(r=>r!=="facebook")),e},isSocialsEnabled(){return Array.isArray(V.state.features?.socials)&&V.state.features?.socials.length>0||Array.isArray(V.state.remoteFeatures?.socials)&&V.state.remoteFeatures?.socials.length>0},isEmailEnabled(){return!!(V.state.features?.email||V.state.remoteFeatures?.email)}},fe=it({features:Te.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:Te.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{},enableMobileFullScreen:!1,coinbasePreference:"all"}),V={state:fe,subscribeKey(t,e){return lr(fe,t,e)},setOptions(t){Object.assign(fe,t)},setRemoteFeatures(t){if(!t)return;const e={...fe.remoteFeatures,...t};fe.remoteFeatures=e,fe.remoteFeatures?.socials&&(fe.remoteFeatures.socials=Vy.filterSocialsByPlatform(fe.remoteFeatures.socials)),fe.features?.pay&&(fe.remoteFeatures.email=!1,fe.remoteFeatures.socials=!1)},setFeatures(t){if(!t)return;fe.features||(fe.features=Te.DEFAULT_FEATURES);const e={...fe.features,...t};fe.features=e,fe.features?.pay&&fe.remoteFeatures&&(fe.remoteFeatures.email=!1,fe.remoteFeatures.socials=!1)},setProjectId(t){fe.projectId=t},setCustomRpcUrls(t){fe.customRpcUrls=t},setAllWallets(t){fe.allWallets=t},setIncludeWalletIds(t){fe.includeWalletIds=t},setExcludeWalletIds(t){fe.excludeWalletIds=t},setFeaturedWalletIds(t){fe.featuredWalletIds=t},setTokens(t){fe.tokens=t},setTermsConditionsUrl(t){fe.termsConditionsUrl=t},setPrivacyPolicyUrl(t){fe.privacyPolicyUrl=t},setCustomWallets(t){fe.customWallets=t},setIsSiweEnabled(t){fe.isSiweEnabled=t},setIsUniversalProvider(t){fe.isUniversalProvider=t},setSdkVersion(t){fe.sdkVersion=t},setMetadata(t){fe.metadata=t},setDisableAppend(t){fe.disableAppend=t},setEIP6963Enabled(t){fe.enableEIP6963=t},setDebug(t){fe.debug=t},setEnableWalletGuide(t){fe.enableWalletGuide=t},setEnableAuthLogger(t){fe.enableAuthLogger=t},setEnableWallets(t){fe.enableWallets=t},setPreferUniversalLinks(t){fe.experimental_preferUniversalLinks=t},setSIWX(t){if(t)for(const[e,r]of Object.entries(Te.SIWX_DEFAULTS))t[e]??=r;fe.siwx=t},setConnectMethodsOrder(t){fe.features={...fe.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){fe.features={...fe.features,walletFeaturesOrder:t}},setSocialsOrder(t){fe.remoteFeatures={...fe.remoteFeatures,socials:t}},setCollapseWallets(t){fe.features={...fe.features,collapseWallets:t}},setEnableEmbedded(t){fe.enableEmbedded=t},setAllowUnsupportedChain(t){fe.allowUnsupportedChain=t},setManualWCControl(t){fe.manualWCControl=t},setEnableNetworkSwitch(t){fe.enableNetworkSwitch=t},setEnableMobileFullScreen(t){fe.enableMobileFullScreen=ue.isMobile()&&t},setEnableReconnect(t){fe.enableReconnect=t},setCoinbasePreference(t){fe.coinbasePreference=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,r])=>{r&&(fe.defaultAccountTypes[e]=r)})},setUniversalProviderConfigOverride(t){fe.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return fe.universalProviderConfigOverride},getSnapshot(){return uu(fe)}},jo=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),kt=it({...jo}),xV={state:kt,subscribeKey(t,e){return lr(kt,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=ue.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){kt.message=jo.message,kt.variant=jo.variant,kt.svg=jo.svg,kt.open=jo.open,kt.autoClose=jo.autoClose},_showMessage({message:t,svg:e,variant:r="success",autoClose:n=jo.autoClose}){kt.open?(kt.open=!1,setTimeout(()=>{kt.message=t,kt.variant=r,kt.svg=e,kt.open=!0,kt.autoClose=n},150)):(kt.message=t,kt.variant=r,kt.svg=e,kt.open=!0,kt.autoClose=n)}},Ts=xV,AV={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},P$=ue.getBlockchainApiUrl(),jr=it({clientId:null,api:new ih({baseUrl:P$,clientId:null}),supportedChains:{http:[],ws:[]}}),we={state:jr,async get(t){const{st:e,sv:r}=we.getSdkProperties(),n=V.state.projectId,s={...t.params||{},st:e,sv:r,projectId:n};return jr.api.get({...t,params:s})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=V.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{jr.supportedChains.http.length||await we.getSupportedNetworks()}catch{return!1}return jr.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await we.get({path:"v1/supported-chains"});return jr.supportedChains=t,t}catch{return jr.supportedChains}},async fetchIdentity({address:t}){const e=J.getIdentityFromCacheForAddress(t);if(e)return e;const r=await we.get({path:`/v1/identity/${t}`,params:{sender:U.state.activeCaipAddress?ue.getPlainAddress(U.state.activeCaipAddress):void 0}});return J.updateIdentityCache({address:t,identity:r,timestamp:Date.now()}),r},async fetchTransactions({account:t,cursor:e,signal:r,cache:n,chainId:s}){if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))return{data:[],next:void 0};const o=J.getTransactionsCacheForAddress({address:t,chainId:s});if(o)return o;const a=await we.get({path:`/v1/account/${t}/history`,params:{cursor:e,chainId:s},signal:r,cache:n});return J.updateTransactionsCache({address:t,chainId:s,timestamp:Date.now(),transactions:a}),a},async fetchSwapQuote({amount:t,userAddress:e,from:r,to:n,gasPrice:s}){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?we.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:r,to:n,gasPrice:s}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?we.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async fetchTokenPrice({addresses:t}){if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))return{fungibles:[]};const r=J.getTokenPriceCacheForAddresses(t);if(r)return r;const n=await jr.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:V.state.projectId},headers:{"Content-Type":"application/json"}});return J.updateTokenPriceCache({addresses:t,timestamp:Date.now(),tokenPrice:n}),n},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?we.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){const{st:e,sv:r}=we.getSdkProperties();if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))throw new Error("Network not supported for Gas Price");return we.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:r}})},async generateSwapCalldata({amount:t,from:e,to:r,userAddress:n,disableEstimate:s}){if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))throw new Error("Network not supported for Swaps");return jr.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:Te.CONVERT_SLIPPAGE_TOLERANCE},projectId:V.state.projectId,from:e,to:r,userAddress:n,disableEstimate:s}})},async generateApproveCalldata({from:t,to:e,userAddress:r}){const{st:n,sv:s}=we.getSdkProperties();if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))throw new Error("Network not supported for Swaps");return we.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:r,from:t,to:e,st:n,sv:s}})},async getBalance(t,e,r){const{st:n,sv:s}=we.getSdkProperties();if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))return Ts.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=J.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await we.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:r,st:n,sv:s}});return J.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(t){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?we.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))return[];const r=U.getAccountData()?.address;return we.get({path:`/v1/profile/reverse/${t}`,params:{sender:r,apiVersion:"2"}})},async getEnsNameSuggestions(t){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?we.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:r,signature:n}){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?jr.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:r,signature:n},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:r,purchaseAmount:n,paymentAmount:s}){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?(await jr.api.post({path:"/v1/generators/onrampurl",params:{projectId:V.state.projectId},body:{destinationWallets:t,defaultNetwork:r,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:n,presetFiatAmount:s}})).url:""},async getOnrampOptions(){if(!await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await we.get({path:"/v1/onramp/options"})}catch{return AV}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:r,network:n}){try{return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?await jr.api.post({path:"/v1/onramp/quote",params:{projectId:V.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:r,network:n}}):null}catch{return{networkFee:{amount:r,currency:e.id},paymentSubtotal:{amount:r,currency:e.id},paymentTotal:{amount:r,currency:e.id},purchaseAmount:{amount:r,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?we.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,r){return await we.isNetworkSupported(U.state.activeCaipNetwork?.caipNetworkId)?jr.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:V.state.projectId},body:{pci:e,signature:r}}):{success:!1}},setClientId(t){jr.clientId=t,jr.api=new ih({baseUrl:P$,clientId:t})}},Bn={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com"},BINANCE:{id:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25",appId:"yFK5FCqYprrXDiVFbhyRx7",deeplink:"bnc://app.binance.com/mp/app",url:"https://app.binance.com/en/download"}},$V={handleMobileDeeplinkRedirect(t,e){const r=window.location.href,n=encodeURIComponent(r);if(t===Bn.PHANTOM.id&&!("phantom"in window)){const s=r.startsWith("https")?"https":"http",i=r.split("/")[2],o=encodeURIComponent(`${s}://${i}`);window.location.href=`${Bn.PHANTOM.url}/ul/browse/${n}?ref=${o}`}if(t===Bn.SOLFLARE.id&&!("solflare"in window)&&(window.location.href=`${Bn.SOLFLARE.url}/ul/v1/browse/${n}?ref=${n}`),e===X.CHAIN.SOLANA&&t===Bn.COINBASE.id&&!("coinbaseSolana"in window)&&(window.location.href=`${Bn.COINBASE.url}/dapp?cb_url=${n}`),e===X.CHAIN.BITCOIN&&t===Bn.BINANCE.id&&!("binancew3w"in window)){const s=U.state.activeCaipNetwork,i=window.btoa("/pages/browser/index"),o=window.btoa(`url=${n}&defaultChainId=${s?.id??1}`),a=new URL(Bn.BINANCE.deeplink);a.searchParams.set("appId",Bn.BINANCE.appId),a.searchParams.set("startPagePath",i),a.searchParams.set("startPageQuery",o);const c=new URL(Bn.BINANCE.url);c.searchParams.set("_dp",window.btoa(a.toString())),window.location.href=c.toString()}}},NV=Object.freeze({enabled:!0,events:[]}),OV=new ih({baseUrl:ue.getAnalyticsUrl(),clientId:null}),TV=5,kV=60*1e3,Mi=it({...NV}),PV={state:Mi,subscribeKey(t,e){return lr(Mi,t,e)},async sendError(t,e){if(!Mi.enabled)return;const r=Date.now();if(Mi.events.filter(i=>{const o=new Date(i.properties.timestamp||"").getTime();return r-o<kV}).length>=TV)return;const s={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};Mi.events.push(s);try{if(typeof window>"u")return;const{projectId:i,sdkType:o,sdkVersion:a}=V.state;await OV.post({path:"/e",params:{projectId:i,st:o,sv:a||"html-wagmi-4.2.2"},body:{eventId:ue.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){Mi.enabled=!0},disable(){Mi.enabled=!1},clearEvents(){Mi.events=[]}};class Ea extends Error{constructor(e,r,n){super(e),this.originalName="AppKitError",this.name="AppKitError",this.category=r,this.originalError=n,n&&n instanceof Error&&(this.originalName=n.name),Object.setPrototypeOf(this,Ea.prototype);let s=!1;if(n instanceof Error&&typeof n.stack=="string"&&n.stack){const i=n.stack,o=i.indexOf(`
`);if(o>-1){const a=i.substring(o+1);this.stack=`${this.name}: ${this.message}
${a}`,s=!0}}s||(Error.captureStackTrace?Error.captureStackTrace(this,Ea):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function c_(t,e){let r="";try{t instanceof Error?r=t.message:typeof t=="string"?r=t:typeof t=="object"&&t!==null?Object.keys(t).length===0?r="Unknown error":r=t?.message||JSON.stringify(t):r=String(t)}catch(s){r="Unknown error",console.error("Error parsing error message",s)}const n=t instanceof Ea?t:new Ea(r,e,t);throw PV.sendError(n,n.category),n}function Kn(t,e="INTERNAL_SDK_ERROR"){const r={};return Object.keys(t).forEach(n=>{const s=t[n];if(typeof s=="function"){let i=s;s.constructor.name==="AsyncFunction"?i=async(...o)=>{try{return await s(...o)}catch(a){return c_(a,e)}}:i=(...o)=>{try{return s(...o)}catch(a){return c_(a,e)}},r[n]=i}else r[n]=s}),r}const un=it({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),RV={state:un,subscribeNetworkImages(t){return cr(un.networkImages,()=>t(un.networkImages))},subscribeKey(t,e){return lr(un,t,e)},subscribe(t){return cr(un,()=>t(un))},setWalletImage(t,e){un.walletImages[t]=e},setNetworkImage(t,e){un.networkImages[t]=e},setChainImage(t,e){un.chainImages[t]=e},setConnectorImage(t,e){un.connectorImages={...un.connectorImages,[t]:e}},setTokenImage(t,e){un.tokenImages[t]=e},setCurrencyImage(t,e){un.currencyImages[t]=e}},zn=Kn(RV),DV={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:"",sui:"",stacks:""},Fg=it({networkImagePromises:{}}),R$={async fetchWalletImage(t){if(t)return await de._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||(Fg.networkImagePromises[t]||(Fg.networkImagePromises[t]=de._fetchNetworkImage(t)),await Fg.networkImagePromises[t],this.getNetworkImageById(t))},getWalletImageById(t){if(t)return zn.state.walletImages[t]},getWalletImage(t){if(t?.image_url)return t?.image_url;if(t?.image_id)return zn.state.walletImages[t.image_id]},getNetworkImage(t){if(t?.assets?.imageUrl)return t?.assets?.imageUrl;if(t?.assets?.imageId)return zn.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return zn.state.networkImages[t]},getConnectorImage(t){if(t?.imageUrl)return t.imageUrl;if(t?.info?.icon)return t.info.icon;if(t?.imageId)return zn.state.connectorImages[t.imageId]},getChainImage(t){return zn.state.networkImages[DV[t]]},getTokenImage(t){if(t)return zn.state.tokenImages[t]}},UV=ue.getAnalyticsUrl(),BV=new ih({baseUrl:UV,clientId:null}),LV=["MODAL_CREATED"],MV=45,l_=1e3*10,ft=it({timestamp:Date.now(),lastFlush:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"},pendingEvents:[],subscribedToVisibilityChange:!1,walletImpressions:[]}),Se={state:ft,subscribe(t){return cr(ft,()=>t(ft))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:r}=V.state;return{projectId:t,st:e,sv:r||"html-wagmi-4.2.2"}},shouldFlushEvents(){const t=JSON.stringify(ft.pendingEvents).length/1024>MV,e=ft.lastFlush+l_<Date.now();return t||e},_setPendingEvent(t){try{let e=U.getAccountData()?.address;if("address"in t.data&&t.data.address&&(e=t.data.address),LV.includes(t.data.event)||typeof window>"u")return;const r=U.getActiveCaipNetwork()?.caipNetworkId;this.state.pendingEvents.push({eventId:ue.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:e,properties:{..."properties"in t.data?t.data.properties:{},caipNetworkId:r}}}),ft.reportedErrors.FORBIDDEN=!1,Se.shouldFlushEvents()&&Se._submitPendingEvents()}catch(e){console.warn("_setPendingEvent",e)}},sendEvent(t){ft.timestamp=Date.now(),ft.data=t;const e=["INITIALIZE","CONNECT_SUCCESS","SOCIAL_LOGIN_SUCCESS"];(V.state.features?.analytics||e.includes(t.event))&&Se._setPendingEvent(ft),this.subscribeToFlushTriggers()},sendWalletImpressionEvent(t){ft.walletImpressions.push(t)},_transformPendingEventsForBatch(t){try{return t.filter(e=>e.props.event!=="WALLET_IMPRESSION_V2")}catch{return t}},_submitPendingEvents(){if(ft.lastFlush=Date.now(),!(ft.pendingEvents.length===0&&ft.walletImpressions.length===0))try{const t=Se._transformPendingEventsForBatch(ft.pendingEvents);ft.walletImpressions.length&&t.push({eventId:ue.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:Date.now(),props:{type:"track",event:"WALLET_IMPRESSION_V2",items:[...ft.walletImpressions]}}),BV.sendBeacon({path:"/batch",params:Se.getSdkProperties(),body:t}),ft.reportedErrors.FORBIDDEN=!1,ft.pendingEvents=[],ft.walletImpressions=[]}catch{ft.reportedErrors.FORBIDDEN=!0}},subscribeToFlushTriggers(){ft.subscribedToVisibilityChange||typeof document>"u"||(ft.subscribedToVisibilityChange=!0,document?.addEventListener?.("visibilitychange",()=>{document.visibilityState==="hidden"&&Se._submitPendingEvents()}),document?.addEventListener?.("freeze",()=>{Se._submitPendingEvents()}),window?.addEventListener?.("pagehide",()=>{Se._submitPendingEvents()}),setInterval(()=>{Se._submitPendingEvents()},l_))}},jV=ue.getApiUrl(),Or=new ih({baseUrl:jV,clientId:null}),FV=40,u_=4,qV=20,be=it({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1,explorerWallets:[],explorerFilteredWallets:[],plan:{tier:"none",hasExceededUsageLimit:!1,limits:{isAboveRpcLimit:!1,isAboveMauLimit:!1}}}),de={state:be,subscribeKey(t,e){return lr(be,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:r}=V.state;return{projectId:t,st:e||"appkit",sv:r||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return V.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${Or.baseUrl}/getWalletImage/${t}`,r=await Or.getBlob({path:e,params:de._getSdkProperties()});zn.setWalletImage(t,URL.createObjectURL(r))},async _fetchNetworkImage(t){const e=`${Or.baseUrl}/public/getAssetImage/${t}`,r=await Or.getBlob({path:e,params:de._getSdkProperties()});zn.setNetworkImage(t,URL.createObjectURL(r))},async _fetchConnectorImage(t){const e=`${Or.baseUrl}/public/getAssetImage/${t}`,r=await Or.getBlob({path:e,params:de._getSdkProperties()});zn.setConnectorImage(t,URL.createObjectURL(r))},async _fetchCurrencyImage(t){const e=`${Or.baseUrl}/public/getCurrencyImage/${t}`,r=await Or.getBlob({path:e,params:de._getSdkProperties()});zn.setCurrencyImage(t,URL.createObjectURL(r))},async _fetchTokenImage(t){const e=`${Or.baseUrl}/public/getTokenImage/${t}`,r=await Or.getBlob({path:e,params:de._getSdkProperties()});zn.setTokenImage(t,URL.createObjectURL(r))},_filterWalletsByPlatform(t){const e=t.length,r=ue.isMobile()?t?.filter(s=>s.mobile_link||s.webapp_link?!0:Object.values(Bn).map(o=>o.id).includes(s.id)):t,n=e-r.length;return{filteredWallets:r,mobileFilteredOutWalletsLength:n}},async fetchProjectConfig(){return(await Or.get({path:"/appkit/v1/config",params:de._getSdkProperties()})).features},async fetchUsage(){try{const t=await Or.get({path:"/appkit/v1/project-limits",params:de._getSdkProperties()}),{tier:e,isAboveMauLimit:r,isAboveRpcLimit:n}=t.planLimits,s=e==="starter",i=r||n;de.state.plan={tier:e,hasExceededUsageLimit:s&&i,limits:{isAboveRpcLimit:n,isAboveMauLimit:r}}}catch(t){console.warn("Failed to fetch usage",t)}},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await Or.get({path:"/projects/v1/origins",params:de._getSdkProperties()});return t}catch(t){if(t instanceof Error&&t.cause instanceof Response){const e=t.cause.status;if(e===X.HTTP_STATUS_CODES.TOO_MANY_REQUESTS)throw new Error("RATE_LIMITED",{cause:t});if(e>=X.HTTP_STATUS_CODES.SERVER_ERROR&&e<600)throw new Error("SERVER_ERROR",{cause:t});return[]}return[]}},async fetchNetworkImages(){const e=U.getAllRequestedCaipNetworks()?.map(({assets:r})=>r?.imageId).filter(Boolean).filter(r=>!R$.getNetworkImageById(r));e&&await Promise.allSettled(e.map(r=>de._fetchNetworkImage(r)))},async fetchConnectorImages(){const{connectors:t}=Q.state,e=t.map(({imageId:r})=>r).filter(Boolean);await Promise.allSettled(e.map(r=>de._fetchConnectorImage(r)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>de._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>de._fetchTokenImage(e)))},async fetchWallets(t){const e=t.exclude??[];de._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(Bn).map(o=>o.id));const n=await Or.get({path:"/getWallets",params:{...de._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:t.include?.join(","),exclude:e.join(",")}}),{filteredWallets:s,mobileFilteredOutWalletsLength:i}=de._filterWalletsByPlatform(n?.data);return{data:s||[],count:n?.count,mobileFilteredOutWalletsLength:i}},async prefetchWalletRanks(){const t=Q.state.connectors;if(!t?.length)return;const e={page:1,entries:20,badge:"certified"};if(e.names=t.map(s=>s.name).join(","),U.state.activeChain===X.CHAIN.EVM){const s=[...t.flatMap(i=>i.connectors?.map(o=>o.info?.rdns)||[]),...t.map(i=>i.info?.rdns)].filter(i=>typeof i=="string"&&i.length>0);s.length&&(e.rdns=s.join(","))}const{data:r}=await de.fetchWallets(e);be.explorerWallets=r;const n=U.getRequestedCaipNetworkIds().join(",");be.explorerFilteredWallets=r.filter(s=>s.chains?.some(i=>n.includes(i)))},async fetchFeaturedWallets(){const{featuredWalletIds:t}=V.state;if(t?.length){const e={...de._getSdkProperties(),page:1,entries:t?.length??u_,include:t},{data:r}=await de.fetchWallets(e),n=[...r].sort((i,o)=>t.indexOf(i.id)-t.indexOf(o.id)),s=n.map(i=>i.image_id).filter(Boolean);await Promise.allSettled(s.map(i=>de._fetchWalletImage(i))),be.featured=n,be.allFeatured=n}},async fetchRecommendedWallets(){try{be.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:r}=V.state,n=[...e??[],...r??[]].filter(Boolean),s=U.getRequestedCaipNetworkIds().join(","),i={page:1,entries:u_,include:t,exclude:n,chains:s},{data:o,count:a}=await de.fetchWallets(i),c=J.getRecentWallets(),l=o.map(h=>h.image_id).filter(Boolean),u=c.map(h=>h.image_id).filter(Boolean);await Promise.allSettled([...l,...u].map(h=>de._fetchWalletImage(h))),be.recommended=o,be.allRecommended=o,be.count=a??0}catch{}finally{be.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){const{includeWalletIds:e,excludeWalletIds:r,featuredWalletIds:n}=V.state,s=U.getRequestedCaipNetworkIds().join(","),i=[...be.recommended.map(({id:h})=>h),...r??[],...n??[]].filter(Boolean),o={page:t,entries:FV,include:e,exclude:i,chains:s},{data:a,count:c,mobileFilteredOutWalletsLength:l}=await de.fetchWallets(o);be.mobileFilteredOutWalletsLength=l+(be.mobileFilteredOutWalletsLength??0);const u=a.slice(0,qV).map(h=>h.image_id).filter(Boolean);await Promise.allSettled(u.map(h=>de._fetchWalletImage(h))),be.wallets=ue.uniqueBy([...be.wallets,...de._filterOutExtensions(a)],"id").filter(h=>h.chains?.some(d=>s.includes(d))),be.count=c>be.count?c:be.count,be.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:r}=await de.fetchWallets(e);r&&r.forEach(n=>{be.excludedWallets.push({rdns:n.rdns,name:n.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:r,excludeWalletIds:n}=V.state,s=U.getRequestedCaipNetworkIds().join(",");be.search=[];const i={page:1,entries:100,search:t?.trim(),badge_type:e,include:r,exclude:n,chains:s},{data:o}=await de.fetchWallets(i);Se.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>de._fetchWalletImage(c)),ue.wait(300)]),be.search=de._filterOutExtensions(o)},initPromise(t,e){const r=be.promises[t];return r||(be.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:r=!0,fetchNetworkImages:n=!0,fetchWalletRanks:s=!0}={}){const i=[t&&de.initPromise("connectorImages",de.fetchConnectorImages),e&&de.initPromise("featuredWallets",de.fetchFeaturedWallets),r&&de.initPromise("recommendedWallets",de.fetchRecommendedWallets),n&&de.initPromise("networkImages",de.fetchNetworkImages),s&&de.initPromise("walletRanks",de.prefetchWalletRanks)].filter(Boolean);return Promise.allSettled(i)},prefetchAnalyticsConfig(){V.state.features?.analytics&&de.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await Or.get({path:"/getAnalyticsConfig",params:de._getSdkProperties()});V.setFeatures({analytics:t})}catch{V.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!t?.length){be.featured=be.allFeatured,be.recommended=be.allRecommended;return}const e=U.getRequestedCaipNetworkIds().join(",");be.featured=be.allFeatured.filter(r=>r.chains?.some(n=>e.includes(n))),be.recommended=be.allRecommended.filter(r=>r.chains?.some(n=>e.includes(n))),be.filteredWallets=be.wallets.filter(r=>r.chains?.some(n=>e.includes(n)))},clearFilterByNamespaces(){be.filteredWallets=[]},setFilterByNamespace(t){if(!t){be.featured=be.allFeatured,be.recommended=be.allRecommended;return}const e=U.getRequestedCaipNetworkIds().join(",");be.featured=be.allFeatured.filter(r=>r.chains?.some(n=>e.includes(n))),be.recommended=be.allRecommended.filter(r=>r.chains?.some(n=>e.includes(n))),be.filteredWallets=be.wallets.filter(r=>r.chains?.some(n=>e.includes(n)))}},zV=["ConnectingExternal","ConnectingMultiChain","ConnectingSocial","ConnectingFarcaster"],Fe=it({view:"Connect",history:["Connect"],transactionStack:[]}),HV={state:Fe,subscribeKey(t,e){return lr(Fe,t,e)},pushTransactionStack(t){Fe.transactionStack.push(t)},popTransactionStack(t){const e=Fe.transactionStack.pop();if(!e)return;const{onSuccess:r,onError:n,onCancel:s}=e;switch(t){case"success":r?.();break;case"error":n?.(),me.goBack();break;case"cancel":s?.(),me.goBack();break}},push(t,e){let r=t,n=e;de.state.plan.hasExceededUsageLimit&&zV.includes(t)&&(r="UsageExceeded",n=void 0),r!==Fe.view&&(Fe.view=r,Fe.history.push(r),Fe.data=n)},reset(t,e){Fe.view=t,Fe.history=[t],Fe.data=e},replace(t,e){Fe.history.at(-1)===t||(Fe.view=t,Fe.history[Fe.history.length-1]=t,Fe.data=e)},goBack(){const t=U.state.activeCaipAddress,e=me.state.view==="ConnectingFarcaster",r=!t&&e;if(Fe.history.length>1){Fe.history.pop();const[n]=Fe.history.slice(-1);n&&(t&&n==="Connect"?Fe.view="Account":Fe.view=n)}else Ce.close();Fe.data?.wallet&&(Fe.data.wallet=void 0),Fe.data?.redirectView&&(Fe.data.redirectView=void 0),setTimeout(()=>{if(r){U.setAccountProp("farcasterUrl",void 0,U.state.activeChain);const n=Q.getAuthConnector();n?.provider?.reload();const s=uu(V.state);n?.provider?.syncDappData?.({metadata:s.metadata,sdkVersion:s.sdkVersion,projectId:s.projectId,sdkType:s.sdkType})}},100)},goBackToIndex(t){if(Fe.history.length>1){Fe.history=Fe.history.slice(0,t+1);const[e]=Fe.history.slice(-1);e&&(Fe.view=e)}},goBackOrCloseModal(){me.state.history.length>1?me.goBack():Ce.close()}},me=Kn(HV),Gs=it({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),Wy={state:Gs,subscribe(t){return cr(Gs,()=>t(Gs))},setThemeMode(t){Gs.themeMode=t;try{const e=Q.getAuthConnector();if(e){const r=Wy.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:r,w3mThemeVariables:of(r,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){Gs.themeVariables={...Gs.themeVariables,...t};try{const e=Q.getAuthConnector();if(e){const r=Wy.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:r,w3mThemeVariables:of(Gs.themeVariables,Gs.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return uu(Gs)}},gn=Kn(Wy),D$=Object.fromEntries(w$.map(t=>[t,void 0])),VV=Object.fromEntries(w$.map(t=>[t,!0])),Ue=it({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:D$,filterByNamespaceMap:VV}),WV={state:Ue,subscribe(t){return cr(Ue,()=>{t(Ue)})},subscribeKey(t,e){return lr(Ue,t,e)},initialize(t){t.forEach(e=>{const r=J.getConnectedConnectorId(e);r&&Q.setConnectorId(r,e)})},setActiveConnector(t){t&&(Ue.activeConnector=hu(t))},setConnectors(t){t.filter(s=>!Ue.allConnectors.some(i=>i.id===s.id&&Q.getConnectorName(i.name)===Q.getConnectorName(s.name)&&i.chain===s.chain)).forEach(s=>{s.type!=="MULTI_CHAIN"&&Ue.allConnectors.push(hu(s))});const r=Q.getEnabledNamespaces(),n=Q.getEnabledConnectors(r);Ue.connectors=Q.mergeMultiChainConnectors(n)},filterByNamespaces(t){Object.keys(Ue.filterByNamespaceMap).forEach(e=>{Ue.filterByNamespaceMap[e]=!1}),t.forEach(e=>{Ue.filterByNamespaceMap[e]=!0}),Q.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){Ue.filterByNamespaceMap[t]=e,Q.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=Q.getEnabledNamespaces(),e=Q.getEnabledConnectors(t),r=Q.areAllNamespacesEnabled();Ue.connectors=Q.mergeMultiChainConnectors(e),r?de.clearFilterByNamespaces():de.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(Ue.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return Ue.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(Ue.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=Q.generateConnectorMapByName(t),r=[];return e.forEach(n=>{const s=n[0],i=s?.id===X.CONNECTOR_ID.AUTH;n.length>1&&s?r.push({name:s.name,imageUrl:s.imageUrl,imageId:s.imageId,connectors:[...n],type:i?"AUTH":"MULTI_CHAIN",chain:"eip155",id:s?.id||""}):s&&r.push(s)}),r},generateConnectorMapByName(t){const e=new Map;return t.forEach(r=>{const{name:n}=r,s=Q.getConnectorName(n);if(!s)return;const i=e.get(s)||[];i.find(a=>a.chain===r.chain)||i.push(r),e.set(s,i)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(r=>{e.find(n=>n.chain===r.chain)||e.push(r)}),e},addConnector(t){if(t.id===X.CONNECTOR_ID.AUTH){const e=t,r=uu(V.state),n=gn.getSnapshot().themeMode,s=gn.getSnapshot().themeVariables;e?.provider?.syncDappData?.({metadata:r.metadata,sdkVersion:r.sdkVersion,projectId:r.projectId,sdkType:r.sdkType}),e?.provider?.syncTheme({themeMode:n,themeVariables:s,w3mThemeVariables:of(s,n)}),Q.setConnectors([t])}else Q.setConnectors([t])},getAuthConnector(t){const e=t||U.state.activeChain,r=Ue.connectors.find(n=>n.id===X.CONNECTOR_ID.AUTH);if(r)return r?.connectors?.length?r.connectors.find(s=>s.chain===e):r},getAnnouncedConnectorRdns(){return Ue.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>t.info?.rdns)},getConnectorById(t){return Ue.allConnectors.find(e=>e.id===t)},getConnector({id:t,rdns:e,namespace:r}){const n=r||U.state.activeChain;return Ue.allConnectors.filter(i=>i.chain===n).find(i=>i.explorerId===t||i.info?.rdns===e)},syncIfAuthConnector(t){if(t.id!=="AUTH")return;const e=t,r=uu(V.state),n=gn.getSnapshot().themeMode,s=gn.getSnapshot().themeVariables;e?.provider?.syncDappData?.({metadata:r.metadata,sdkVersion:r.sdkVersion,sdkType:r.sdkType,projectId:r.projectId}),e.provider.syncTheme({themeMode:n,themeVariables:s,w3mThemeVariables:of(s,n)})},getConnectorsByNamespace(t){const e=Ue.allConnectors.filter(r=>r.chain===t);return Q.mergeMultiChainConnectors(e)},canSwitchToSmartAccount(t){return U.checkIfSmartAccountEnabled()&&Hn(t)===pi.ACCOUNT_TYPES.EOA},selectWalletConnector(t){const e=me.state.data?.redirectView,r=Q.getConnector({id:t.id,rdns:t.rdns});$V.handleMobileDeeplinkRedirect(r?.explorerId||t.id,U.state.activeChain),r?me.push("ConnectingExternal",{connector:r,wallet:t,redirectView:e}):me.push("ConnectingWalletConnect",{wallet:t,redirectView:e})},getConnectors(t){return t?Q.getConnectorsByNamespace(t):Q.mergeMultiChainConnectors(Ue.allConnectors)},setFilterByNamespace(t){Ue.filterByNamespace=t,Ue.connectors=Q.getConnectors(t),de.setFilterByNamespace(t)},setConnectorId(t,e){t&&(Ue.activeConnectorIds={...Ue.activeConnectorIds,[e]:t},J.setConnectedConnectorId(e,t))},removeConnectorId(t){Ue.activeConnectorIds={...Ue.activeConnectorIds,[t]:void 0},J.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return Ue.activeConnectorIds[t]},isConnected(t){return t?!!Ue.activeConnectorIds[t]:Object.values(Ue.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){Ue.activeConnectorIds={...D$}}},Q=Kn(WV),KV=1e3,fl={checkNamespaceConnectorId(t,e){return Q.getConnectorId(t)===e},isSocialProvider(t){return Te.DEFAULT_REMOTE_FEATURES.socials.includes(t)},connectWalletConnect({walletConnect:t,connector:e,closeModalOnConnect:r=!0,redirectViewOnModalClose:n="Connect",onOpen:s,onConnect:i}){return new Promise((o,a)=>{if(t&&Q.setActiveConnector(e),s?.(ue.isMobile()&&t),n){const l=Ce.subscribeKey("open",u=>{u||(me.state.view!==n&&me.replace(n),l(),a(new Error("Modal closed")))})}const c=U.subscribeKey("activeCaipAddress",l=>{l&&(i?.(),r&&Ce.close(),c(),o(or.parseCaipAddress(l)))})})},connectExternal(t){return new Promise((e,r)=>{const n=U.subscribeKey("activeCaipAddress",s=>{s&&(Ce.close(),n(),e(or.parseCaipAddress(s)))});ie.connectExternal(t,t.chain).catch(()=>{n(),r(new Error("Connection rejected"))})})},connectSocial({social:t,namespace:e,closeModalOnConnect:r=!0,onOpenFarcaster:n,onConnect:s}){let i,o=!1,a=null;const c=e||U.state.activeChain,l=U.subscribeKey("activeCaipAddress",u=>{u&&(r&&Ce.close(),l())});return new Promise((u,h)=>{async function d(g){if(g.data?.resultUri)if(g.origin===X.SECURE_SITE_SDK_ORIGIN){window.removeEventListener("message",d,!1);try{const m=Q.getAuthConnector(c);if(m&&!o){i&&i.close(),o=!0;const w=g.data.resultUri;Se.sendEvent({type:"track",event:"SOCIAL_LOGIN_REQUEST_USER_DATA",properties:{provider:t}}),J.setConnectedSocialProvider(t),await ie.connectExternal({id:m.id,type:m.type,socialUri:w},m.chain);const I=U.state.activeCaipAddress;if(!I){h(new Error("Failed to connect"));return}u(or.parseCaipAddress(I)),Se.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:t}})}}catch(m){Se.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:ue.parseError(m)}}),h(new Error("Failed to connect"))}}else Se.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:"Untrusted Origin"}})}async function p(){if(Se.sendEvent({type:"track",event:"SOCIAL_LOGIN_STARTED",properties:{provider:t}}),t==="farcaster"){n?.();const g=Ce.subscribeKey("open",w=>{!w&&t==="farcaster"&&(h(new Error("Popup closed")),s?.(),g())}),m=Q.getAuthConnector();if(m&&!U.getAccountData(c)?.farcasterUrl)try{const{url:I}=await m.provider.getFarcasterUri();U.setAccountProp("farcasterUrl",I,c)}catch{h(new Error("Failed to connect to farcaster"))}}else{const g=Q.getAuthConnector();a=ue.returnOpenHref(`${X.SECURE_SITE_SDK_ORIGIN}/loading`,"popupWindow","width=600,height=800,scrollbars=yes");try{if(g){const{uri:m}=await g.provider.getSocialRedirectUri({provider:t});if(a&&m){a.location.href=m,i=a;const w=setInterval(()=>{i?.closed&&!o&&(h(new Error("Popup closed")),clearInterval(w))},1e3);window.addEventListener("message",d,!1)}else a?.close(),h(new Error("Failed to initiate social connection"))}}catch{h(new Error("Failed to initiate social connection")),a?.close()}}}p()})},connectEmail({closeModalOnConnect:t=!0,redirectViewOnModalClose:e="Connect",onOpen:r,onConnect:n}){return new Promise((s,i)=>{if(r?.(),e){const a=Ce.subscribeKey("open",c=>{c||(me.state.view!==e&&me.replace(e),a(),i(new Error("Modal closed")))})}const o=U.subscribeKey("activeCaipAddress",a=>{a&&(n?.(),t&&Ce.close(),o(),s(or.parseCaipAddress(a)))})})},async updateEmail(){const t=J.getConnectedConnectorId(U.state.activeChain),e=Q.getAuthConnector();if(!e)throw new Error("No auth connector found");if(t!==X.CONNECTOR_ID.AUTH)throw new Error("Not connected to email or social");const r=e.provider.getEmail()??"";return await Ce.open({view:"UpdateEmailWallet",data:{email:r,redirectView:void 0}}),new Promise((n,s)=>{const i=setInterval(()=>{const a=e.provider.getEmail()??"";a!==r&&(Ce.close(),clearInterval(i),o(),n({email:a}))},KV),o=Ce.subscribeKey("open",a=>{a||(me.state.view!=="Connect"&&me.push("Connect"),clearInterval(i),o(),s(new Error("Modal closed")))})})},canSwitchToSmartAccount(t){return U.checkIfSmartAccountEnabled()&&Hn(t)===pi.ACCOUNT_TYPES.EOA}};function U$(){const t=U.state.activeCaipNetwork?.chainNamespace||"eip155",e=U.state.activeCaipNetwork?.id||1,r=Te.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${r}`}function Hn(t){return U.getAccountData(t)?.preferredAccountType}function Fh(t){return U.state.activeCaipNetwork}const lf={getConnectionStatus(t,e){const r=Q.state.activeConnectorIds[e],n=ie.getConnections(e);return!!r&&t.connectorId===r?"connected":n.some(o=>o.connectorId.toLowerCase()===t.connectorId.toLowerCase())?"active":"disconnected"},excludeConnectorAddressFromConnections({connections:t,connectorId:e,addresses:r}){return t.map(n=>{if((e?n.connectorId.toLowerCase()===e.toLowerCase():!1)&&r){const i=n.accounts.filter(o=>!r.some(c=>c.toLowerCase()===o.address.toLowerCase()));return{...n,accounts:i}}return n})},excludeExistingConnections(t,e){const r=new Set(t);return e.filter(n=>!r.has(n.connectorId))},getConnectionsByConnectorId(t,e){return t.filter(r=>r.connectorId.toLowerCase()===e.toLowerCase())},getConnectionsData(t){const e=!!V.state.remoteFeatures?.multiWallet,r=Q.state.activeConnectorIds[t],n=ie.getConnections(t),i=(ie.state.recentConnections.get(t)??[]).filter(a=>Q.getConnectorById(a.connectorId)),o=lf.excludeExistingConnections([...n.map(a=>a.connectorId),...r?[r]:[]],i);return e?{connections:n,recentConnections:o}:{connections:n.filter(a=>a.connectorId.toLowerCase()===r?.toLowerCase()),recentConnections:[]}}},at=it({transactions:[],transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),GV={state:at,subscribe(t){return cr(at,()=>t(at))},setLastNetworkInView(t){at.lastNetworkInView=t},async fetchTransactions(t){if(!t)throw new Error("Transactions can't be fetched without an accountAddress");at.loading=!0;try{const e=await we.fetchTransactions({account:t,cursor:at.next,chainId:U.state.activeCaipNetwork?.caipNetworkId}),r=_d.filterSpamTransactions(e.data),n=_d.filterByConnectedChain(r),s=[...at.transactions,...n];at.loading=!1,at.transactions=s,at.transactionsByYear=_d.groupTransactionsByYearAndMonth(at.transactionsByYear,n),at.empty=s.length===0,at.next=e.next?e.next:void 0}catch{const r=U.state.activeChain;Se.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:V.state.projectId,cursor:at.next,isSmartAccount:Hn(r)===pi.ACCOUNT_TYPES.SMART_ACCOUNT}}),Ts.showError("Failed to fetch transactions"),at.loading=!1,at.empty=!0,at.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const r=t;return e.forEach(n=>{const s=new Date(n.metadata.minedAt).getFullYear(),i=new Date(n.metadata.minedAt).getMonth(),o=r[s]??{},c=(o[i]??[]).filter(l=>l.id!==n.id);r[s]={...o,[i]:[...c,n].sort((l,u)=>new Date(u.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),r},filterSpamTransactions(t){return t.filter(e=>!e.transfers.every(n=>n.nft_info?.flags.is_spam===!0))},filterByConnectedChain(t){const e=U.state.activeCaipNetwork?.caipNetworkId;return t.filter(n=>n.metadata.chain===e)},clearCursor(){at.next=void 0},resetTransactions(){at.transactions=[],at.transactionsByYear={},at.lastNetworkInView=void 0,at.loading=!1,at.empty=!1,at.next=void 0}},_d=Kn(GV,"API_ERROR"),Be=it({connections:new Map,recentConnections:new Map,isSwitchingConnection:!1,wcError:!1,buffering:!1,status:"disconnected"});let Po;const YV={state:Be,subscribe(t){return cr(Be,()=>t(Be))},subscribeKey(t,e){return lr(Be,t,e)},_getClient(){return Be._client},setClient(t){Be._client=hu(t)},initialize(t){const e=t.filter(r=>!!r.namespace).map(r=>r.namespace);ie.syncStorageConnections(e)},syncStorageConnections(t){const e=J.getConnections(),r=t??Array.from(U.state.chains.keys());for(const n of r){const s=e[n]??[],i=new Map(Be.recentConnections);i.set(n,s),Be.recentConnections=i}},getConnections(t){return t?Be.connections.get(t)??[]:[]},hasAnyConnection(t){const e=ie.state.connections;return Array.from(e.values()).flatMap(r=>r).some(({connectorId:r})=>r===t)},async connectWalletConnect({cache:t="auto"}={}){const e=ue.isTelegram()||ue.isSafari()&&ue.isIos();if(t==="always"||t==="auto"&&e){if(Po){await Po,Po=void 0;return}if(!ue.isPairingExpired(Be?.wcPairingExpiry)){const r=Be.wcUri;Be.wcUri=r;return}Po=ie._getClient()?.connectWalletConnect?.().catch(()=>{}),ie.state.status="connecting",await Po,Po=void 0,Be.wcPairingExpiry=void 0,ie.state.status="connected"}else await ie._getClient()?.connectWalletConnect?.()},async connectExternal(t,e,r=!0){const n=await ie._getClient()?.connectExternal?.(t);return r&&U.setActiveNamespace(e),n},async reconnectExternal(t){await ie._getClient()?.reconnectExternal?.(t);const e=t.chain||U.state.activeChain;e&&Q.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){if(!e)return;Ce.setLoading(!0,U.state.activeChain);const r=Q.getAuthConnector();r&&(U.setAccountProp("preferredAccountType",t,e),await r.provider.setPreferredAccount(t),J.setPreferredAccountTypes(Object.entries(U.state.chains).reduce((n,[s,i])=>{const o=s,a=Hn(o);return a!==void 0&&(n[o]=a),n},{})),await ie.reconnectExternal(r),Ce.setLoading(!1,U.state.activeChain),Se.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:U.state.activeCaipNetwork?.caipNetworkId||""}}))},async signMessage(t){return ie._getClient()?.signMessage(t)},parseUnits(t,e){return ie._getClient()?.parseUnits(t,e)},formatUnits(t,e){return ie._getClient()?.formatUnits(t,e)},updateBalance(t){return ie._getClient()?.updateBalance(t)},async sendTransaction(t){return ie._getClient()?.sendTransaction(t)},async getCapabilities(t){return ie._getClient()?.getCapabilities(t)},async grantPermissions(t){return ie._getClient()?.grantPermissions(t)},async walletGetAssets(t){return ie._getClient()?.walletGetAssets(t)??{}},async estimateGas(t){return ie._getClient()?.estimateGas(t)},async writeContract(t){return ie._getClient()?.writeContract(t)},async getEnsAddress(t){return ie._getClient()?.getEnsAddress(t)},async getEnsAvatar(t){return ie._getClient()?.getEnsAvatar(t)},checkInstalled(t){return ie._getClient()?.checkInstalled?.(t)||!1},resetWcConnection(){Be.wcUri=void 0,Be.wcPairingExpiry=void 0,Be.wcLinking=void 0,Be.recentWallet=void 0,Be.status="disconnected",_d.resetTransactions(),J.deleteWalletConnectDeepLink(),J.deleteRecentWallet()},resetUri(){Be.wcUri=void 0,Be.wcPairingExpiry=void 0,Po=void 0},finalizeWcConnection(t){const{wcLinking:e,recentWallet:r}=ie.state;e&&J.setWalletConnectDeepLink(e),r&&J.setAppKitRecent(r),t&&Se.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:t,properties:{method:e?"mobile":"qrcode",name:me.state.data?.wallet?.name||"Unknown",view:me.state.view,walletRank:r?.order}})},setWcBasic(t){Be.wcBasic=t},setUri(t){Be.wcUri=t,Be.wcPairingExpiry=ue.getPairingExpiry()},setWcLinking(t){Be.wcLinking=t},setWcError(t){Be.wcError=t,Be.buffering=!1},setRecentWallet(t){Be.recentWallet=t},setBuffering(t){Be.buffering=t},setStatus(t){Be.status=t},setIsSwitchingConnection(t){Be.isSwitchingConnection=t},async disconnect({id:t,namespace:e,initialDisconnect:r}={}){try{await ie._getClient()?.disconnect({id:t,chainNamespace:e,initialDisconnect:r})}catch(n){throw new Ea("Failed to disconnect","INTERNAL_SDK_ERROR",n)}},async disconnectConnector({id:t,namespace:e}){try{await ie._getClient()?.disconnectConnector({id:t,namespace:e})}catch(r){throw new Ea("Failed to disconnect connector","INTERNAL_SDK_ERROR",r)}},setConnections(t,e){const r=new Map(Be.connections);r.set(e,t),Be.connections=r},async handleAuthAccountSwitch({address:t,namespace:e}){const n=U.getAccountData(e)?.user?.accounts?.find(i=>i.type==="smartAccount"),s=n&&n.address.toLowerCase()===t.toLowerCase()&&fl.canSwitchToSmartAccount(e)?"smartAccount":"eoa";await ie.setPreferredAccountType(s,e)},async handleActiveConnection({connection:t,namespace:e,address:r}){const n=Q.getConnectorById(t.connectorId),s=t.connectorId===X.CONNECTOR_ID.AUTH;if(!n)throw new Error(`No connector found for connection: ${t.connectorId}`);if(s)r&&await ie.handleAuthAccountSwitch({address:r,namespace:e});else return(await ie.connectExternal({id:n.id,type:n.type,provider:n.provider,address:r,chain:e},e))?.address;return r},async handleDisconnectedConnection({connection:t,namespace:e,address:r,closeModalOnConnect:n}){const s=Q.getConnectorById(t.connectorId),i=t.auth?.name?.toLowerCase(),o=t.connectorId===X.CONNECTOR_ID.AUTH,a=t.connectorId===X.CONNECTOR_ID.WALLET_CONNECT;if(!s)throw new Error(`No connector found for connection: ${t.connectorId}`);let c;if(o)if(i&&fl.isSocialProvider(i)){const{address:l}=await fl.connectSocial({social:i,closeModalOnConnect:n,onOpenFarcaster(){Ce.open({view:"ConnectingFarcaster"})},onConnect(){me.replace("ProfileWallets")}});c=l}else{const{address:l}=await fl.connectEmail({closeModalOnConnect:n,onOpen(){Ce.open({view:"EmailLogin"})},onConnect(){me.replace("ProfileWallets")}});c=l}else if(a){const{address:l}=await fl.connectWalletConnect({walletConnect:!0,connector:s,closeModalOnConnect:n,onOpen(u){const h=u?"AllWallets":"ConnectingWalletConnect";Ce.state.open?me.push(h):Ce.open({view:h})},onConnect(){me.replace("ProfileWallets")}});c=l}else{const l=await ie.connectExternal({id:s.id,type:s.type,provider:s.provider,chain:e},e);l&&(c=l.address)}return o&&r&&await ie.handleAuthAccountSwitch({address:r,namespace:e}),c},async switchConnection({connection:t,address:e,namespace:r,closeModalOnConnect:n,onChange:s}){let i;const o=U.getAccountData(r)?.caipAddress;if(o){const{address:c}=or.parseCaipAddress(o);i=c}const a=lf.getConnectionStatus(t,r);switch(a){case"connected":case"active":{const c=await ie.handleActiveConnection({connection:t,namespace:r,address:e});if(i&&c){const l=c.toLowerCase()!==i.toLowerCase();s?.({address:c,namespace:r,hasSwitchedAccount:l,hasSwitchedWallet:a==="active"})}break}case"disconnected":{const c=await ie.handleDisconnectedConnection({connection:t,namespace:r,address:e,closeModalOnConnect:n});c&&s?.({address:c,namespace:r,hasSwitchedAccount:!0,hasSwitchedWallet:!0});break}default:throw new Error(`Invalid connection status: ${a}`)}}},ie=Kn(YV),qg={createBalance(t,e){const r={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:r.name,symbol:r.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:r.value,price:r.price,quantity:{decimals:r.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:r.decimals})},iconUrl:r.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return R0(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const r=e[1],n=parseInt(r,10);return isNaN(n)?"0x0":`0x${n.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(r=>this.isValidAsset(r)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}};let zg;async function h_(){if(!zg){const{createPublicClient:t,http:e,defineChain:r}=await sf(async()=>{const{createPublicClient:n,http:s,defineChain:i}=await import("./index-B7fs6wZ8.js");return{createPublicClient:n,http:s,defineChain:i}},[]);zg={createPublicClient:t,http:e,defineChain:r}}return zg}const Ky={getBlockchainApiRpcUrl(t,e){const r=new URL("https://rpc.walletconnect.org/v1/");return r.searchParams.set("chainId",t),r.searchParams.set("projectId",e),r.toString()},async getViemChain(t){const{defineChain:e}=await h_(),{chainId:r}=or.parseCaipNetworkId(t.caipNetworkId);return e({...t,id:Number(r)})},async createViemPublicClient(t){const{createPublicClient:e,http:r}=await h_(),n=V.state.projectId,s=await Ky.getViemChain(t);if(!s)throw new Error(`Chain ${t.caipNetworkId} not found in viem/chains`);return e({chain:s,transport:r(Ky.getBlockchainApiRpcUrl(t.caipNetworkId,n))})}},B0={async getMyTokensWithBalance(t){const e=U.getAccountData()?.address,r=U.state.activeCaipNetwork,n=Q.getConnectorId("eip155")===X.CONNECTOR_ID.AUTH;if(!e||!r)return[];const s=`${r.caipNetworkId}:${e}`,i=J.getBalanceCacheForCaipAddress(s);if(i)return i.balances;if(r.chainNamespace===X.CHAIN.EVM&&n){const a=await this.getEIP155Balances(e,r);if(a)return this.filterLowQualityTokens(a)}const o=await we.getBalance(e,r.caipNetworkId,t);return this.filterLowQualityTokens(o.balances)},async getEIP155Balances(t,e){try{const r=qg.getChainIdHexFromCAIP2ChainId(e.caipNetworkId);if(!(await ie.getCapabilities(t))?.[r]?.assetDiscovery?.supported)return null;const s=await ie.walletGetAssets({account:t,chainFilter:[r]});if(!qg.isWalletGetAssetsResponse(s))return null;const o=(s[r]||[]).map(a=>qg.createBalance(a,e.caipNetworkId));return J.updateBalanceCache({caipAddress:`${e.caipNetworkId}:${t}`,balance:{balances:o},timestamp:Date.now()}),o}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},async fetchERC20Balance({caipAddress:t,assetAddress:e,caipNetwork:r}){const n=await Ky.createViemPublicClient(r),{address:s}=or.parseCaipAddress(t),[{result:i},{result:o},{result:a},{result:c}]=await n.multicall({contracts:[{address:e,functionName:"name",args:[],abi:Uh},{address:e,functionName:"symbol",args:[],abi:Uh},{address:e,functionName:"balanceOf",args:[s],abi:Uh},{address:e,functionName:"decimals",args:[],abi:Uh}]});return{name:i,symbol:o,decimals:c,balance:a&&c?R0(a,c):"0"}}},Hg={adapters:{}},B$={state:Hg,initialize(t){Hg.adapters={...t}},get(t){return Hg.adapters[t]}},uf={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0,sui:void 0,stacks:void 0},Fr=it({providers:{...uf},providerIds:{...uf}}),ct={state:Fr,subscribeKey(t,e){return lr(Fr,t,e)},subscribe(t){return cr(Fr,()=>{t(Fr)})},subscribeProviders(t){return cr(Fr.providers,()=>t(Fr.providers))},setProvider(t,e){t&&e&&(Fr.providers[t]=hu(e))},getProvider(t){if(t)return Fr.providers[t]},setProviderId(t,e){e&&(Fr.providerIds[t]=e)},getProviderId(t){if(t)return Fr.providerIds[t]},reset(){Fr.providers={...uf},Fr.providerIds={...uf}},resetChain(t){Fr.providers[t]=void 0,Fr.providerIds[t]=void 0}},Ka=it({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),bi={state:Ka,subscribe(t){return cr(Ka,()=>t(Ka))},subscribeOpen(t){return lr(Ka,"open",t)},set(t){Object.assign(Ka,{...Ka,...t})}},ZV={async getTokenList(t){return(await we.fetchSwapTokens({chainId:t}))?.tokens?.map(n=>({...n,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0}))||[]},async fetchGasPrice(){const t=U.state.activeCaipNetwork;if(!t)return null;try{switch(t.chainNamespace){case"solana":const e=(await ie?.estimateGas({chainNamespace:"solana"}))?.toString();return{standard:e,fast:e,instant:e};case"eip155":default:return await we.fetchGasPrice({chainId:t.caipNetworkId})}}catch{return null}},async fetchSwapAllowance({tokenAddress:t,userAddress:e,sourceTokenAmount:r,sourceTokenDecimals:n}){const s=await we.fetchSwapAllowance({tokenAddress:t,userAddress:e});if(s?.allowance&&r&&n){const i=ie.parseUnits(r,n)||0;return BigInt(s.allowance)>=i}return!1},async getMyTokensWithBalance(t){const e=await B0.getMyTokensWithBalance(t);return U.setAccountProp("tokenBalance",e,U.state.activeChain),this.mapBalancesToSwapTokens(e)},mapBalancesToSwapTokens(t){return t?.map(e=>({...e,address:e?.address?e.address:U$(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1}))||[]},async handleSwapError(t){try{const e=t?.cause;return e?.json&&(await e.json())?.reasons?.[0]?.description?.includes("insufficient liquidity")?"Insufficient liquidity":void 0}catch{return}}},Oe=it({tokenBalances:[],loading:!1}),JV={state:Oe,subscribe(t){return cr(Oe,()=>t(Oe))},subscribeKey(t,e){return lr(Oe,t,e)},setToken(t){t&&(Oe.token=hu(t))},setTokenAmount(t){Oe.sendTokenAmount=t},setReceiverAddress(t){Oe.receiverAddress=t},setReceiverProfileImageUrl(t){Oe.receiverProfileImageUrl=t},setReceiverProfileName(t){Oe.receiverProfileName=t},setNetworkBalanceInUsd(t){Oe.networkBalanceInUSD=t},setLoading(t){Oe.loading=t},getSdkEventProperties(t){return{message:ue.parseError(t),isSmartAccount:Hn(U.state.activeChain)===pi.ACCOUNT_TYPES.SMART_ACCOUNT,token:Oe.token?.symbol||"",amount:Oe.sendTokenAmount??0,network:U.state.activeCaipNetwork?.caipNetworkId||""}},async sendToken(){try{switch(Ie.setLoading(!0),U.state.activeCaipNetwork?.chainNamespace){case"eip155":await Ie.sendEvmToken();return;case"solana":await Ie.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}catch(t){throw fi.isUserRejectedRequestError(t)?new E$(t):t}finally{Ie.setLoading(!1)}},async sendEvmToken(){const t=U.state.activeChain;if(!t)throw new Error("SendController:sendEvmToken - activeChainNamespace is required");const e=Hn(t);if(!Ie.state.sendTokenAmount||!Ie.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!Ie.state.token)throw new Error("A token is required");if(Ie.state.token?.address){Se.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===pi.ACCOUNT_TYPES.SMART_ACCOUNT,token:Ie.state.token.address,amount:Ie.state.sendTokenAmount,network:U.state.activeCaipNetwork?.caipNetworkId||""}});const{hash:r}=await Ie.sendERC20Token({receiverAddress:Ie.state.receiverAddress,tokenAddress:Ie.state.token.address,sendTokenAmount:Ie.state.sendTokenAmount,decimals:Ie.state.token.quantity.decimals});r&&(Oe.hash=r)}else{Se.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===pi.ACCOUNT_TYPES.SMART_ACCOUNT,token:Ie.state.token.symbol||"",amount:Ie.state.sendTokenAmount,network:U.state.activeCaipNetwork?.caipNetworkId||""}});const{hash:r}=await Ie.sendNativeToken({receiverAddress:Ie.state.receiverAddress,sendTokenAmount:Ie.state.sendTokenAmount,decimals:Ie.state.token.quantity.decimals});r&&(Oe.hash=r)}},async fetchTokenBalance(t){Oe.loading=!0;const e=U.state.activeChain,r=U.state.activeCaipNetwork?.caipNetworkId,n=U.state.activeCaipNetwork?.chainNamespace,s=U.getAccountData(e)?.caipAddress??U.state.activeCaipAddress,i=s?ue.getPlainAddress(s):void 0;if(Oe.lastRetry&&!ue.isAllowedRetry(Oe.lastRetry,30*Te.ONE_SEC_MS))return Oe.loading=!1,[];try{if(i&&r&&n){const o=await B0.getMyTokensWithBalance();return Oe.tokenBalances=o,Oe.lastRetry=void 0,o}}catch(o){Oe.lastRetry=Date.now(),t?.(o),Ts.showError("Token Balance Unavailable")}finally{Oe.loading=!1}return[]},fetchNetworkBalance(){if(Oe.tokenBalances.length===0)return;const t=ZV.mapBalancesToSwapTokens(Oe.tokenBalances);if(!t)return;const e=t.find(r=>r.address===U$());e&&(Oe.networkBalanceInUSD=e?vH.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){me.pushTransactionStack({});const e=t.receiverAddress,r=U.getAccountData()?.address,n=ie.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),i=await ie.sendTransaction({chainNamespace:X.CHAIN.EVM,to:e,address:r,data:"0x",value:n??BigInt(0)});return Se.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Hn("eip155")===pi.ACCOUNT_TYPES.SMART_ACCOUNT,token:Ie.state.token?.symbol||"",amount:t.sendTokenAmount,network:U.state.activeCaipNetwork?.caipNetworkId||"",hash:i||""}}),ie._getClient()?.updateBalance("eip155"),Ie.resetSend(),{hash:i}},async sendERC20Token(t){me.pushTransactionStack({onSuccess(){me.replace("Account")}});const e=ie.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),r=U.getAccountData()?.address;if(r&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const n=ue.getPlainAddress(t.tokenAddress);if(!n)throw new Error("SendController:sendERC20Token - tokenAddress is required");const s=await ie.writeContract({fromAddress:r,tokenAddress:n,args:[t.receiverAddress,e??BigInt(0)],method:"transfer",abi:SH.getERC20Abi(n),chainNamespace:X.CHAIN.EVM});return Se.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Hn("eip155")===pi.ACCOUNT_TYPES.SMART_ACCOUNT,token:Ie.state.token?.symbol||"",amount:t.sendTokenAmount,network:U.state.activeCaipNetwork?.caipNetworkId||"",hash:s||""}}),Ie.resetSend(),{hash:s}}return{hash:void 0}},async sendSolanaToken(){if(!Ie.state.sendTokenAmount||!Ie.state.receiverAddress)throw new Error("An amount and receiver address are required");me.pushTransactionStack({onSuccess(){me.replace("Account")}});let t;Ie.state.token&&Ie.state.token.address!==Te.SOLANA_NATIVE_TOKEN_ADDRESS&&(ue.isCaipAddress(Ie.state.token.address)?t=ue.getPlainAddress(Ie.state.token.address):t=Ie.state.token.address);const e=await ie.sendTransaction({chainNamespace:"solana",tokenMint:t,to:Ie.state.receiverAddress,value:Ie.state.sendTokenAmount});e&&(Oe.hash=e),ie._getClient()?.updateBalance("solana"),Se.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:!1,token:Ie.state.token?.symbol||"",amount:Ie.state.sendTokenAmount,network:U.state.activeCaipNetwork?.caipNetworkId||"",hash:e||""}}),Ie.resetSend()},resetSend(){Oe.token=void 0,Oe.sendTokenAmount=void 0,Oe.receiverAddress=void 0,Oe.receiverProfileImageUrl=void 0,Oe.receiverProfileName=void 0,Oe.loading=!1,Oe.tokenBalances=[]}},Ie=Kn(JV),Vg={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,user:void 0,preferredAccountType:void 0},qh={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},oe=it({chains:LH(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{connectionControllerClient:void 0},isSwitchingNamespace:!1}),L$={state:oe,subscribe(t){return cr(oe,()=>{t(oe)})},subscribeKey(t,e){return lr(oe,t,e)},subscribeAccountStateProp(t,e,r){const n=r||oe.activeChain;return n?lr(oe.chains.get(n)?.accountState||{},t,e):()=>{}},subscribeChainProp(t,e,r){let n;return cr(oe.chains,()=>{const s=r||oe.activeChain;if(s){const i=oe.chains.get(s)?.[t];n!==i&&(n=i,e(i))}})},initialize(t,e,r){const{chainId:n,namespace:s}=J.getActiveNetworkProps(),i=e?.find(u=>u.id.toString()===n?.toString()),a=t.find(u=>u?.namespace===s)||t?.[0],c=t.map(u=>u.namespace).filter(u=>u!==void 0),l=V.state.enableEmbedded?new Set([...c]):new Set([...e?.map(u=>u.chainNamespace)??[]]);(t?.length===0||!a)&&(oe.noAdapters=!0),oe.noAdapters||(oe.activeChain=a?.namespace,oe.activeCaipNetwork=i,U.setChainNetworkData(a?.namespace,{caipNetwork:i}),oe.activeChain&&bi.set({activeChain:a?.namespace})),l.forEach(u=>{const h=e?.filter(g=>g.chainNamespace===u),d=J.getPreferredAccountTypes()||{},p={...V.state.defaultAccountTypes,...d};U.state.chains.set(u,{namespace:u,networkState:it({...qh,caipNetwork:h?.[0]}),accountState:it({...Vg,preferredAccountType:p[u]}),caipNetworks:h??[],...r}),U.setRequestedCaipNetworks(h??[],u)})},removeAdapter(t){if(oe.activeChain===t){const e=Array.from(oe.chains.entries()).find(([r])=>r!==t);if(e){const r=e[1]?.caipNetworks?.[0];r&&U.setActiveCaipNetwork(r)}}oe.chains.delete(t)},addAdapter(t,{connectionControllerClient:e},r){if(!t.namespace)throw new Error("ChainController:addAdapter - adapter must have a namespace");oe.chains.set(t.namespace,{namespace:t.namespace,networkState:{...qh,caipNetwork:r[0]},accountState:{...Vg},caipNetworks:r,connectionControllerClient:e}),U.setRequestedCaipNetworks(r?.filter(n=>n.chainNamespace===t.namespace)??[],t.namespace)},addNetwork(t){const e=oe.chains.get(t.chainNamespace);if(e){const r=[...e.caipNetworks||[]];e.caipNetworks?.find(n=>n.id===t.id)||r.push(t),oe.chains.set(t.chainNamespace,{...e,caipNetworks:r}),U.setRequestedCaipNetworks(r,t.chainNamespace),Q.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){const r=oe.chains.get(t);if(r){const n=oe.activeCaipNetwork?.id===e,s=[...r.caipNetworks?.filter(i=>i.id!==e)||[]];n&&r?.caipNetworks?.[0]&&U.setActiveCaipNetwork(r.caipNetworks[0]),oe.chains.set(t,{...r,caipNetworks:s}),U.setRequestedCaipNetworks(s||[],t),s.length===0&&Q.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const r=oe.chains.get(t);r&&(r.networkState={...r.networkState||qh,...e},oe.chains.set(t,r))},setChainAccountData(t,e,r=!0){if(!t)throw new Error("Chain is required to update chain account data");const n=oe.chains.get(t);if(n){const s={...n.accountState||Vg,...e};oe.chains.set(t,{...n,accountState:s}),(oe.chains.size===1||oe.activeChain===t)&&e.caipAddress&&(oe.activeCaipAddress=e.caipAddress)}},setChainNetworkData(t,e){if(!t)return;const r=oe.chains.get(t);if(r){const n={...r.networkState||qh,...e};oe.chains.set(t,{...r,networkState:n})}},setAccountProp(t,e,r,n=!0){U.setChainAccountData(r,{[t]:e},n)},setActiveNamespace(t){oe.activeChain=t;const e=t?oe.chains.get(t):void 0,r=e?.networkState?.caipNetwork;r?.id&&t&&(oe.activeCaipAddress=e?.accountState?.caipAddress,oe.activeCaipNetwork=r,U.setChainNetworkData(t,{caipNetwork:r}),J.setActiveCaipNetworkId(r?.caipNetworkId),bi.set({activeChain:t,selectedNetworkId:r?.caipNetworkId}))},setActiveCaipNetwork(t){if(!t)return;const e=oe.activeChain===t.chainNamespace;e||U.setIsSwitchingNamespace(!0);const r=oe.chains.get(t.chainNamespace);oe.activeChain=t.chainNamespace,oe.activeCaipNetwork=t,U.setChainNetworkData(t.chainNamespace,{caipNetwork:t});let n=r?.accountState?.address;if(n)oe.activeCaipAddress=`${t.chainNamespace}:${t.id}:${n}`;else if(e&&oe.activeCaipAddress){const{address:i}=or.parseCaipAddress(oe.activeCaipAddress);n=i,oe.activeCaipAddress=`${t.caipNetworkId}:${n}`}else oe.activeCaipAddress=void 0;U.setChainAccountData(t.chainNamespace,{address:n,caipAddress:oe.activeCaipAddress}),Ie.resetSend(),bi.set({activeChain:oe.activeChain,selectedNetworkId:oe.activeCaipNetwork?.caipNetworkId}),J.setActiveCaipNetworkId(t.caipNetworkId),!U.checkIfSupportedNetwork(t.chainNamespace)&&V.state.enableNetworkSwitch&&!V.state.allowUnsupportedChain&&!ie.state.wcBasic&&U.showUnsupportedChainUI()},addCaipNetwork(t){if(!t)return;const e=oe.chains.get(t.chainNamespace);e&&e?.caipNetworks?.push(t)},async switchActiveNamespace(t){if(!t)return;const e=t!==U.state.activeChain,r=U.getNetworkData(t)?.caipNetwork,n=U.getCaipNetworkByNamespace(t,r?.id);e&&n&&await U.switchActiveNetwork(n)},async switchActiveNetwork(t,{throwOnFailure:e=!1}={}){const r=U.state.activeChain;if(!r)throw new Error("ChainController:switchActiveNetwork - namespace is required");const n=ct.getProviderId(oe.activeChain)==="AUTH",s=U.getAccountData(r)?.address,i=X.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(t.chainNamespace);try{if(s&&t.chainNamespace===r||n&&i){const o=B$.get(t.chainNamespace);if(!o)throw new Error("Adapter not found");await o.switchNetwork({caipNetwork:t})}U.setActiveCaipNetwork(t)}catch(o){if(e)throw o}Se.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})},getConnectionControllerClient(t){const e=t||oe.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const r=oe.chains.get(e);if(!r?.connectionControllerClient)throw new Error("ConnectionController client not set");return r.connectionControllerClient},getNetworkProp(t,e){const r=oe.chains.get(e)?.networkState;if(r)return r[t]},getRequestedCaipNetworks(t){const e=oe.chains.get(t),{approvedCaipNetworkIds:r=[],requestedCaipNetworks:n=[]}=e?.networkState||{};return ue.sortRequestedNetworks(r,n).filter(o=>o?.id)},getAllRequestedCaipNetworks(){const t=[];return oe.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllRequestedCaipNetworks - chainAdapter must have a namespace");const r=U.getRequestedCaipNetworks(e.namespace);t.push(...r)}),t},setRequestedCaipNetworks(t,e){U.setAdapterNetworkState(e,{requestedCaipNetworks:t});const n=U.getAllRequestedCaipNetworks().map(i=>i.chainNamespace),s=Array.from(new Set(n));Q.filterByNamespaces(s)},getAllApprovedCaipNetworkIds(){const t=[];return oe.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllApprovedCaipNetworkIds - chainAdapter must have a namespace");const r=U.getApprovedCaipNetworkIds(e.namespace);t.push(...r)}),t},getActiveCaipNetwork(t){return t?oe.chains.get(t)?.networkState?.caipNetwork:oe.activeCaipNetwork},getActiveCaipAddress(){return oe.activeCaipAddress},getApprovedCaipNetworkIds(t){return oe.chains.get(t)?.networkState?.approvedCaipNetworkIds||[]},setApprovedCaipNetworksData(t,e){U.setAdapterNetworkState(t,e)},checkIfSupportedNetwork(t,e){const r=e||oe.activeCaipNetwork?.caipNetworkId,n=U.getRequestedCaipNetworks(t);return n.length?n?.some(s=>s.caipNetworkId===r):!0},checkIfSupportedChainId(t){return oe.activeChain?U.getRequestedCaipNetworks(oe.activeChain)?.some(r=>r.id===t):!0},checkIfSmartAccountEnabled(){const t=y$.caipNetworkIdToNumber(oe.activeCaipNetwork?.caipNetworkId);return!oe.activeChain||!t?!1:!!(jH.get(Ed.SMART_ACCOUNT_ENABLED_NETWORKS)?.split(",")||[])?.includes(t.toString())},showUnsupportedChainUI(){Ce.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=oe.activeCaipNetwork;return!!(t?.chainNamespace&&Te.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){U.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0})},resetAccount(t){const e=t;if(!e)throw new Error("Chain is required to set account prop");const r=U.state.chains.get(e)?.accountState?.preferredAccountType,n=V.state.defaultAccountTypes[e];oe.activeCaipAddress=void 0,U.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:n||r,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,user:void 0,status:"disconnected"}),Q.removeConnectorId(e)},setIsSwitchingNamespace(t){oe.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){const t=[];let e;if(oe.chains.forEach(r=>{X.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(n=>n===r.namespace)&&r.namespace&&t.push(r.namespace)}),t.length>0){const r=t[0];return e=r?oe.chains.get(r)?.caipNetworks?.[0]:void 0,e}},getAccountData(t){const e=t||oe.activeChain;if(e)return U.state.chains.get(e)?.accountState},getNetworkData(t){const e=t||oe.activeChain;if(e)return U.state.chains.get(e)?.networkState},getCaipNetworkByNamespace(t,e){if(!t)return;const r=U.state.chains.get(t),n=r?.caipNetworks?.find(s=>s.id.toString()===e?.toString());return n||r?.networkState?.caipNetwork||r?.caipNetworks?.[0]},getRequestedCaipNetworkIds(){const t=Q.state.filterByNamespace;return(t?[oe.chains.get(t)]:Array.from(oe.chains.values())).flatMap(r=>r?.caipNetworks||[]).map(r=>r.caipNetworkId)},getCaipNetworks(t){return t?U.getRequestedCaipNetworks(t):U.getAllRequestedCaipNetworks()},getCaipNetworkById(t,e){return L$.getCaipNetworks(e).find(r=>r.id.toString()===t.toString()||r.caipNetworkId.toString()===t.toString())},setLastConnectedSIWECaipNetwork(t){oe.lastConnectedSIWECaipNetwork=t},getLastConnectedSIWECaipNetwork(){return oe.lastConnectedSIWECaipNetwork},async fetchTokenBalance(t){const e=U.getAccountData();if(!e)return[];const r=U.state.activeCaipNetwork?.caipNetworkId,n=U.state.activeCaipNetwork?.chainNamespace,s=U.state.activeCaipAddress,i=s?ue.getPlainAddress(s):void 0;if(U.setAccountProp("balanceLoading",!0,n),e.lastRetry&&!ue.isAllowedRetry(e.lastRetry,30*Te.ONE_SEC_MS))return U.setAccountProp("balanceLoading",!1,n),[];try{if(i&&r&&n){const o=await B0.getMyTokensWithBalance();return U.setAccountProp("tokenBalance",o,n),U.setAccountProp("lastRetry",void 0,n),U.setAccountProp("balanceLoading",!1,n),o}}catch(o){U.setAccountProp("lastRetry",Date.now(),n),t?.(o),Ts.showError("Token Balance Unavailable")}finally{U.setAccountProp("balanceLoading",!1,n)}return[]},isCaipNetworkDisabled(t){const e=t.chainNamespace,r=!!U.getAccountData(e)?.caipAddress,n=U.getAllApprovedCaipNetworkIds(),s=U.getNetworkProp("supportsAllNetworks",e)!==!1,i=Q.getConnectorId(e),o=Q.getAuthConnector(),a=i===X.CONNECTOR_ID.AUTH&&o;return!r||s||a?!1:!n?.includes(t.caipNetworkId)}},U=Kn(L$),XV={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){const r=U.state.activeCaipNetwork,n=U.state.activeChain,s=me.state.data;if(t.id===r?.id)return;const o=!!U.getAccountData(n)?.address,a=!!U.getAccountData(t.chainNamespace)?.address,c=t.chainNamespace!==n,u=Q.getConnectorId(n)===X.CONNECTOR_ID.AUTH,h=X.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(d=>d===t.chainNamespace);e||u&&h?me.push("SwitchNetwork",{...s,network:t}):o&&c&&!a?me.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):me.push("SwitchNetwork",{...s,network:t})}},qr=it({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),QV={state:qr,subscribe(t){return cr(qr,()=>t(qr))},subscribeKey(t,e){return lr(qr,t,e)},async open(t){const e=t?.namespace,r=U.state.activeChain,n=e&&e!==r,s=U.getAccountData(t?.namespace)?.caipAddress,i=U.state.noAdapters;if(ie.state.wcBasic?de.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1}):await de.prefetch(),Q.setFilterByNamespace(t?.namespace),Ce.setLoading(!0,e),e&&n){const o=U.getNetworkData(e)?.caipNetwork||U.getRequestedCaipNetworks(e)[0];o&&(i?(await U.switchActiveNetwork(o),me.push("ConnectingWalletConnectBasic")):XV.onSwitchNetwork({network:o,ignoreSwitchConfirmation:!0}))}else V.state.manualWCControl||i&&!s?ue.isMobile()?me.reset("AllWallets"):me.reset("ConnectingWalletConnectBasic"):t?.view?me.reset(t.view,t.data):s?me.reset("Account"):me.reset("Connect");qr.open=!0,bi.set({open:!0}),Se.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!s}})},close(){const t=V.state.enableEmbedded,e=!!U.state.activeCaipAddress;qr.open&&Se.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),qr.open=!1,me.reset("Connect"),Ce.clearLoading(),t?e?me.replace("Account"):me.push("Connect"):bi.set({open:!1}),ie.resetUri()},setLoading(t,e){e&&qr.loadingNamespaceMap.set(e,t),qr.loading=t,bi.set({loading:t})},clearLoading(){qr.loadingNamespaceMap.clear(),qr.loading=!1,bi.set({loading:!1})},shake(){qr.shake||(qr.shake=!0,setTimeout(()=>{qr.shake=!1},500))}},Ce=Kn(QV),ql={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},Gy={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},eW={providers:I$,selectedProvider:null,error:null,purchaseCurrency:ql,paymentCurrency:Gy,purchaseCurrencies:[ql],paymentCurrencies:[],quotesLoading:!1},Pe=it(eW),tW={state:Pe,subscribe(t){return cr(Pe,()=>t(Pe))},subscribeKey(t,e){return lr(Pe,t,e)},setSelectedProvider(t){if(t&&t.name==="meld"){const e=U.state.activeChain,r=e===X.CHAIN.SOLANA?"SOL":"USDC",n=e?U.state.chains.get(e)?.accountState?.address??"":"",s=new URL(t.url);s.searchParams.append("publicKey",MH),s.searchParams.append("destinationCurrencyCode",r),s.searchParams.append("walletAddress",n),s.searchParams.append("externalCustomerId",V.state.projectId),Pe.selectedProvider={...t,url:s.toString()}}else Pe.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,r=I$.filter(n=>e.includes(n.name));Pe.providers=r}else Pe.providers=[]},setPurchaseCurrency(t){Pe.purchaseCurrency=t},setPaymentCurrency(t){Pe.paymentCurrency=t},setPurchaseAmount(t){Yy.state.purchaseAmount=t},setPaymentAmount(t){Yy.state.paymentAmount=t},async getAvailableCurrencies(){const t=await we.getOnrampOptions();Pe.purchaseCurrencies=t.purchaseCurrencies,Pe.paymentCurrencies=t.paymentCurrencies,Pe.paymentCurrency=t.paymentCurrencies[0]||Gy,Pe.purchaseCurrency=t.purchaseCurrencies[0]||ql,await de.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await de.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){Pe.quotesLoading=!0;try{const t=await we.getOnrampQuote({purchaseCurrency:Pe.purchaseCurrency,paymentCurrency:Pe.paymentCurrency,amount:Pe.paymentAmount?.toString()||"0",network:Pe.purchaseCurrency?.symbol});return Pe.quotesLoading=!1,Pe.purchaseAmount=Number(t?.purchaseAmount.amount),t}catch(t){return Pe.error=t.message,Pe.quotesLoading=!1,null}finally{Pe.quotesLoading=!1}},resetState(){Pe.selectedProvider=null,Pe.error=null,Pe.purchaseCurrency=ql,Pe.paymentCurrency=Gy,Pe.purchaseCurrencies=[ql],Pe.paymentCurrencies=[],Pe.paymentAmount=void 0,Pe.purchaseAmount=void 0,Pe.quotesLoading=!1}},Yy=Kn(tW);let rW=class extends nn{constructor(e){super()}};const d_=z.FIVE_SECONDS,Da={pulse:"heartbeat_pulse"};let nW=class M$ extends rW{constructor(e){super(e),this.events=new mt.EventEmitter,this.interval=d_,this.interval=e?.interval||d_}static async init(e){const r=new M$(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),z.toMiliseconds(this.interval))}pulse(){this.events.emit(Da.pulse)}};var pl={exports:{}},f_;function sW(){if(f_)return pl.exports;f_=1;const t=Xw();pl.exports=u;const e=T().console||{},r={mapHttpRequest:P,mapHttpResponse:P,wrapRequestSerializer:R,wrapResponseSerializer:R,wrapErrorSerializer:R,req:P,res:P,err:C,errWithCause:C};function n(f,y){return f==="silent"?1/0:y.levels.values[f]}const s=Symbol("pino.logFuncs"),i=Symbol("pino.hierarchy"),o={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function a(f,y){const E={logger:y,parent:f[i]};y[i]=E}function c(f,y,E){const x={};y.forEach(_=>{x[_]=E[_]?E[_]:e[_]||e[o[_]||"log"]||O}),f[s]=x}function l(f,y){return Array.isArray(f)?f.filter(function(x){return x!=="!stdSerializers.err"}):f===!0?Object.keys(y):!1}function u(f){f=f||{},f.browser=f.browser||{};const y=f.browser.transmit;if(y&&typeof y.send!="function")throw Error("pino: transmit option must have a send function");const E=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const x=f.serializers||{},_=l(f.browser.serialize,x);let A=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(A=!1);const L=Object.keys(f.customLevels||{}),B=["error","fatal","warn","info","debug","trace"].concat(L);typeof E=="function"&&B.forEach(function(G){E[G]=E}),(f.enabled===!1||f.browser.disabled)&&(f.level="silent");const q=f.level||"info",D=Object.create(E);D.log||(D.log=O),c(D,B,E),a({},D),Object.defineProperty(D,"levelVal",{get:H}),Object.defineProperty(D,"level",{get:W,set:ee});const F={transmit:y,serialize:_,asObject:f.browser.asObject,asObjectBindingsOnly:f.browser.asObjectBindingsOnly,formatters:f.browser.formatters,levels:B,timestamp:N(f),messageKey:f.messageKey||"msg",onChild:f.onChild||O};D.levels=h(f),D.level=q,D.isLevelEnabled=function(G){return this.levels.values[G]?this.levels.values[G]>=this.levels.values[this.level]:!1},D.setMaxListeners=D.getMaxListeners=D.emit=D.addListener=D.on=D.prependListener=D.once=D.prependOnceListener=D.removeListener=D.removeAllListeners=D.listeners=D.listenerCount=D.eventNames=D.write=D.flush=O,D.serializers=x,D._serialize=_,D._stdErrSerialize=A,D.child=function(...G){return K.call(this,F,...G)},y&&(D._logEvent=b());function H(){return n(this.level,this)}function W(){return this._level}function ee(G){if(G!=="silent"&&!this.levels.values[G])throw Error("unknown level "+G);this._level=G,g(this,F,D,"error"),g(this,F,D,"fatal"),g(this,F,D,"warn"),g(this,F,D,"info"),g(this,F,D,"debug"),g(this,F,D,"trace"),L.forEach(le=>{g(this,F,D,le)})}function K(G,le,ye){if(!le)throw new Error("missing bindings for child Pino");ye=ye||{},_&&le.serializers&&(ye.serializers=le.serializers);const ve=ye.serializers;if(_&&ve){var Ee=Object.assign({},x,ve),Ke=f.browser.serialize===!0?Object.keys(Ee):_;delete le.serializers,S([le],Ke,Ee,this._stdErrSerialize)}function gr(mr){this._childLevel=(mr._childLevel|0)+1,this.bindings=le,Ee&&(this.serializers=Ee,this._serialize=Ke),y&&(this._logEvent=b([].concat(mr._logEvent.bindings,le)))}gr.prototype=this;const Ot=new gr(this);return a(this,Ot),Ot.child=function(...mr){return K.call(this,G,...mr)},Ot.level=ye.level||this.level,G.onChild(Ot),Ot}return D}function h(f){const y=f.customLevels||{},E=Object.assign({},u.levels.values,y),x=Object.assign({},u.levels.labels,d(y));return{values:E,labels:x}}function d(f){const y={};return Object.keys(f).forEach(function(E){y[f[E]]=E}),y}u.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},u.stdSerializers=r,u.stdTimeFunctions=Object.assign({},{nullTime:M,epochTime:j,unixTime:k,isoTime:$});function p(f){const y=[];f.bindings&&y.push(f.bindings);let E=f[i];for(;E.parent;)E=E.parent,E.logger.bindings&&y.push(E.logger.bindings);return y.reverse()}function g(f,y,E,x){if(Object.defineProperty(f,x,{value:n(f.level,E)>n(x,E)?O:E[s][x],writable:!0,enumerable:!0,configurable:!0}),f[x]===O){if(!y.transmit)return;const A=y.transmit.level||f.level,L=n(A,E);if(n(x,E)<L)return}f[x]=w(f,y,E,x);const _=p(f);_.length!==0&&(f[x]=m(_,f[x]))}function m(f,y){return function(){return y.apply(this,[...f,...arguments])}}function w(f,y,E,x){return(function(_){return function(){const L=y.timestamp(),B=new Array(arguments.length),q=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var D=0;D<B.length;D++)B[D]=arguments[D];var F=!1;if(y.serialize&&(S(B,this._serialize,this.serializers,this._stdErrSerialize),F=!0),y.asObject||y.formatters?_.call(q,...I(this,x,B,L,y)):_.apply(q,B),y.transmit){const H=y.transmit.level||f._level,W=n(H,E),ee=n(x,E);if(ee<W)return;v(this,{ts:L,methodLevel:x,methodValue:ee,transmitValue:E.levels.values[y.transmit.level||f._level],send:y.transmit.send,val:n(f._level,E)},B,F)}}})(f[s][x])}function I(f,y,E,x,_){const{level:A,log:L=H=>H}=_.formatters||{},B=E.slice();let q=B[0];const D={};let F=(f._childLevel|0)+1;if(F<1&&(F=1),x&&(D.time=x),A){const H=A(y,f.levels.values[y]);Object.assign(D,H)}else D.level=f.levels.values[y];if(_.asObjectBindingsOnly){if(q!==null&&typeof q=="object")for(;F--&&typeof B[0]=="object";)Object.assign(D,B.shift());return[L(D),...B]}else{if(q!==null&&typeof q=="object"){for(;F--&&typeof B[0]=="object";)Object.assign(D,B.shift());q=B.length?t(B.shift(),B):void 0}else typeof q=="string"&&(q=t(B.shift(),B));return q!==void 0&&(D[_.messageKey]=q),[L(D)]}}function S(f,y,E,x){for(const _ in f)if(x&&f[_]instanceof Error)f[_]=u.stdSerializers.err(f[_]);else if(typeof f[_]=="object"&&!Array.isArray(f[_])&&y)for(const A in f[_])y.indexOf(A)>-1&&A in E&&(f[_][A]=E[A](f[_][A]))}function v(f,y,E,x=!1){const _=y.send,A=y.ts,L=y.methodLevel,B=y.methodValue,q=y.val,D=f._logEvent.bindings;x||S(E,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=A,f._logEvent.messages=E.filter(function(F){return D.indexOf(F)===-1}),f._logEvent.level.label=L,f._logEvent.level.value=B,_(L,f._logEvent,q),f._logEvent=b(D)}function b(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function C(f){const y={type:f.constructor.name,msg:f.message,stack:f.stack};for(const E in f)y[E]===void 0&&(y[E]=f[E]);return y}function N(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?M:j}function P(){return{}}function R(f){return f}function O(){}function M(){return!1}function j(){return Date.now()}function k(){return Math.round(Date.now()/1e3)}function $(){return new Date(Date.now()).toISOString()}function T(){function f(y){return typeof y<"u"&&y}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return pl.exports.default=u,pl.exports.pino=u,pl.exports}var rc=sW();const j$=zu(rc),iW={level:"info"},cp="custom_context",L0=1e3*1024;var oW=Object.defineProperty,aW=(t,e,r)=>e in t?oW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oo=(t,e,r)=>aW(t,typeof e!="symbol"?e+"":e,r);let cW=class{constructor(e){oo(this,"nodeValue"),oo(this,"sizeInBytes"),oo(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},p_=class{constructor(e){oo(this,"lengthInNodes"),oo(this,"sizeInBytes"),oo(this,"head"),oo(this,"tail"),oo(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new cW(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};var lW=Object.defineProperty,uW=(t,e,r)=>e in t?lW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zh=(t,e,r)=>uW(t,typeof e!="symbol"?e+"":e,r);let F$=class{constructor(e,r=L0){zh(this,"logs"),zh(this,"level"),zh(this,"levelValue"),zh(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=rc.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new p_(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===rc.levels.values.error?console.error(e):r===rc.levels.values.warn?console.warn(e):r===rc.levels.values.debug?console.debug(e):r===rc.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Br({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new p_(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Br({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var hW=Object.defineProperty,dW=(t,e,r)=>e in t?hW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fW=(t,e,r)=>dW(t,e+"",r);let pW=class{constructor(e,r=L0){fW(this,"baseChunkLogger"),this.baseChunkLogger=new F$(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var gW=Object.defineProperty,mW=(t,e,r)=>e in t?gW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yW=(t,e,r)=>mW(t,e+"",r);let wW=class{constructor(e,r=L0){yW(this,"baseChunkLogger"),this.baseChunkLogger=new F$(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var bW=Object.defineProperty,vW=Object.defineProperties,EW=Object.getOwnPropertyDescriptors,g_=Object.getOwnPropertySymbols,_W=Object.prototype.hasOwnProperty,IW=Object.prototype.propertyIsEnumerable,m_=(t,e,r)=>e in t?bW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hf=(t,e)=>{for(var r in e||(e={}))_W.call(e,r)&&m_(t,r,e[r]);if(g_)for(var r of g_(e))IW.call(e,r)&&m_(t,r,e[r]);return t},df=(t,e)=>vW(t,EW(e));function SW(t){return df(hf({},t),{level:t?.level||iW.level})}function CW(t,e,r=cp){return t[r]=e,t}function an(t,e=cp){return t[e]||""}function xW(t,e,r=cp){const n=an(t,r);return n.trim()?`${n}/${e}`:e}function Cn(t,e,r=cp){const n=xW(t,e,r),s=t.child({context:n});return CW(s,n,r)}function AW(t){var e,r;const n=new pW((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:j$(df(hf({},t.opts),{level:"trace",browser:df(hf({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function $W(t){var e;const r=new wW((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:j$(df(hf({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function q$(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?AW(t):$W(t)}var NW=Object.defineProperty,OW=(t,e,r)=>e in t?NW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y_=(t,e,r)=>OW(t,typeof e!="symbol"?e+"":e,r);let TW=class extends nn{constructor(e){super(),this.opts=e,y_(this,"protocol","wc"),y_(this,"version",2)}};var kW=Object.defineProperty,PW=(t,e,r)=>e in t?kW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,RW=(t,e,r)=>PW(t,e+"",r);let DW=class extends nn{constructor(e,r){super(),this.core=e,this.logger=r,RW(this,"records",new Map)}},UW=class{constructor(e,r){this.logger=e,this.core=r}},BW=class extends nn{constructor(e,r){super(),this.relayer=e,this.logger=r}},LW=class extends nn{constructor(e){super()}},MW=class{constructor(e,r,n,s){this.core=e,this.logger=r,this.name=n}},jW=class extends nn{constructor(e,r){super(),this.relayer=e,this.logger=r}},FW=class extends nn{constructor(e,r){super(),this.core=e,this.logger=r}},qW=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},zW=class{constructor(e,r){this.projectId=e,this.logger=r}},HW=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}};var VW=Object.defineProperty,WW=(t,e,r)=>e in t?VW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,w_=(t,e,r)=>WW(t,typeof e!="symbol"?e+"":e,r);let KW=class{constructor(e){this.opts=e,w_(this,"protocol","wc"),w_(this,"version",2)}},GW=class{constructor(e){this.client=e}};const YW="0.1.1";function ZW(){return YW}class ht extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof ht){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),s=r.cause instanceof ht&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||s?["",n?`Details: ${n}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${ZW()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return z$(this,e)}}function z$(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?z$(t.cause,e):e?null:t}const Ga=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function JW(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ku(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function _a(t,...e){if(!JW(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function XW(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ku(t.outputLen),ku(t.blockLen)}function Rc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function H$(t,e){_a(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function QW(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Dc(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Wg(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function vs(t,e){return t<<32-e|t>>>e}const eK=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function tK(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function rK(t){for(let e=0;e<t.length;e++)t[e]=tK(t[e]);return t}const b_=eK?t=>t:rK;function nK(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function lp(t){return typeof t=="string"&&(t=nK(t)),_a(t),t}function sK(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];_a(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}class M0{}function V$(t){const e=n=>t().update(lp(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function iK(t=32){if(Ga&&typeof Ga.getRandomValues=="function")return Ga.getRandomValues(new Uint8Array(t));if(Ga&&typeof Ga.randomBytes=="function")return Uint8Array.from(Ga.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function oK(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function aK(t,e,r){return t&e^~t&r}function cK(t,e,r){return t&e^t&r^e&r}class lK extends M0{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Wg(this.buffer)}update(e){Rc(this),e=lp(e),_a(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Wg(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rc(this),H$(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,Dc(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;oK(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Wg(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const ji=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Hh=BigInt(2**32-1),v_=BigInt(32);function uK(t,e=!1){return e?{h:Number(t&Hh),l:Number(t>>v_&Hh)}:{h:Number(t>>v_&Hh)|0,l:Number(t&Hh)|0}}function hK(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=uK(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const dK=(t,e,r)=>t<<r|e>>>32-r,fK=(t,e,r)=>e<<r|t>>>32-r,pK=(t,e,r)=>e<<r-32|t>>>64-r,gK=(t,e,r)=>t<<r-32|e>>>64-r,mK=BigInt(0),gl=BigInt(1),yK=BigInt(2),wK=BigInt(7),bK=BigInt(256),vK=BigInt(113),W$=[],K$=[],G$=[];for(let t=0,e=gl,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],W$.push(2*(5*n+r)),K$.push((t+1)*(t+2)/2%64);let s=mK;for(let i=0;i<7;i++)e=(e<<gl^(e>>wK)*vK)%bK,e&yK&&(s^=gl<<(gl<<BigInt(i))-gl);G$.push(s)}const Y$=hK(G$,!0),EK=Y$[0],_K=Y$[1],E_=(t,e,r)=>r>32?pK(t,e,r):dK(t,e,r),__=(t,e,r)=>r>32?gK(t,e,r):fK(t,e,r);function IK(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=E_(l,u,1)^r[a],d=__(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=K$[o],c=E_(s,i,a),l=__(s,i,a),u=W$[o];s=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=EK[n],t[1]^=_K[n]}Dc(r)}class j0 extends M0{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,ku(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=QW(this.state)}clone(){return this._cloneInto()}keccak(){b_(this.state32),IK(this.state32,this.rounds),b_(this.state32),this.posOut=0,this.pos=0}update(e){Rc(this),e=lp(e),_a(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Rc(this,!1),_a(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ku(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(H$(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Dc(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new j0(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const SK=(t,e,r)=>V$(()=>new j0(e,t,r)),CK=SK(1,136,256/8),xK=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Fi=new Uint32Array(64);class AK extends lK{constructor(e=32){super(64,e,8,!1),this.A=ji[0]|0,this.B=ji[1]|0,this.C=ji[2]|0,this.D=ji[3]|0,this.E=ji[4]|0,this.F=ji[5]|0,this.G=ji[6]|0,this.H=ji[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Fi[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=Fi[h-15],p=Fi[h-2],g=vs(d,7)^vs(d,18)^d>>>3,m=vs(p,17)^vs(p,19)^p>>>10;Fi[h]=m+Fi[h-7]+g+Fi[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=vs(a,6)^vs(a,11)^vs(a,25),p=u+d+aK(a,c,l)+xK[h]+Fi[h]|0,m=(vs(n,2)^vs(n,13)^vs(n,22))+cK(n,s,i)|0;u=l,l=c,c=a,a=o+p|0,o=i,i=s,s=n,n=p+m|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){Dc(Fi)}destroy(){this.set(0,0,0,0,0,0,0,0),Dc(this.buffer)}}const $K=V$(()=>new AK);const F0=BigInt(0),Zy=BigInt(1);function oh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function q0(t){if(!oh(t))throw new Error("Uint8Array expected")}function Pu(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Vh(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Z$(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?F0:BigInt("0x"+t)}const J$=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",NK=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ru(t){if(q0(t),J$)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=NK[t[r]];return e}const Ys={_0:48,_9:57,A:65,F:70,a:97,f:102};function I_(t){if(t>=Ys._0&&t<=Ys._9)return t-Ys._0;if(t>=Ys.A&&t<=Ys.F)return t-(Ys.A-10);if(t>=Ys.a&&t<=Ys.f)return t-(Ys.a-10)}function ff(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(J$)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=I_(t.charCodeAt(i)),a=I_(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function pa(t){return Z$(Ru(t))}function X$(t){return q0(t),Z$(Ru(Uint8Array.from(t).reverse()))}function ah(t,e){return ff(t.toString(16).padStart(e*2,"0"))}function Q$(t,e){return ah(t,e).reverse()}function jn(t,e,r){let n;if(typeof e=="string")try{n=ff(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(oh(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function pf(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];q0(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const Kg=t=>typeof t=="bigint"&&F0<=t;function z0(t,e,r){return Kg(t)&&Kg(e)&&Kg(r)&&e<=t&&t<r}function mc(t,e,r,n){if(!z0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function OK(t){let e;for(e=0;t>F0;t>>=Zy,e+=1);return e}const up=t=>(Zy<<BigInt(t))-Zy,Gg=t=>new Uint8Array(t),S_=t=>Uint8Array.from(t);function TK(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Gg(t),s=Gg(t),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...h)=>r(s,n,...h),c=(h=Gg(0))=>{s=a(S_([0]),h),n=a(),h.length!==0&&(s=a(S_([1]),h),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){n=a();const p=n.slice();d.push(p),h+=n.length}return pf(...d)};return(h,d)=>{o(),c(h);let p;for(;!(p=d(l()));)c();return o(),p}}const kK={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||oh(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function hp(t,e,r={}){const n=(s,i,o)=>{const a=kK[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function C_(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}function PK(t,e){if(N_(t)>e)throw new eG({givenSize:N_(t),maxSize:e})}const Zs={zero:48,nine:57,A:65,F:70,a:97,f:102};function x_(t){if(t>=Zs.zero&&t<=Zs.nine)return t-Zs.zero;if(t>=Zs.A&&t<=Zs.F)return t-(Zs.A-10);if(t>=Zs.a&&t<=Zs.f)return t-(Zs.a-10)}function RK(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new tG({size:t.length,targetSize:n,type:"Bytes"});const s=new Uint8Array(n);for(let i=0;i<n;i++){const o=r==="right";s[o?i:n-i-1]=t[o?i:t.length-i-1]}return s}function eN(t,e){if(_o(t)>e)throw new HK({givenSize:_o(t),maxSize:e})}function DK(t,e){if(typeof e=="number"&&e>0&&e>_o(t)-1)throw new nN({offset:e,position:"start",size:_o(t)})}function UK(t,e,r){if(typeof e=="number"&&typeof r=="number"&&_o(t)!==r-e)throw new nN({offset:r,position:"end",size:_o(t)})}function tN(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const s=t.replace("0x","");if(s.length>n*2)throw new VK({size:Math.ceil(s.length/2),targetSize:n,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const BK="#__bigint";function H0(t,e,r){return JSON.stringify(t,(n,s)=>typeof s=="bigint"?s.toString()+BK:s,r)}const LK=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function MK(t,e={}){const{strict:r=!1}=e;if(!t)throw new A_(t);if(typeof t!="string")throw new A_(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new $_(t);if(!t.startsWith("0x"))throw new $_(t)}function jK(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function V0(t){return t instanceof Uint8Array?gf(t):Array.isArray(t)?gf(new Uint8Array(t)):t}function gf(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=LK[t[s]];const n=`0x${r}`;return typeof e.size=="number"?(eN(n,e.size),rN(n,e.size)):n}function Yg(t,e={}){const{signed:r,size:n}=e,s=BigInt(t);let i;n?r?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&r?-i-1n:0;if(i&&s>i||s<o){const l=typeof t=="bigint"?"n":"";throw new zK({max:i?`${i}${l}`:void 0,min:`${o}${l}`,signed:r,size:n,value:`${t}${l}`})}const c=`0x${(r&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?FK(c,n):c}function FK(t,e){return tN(t,{dir:"left",size:e})}function rN(t,e){return tN(t,{dir:"right",size:e})}function ii(t,e,r,n={}){const{strict:s}=n;DK(t,e);const i=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&UK(i,e,r),i}function _o(t){return Math.ceil((t.length-2)/2)}function qK(t,e={}){const{strict:r=!1}=e;try{return MK(t,{strict:r}),!0}catch{return!1}}class zK extends ht{constructor({max:e,min:r,signed:n,size:s,value:i}){super(`Number \`${i}\` is not in safe${s?` ${s*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class A_ extends ht{constructor(e){super(`Value \`${typeof e=="object"?H0(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class $_ extends ht{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let HK=class extends ht{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class nN extends ht{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let VK=class extends ht{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const WK=new TextEncoder;function KK(t){if(!(t instanceof Uint8Array)){if(!t)throw new Wh(t);if(typeof t!="object")throw new Wh(t);if(!("BYTES_PER_ELEMENT"in t))throw new Wh(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Wh(t)}}function GK(t){return t instanceof Uint8Array?t:typeof t=="string"?ZK(t):YK(t)}function YK(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function ZK(t,e={}){const{size:r}=e;let n=t;r&&(eN(t,r),n=rN(t,r));let s=n.slice(2);s.length%2&&(s=`0${s}`);const i=s.length/2,o=new Uint8Array(i);for(let a=0,c=0;a<i;a++){const l=x_(s.charCodeAt(c++)),u=x_(s.charCodeAt(c++));if(l===void 0||u===void 0)throw new ht(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=l*16+u}return o}function JK(t,e={}){const{size:r}=e,n=WK.encode(t);return typeof r=="number"?(PK(n,r),XK(n,r)):n}function XK(t,e){return RK(t,{dir:"right",size:e})}function N_(t){return t.length}function QK(t){try{return KK(t),!0}catch{return!1}}class Wh extends ht{constructor(e){super(`Value \`${typeof e=="object"?H0(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class eG extends ht{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class tG extends ht{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function sN(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=CK(GK(t));return r==="Bytes"?n:gf(n)}class rG extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const nG={checksum:new rG(8192)},Zg=nG.checksum;function iN(t,e={}){const{compressed:r}=e,{prefix:n,x:s,y:i}=t;if(r===!1||typeof s=="bigint"&&typeof i=="bigint"){if(n!==4)throw new O_({prefix:n,cause:new lG});return}if(r===!0||typeof s=="bigint"&&typeof i>"u"){if(n!==3&&n!==2)throw new O_({prefix:n,cause:new cG});return}throw new aG({publicKey:t})}function sG(t){const e=(()=>{if(qK(t))return oN(t);if(QK(t))return iG(t);const{prefix:r,x:n,y:s}=t;return typeof n=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:n,y:s}:{prefix:r,x:n}})();return iN(e),e}function iG(t){return oN(gf(t))}function oN(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new uG({publicKey:t});if(t.length===130){const n=BigInt(ii(t,0,32)),s=BigInt(ii(t,32,64));return{prefix:4,x:n,y:s}}if(t.length===132){const n=Number(ii(t,0,1)),s=BigInt(ii(t,1,33)),i=BigInt(ii(t,33,65));return{prefix:n,x:s,y:i}}const e=Number(ii(t,0,1)),r=BigInt(ii(t,1,33));return{prefix:e,x:r}}function oG(t,e={}){iN(t);const{prefix:r,x:n,y:s}=t,{includePrefix:i=!0}=e;return jK(i?Yg(r,{size:1}):"0x",Yg(n,{size:32}),typeof s=="bigint"?Yg(s,{size:32}):"0x")}class aG extends ht{constructor({publicKey:e}){super(`Value \`${H0(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class O_ extends ht{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class cG extends ht{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class lG extends ht{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let uG=class extends ht{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${_o(V0(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const hG=/^0x[a-fA-F0-9]{40}$/;function aN(t,e={}){const{strict:r=!0}=e;if(!hG.test(t))throw new T_({address:t,cause:new pG});if(r){if(t.toLowerCase()===t)return;if(cN(t)!==t)throw new T_({address:t,cause:new gG})}}function cN(t){if(Zg.has(t))return Zg.get(t);aN(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=sN(JK(e),{as:"Bytes"}),n=e.split("");for(let i=0;i<40;i+=2)r[i>>1]>>4>=8&&n[i]&&(n[i]=n[i].toUpperCase()),(r[i>>1]&15)>=8&&n[i+1]&&(n[i+1]=n[i+1].toUpperCase());const s=`0x${n.join("")}`;return Zg.set(t,s),s}function dG(t,e={}){const{checksum:r=!1}=e;return aN(t),r?cN(t):t}function fG(t,e={}){const r=sN(`0x${oG(t).slice(4)}`).substring(26);return dG(`0x${r}`,e)}class T_ extends ht{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class pG extends ht{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class gG extends ht{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class lN extends M0{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,XW(e);const n=lp(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Dc(i)}update(e){return Rc(this),this.iHash.update(e),this}digestInto(e){Rc(this),_a(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const uN=(t,e,r)=>new lN(t,e).update(r).digest();uN.create=(t,e)=>new lN(t,e);const tn=BigInt(0),Rr=BigInt(1),na=BigInt(2),mG=BigInt(3),hN=BigInt(4),dN=BigInt(5),fN=BigInt(8);function Zr(t,e){const r=t%e;return r>=tn?r:e+r}function On(t,e,r){let n=t;for(;e-- >tn;)n*=n,n%=r;return n}function Jy(t,e){if(t===tn)throw new Error("invert: expected non-zero number");if(e<=tn)throw new Error("invert: expected positive modulus, got "+e);let r=Zr(t,e),n=e,s=tn,i=Rr;for(;r!==tn;){const a=n/r,c=n%r,l=s-i*a;n=r,r=c,s=i,i=l}if(n!==Rr)throw new Error("invert: does not exist");return Zr(s,e)}function pN(t,e){const r=(t.ORDER+Rr)/hN,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function yG(t,e){const r=(t.ORDER-dN)/fN,n=t.mul(e,na),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,na),s),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function wG(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Rr,r=0;for(;e%na===tn;)e/=na,r++;let n=na;const s=W0(t);for(;k_(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return pN;let i=s.pow(n,e);const o=(e+Rr)/na;return function(c,l){if(c.is0(l))return l;if(k_(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,i),d=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let g=1,m=c.sqr(d);for(;!c.eql(m,c.ONE);)if(g++,m=c.sqr(m),g===u)throw new Error("Cannot find square root");const w=Rr<<BigInt(u-g-1),I=c.pow(h,w);u=g,h=c.sqr(I),d=c.mul(d,h),p=c.mul(p,I)}return p}}function bG(t){return t%hN===mG?pN:t%fN===dN?yG:wG(t)}const vG=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function EG(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=vG.reduce((n,s)=>(n[s]="function",n),e);return hp(t,r)}function _G(t,e,r){if(r<tn)throw new Error("invalid exponent, negatives unsupported");if(r===tn)return t.ONE;if(r===Rr)return e;let n=t.ONE,s=e;for(;r>tn;)r&Rr&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Rr;return n}function gN(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function k_(t,e){const r=(t.ORDER-Rr)/na,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function mN(t,e){e!==void 0&&ku(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function W0(t,e,r=!1,n={}){if(t<=tn)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=mN(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:up(s),ZERO:tn,ONE:Rr,create:c=>Zr(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return tn<=c&&c<t},is0:c=>c===tn,isOdd:c=>(c&Rr)===Rr,neg:c=>Zr(-c,t),eql:(c,l)=>c===l,sqr:c=>Zr(c*c,t),add:(c,l)=>Zr(c+l,t),sub:(c,l)=>Zr(c-l,t),mul:(c,l)=>Zr(c*l,t),pow:(c,l)=>_G(a,c,l),div:(c,l)=>Zr(c*Jy(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Jy(c,t),sqrt:n.sqrt||(c=>(o||(o=bG(t)),o(a,c))),toBytes:c=>r?Q$(c,i):ah(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?X$(c):pa(c)},invertBatch:c=>gN(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function yN(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function wN(t){const e=yN(t);return e+Math.ceil(e/2)}function IG(t,e,r=!1){const n=t.length,s=yN(e),i=wN(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?X$(t):pa(t),a=Zr(o,e-Rr)+Rr;return r?Q$(a,s):ah(a,s)}const P_=BigInt(0),Xy=BigInt(1);function Jg(t,e){const r=e.negate();return t?r:e}function bN(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Xg(t,e){bN(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=up(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function R_(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=Xy);const l=e*n,u=l+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:l}}function SG(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function CG(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Qg=new WeakMap,vN=new WeakMap;function em(t){return vN.get(t)||1}function xG(t,e){return{constTimeNegate:Jg,hasPrecomputes(r){return em(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>P_;)n&Xy&&(s=s.add(i)),i=i.double(),n>>=Xy;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=Xg(n,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){let i=t.ZERO,o=t.BASE;const a=Xg(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:g}=R_(s,c,a);s=l,h?o=o.add(Jg(p,n[g])):i=i.add(Jg(d,n[u]))}return{p:i,f:o}},wNAFUnsafe(r,n,s,i=t.ZERO){const o=Xg(r,e);for(let a=0;a<o.windows&&s!==P_;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=R_(s,a,o);if(s=c,!u){const d=n[l];i=i.add(h?d.negate():d)}}return i},getPrecomputes(r,n,s){let i=Qg.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&Qg.set(n,s(i))),i},wNAFCached(r,n,s){const i=em(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=em(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){bN(n,e),vN.set(r,n),Qg.delete(r)}}}function AG(t,e,r,n){SG(r,t),CG(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=OK(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=up(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let m=0;m<i;m++){const w=n[m],I=Number(w>>BigInt(p)&l);u[I]=u[I].add(r[m])}let g=o;for(let m=u.length-1,w=o;m>0;m--)w=w.add(u[m]),g=g.add(w);if(d=d.add(g),p!==0)for(let m=0;m<c;m++)d=d.double()}return d}function EN(t){return EG(t.Fp),hp(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...mN(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function D_(t){t.lowS!==void 0&&Pu("lowS",t.lowS),t.prehash!==void 0&&Pu("prehash",t.prehash)}function $G(t){const e=EN(t);hp(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class NG extends Error{constructor(e=""){super(e)}}const ui={Err:NG,_tlv:{encode:(t,e)=>{const{Err:r}=ui;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=Vh(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?Vh(s.length/2|128):"";return Vh(t)+i+s+e},decode(t,e){const{Err:r}=ui;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=ui;if(t<gi)throw new e("integer: negative integers are not allowed");let r=Vh(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=ui;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return pa(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=ui,s=jn("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=ui,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}};function tm(t,e){return Ru(ah(t,e))}const gi=BigInt(0),Wt=BigInt(1);BigInt(2);const rm=BigInt(3),OG=BigInt(4);function TG(t){const e=$G(t),{Fp:r}=e,n=W0(e.n,e.nBitLength),s=e.toBytes||((v,b,C)=>{const N=b.toAffine();return pf(Uint8Array.from([4]),r.toBytes(N.x),r.toBytes(N.y))}),i=e.fromBytes||(v=>{const b=v.subarray(1),C=r.fromBytes(b.subarray(0,r.BYTES)),N=r.fromBytes(b.subarray(r.BYTES,2*r.BYTES));return{x:C,y:N}});function o(v){const{a:b,b:C}=e,N=r.sqr(v),P=r.mul(N,v);return r.add(r.add(P,r.mul(v,b)),C)}function a(v,b){const C=r.sqr(b),N=o(v);return r.eql(C,N)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,rm),OG),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(v){return z0(v,Wt,e.n)}function h(v){const{allowedPrivateKeyLengths:b,nByteLength:C,wrapPrivateKey:N,n:P}=e;if(b&&typeof v!="bigint"){if(oh(v)&&(v=Ru(v)),typeof v!="string"||!b.includes(v.length))throw new Error("invalid private key");v=v.padStart(C*2,"0")}let R;try{R=typeof v=="bigint"?v:pa(jn("private key",v,C))}catch{throw new Error("invalid private key, expected hex or "+C+" bytes, got "+typeof v)}return N&&(R=Zr(R,P)),mc("private key",R,Wt,P),R}function d(v){if(!(v instanceof m))throw new Error("ProjectivePoint expected")}const p=C_((v,b)=>{const{px:C,py:N,pz:P}=v;if(r.eql(P,r.ONE))return{x:C,y:N};const R=v.is0();b==null&&(b=R?r.ONE:r.inv(P));const O=r.mul(C,b),M=r.mul(N,b),j=r.mul(P,b);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(j,r.ONE))throw new Error("invZ was invalid");return{x:O,y:M}}),g=C_(v=>{if(v.is0()){if(e.allowInfinityPoint&&!r.is0(v.py))return;throw new Error("bad point: ZERO")}const{x:b,y:C}=v.toAffine();if(!r.isValid(b)||!r.isValid(C))throw new Error("bad point: x or y not FE");if(!a(b,C))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class m{constructor(b,C,N){if(b==null||!r.isValid(b))throw new Error("x required");if(C==null||!r.isValid(C)||r.is0(C))throw new Error("y required");if(N==null||!r.isValid(N))throw new Error("z required");this.px=b,this.py=C,this.pz=N,Object.freeze(this)}static fromAffine(b){const{x:C,y:N}=b||{};if(!b||!r.isValid(C)||!r.isValid(N))throw new Error("invalid affine point");if(b instanceof m)throw new Error("projective point not allowed");const P=R=>r.eql(R,r.ZERO);return P(C)&&P(N)?m.ZERO:new m(C,N,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const C=gN(r,b.map(N=>N.pz));return b.map((N,P)=>N.toAffine(C[P])).map(m.fromAffine)}static fromHex(b){const C=m.fromAffine(i(jn("pointHex",b)));return C.assertValidity(),C}static fromPrivateKey(b){return m.BASE.multiply(h(b))}static msm(b,C){return AG(m,n,b,C)}_setWindowSize(b){S.setWindowSize(this,b)}assertValidity(){g(this)}hasEvenY(){const{y:b}=this.toAffine();if(r.isOdd)return!r.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){d(b);const{px:C,py:N,pz:P}=this,{px:R,py:O,pz:M}=b,j=r.eql(r.mul(C,M),r.mul(R,P)),k=r.eql(r.mul(N,M),r.mul(O,P));return j&&k}negate(){return new m(this.px,r.neg(this.py),this.pz)}double(){const{a:b,b:C}=e,N=r.mul(C,rm),{px:P,py:R,pz:O}=this;let M=r.ZERO,j=r.ZERO,k=r.ZERO,$=r.mul(P,P),T=r.mul(R,R),f=r.mul(O,O),y=r.mul(P,R);return y=r.add(y,y),k=r.mul(P,O),k=r.add(k,k),M=r.mul(b,k),j=r.mul(N,f),j=r.add(M,j),M=r.sub(T,j),j=r.add(T,j),j=r.mul(M,j),M=r.mul(y,M),k=r.mul(N,k),f=r.mul(b,f),y=r.sub($,f),y=r.mul(b,y),y=r.add(y,k),k=r.add($,$),$=r.add(k,$),$=r.add($,f),$=r.mul($,y),j=r.add(j,$),f=r.mul(R,O),f=r.add(f,f),$=r.mul(f,y),M=r.sub(M,$),k=r.mul(f,T),k=r.add(k,k),k=r.add(k,k),new m(M,j,k)}add(b){d(b);const{px:C,py:N,pz:P}=this,{px:R,py:O,pz:M}=b;let j=r.ZERO,k=r.ZERO,$=r.ZERO;const T=e.a,f=r.mul(e.b,rm);let y=r.mul(C,R),E=r.mul(N,O),x=r.mul(P,M),_=r.add(C,N),A=r.add(R,O);_=r.mul(_,A),A=r.add(y,E),_=r.sub(_,A),A=r.add(C,P);let L=r.add(R,M);return A=r.mul(A,L),L=r.add(y,x),A=r.sub(A,L),L=r.add(N,P),j=r.add(O,M),L=r.mul(L,j),j=r.add(E,x),L=r.sub(L,j),$=r.mul(T,A),j=r.mul(f,x),$=r.add(j,$),j=r.sub(E,$),$=r.add(E,$),k=r.mul(j,$),E=r.add(y,y),E=r.add(E,y),x=r.mul(T,x),A=r.mul(f,A),E=r.add(E,x),x=r.sub(y,x),x=r.mul(T,x),A=r.add(A,x),y=r.mul(E,A),k=r.add(k,y),y=r.mul(L,A),j=r.mul(_,j),j=r.sub(j,y),y=r.mul(_,E),$=r.mul(L,$),$=r.add($,y),new m(j,k,$)}subtract(b){return this.add(b.negate())}is0(){return this.equals(m.ZERO)}wNAF(b){return S.wNAFCached(this,b,m.normalizeZ)}multiplyUnsafe(b){const{endo:C,n:N}=e;mc("scalar",b,gi,N);const P=m.ZERO;if(b===gi)return P;if(this.is0()||b===Wt)return this;if(!C||S.hasPrecomputes(this))return S.wNAFCachedUnsafe(this,b,m.normalizeZ);let{k1neg:R,k1:O,k2neg:M,k2:j}=C.splitScalar(b),k=P,$=P,T=this;for(;O>gi||j>gi;)O&Wt&&(k=k.add(T)),j&Wt&&($=$.add(T)),T=T.double(),O>>=Wt,j>>=Wt;return R&&(k=k.negate()),M&&($=$.negate()),$=new m(r.mul($.px,C.beta),$.py,$.pz),k.add($)}multiply(b){const{endo:C,n:N}=e;mc("scalar",b,Wt,N);let P,R;if(C){const{k1neg:O,k1:M,k2neg:j,k2:k}=C.splitScalar(b);let{p:$,f:T}=this.wNAF(M),{p:f,f:y}=this.wNAF(k);$=S.constTimeNegate(O,$),f=S.constTimeNegate(j,f),f=new m(r.mul(f.px,C.beta),f.py,f.pz),P=$.add(f),R=T.add(y)}else{const{p:O,f:M}=this.wNAF(b);P=O,R=M}return m.normalizeZ([P,R])[0]}multiplyAndAddUnsafe(b,C,N){const P=m.BASE,R=(M,j)=>j===gi||j===Wt||!M.equals(P)?M.multiplyUnsafe(j):M.multiply(j),O=R(this,C).add(R(b,N));return O.is0()?void 0:O}toAffine(b){return p(this,b)}isTorsionFree(){const{h:b,isTorsionFree:C}=e;if(b===Wt)return!0;if(C)return C(m,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:C}=e;return b===Wt?this:C?C(m,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return Pu("isCompressed",b),this.assertValidity(),s(m,this,b)}toHex(b=!0){return Pu("isCompressed",b),Ru(this.toRawBytes(b))}}m.BASE=new m(e.Gx,e.Gy,r.ONE),m.ZERO=new m(r.ZERO,r.ONE,r.ZERO);const{endo:w,nBitLength:I}=e,S=xG(m,w?Math.ceil(I/2):I);return{CURVE:e,ProjectivePoint:m,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function kG(t){const e=EN(t);return hp(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function PG(t){const e=kG(t),{Fp:r,n,nByteLength:s,nBitLength:i}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(f){return Zr(f,n)}function l(f){return Jy(f,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:p}=TG({...e,toBytes(f,y,E){const x=y.toAffine(),_=r.toBytes(x.x),A=pf;return Pu("isCompressed",E),E?A(Uint8Array.from([y.hasEvenY()?2:3]),_):A(Uint8Array.from([4]),_,r.toBytes(x.y))},fromBytes(f){const y=f.length,E=f[0],x=f.subarray(1);if(y===o&&(E===2||E===3)){const _=pa(x);if(!z0(_,Wt,r.ORDER))throw new Error("Point is not on curve");const A=d(_);let L;try{L=r.sqrt(A)}catch(D){const F=D instanceof Error?": "+D.message:"";throw new Error("Point is not on curve"+F)}const B=(L&Wt)===Wt;return(E&1)===1!==B&&(L=r.neg(L)),{x:_,y:L}}else if(y===a&&E===4){const _=r.fromBytes(x.subarray(0,r.BYTES)),A=r.fromBytes(x.subarray(r.BYTES,2*r.BYTES));return{x:_,y:A}}else{const _=o,A=a;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+A+", got "+y)}}});function g(f){const y=n>>Wt;return f>y}function m(f){return g(f)?c(-f):f}const w=(f,y,E)=>pa(f.slice(y,E));class I{constructor(y,E,x){mc("r",y,Wt,n),mc("s",E,Wt,n),this.r=y,this.s=E,x!=null&&(this.recovery=x),Object.freeze(this)}static fromCompact(y){const E=s;return y=jn("compactSignature",y,E*2),new I(w(y,0,E),w(y,E,2*E))}static fromDER(y){const{r:E,s:x}=ui.toSig(jn("DER",y));return new I(E,x)}assertValidity(){}addRecoveryBit(y){return new I(this.r,this.s,y)}recoverPublicKey(y){const{r:E,s:x,recovery:_}=this,A=P(jn("msgHash",y));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const L=_===2||_===3?E+e.n:E;if(L>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const B=(_&1)===0?"02":"03",q=u.fromHex(B+tm(L,r.BYTES)),D=l(L),F=c(-A*D),H=c(x*D),W=u.BASE.multiplyAndAddUnsafe(q,F,H);if(!W)throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new I(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return ff(this.toDERHex())}toDERHex(){return ui.hexFromSig(this)}toCompactRawBytes(){return ff(this.toCompactHex())}toCompactHex(){const y=s;return tm(this.r,y)+tm(this.s,y)}}const S={isValidPrivateKey(f){try{return h(f),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const f=wN(e.n);return IG(e.randomBytes(f),e.n)},precompute(f=8,y=u.BASE){return y._setWindowSize(f),y.multiply(BigInt(3)),y}};function v(f,y=!0){return u.fromPrivateKey(f).toRawBytes(y)}function b(f){if(typeof f=="bigint")return!1;if(f instanceof u)return!0;const E=jn("key",f).length,x=r.BYTES,_=x+1,A=2*x+1;if(!(e.allowedPrivateKeyLengths||s===_))return E===_||E===A}function C(f,y,E=!0){if(b(f)===!0)throw new Error("first arg must be private key");if(b(y)===!1)throw new Error("second arg must be public key");return u.fromHex(y).multiply(h(f)).toRawBytes(E)}const N=e.bits2int||function(f){if(f.length>8192)throw new Error("input is too large");const y=pa(f),E=f.length*8-i;return E>0?y>>BigInt(E):y},P=e.bits2int_modN||function(f){return c(N(f))},R=up(i);function O(f){return mc("num < 2^"+i,f,gi,R),ah(f,s)}function M(f,y,E=j){if(["recovered","canonical"].some(K=>K in E))throw new Error("sign() legacy options not supported");const{hash:x,randomBytes:_}=e;let{lowS:A,prehash:L,extraEntropy:B}=E;A==null&&(A=!0),f=jn("msgHash",f),D_(E),L&&(f=jn("prehashed msgHash",x(f)));const q=P(f),D=h(y),F=[O(D),O(q)];if(B!=null&&B!==!1){const K=B===!0?_(r.BYTES):B;F.push(jn("extraEntropy",K))}const H=pf(...F),W=q;function ee(K){const G=N(K);if(!p(G))return;const le=l(G),ye=u.BASE.multiply(G).toAffine(),ve=c(ye.x);if(ve===gi)return;const Ee=c(le*c(W+ve*D));if(Ee===gi)return;let Ke=(ye.x===ve?0:2)|Number(ye.y&Wt),gr=Ee;return A&&g(Ee)&&(gr=m(Ee),Ke^=1),new I(ve,gr,Ke)}return{seed:H,k2sig:ee}}const j={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};function $(f,y,E=j){const{seed:x,k2sig:_}=M(f,y,E),A=e;return TK(A.hash.outputLen,A.nByteLength,A.hmac)(x,_)}u.BASE._setWindowSize(8);function T(f,y,E,x=k){const _=f;y=jn("msgHash",y),E=jn("publicKey",E);const{lowS:A,prehash:L,format:B}=x;if(D_(x),"strict"in x)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&B!=="compact"&&B!=="der")throw new Error("format must be compact or der");const q=typeof _=="string"||oh(_),D=!q&&!B&&typeof _=="object"&&_!==null&&typeof _.r=="bigint"&&typeof _.s=="bigint";if(!q&&!D)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let F,H;try{if(D&&(F=new I(_.r,_.s)),q){try{B!=="compact"&&(F=I.fromDER(_))}catch(Ke){if(!(Ke instanceof ui.Err))throw Ke}!F&&B!=="der"&&(F=I.fromCompact(_))}H=u.fromHex(E)}catch{return!1}if(!F||A&&F.hasHighS())return!1;L&&(y=e.hash(y));const{r:W,s:ee}=F,K=P(y),G=l(ee),le=c(K*G),ye=c(W*G),ve=u.BASE.multiplyAndAddUnsafe(H,le,ye)?.toAffine();return ve?c(ve.x)===W:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:C,sign:$,verify:T,ProjectivePoint:u,Signature:I,utils:S}}function RG(t){return{hash:t,hmac:(e,...r)=>uN(t,e,sK(...r)),randomBytes:iK}}function DG(t,e){const r=n=>PG({...t,...RG(n)});return{...r(e),create:r}}const _N=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),U_=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),UG=BigInt(0),BG=BigInt(1),Qy=BigInt(2),B_=(t,e)=>(t+e/Qy)/e;function LG(t){const e=_N,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=On(u,r,e)*u%e,d=On(h,r,e)*u%e,p=On(d,Qy,e)*l%e,g=On(p,s,e)*p%e,m=On(g,i,e)*g%e,w=On(m,a,e)*m%e,I=On(w,c,e)*w%e,S=On(I,a,e)*m%e,v=On(S,r,e)*u%e,b=On(v,o,e)*g%e,C=On(b,n,e)*l%e,N=On(C,Qy,e);if(!ew.eql(ew.sqr(N),t))throw new Error("Cannot find square root");return N}const ew=W0(_N,void 0,void 0,{sqrt:LG}),MG=DG({a:UG,b:BigInt(7),Fp:ew,n:U_,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=U_,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-BG*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=B_(i*t,e),c=B_(-n*t,e);let l=Zr(t-a*r-c*s,e),u=Zr(-a*n-c*i,e);const h=l>o,d=u>o;if(h&&(l=e-l),d&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},$K);function jG(t){if(t.length!==130&&t.length!==132)throw new qG({signature:t});const e=BigInt(ii(t,0,32)),r=BigInt(ii(t,32,64)),n=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return FG(s)}catch{throw new zG({value:s})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function FG(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new HG({value:t})}class qG extends ht{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${_o(V0(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class zG extends ht{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class HG extends ht{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function VG(t){return fG(WG(t))}function WG(t){const{payload:e,signature:r}=t,{r:n,s,yParity:i}=r,a=new MG.Signature(BigInt(n),BigInt(s)).addRecoveryBit(i).recoverPublicKey(V0(e).substring(2));return sG(a)}function KG(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,n=t.charAt(0),s=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0;const p=l.length;for(;d!==p&&l[d]===0;)d++,u++;const g=(p-d)*i+1>>>0,m=new Uint8Array(g);for(;d!==p;){let S=l[d],v=0;for(let b=g-1;(S!==0||v<h)&&b!==-1;b--,v++)S+=256*m[b]>>>0,m[b]=S%r>>>0,S=S/r>>>0;if(S!==0)throw new Error("Non-zero carry");h=v,d++}let w=g-h;for(;w!==g&&m[w]===0;)w++;let I=n.repeat(u);for(;w<g;++w)I+=t.charAt(m[w]);return I}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===n;)h++,u++;const p=(l.length-u)*s+1>>>0,g=new Uint8Array(p);for(;u<l.length;){const S=l.charCodeAt(u);if(S>255)return;let v=e[S];if(v===255)return;let b=0;for(let C=p-1;(v!==0||b<d)&&C!==-1;C--,b++)v+=r*g[C]>>>0,g[C]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=b,u++}let m=p-d;for(;m!==p&&g[m]===0;)m++;const w=new Uint8Array(h+(p-m));let I=h;for(;m!==p;)w[I++]=g[m++];return w}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var GG="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const ch=KG(GG);var YG={};const ZG=":";function _i(t){const[e,r]=t.split(ZG);return{namespace:e,reference:r}}function IN(t,e){return t.includes(":")?[t]:e.chains||[]}var JG=Object.defineProperty,XG=Object.defineProperties,QG=Object.getOwnPropertyDescriptors,L_=Object.getOwnPropertySymbols,eY=Object.prototype.hasOwnProperty,tY=Object.prototype.propertyIsEnumerable,tw=(t,e,r)=>e in t?JG(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,M_=(t,e)=>{for(var r in e||(e={}))eY.call(e,r)&&tw(t,r,e[r]);if(L_)for(var r of L_(e))tY.call(e,r)&&tw(t,r,e[r]);return t},rY=(t,e)=>XG(t,QG(e)),j_=(t,e,r)=>tw(t,typeof e!="symbol"?e+"":e,r);const nY="ReactNative",_n={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},sY="js";function mf(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ao(){return!Jt.getDocument()&&!!Jt.getNavigator()&&navigator.product===nY}function iY(){return Ao()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function oY(){return Ao()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Wc(){return!mf()&&!!Jt.getNavigator()&&!!Jt.getDocument()}function lh(){return Ao()?_n.reactNative:mf()?_n.node:Wc()?_n.browser:_n.unknown}function F_(){var t;try{return Ao()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function aY(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!=null&&r.set(n,String(s))}),r.toString()}function cY(t){var e,r;const n=SN();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),rY(M_(M_({},n),t),{url:t?.url||n.url,name:t?.name||n.name,description:t?.description||n.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(s){return console.warn("Error populating app metadata",s),t||n}}function SN(){return kC.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function lY(){if(lh()===_n.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=OC();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function uY(){var t;const e=lh();return e===_n.browser?[e,((t=Jt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function CN(t,e,r){const n=lY(),s=uY();return[[t,e].join("-"),[sY,r].join("-"),n,s].join("/")}function hY({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:s,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=CN(t,e,n),h={auth:s,ua:u,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=aY(l[1]||"",h);return l[0]+"?"+d}function sa(t,e){return t.filter(r=>e.includes(r)).length===t.length}function rw(t){return Object.fromEntries(t.entries())}function nw(t){return new Map(Object.entries(t))}function Fo(t=z.FIVE_MINUTES,e){const r=z.toMiliseconds(t||z.FIVE_MINUTES);let n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),n=a,s=c})}}function ks(t,e,r){return new Promise(async(n,s)=>{const i=setTimeout(()=>s(new Error(r)),e);try{const o=await t;n(o)}catch(o){s(o)}clearTimeout(i)})}function xN(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function dY(t){return xN("topic",t)}function fY(t){return xN("id",t)}function AN(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function St(t,e){return z.fromMiliseconds(Date.now()+z.toMiliseconds(t))}function Ns(t){return Date.now()>=z.toMiliseconds(t)}function qe(t,e){return`${t}${e?`:${e}`:""}`}function Us(t=[],e=[]){return[...new Set([...t,...e])]}async function pY({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,i=s?.href;if(typeof i!="string")return;const o=gY(i,t,e),a=lh();if(a===_n.browser){if(!((n=Jt.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}mY(o)}else a===_n.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function gY(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const i=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${i}${vY(n,!0)}`}else s=`${s}/wc?${n}`;return s}function mY(t){let e="_self";bY()?e="_top":(wY()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function yY(t,e){let r="";try{if(Wc()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function q_(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function z_(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function K0(){return typeof process<"u"&&YG.IS_VITEST==="true"}function wY(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function bY(){try{return window.self!==window.top}catch{return!1}}function vY(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function $N(t){return Buffer.from(t,"base64").toString("utf-8")}function EY(t){return new Promise(e=>setTimeout(e,t))}let _Y=class{constructor({limit:e}){j_(this,"limit"),j_(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const Kh=BigInt(2**32-1),H_=BigInt(32);function NN(t,e=!1){return e?{h:Number(t&Kh),l:Number(t>>H_&Kh)}:{h:Number(t>>H_&Kh)|0,l:Number(t&Kh)|0}}function ON(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=NN(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const V_=(t,e,r)=>t>>>r,W_=(t,e,r)=>t<<32-r|e>>>r,eo=(t,e,r)=>t>>>r|e<<32-r,to=(t,e,r)=>t<<32-r|e>>>r,Ol=(t,e,r)=>t<<64-r|e>>>r-32,Tl=(t,e,r)=>t>>>r-32|e<<64-r,IY=(t,e)=>e,SY=(t,e)=>t,CY=(t,e,r)=>t<<r|e>>>32-r,xY=(t,e,r)=>e<<r|t>>>32-r,AY=(t,e,r)=>e<<r-32|t>>>64-r,$Y=(t,e,r)=>t<<r-32|e>>>64-r;function ss(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const G0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Y0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,NY=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),OY=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,TY=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),kY=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,Ya=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function dp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ai(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ps(t,...e){if(!dp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function fp(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ai(t.outputLen),Ai(t.blockLen)}function Io(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Z0(t,e){ps(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Du(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Wn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function nm(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Es(t,e){return t<<32-e|t>>>e}const TN=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function kN(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const ei=TN?t=>t:t=>kN(t);function PY(t){for(let e=0;e<t.length;e++)t[e]=kN(t[e]);return t}const ro=TN?t=>t:PY,PN=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",RY=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function yc(t){if(ps(t),PN)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=RY[t[r]];return e}const Js={_0:48,_9:57,A:65,F:70,a:97,f:102};function K_(t){if(t>=Js._0&&t<=Js._9)return t-Js._0;if(t>=Js.A&&t<=Js.F)return t-(Js.A-10);if(t>=Js.a&&t<=Js.f)return t-(Js.a-10)}function yf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(PN)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=K_(t.charCodeAt(i)),a=K_(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function RN(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function hs(t){return typeof t=="string"&&(t=RN(t)),ps(t),t}function ao(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];ps(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}class pp{}function uh(t){const e=n=>t().update(hs(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function DY(t){const e=(n,s)=>t(s).update(hs(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function Ua(t=32){if(Ya&&typeof Ya.getRandomValues=="function")return Ya.getRandomValues(new Uint8Array(t));if(Ya&&typeof Ya.randomBytes=="function")return Uint8Array.from(Ya.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const UY=BigInt(0),ml=BigInt(1),BY=BigInt(2),LY=BigInt(7),MY=BigInt(256),jY=BigInt(113),DN=[],UN=[],BN=[];for(let t=0,e=ml,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],DN.push(2*(5*n+r)),UN.push((t+1)*(t+2)/2%64);let s=UY;for(let i=0;i<7;i++)e=(e<<ml^(e>>LY)*jY)%MY,e&BY&&(s^=ml<<(ml<<BigInt(i))-ml);BN.push(s)}const LN=ON(BN,!0),FY=LN[0],qY=LN[1],G_=(t,e,r)=>r>32?AY(t,e,r):CY(t,e,r),Y_=(t,e,r)=>r>32?$Y(t,e,r):xY(t,e,r);function zY(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=G_(l,u,1)^r[a],d=Y_(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=UN[o],c=G_(s,i,a),l=Y_(s,i,a),u=DN[o];s=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=FY[n],t[1]^=qY[n]}Wn(r)}let HY=class MN extends pp{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,Ai(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Du(this.state)}clone(){return this._cloneInto()}keccak(){ro(this.state32),zY(this.state32,this.rounds),ro(this.state32),this.posOut=0,this.pos=0}update(e){Io(this),e=hs(e),ps(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Io(this,!1),ps(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ai(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Z0(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Wn(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new MN(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const VY=(t,e,r)=>uh(()=>new HY(e,t,r)),WY=VY(1,136,256/8);function KY(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function GY(t,e,r){return t&e^~t&r}function YY(t,e,r){return t&e^t&r^e&r}let jN=class extends pp{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=nm(this.buffer)}update(e){Io(this),e=hs(e),ps(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=nm(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Io(this),Z0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,Wn(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;KY(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=nm(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const qi=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Er=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),_r=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),ZY=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),zi=new Uint32Array(64);class JY extends jN{constructor(e=32){super(64,e,8,!1),this.A=qi[0]|0,this.B=qi[1]|0,this.C=qi[2]|0,this.D=qi[3]|0,this.E=qi[4]|0,this.F=qi[5]|0,this.G=qi[6]|0,this.H=qi[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)zi[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=zi[h-15],p=zi[h-2],g=Es(d,7)^Es(d,18)^d>>>3,m=Es(p,17)^Es(p,19)^p>>>10;zi[h]=m+zi[h-7]+g+zi[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=Es(a,6)^Es(a,11)^Es(a,25),p=u+d+GY(a,c,l)+ZY[h]+zi[h]|0,g=(Es(n,2)^Es(n,13)^Es(n,22))+YY(n,s,i)|0;u=l,l=c,c=a,a=o+p|0,o=i,i=s,s=n,n=p+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){Wn(zi)}destroy(){this.set(0,0,0,0,0,0,0,0),Wn(this.buffer)}}const FN=ON(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),XY=FN[0],QY=FN[1],Hi=new Uint32Array(80),Vi=new Uint32Array(80);let J0=class extends jN{constructor(e=64){super(128,e,16,!1),this.Ah=_r[0]|0,this.Al=_r[1]|0,this.Bh=_r[2]|0,this.Bl=_r[3]|0,this.Ch=_r[4]|0,this.Cl=_r[5]|0,this.Dh=_r[6]|0,this.Dl=_r[7]|0,this.Eh=_r[8]|0,this.El=_r[9]|0,this.Fh=_r[10]|0,this.Fl=_r[11]|0,this.Gh=_r[12]|0,this.Gl=_r[13]|0,this.Hh=_r[14]|0,this.Hl=_r[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:p,Gl:g,Hh:m,Hl:w}=this;return[e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w]}set(e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=g|0,this.Hh=m|0,this.Hl=w|0}process(e,r){for(let v=0;v<16;v++,r+=4)Hi[v]=e.getUint32(r),Vi[v]=e.getUint32(r+=4);for(let v=16;v<80;v++){const b=Hi[v-15]|0,C=Vi[v-15]|0,N=eo(b,C,1)^eo(b,C,8)^V_(b,C,7),P=to(b,C,1)^to(b,C,8)^W_(b,C,7),R=Hi[v-2]|0,O=Vi[v-2]|0,M=eo(R,O,19)^Ol(R,O,61)^V_(R,O,6),j=to(R,O,19)^Tl(R,O,61)^W_(R,O,6),k=NY(P,j,Vi[v-7],Vi[v-16]),$=OY(k,N,M,Hi[v-7],Hi[v-16]);Hi[v]=$|0,Vi[v]=k|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:p,Fl:g,Gh:m,Gl:w,Hh:I,Hl:S}=this;for(let v=0;v<80;v++){const b=eo(h,d,14)^eo(h,d,18)^Ol(h,d,41),C=to(h,d,14)^to(h,d,18)^Tl(h,d,41),N=h&p^~h&m,P=d&g^~d&w,R=TY(S,C,P,QY[v],Vi[v]),O=kY(R,I,b,N,XY[v],Hi[v]),M=R|0,j=eo(n,s,28)^Ol(n,s,34)^Ol(n,s,39),k=to(n,s,28)^Tl(n,s,34)^Tl(n,s,39),$=n&i^n&a^i&a,T=s&o^s&c^o&c;I=m|0,S=w|0,m=p|0,w=g|0,p=h|0,g=d|0,{h,l:d}=ss(l|0,u|0,O|0,M|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const f=G0(M,k,T);n=Y0(f,O,j,$),s=f|0}({h:n,l:s}=ss(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ss(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ss(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ss(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=ss(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:g}=ss(this.Fh|0,this.Fl|0,p|0,g|0),{h:m,l:w}=ss(this.Gh|0,this.Gl|0,m|0,w|0),{h:I,l:S}=ss(this.Hh|0,this.Hl|0,I|0,S|0),this.set(n,s,i,o,a,c,l,u,h,d,p,g,m,w,I,S)}roundClean(){Wn(Hi,Vi)}destroy(){Wn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class eZ extends J0{constructor(){super(48),this.Ah=Er[0]|0,this.Al=Er[1]|0,this.Bh=Er[2]|0,this.Bl=Er[3]|0,this.Ch=Er[4]|0,this.Cl=Er[5]|0,this.Dh=Er[6]|0,this.Dl=Er[7]|0,this.Eh=Er[8]|0,this.El=Er[9]|0,this.Fh=Er[10]|0,this.Fl=Er[11]|0,this.Gh=Er[12]|0,this.Gl=Er[13]|0,this.Hh=Er[14]|0,this.Hl=Er[15]|0}}const Ir=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class tZ extends J0{constructor(){super(32),this.Ah=Ir[0]|0,this.Al=Ir[1]|0,this.Bh=Ir[2]|0,this.Bl=Ir[3]|0,this.Ch=Ir[4]|0,this.Cl=Ir[5]|0,this.Dh=Ir[6]|0,this.Dl=Ir[7]|0,this.Eh=Ir[8]|0,this.El=Ir[9]|0,this.Fh=Ir[10]|0,this.Fl=Ir[11]|0,this.Gh=Ir[12]|0,this.Gl=Ir[13]|0,this.Hh=Ir[14]|0,this.Hl=Ir[15]|0}}const gp=uh(()=>new JY),rZ=uh(()=>new J0),nZ=uh(()=>new eZ),sZ=uh(()=>new tZ),iZ=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Pt=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),ce=new Uint32Array(32);function Wi(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=ce[2*t],l=ce[2*t+1],u=ce[2*e],h=ce[2*e+1],d=ce[2*r],p=ce[2*r+1],g=ce[2*n],m=ce[2*n+1],w=G0(c,u,o);l=Y0(w,l,h,a),c=w|0,{Dh:m,Dl:g}={Dh:m^l,Dl:g^c},{Dh:m,Dl:g}={Dh:IY(m,g),Dl:SY(m)},{h:p,l:d}=ss(p,d,m,g),{Bh:h,Bl:u}={Bh:h^p,Bl:u^d},{Bh:h,Bl:u}={Bh:eo(h,u,24),Bl:to(h,u,24)},ce[2*t]=c,ce[2*t+1]=l,ce[2*e]=u,ce[2*e+1]=h,ce[2*r]=d,ce[2*r+1]=p,ce[2*n]=g,ce[2*n+1]=m}function Ki(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=ce[2*t],l=ce[2*t+1],u=ce[2*e],h=ce[2*e+1],d=ce[2*r],p=ce[2*r+1],g=ce[2*n],m=ce[2*n+1],w=G0(c,u,o);l=Y0(w,l,h,a),c=w|0,{Dh:m,Dl:g}={Dh:m^l,Dl:g^c},{Dh:m,Dl:g}={Dh:eo(m,g,16),Dl:to(m,g,16)},{h:p,l:d}=ss(p,d,m,g),{Bh:h,Bl:u}={Bh:h^p,Bl:u^d},{Bh:h,Bl:u}={Bh:Ol(h,u,63),Bl:Tl(h,u,63)},ce[2*t]=c,ce[2*t+1]=l,ce[2*e]=u,ce[2*e+1]=h,ce[2*r]=d,ce[2*r+1]=p,ce[2*n]=g,ce[2*n+1]=m}function oZ(t,e={},r,n,s){if(Ai(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class aZ extends pp{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Ai(e),Ai(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Du(this.buffer)}update(e){Io(this),e=hs(e),ps(e);const{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(ro(s),this.compress(s,0,!1),ro(s),this.pos=0);const l=Math.min(r-this.pos,i-c),u=o+c;if(l===r&&!(u%4)&&c+l<i){const h=new Uint32Array(a,u,Math.floor((i-c)/4));ro(h);for(let d=0;c+r<i;d+=s.length,c+=r)this.length+=r,this.compress(h,d,!1);ro(h);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Io(this),Z0(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Wn(this.buffer.subarray(r)),ro(n),this.compress(n,0,!0),ro(n);const s=Du(e);this.get().forEach((i,o)=>s[o]=ei(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class cZ extends aZ{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Pt[0]|0,this.v0h=Pt[1]|0,this.v1l=Pt[2]|0,this.v1h=Pt[3]|0,this.v2l=Pt[4]|0,this.v2h=Pt[5]|0,this.v3l=Pt[6]|0,this.v3h=Pt[7]|0,this.v4l=Pt[8]|0,this.v4h=Pt[9]|0,this.v5l=Pt[10]|0,this.v5h=Pt[11]|0,this.v6l=Pt[12]|0,this.v6h=Pt[13]|0,this.v7l=Pt[14]|0,this.v7h=Pt[15]|0,oZ(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=hs(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=hs(i);const a=Du(i);this.v4l^=ei(a[0]),this.v4h^=ei(a[1]),this.v5l^=ei(a[2]),this.v5h^=ei(a[3])}if(s!==void 0){s=hs(s);const a=Du(s);this.v6l^=ei(a[0]),this.v6h^=ei(a[1]),this.v7l^=ei(a[2]),this.v7h^=ei(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:d,v6l:p,v6h:g,v7l:m,v7h:w}=this;return[e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w]}set(e,r,n,s,i,o,a,c,l,u,h,d,p,g,m,w){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=d|0,this.v6l=p|0,this.v6h=g|0,this.v7l=m|0,this.v7h=w|0}compress(e,r,n){this.get().forEach((c,l)=>ce[l]=c),ce.set(Pt,16);let{h:s,l:i}=NN(BigInt(this.length));ce[24]=Pt[8]^i,ce[25]=Pt[9]^s,n&&(ce[28]=~ce[28],ce[29]=~ce[29]);let o=0;const a=iZ;for(let c=0;c<12;c++)Wi(0,4,8,12,e,r+2*a[o++]),Ki(0,4,8,12,e,r+2*a[o++]),Wi(1,5,9,13,e,r+2*a[o++]),Ki(1,5,9,13,e,r+2*a[o++]),Wi(2,6,10,14,e,r+2*a[o++]),Ki(2,6,10,14,e,r+2*a[o++]),Wi(3,7,11,15,e,r+2*a[o++]),Ki(3,7,11,15,e,r+2*a[o++]),Wi(0,5,10,15,e,r+2*a[o++]),Ki(0,5,10,15,e,r+2*a[o++]),Wi(1,6,11,12,e,r+2*a[o++]),Ki(1,6,11,12,e,r+2*a[o++]),Wi(2,7,8,13,e,r+2*a[o++]),Ki(2,7,8,13,e,r+2*a[o++]),Wi(3,4,9,14,e,r+2*a[o++]),Ki(3,4,9,14,e,r+2*a[o++]);this.v0l^=ce[0]^ce[16],this.v0h^=ce[1]^ce[17],this.v1l^=ce[2]^ce[18],this.v1h^=ce[3]^ce[19],this.v2l^=ce[4]^ce[20],this.v2h^=ce[5]^ce[21],this.v3l^=ce[6]^ce[22],this.v3h^=ce[7]^ce[23],this.v4l^=ce[8]^ce[24],this.v4h^=ce[9]^ce[25],this.v5l^=ce[10]^ce[26],this.v5h^=ce[11]^ce[27],this.v6l^=ce[12]^ce[28],this.v6h^=ce[13]^ce[29],this.v7l^=ce[14]^ce[30],this.v7h^=ce[15]^ce[31],Wn(ce)}destroy(){this.destroyed=!0,Wn(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const lZ=DY(t=>new cZ(t)),uZ="https://rpc.walletconnect.org/v1";function qN(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(WY(r)).toString("hex")}async function hZ(t,e,r,n,s,i){switch(r.t){case"eip191":return await dZ(t,e,r.s);case"eip1271":return await fZ(t,e,r.s,n,s,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function dZ(t,e,r){const n=jG(r);return VG({payload:qN(e),signature:n}).toLowerCase()===t.toLowerCase()}async function fZ(t,e,r,n,s,i){const o=_i(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:qN(e)).substring(2),d=a+h+c+u+l,p=await fetch(`${i||uZ}/?chainId=${n}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:pZ(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:g}=await p.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function pZ(){return Date.now()+Math.floor(Math.random()*1e3)}function gZ(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const s=1+n*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const i=Buffer.from(t,"base64").slice(1,65);return ch.encode(i)}function mZ(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const s=lZ(n,{dkLen:32});return ch.encode(s)}function Z_(t){const e=new Uint8Array(gp(yZ(t)));return ch.encode(e)}function yZ(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function J_(t){const e=Buffer.from(t,"base64"),r=Cx(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=_x(r),s=Buffer.from("TX"),i=Buffer.concat([s,Buffer.from(n)]),o=sZ(i);return yx.encode(o).replace(/=+$/,"")}function sm(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function wZ(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(sm(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(sm(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(sm(n.length)),s.push(n);const i=Buffer.concat(s),o=gp(i);return Buffer.from(o).toString("hex").toUpperCase()}function bZ(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const s=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&n.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return n}var vZ=Object.defineProperty,EZ=Object.defineProperties,_Z=Object.getOwnPropertyDescriptors,X_=Object.getOwnPropertySymbols,IZ=Object.prototype.hasOwnProperty,SZ=Object.prototype.propertyIsEnumerable,Q_=(t,e,r)=>e in t?vZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,CZ=(t,e)=>{for(var r in e||(e={}))IZ.call(e,r)&&Q_(t,r,e[r]);if(X_)for(var r of X_(e))SZ.call(e,r)&&Q_(t,r,e[r]);return t},xZ=(t,e)=>EZ(t,_Z(e));const AZ="did:pkh:",X0=t=>t?.split(":"),$Z=t=>{const e=t&&X0(t);if(e)return t.includes(AZ)?e[3]:e[1]},sw=t=>{const e=t&&X0(t);if(e)return e[2]+":"+e[3]},wf=t=>{const e=t&&X0(t);if(e)return e.pop()};async function e2(t){const{cacao:e,projectId:r}=t,{s:n,p:s}=e,i=zN(s,s.iss),o=wf(s.iss);return await hZ(o,i,n,sw(s.iss),r)}const zN=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,n=wf(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const i=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${$Z(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,g=Id(t.resources);if(g){const m=Uu(g);s=BZ(s,m)}return[r,n,"",s,"",i,o,a,c,l,u,h,d,p].filter(m=>m!=null).join(`
`)};function NZ(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function OZ(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Ia(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(s=>{const i=n[s];if(!Array.isArray(i))throw new Error(`Ability limits ${s} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function TZ(t,e,r,n={}){return r?.sort((s,i)=>s.localeCompare(i)),{att:{[t]:kZ(e,r,n)}}}function kZ(t,e,r={}){e=e?.sort((s,i)=>s.localeCompare(i));const n=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...n)}function HN(t){return Ia(t),`urn:recap:${NZ(t).replace(/=/g,"")}`}function Uu(t){const e=OZ(t.replace("urn:recap:",""));return Ia(e),e}function PZ(t,e,r){const n=TZ(t,e,r);return HN(n)}function RZ(t){return t&&t.includes("urn:recap:")}function DZ(t,e){const r=Uu(t),n=Uu(e),s=UZ(r,n);return HN(s)}function UZ(t,e){Ia(t),Ia(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,i)=>s.localeCompare(i)),n={att:{}};return r.forEach(s=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[s]=xZ(CZ({},n.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),n}function BZ(t="",e){Ia(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));n.push(u.join(", ").replace(".,","."))});const i=n.join(" "),o=`${r}${i}`;return`${t?t+" ":""}${o}`}function t2(t){var e;const r=Uu(t);Ia(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(s=>s.split("/")[1]):[]}function r2(t){const e=Uu(t);Ia(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(s=>{var i;(i=s?.[0])!=null&&i.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function Id(t){if(!t)return;const e=t?.[t.length-1];return RZ(e)?e:void 0}function VN(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function iw(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function im(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Jr(t,...e){if(!VN(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function n2(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function LZ(t,e){Jr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function yo(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Uc(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function MZ(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const jZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function FZ(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ow(t){if(typeof t=="string")t=FZ(t);else if(VN(t))t=aw(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function qZ(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function zZ(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const HZ=(t,e)=>{function r(n,...s){if(Jr(n),!jZ)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Jr(l):Jr(l,t.nonceLength)}const i=t.tagLength;i&&s[1]!==void 0&&Jr(s[1]);const o=e(n,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Jr(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Jr(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Jr(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function s2(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!WZ(e))throw new Error("invalid output, must be aligned");return e}function i2(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function VZ(t,e,r){iw(r);const n=new Uint8Array(16),s=MZ(n);return i2(s,0,BigInt(e),r),i2(s,8,BigInt(t),r),n}function WZ(t){return t.byteOffset%4===0}function aw(t){return Uint8Array.from(t)}const WN=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),KZ=WN("expand 16-byte k"),GZ=WN("expand 32-byte k"),YZ=yo(KZ),ZZ=yo(GZ);function Le(t,e){return t<<e|t>>>32-e}function cw(t){return t.byteOffset%4===0}const Gh=64,JZ=16,KN=2**32-1,o2=new Uint32Array;function XZ(t,e,r,n,s,i,o,a){const c=s.length,l=new Uint8Array(Gh),u=yo(l),h=cw(s)&&cw(i),d=h?yo(s):o2,p=h?yo(i):o2;for(let g=0;g<c;o++){if(t(e,r,n,u,o,a),o>=KN)throw new Error("arx: counter overflow");const m=Math.min(Gh,c-g);if(h&&m===Gh){const w=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let I=0,S;I<JZ;I++)S=w+I,p[S]=d[S]^u[I];g+=Gh;continue}for(let w=0,I;w<m;w++)I=g+w,i[I]=s[I]^l[w];g+=m}}function QZ(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=qZ({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return im(s),im(o),iw(i),iw(r),(a,c,l,u,h=0)=>{Jr(a),Jr(c),Jr(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Jr(u),im(h),h<0||h>=KN)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const p=[];let g=a.length,m,w;if(g===32)p.push(m=aw(a)),w=ZZ;else if(g===16&&r)m=new Uint8Array(32),m.set(a),m.set(a,16),w=YZ,p.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);cw(c)||p.push(c=aw(c));const I=yo(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(w,I,yo(c.subarray(0,16)),I),c=c.subarray(16)}const S=16-s;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){const b=new Uint8Array(12);b.set(c,i?0:12-c.length),c=b,p.push(c)}const v=yo(c);return XZ(t,w,I,v,l,u,h,o),Uc(...p),u}}const rr=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class eJ{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ow(e),Jr(e,32);const r=rr(e,0),n=rr(e,2),s=rr(e,4),i=rr(e,6),o=rr(e,8),a=rr(e,10),c=rr(e,12),l=rr(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=rr(e,16+2*u)}process(e,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],p=o[6],g=o[7],m=o[8],w=o[9],I=rr(e,r+0),S=rr(e,r+2),v=rr(e,r+4),b=rr(e,r+6),C=rr(e,r+8),N=rr(e,r+10),P=rr(e,r+12),R=rr(e,r+14);let O=i[0]+(I&8191),M=i[1]+((I>>>13|S<<3)&8191),j=i[2]+((S>>>10|v<<6)&8191),k=i[3]+((v>>>7|b<<9)&8191),$=i[4]+((b>>>4|C<<12)&8191),T=i[5]+(C>>>1&8191),f=i[6]+((C>>>14|N<<2)&8191),y=i[7]+((N>>>11|P<<5)&8191),E=i[8]+((P>>>8|R<<8)&8191),x=i[9]+(R>>>5|s),_=0,A=_+O*a+M*(5*w)+j*(5*m)+k*(5*g)+$*(5*p);_=A>>>13,A&=8191,A+=T*(5*d)+f*(5*h)+y*(5*u)+E*(5*l)+x*(5*c),_+=A>>>13,A&=8191;let L=_+O*c+M*a+j*(5*w)+k*(5*m)+$*(5*g);_=L>>>13,L&=8191,L+=T*(5*p)+f*(5*d)+y*(5*h)+E*(5*u)+x*(5*l),_+=L>>>13,L&=8191;let B=_+O*l+M*c+j*a+k*(5*w)+$*(5*m);_=B>>>13,B&=8191,B+=T*(5*g)+f*(5*p)+y*(5*d)+E*(5*h)+x*(5*u),_+=B>>>13,B&=8191;let q=_+O*u+M*l+j*c+k*a+$*(5*w);_=q>>>13,q&=8191,q+=T*(5*m)+f*(5*g)+y*(5*p)+E*(5*d)+x*(5*h),_+=q>>>13,q&=8191;let D=_+O*h+M*u+j*l+k*c+$*a;_=D>>>13,D&=8191,D+=T*(5*w)+f*(5*m)+y*(5*g)+E*(5*p)+x*(5*d),_+=D>>>13,D&=8191;let F=_+O*d+M*h+j*u+k*l+$*c;_=F>>>13,F&=8191,F+=T*a+f*(5*w)+y*(5*m)+E*(5*g)+x*(5*p),_+=F>>>13,F&=8191;let H=_+O*p+M*d+j*h+k*u+$*l;_=H>>>13,H&=8191,H+=T*c+f*a+y*(5*w)+E*(5*m)+x*(5*g),_+=H>>>13,H&=8191;let W=_+O*g+M*p+j*d+k*h+$*u;_=W>>>13,W&=8191,W+=T*l+f*c+y*a+E*(5*w)+x*(5*m),_+=W>>>13,W&=8191;let ee=_+O*m+M*g+j*p+k*d+$*h;_=ee>>>13,ee&=8191,ee+=T*u+f*l+y*c+E*a+x*(5*w),_+=ee>>>13,ee&=8191;let K=_+O*w+M*m+j*g+k*p+$*d;_=K>>>13,K&=8191,K+=T*h+f*u+y*l+E*c+x*a,_+=K>>>13,K&=8191,_=(_<<2)+_|0,_=_+A|0,A=_&8191,_=_>>>13,L+=_,i[0]=A,i[1]=L,i[2]=B,i[3]=q,i[4]=D,i[5]=F,i[6]=H,i[7]=W,i[8]=ee,i[9]=K}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Uc(n)}update(e){n2(this),e=ow(e),Jr(e);const{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Uc(this.h,this.r,this.buffer,this.pad)}digestInto(e){n2(this),LZ(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function tJ(t){const e=(n,s)=>t(s).update(ow(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const rJ=tJ(t=>new eJ(t));function nJ(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],p=e[3],g=e[4],m=e[5],w=e[6],I=e[7],S=s,v=r[0],b=r[1],C=r[2],N=o,P=a,R=c,O=l,M=u,j=h,k=d,$=p,T=g,f=m,y=w,E=I,x=S,_=v,A=b,L=C;for(let q=0;q<i;q+=2)N=N+M|0,x=Le(x^N,16),T=T+x|0,M=Le(M^T,12),N=N+M|0,x=Le(x^N,8),T=T+x|0,M=Le(M^T,7),P=P+j|0,_=Le(_^P,16),f=f+_|0,j=Le(j^f,12),P=P+j|0,_=Le(_^P,8),f=f+_|0,j=Le(j^f,7),R=R+k|0,A=Le(A^R,16),y=y+A|0,k=Le(k^y,12),R=R+k|0,A=Le(A^R,8),y=y+A|0,k=Le(k^y,7),O=O+$|0,L=Le(L^O,16),E=E+L|0,$=Le($^E,12),O=O+$|0,L=Le(L^O,8),E=E+L|0,$=Le($^E,7),N=N+j|0,L=Le(L^N,16),y=y+L|0,j=Le(j^y,12),N=N+j|0,L=Le(L^N,8),y=y+L|0,j=Le(j^y,7),P=P+k|0,x=Le(x^P,16),E=E+x|0,k=Le(k^E,12),P=P+k|0,x=Le(x^P,8),E=E+x|0,k=Le(k^E,7),R=R+$|0,_=Le(_^R,16),T=T+_|0,$=Le($^T,12),R=R+$|0,_=Le(_^R,8),T=T+_|0,$=Le($^T,7),O=O+M|0,A=Le(A^O,16),f=f+A|0,M=Le(M^f,12),O=O+M|0,A=Le(A^O,8),f=f+A|0,M=Le(M^f,7);let B=0;n[B++]=o+N|0,n[B++]=a+P|0,n[B++]=c+R|0,n[B++]=l+O|0,n[B++]=u+M|0,n[B++]=h+j|0,n[B++]=d+k|0,n[B++]=p+$|0,n[B++]=g+T|0,n[B++]=m+f|0,n[B++]=w+y|0,n[B++]=I+E|0,n[B++]=S+x|0,n[B++]=v+_|0,n[B++]=b+A|0,n[B++]=C+L|0}const sJ=QZ(nJ,{counterRight:!1,counterLength:4,allowShortKeys:!1}),iJ=new Uint8Array(16),a2=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(iJ.subarray(r))},oJ=new Uint8Array(32);function c2(t,e,r,n,s){const i=t(e,r,oJ),o=rJ.create(i);s&&a2(o,s),a2(o,n);const a=VZ(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return Uc(i,a),c}const aJ=t=>(e,r,n)=>({encrypt(s,i){const o=s.length;i=s2(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=c2(t,e,r,a,n);return i.set(c,o),Uc(c),i},decrypt(s,i){i=s2(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=c2(t,e,r,o,n);if(!zZ(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),Uc(c),i}}),GN=HZ({blockSize:64,nonceLength:12,tagLength:16},aJ(sJ));let YN=class extends pp{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,fp(e);const n=hs(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Wn(i)}update(e){return Io(this),this.iHash.update(e),this}digestInto(e){Io(this),ps(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const mp=(t,e,r)=>new YN(t,e).update(r).digest();mp.create=(t,e)=>new YN(t,e);function cJ(t,e,r){return fp(t),r===void 0&&(r=new Uint8Array(t.outputLen)),mp(t,hs(r),hs(e))}const om=Uint8Array.from([0]),l2=Uint8Array.of();function lJ(t,e,r,n=32){fp(t),Ai(n);const s=t.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);r===void 0&&(r=l2);const o=new Uint8Array(i*s),a=mp.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)om[0]=u+1,c.update(u===0?l2:l).update(r).update(om).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),Wn(l,om),o.slice(0,n)}const uJ=(t,e,r,n,s)=>lJ(t,cJ(t,e,r),n,s),yp=gp,Q0=BigInt(0),lw=BigInt(1);function bf(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function ia(t,e,r=""){const n=dp(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){const o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Yh(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ZN(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Q0:BigInt("0x"+t)}function wp(t){return ZN(yc(t))}function vf(t){return ps(t),ZN(yc(Uint8Array.from(t).reverse()))}function eb(t,e){return yf(t.toString(16).padStart(e*2,"0"))}function tb(t,e){return eb(t,e).reverse()}function $r(t,e,r){let n;if(typeof e=="string")try{n=yf(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(dp(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const am=t=>typeof t=="bigint"&&Q0<=t;function hJ(t,e,r){return am(t)&&am(e)&&am(r)&&e<=t&&t<r}function uw(t,e,r,n){if(!hJ(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function JN(t){let e;for(e=0;t>Q0;t>>=lw,e+=1);return e}const hh=t=>(lw<<BigInt(t))-lw;function dJ(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=d=>new Uint8Array(d),s=d=>Uint8Array.of(d);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...d)=>r(o,i,...d),u=(d=n(0))=>{o=l(s(0),d),i=l(),d.length!==0&&(o=l(s(1),d),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const p=[];for(;d<e;){i=l();const g=i.slice();p.push(g),d+=i.length}return ao(...p)};return(d,p)=>{c(),u(d);let g;for(;!(g=p(h()));)u();return c(),g}}function bp(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function u2(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const rn=BigInt(0),Dr=BigInt(1),oa=BigInt(2),XN=BigInt(3),QN=BigInt(4),e3=BigInt(5),fJ=BigInt(7),t3=BigInt(8),pJ=BigInt(9),r3=BigInt(16);function wn(t,e){const r=t%e;return r>=rn?r:e+r}function rs(t,e,r){let n=t;for(;e-- >rn;)n*=n,n%=r;return n}function h2(t,e){if(t===rn)throw new Error("invert: expected non-zero number");if(e<=rn)throw new Error("invert: expected positive modulus, got "+e);let r=wn(t,e),n=e,s=rn,i=Dr;for(;r!==rn;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==Dr)throw new Error("invert: does not exist");return wn(s,e)}function rb(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function n3(t,e){const r=(t.ORDER+Dr)/QN,n=t.pow(e,r);return rb(t,n,e),n}function gJ(t,e){const r=(t.ORDER-e3)/t3,n=t.mul(e,oa),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,oa),s),a=t.mul(i,t.sub(o,t.ONE));return rb(t,a,e),a}function mJ(t){const e=$o(t),r=s3(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+fJ)/r3;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,n);const h=a.mul(l,s),d=a.mul(l,i),p=a.eql(a.sqr(u),c),g=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(d,h,g);const m=a.eql(a.sqr(u),c),w=a.cmov(l,u,m);return rb(a,w,c),w}}function s3(t){if(t<XN)throw new Error("sqrt is not defined for small field");let e=t-Dr,r=0;for(;e%oa===rn;)e/=oa,r++;let n=oa;const s=$o(t);for(;d2(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return n3;let i=s.pow(n,e);const o=(e+Dr)/oa;return function(a,c){if(a.is0(c))return c;if(d2(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,i),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(p++,g=a.sqr(g),p===l)throw new Error("Cannot find square root");const m=Dr<<BigInt(l-p-1),w=a.pow(u,m);l=p,u=a.sqr(w),h=a.mul(h,u),d=a.mul(d,w)}return d}}function yJ(t){return t%QN===XN?n3:t%t3===e3?gJ:t%r3===pJ?mJ(t):s3(t)}const wJ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bJ(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=wJ.reduce((n,s)=>(n[s]="function",n),e);return bp(t,r),t}function vJ(t,e,r){if(r<rn)throw new Error("invalid exponent, negatives unsupported");if(r===rn)return t.ONE;if(r===Dr)return e;let n=t.ONE,s=e;for(;r>rn;)r&Dr&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Dr;return n}function i3(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function d2(t,e){const r=(t.ORDER-Dr)/oa,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function o3(t,e){e!==void 0&&Ai(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function $o(t,e,r=!1,n={}){if(t<=rn)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(s=d.BITS),d.sqrt&&(i=d.sqrt),typeof d.isLE=="boolean"&&(r=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:l}=o3(t,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:hh(c),ZERO:rn,ONE:Dr,allowedLengths:a,create:d=>wn(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return rn<=d&&d<t},is0:d=>d===rn,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&Dr)===Dr,neg:d=>wn(-d,t),eql:(d,p)=>d===p,sqr:d=>wn(d*d,t),add:(d,p)=>wn(d+p,t),sub:(d,p)=>wn(d-p,t),mul:(d,p)=>wn(d*p,t),pow:(d,p)=>vJ(h,d,p),div:(d,p)=>wn(d*h2(p,t),t),sqrN:d=>d*d,addN:(d,p)=>d+p,subN:(d,p)=>d-p,mulN:(d,p)=>d*p,inv:d=>h2(d,t),sqrt:i||(d=>(u||(u=yJ(t)),u(h,d))),toBytes:d=>r?tb(d,l):eb(d,l),fromBytes:(d,p=!0)=>{if(a){if(!a.includes(d.length)||d.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const m=new Uint8Array(l);m.set(d,r?0:m.length-d.length),d=m}if(d.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+d.length);let g=r?vf(d):wp(d);if(o&&(g=wn(g,t)),!p&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:d=>i3(h,d),cmov:(d,p,g)=>g?p:d});return Object.freeze(h)}function a3(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function c3(t){const e=a3(t);return e+Math.ceil(e/2)}function EJ(t,e,r=!1){const n=t.length,s=a3(e),i=c3(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?vf(t):wp(t),a=wn(o,e-Dr)+Dr;return r?tb(a,s):eb(a,s)}const Bc=BigInt(0),aa=BigInt(1);function Ef(t,e){const r=e.negate();return t?r:e}function cm(t,e){const r=i3(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function l3(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function lm(t,e){l3(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=hh(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function f2(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=aa);const l=e*n,u=l+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:l}}function _J(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function IJ(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const um=new WeakMap,u3=new WeakMap;function hm(t){return u3.get(t)||1}function p2(t){if(t!==Bc)throw new Error("invalid wNAF")}class SJ{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>Bc;)r&aa&&(n=n.add(s)),s=s.double(),r>>=aa;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=lm(r,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let l=1;l<s;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=lm(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:d,offsetF:p}=f2(n,a,o);n=c,u?i=i.add(Ef(d,r[p])):s=s.add(Ef(h,r[l]))}return p2(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){const i=lm(e,this.bits);for(let o=0;o<i.windows&&n!==Bc;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=f2(n,o,i);if(n=a,!l){const h=r[c];s=s.add(u?h.negate():h)}}return p2(n),s}getPrecomputes(e,r,n){let s=um.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),um.set(r,s))),s}cached(e,r,n){const s=hm(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const i=hm(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){l3(r,this.bits),u3.set(e,r),um.delete(e)}hasCache(e){return hm(e)!==1}}function CJ(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>Bc||n>Bc;)r&aa&&(i=i.add(s)),n&aa&&(o=o.add(s)),s=s.double(),r>>=aa,n>>=aa;return{p1:i,p2:o}}function xJ(t,e,r,n){_J(r,t),IJ(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=JN(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=hh(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let m=0;m<i;m++){const w=n[m],I=Number(w>>BigInt(p)&l);u[I]=u[I].add(r[m])}let g=o;for(let m=u.length-1,w=o;m>0;m--)w=w.add(u[m]),g=g.add(w);if(d=d.add(g),p!==0)for(let m=0;m<c;m++)d=d.double()}return d}function g2(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return bJ(e),e}else return $o(t,{isLE:r})}function AJ(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Bc))throw new Error(`CURVE.${a} must be positive bigint`)}const s=g2(e.p,r.Fp,n),i=g2(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),RN("HashToScalar-");const yl=BigInt(0),Za=BigInt(1),Zh=BigInt(2);function $J(t){return bp(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function NJ(t){const e=$J(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||Ua,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),p=a?Zh**BigInt(254):Zh**BigInt(447),g=a?BigInt(8)*Zh**BigInt(251)-Za:BigInt(4)*Zh**BigInt(445)-Za,m=p+g+Za,w=k=>wn(k,r),I=S(h);function S(k){return tb(w(k),u)}function v(k){const $=$r("u coordinate",k,u);return a&&($[31]&=127),w(vf($))}function b(k){return vf(s($r("scalar",k,u)))}function C(k,$){const T=R(v($),b(k));if(T===yl)throw new Error("invalid private or public key received");return S(T)}function N(k){return C(k,I)}function P(k,$,T){const f=w(k*($-T));return $=w($-f),T=w(T+f),{x_2:$,x_3:T}}function R(k,$){uw("u",k,yl,r),uw("scalar",$,p,m);const T=$,f=k;let y=Za,E=yl,x=k,_=Za,A=yl;for(let B=BigInt(l-1);B>=yl;B--){const q=T>>B&Za;A^=q,{x_2:y,x_3:x}=P(A,y,x),{x_2:E,x_3:_}=P(A,E,_),A=q;const D=y+E,F=w(D*D),H=y-E,W=w(H*H),ee=F-W,K=x+_,G=x-_,le=w(G*D),ye=w(K*H),ve=le+ye,Ee=le-ye;x=w(ve*ve),_=w(f*w(Ee*Ee)),y=w(F*W),E=w(ee*(F+w(d*ee)))}({x_2:y,x_3:x}=P(A,y,x)),{x_2:E,x_3:_}=P(A,E,_);const L=i(E);return w(y*L)}const O={secretKey:u,publicKey:u,seed:u},M=(k=c(u))=>(ps(k,O.seed),k);function j(k){const $=M(k);return{secretKey:$,publicKey:N($)}}return{keygen:j,getSharedSecret:(k,$)=>C(k,$),getPublicKey:k=>N(k),scalarMult:C,scalarMultBase:N,utils:{randomSecretKey:M,randomPrivateKey:M},GuBytes:I.slice(),lengths:O}}const OJ=BigInt(1),m2=BigInt(2),TJ=BigInt(3),kJ=BigInt(5);BigInt(8);const h3=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),PJ={p:h3,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function RJ(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=h3,o=t*t%i*t%i,a=rs(o,m2,i)*o%i,c=rs(a,OJ,i)*t%i,l=rs(c,kJ,i)*c%i,u=rs(l,e,i)*l%i,h=rs(u,r,i)*u%i,d=rs(h,n,i)*h%i,p=rs(d,s,i)*d%i,g=rs(p,s,i)*d%i,m=rs(g,e,i)*l%i;return{pow_p_5_8:rs(m,m2,i)*t%i,b2:o}}function DJ(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const UJ=$o(PJ.p,{isLE:!0}),hw=(()=>{const t=UJ.ORDER;return NJ({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=RJ(e);return wn(rs(r,TJ,t)*n,t)},adjustScalarBytes:DJ})})(),y2=(t,e)=>(t+(t>=0?e:-e)/d3)/e;function BJ(t,e,r){const[[n,s],[i,o]]=e,a=y2(o*t,r),c=y2(-s*t,r);let l=t-a*n-c*i,u=-a*s-c*o;const h=l<vi,d=u<vi;h&&(l=-l),d&&(u=-u);const p=hh(Math.ceil(JN(r)/2))+wc;if(l<vi||l>=p||u<vi||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}function dw(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function dm(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return bf(r.lowS,"lowS"),bf(r.prehash,"prehash"),r.format!==void 0&&dw(r.format),r}class LJ extends Error{constructor(e=""){super(e)}}const hi={Err:LJ,_tlv:{encode:(t,e)=>{const{Err:r}=hi;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=Yh(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?Yh(s.length/2|128):"";return Yh(t)+i+s+e},decode(t,e){const{Err:r}=hi;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=hi;if(t<vi)throw new e("integer: negative integers are not allowed");let r=Yh(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=hi;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return wp(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=hi,s=$r("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=hi,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},vi=BigInt(0),wc=BigInt(1),d3=BigInt(2),Jh=BigInt(3),MJ=BigInt(4);function cc(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=$r("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function jJ(t,e={}){const r=AJ("weierstrass",t,e),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;bp(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=p3(n,s);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(k,$,T){const{x:f,y}=$.toAffine(),E=n.toBytes(f);if(bf(T,"isCompressed"),T){u();const x=!n.isOdd(y);return ao(f3(x),E)}else return ao(Uint8Array.of(4),E,n.toBytes(y))}function d(k){ia(k,void 0,"Point");const{publicKey:$,publicKeyUncompressed:T}=l,f=k.length,y=k[0],E=k.subarray(1);if(f===$&&(y===2||y===3)){const x=n.fromBytes(E);if(!n.isValid(x))throw new Error("bad point: is not on curve, wrong x");const _=m(x);let A;try{A=n.sqrt(_)}catch(B){const q=B instanceof Error?": "+B.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const L=n.isOdd(A);return(y&1)===1!==L&&(A=n.neg(A)),{x,y:A}}else if(f===T&&y===4){const x=n.BYTES,_=n.fromBytes(E.subarray(0,x)),A=n.fromBytes(E.subarray(x,x*2));if(!w(_,A))throw new Error("bad point: is not on curve");return{x:_,y:A}}else throw new Error(`bad point: got length ${f}, expected compressed=${$} or uncompressed=${T}`)}const p=e.toBytes||h,g=e.fromBytes||d;function m(k){const $=n.sqr(k),T=n.mul($,k);return n.add(n.add(T,n.mul(k,i.a)),i.b)}function w(k,$){const T=n.sqr($),f=m(k);return n.eql(T,f)}if(!w(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const I=n.mul(n.pow(i.a,Jh),MJ),S=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(I,S)))throw new Error("bad curve params: a or b");function v(k,$,T=!1){if(!n.isValid($)||T&&n.is0($))throw new Error(`bad point coordinate ${k}`);return $}function b(k){if(!(k instanceof O))throw new Error("ProjectivePoint expected")}function C(k){if(!c||!c.basises)throw new Error("no endo");return BJ(k,c.basises,s.ORDER)}const N=u2((k,$)=>{const{X:T,Y:f,Z:y}=k;if(n.eql(y,n.ONE))return{x:T,y:f};const E=k.is0();$==null&&($=E?n.ONE:n.inv(y));const x=n.mul(T,$),_=n.mul(f,$),A=n.mul(y,$);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x,y:_}}),P=u2(k=>{if(k.is0()){if(e.allowInfinityPoint&&!n.is0(k.Y))return;throw new Error("bad point: ZERO")}const{x:$,y:T}=k.toAffine();if(!n.isValid($)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!w($,T))throw new Error("bad point: equation left != right");if(!k.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(k,$,T,f,y){return T=new O(n.mul(T.X,k),T.Y,T.Z),$=Ef(f,$),T=Ef(y,T),$.add(T)}class O{constructor($,T,f){this.X=v("x",$),this.Y=v("y",T,!0),this.Z=v("z",f),Object.freeze(this)}static CURVE(){return i}static fromAffine($){const{x:T,y:f}=$||{};if(!$||!n.isValid(T)||!n.isValid(f))throw new Error("invalid affine point");if($ instanceof O)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(f)?O.ZERO:new O(T,f,n.ONE)}static fromBytes($){const T=O.fromAffine(g(ia($,void 0,"point")));return T.assertValidity(),T}static fromHex($){return O.fromBytes($r("pointHex",$))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute($=8,T=!0){return j.createCache(this,$),T||this.multiply(Jh),this}assertValidity(){P(this)}hasEvenY(){const{y:$}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd($)}equals($){b($);const{X:T,Y:f,Z:y}=this,{X:E,Y:x,Z:_}=$,A=n.eql(n.mul(T,_),n.mul(E,y)),L=n.eql(n.mul(f,_),n.mul(x,y));return A&&L}negate(){return new O(this.X,n.neg(this.Y),this.Z)}double(){const{a:$,b:T}=i,f=n.mul(T,Jh),{X:y,Y:E,Z:x}=this;let _=n.ZERO,A=n.ZERO,L=n.ZERO,B=n.mul(y,y),q=n.mul(E,E),D=n.mul(x,x),F=n.mul(y,E);return F=n.add(F,F),L=n.mul(y,x),L=n.add(L,L),_=n.mul($,L),A=n.mul(f,D),A=n.add(_,A),_=n.sub(q,A),A=n.add(q,A),A=n.mul(_,A),_=n.mul(F,_),L=n.mul(f,L),D=n.mul($,D),F=n.sub(B,D),F=n.mul($,F),F=n.add(F,L),L=n.add(B,B),B=n.add(L,B),B=n.add(B,D),B=n.mul(B,F),A=n.add(A,B),D=n.mul(E,x),D=n.add(D,D),B=n.mul(D,F),_=n.sub(_,B),L=n.mul(D,q),L=n.add(L,L),L=n.add(L,L),new O(_,A,L)}add($){b($);const{X:T,Y:f,Z:y}=this,{X:E,Y:x,Z:_}=$;let A=n.ZERO,L=n.ZERO,B=n.ZERO;const q=i.a,D=n.mul(i.b,Jh);let F=n.mul(T,E),H=n.mul(f,x),W=n.mul(y,_),ee=n.add(T,f),K=n.add(E,x);ee=n.mul(ee,K),K=n.add(F,H),ee=n.sub(ee,K),K=n.add(T,y);let G=n.add(E,_);return K=n.mul(K,G),G=n.add(F,W),K=n.sub(K,G),G=n.add(f,y),A=n.add(x,_),G=n.mul(G,A),A=n.add(H,W),G=n.sub(G,A),B=n.mul(q,K),A=n.mul(D,W),B=n.add(A,B),A=n.sub(H,B),B=n.add(H,B),L=n.mul(A,B),H=n.add(F,F),H=n.add(H,F),W=n.mul(q,W),K=n.mul(D,K),H=n.add(H,W),W=n.sub(F,W),W=n.mul(q,W),K=n.add(K,W),F=n.mul(H,K),L=n.add(L,F),F=n.mul(G,K),A=n.mul(ee,A),A=n.sub(A,F),F=n.mul(ee,H),B=n.mul(G,B),B=n.add(B,F),new O(A,L,B)}subtract($){return this.add($.negate())}is0(){return this.equals(O.ZERO)}multiply($){const{endo:T}=e;if(!s.isValidNot0($))throw new Error("invalid scalar: out of range");let f,y;const E=x=>j.cached(this,x,_=>cm(O,_));if(T){const{k1neg:x,k1:_,k2neg:A,k2:L}=C($),{p:B,f:q}=E(_),{p:D,f:F}=E(L);y=q.add(F),f=R(T.beta,B,D,x,A)}else{const{p:x,f:_}=E($);f=x,y=_}return cm(O,[f,y])[0]}multiplyUnsafe($){const{endo:T}=e,f=this;if(!s.isValid($))throw new Error("invalid scalar: out of range");if($===vi||f.is0())return O.ZERO;if($===wc)return f;if(j.hasCache(this))return this.multiply($);if(T){const{k1neg:y,k1:E,k2neg:x,k2:_}=C($),{p1:A,p2:L}=CJ(O,f,E,_);return R(T.beta,A,L,y,x)}else return j.unsafe(f,$)}multiplyAndAddUnsafe($,T,f){const y=this.multiplyUnsafe(T).add($.multiplyUnsafe(f));return y.is0()?void 0:y}toAffine($){return N(this,$)}isTorsionFree(){const{isTorsionFree:$}=e;return o===wc?!0:$?$(O,this):j.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:$}=e;return o===wc?this:$?$(O,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes($=!0){return bf($,"isCompressed"),this.assertValidity(),p(O,this,$)}toHex($=!0){return yc(this.toBytes($))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes($=!0){return this.toBytes($)}_setWindowSize($){this.precompute($)}static normalizeZ($){return cm(O,$)}static msm($,T){return xJ(O,s,$,T)}static fromPrivateKey($){return O.BASE.multiply(cc(s,$))}}O.BASE=new O(i.Gx,i.Gy,n.ONE),O.ZERO=new O(n.ZERO,n.ONE,n.ZERO),O.Fp=n,O.Fn=s;const M=s.BITS,j=new SJ(O,e.endo?Math.ceil(M/2):M);return O.BASE.precompute(8),O}function f3(t){return Uint8Array.of(t?2:3)}function p3(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function FJ(t,e={}){const{Fn:r}=t,n=e.randomBytes||Ua,s=Object.assign(p3(t.Fp,r),{seed:c3(r.ORDER)});function i(d){try{return!!cc(r,d)}catch{return!1}}function o(d,p){const{publicKey:g,publicKeyUncompressed:m}=s;try{const w=d.length;return p===!0&&w!==g||p===!1&&w!==m?!1:!!t.fromBytes(d)}catch{return!1}}function a(d=n(s.seed)){return EJ(ia(d,s.seed,"seed"),r.ORDER)}function c(d,p=!0){return t.BASE.multiply(cc(r,d)).toBytes(p)}function l(d){const p=a(d);return{secretKey:p,publicKey:c(p)}}function u(d){if(typeof d=="bigint")return!1;if(d instanceof t)return!0;const{secretKey:p,publicKey:g,publicKeyUncompressed:m}=s;if(r.allowedLengths||p===g)return;const w=$r("key",d).length;return w===g||w===m}function h(d,p,g=!0){if(u(d)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const m=cc(r,d);return t.fromHex(p).multiply(m).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:d=>cc(r,d),precompute(d=8,p=t.BASE){return p.precompute(d,!1)}},lengths:s})}function qJ(t,e,r={}){fp(e),bp(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||Ua,s=r.hmac||((T,...f)=>mp(e,T,ao(...f))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:p}=FJ(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},m="compact";function w(T){const f=a>>wc;return T>f}function I(T,f){if(!o.isValidNot0(f))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return f}function S(T,f){dw(f);const y=p.signature,E=f==="compact"?y:f==="recovered"?y+1:void 0;return ia(T,E,`${f} signature`)}class v{constructor(f,y,E){this.r=I("r",f),this.s=I("s",y),E!=null&&(this.recovery=E),Object.freeze(this)}static fromBytes(f,y=m){S(f,y);let E;if(y==="der"){const{r:L,s:B}=hi.toSig(ia(f));return new v(L,B)}y==="recovered"&&(E=f[0],y="compact",f=f.subarray(1));const x=o.BYTES,_=f.subarray(0,x),A=f.subarray(x,x*2);return new v(o.fromBytes(_),o.fromBytes(A),E)}static fromHex(f,y){return this.fromBytes(yf(f),y)}addRecoveryBit(f){return new v(this.r,this.s,f)}recoverPublicKey(f){const y=i.ORDER,{r:E,s:x,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*d3<y&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=_===2||_===3?E+a:E;if(!i.isValid(A))throw new Error("recovery id 2 or 3 invalid");const L=i.toBytes(A),B=t.fromBytes(ao(f3((_&1)===0),L)),q=o.inv(A),D=C($r("msgHash",f)),F=o.create(-D*q),H=o.create(x*q),W=t.BASE.multiplyUnsafe(F).add(B.multiplyUnsafe(H));if(W.is0())throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return w(this.s)}toBytes(f=m){if(dw(f),f==="der")return yf(hi.hexFromSig(this));const y=o.toBytes(this.r),E=o.toBytes(this.s);if(f==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return ao(Uint8Array.of(this.recovery),y,E)}return ao(y,E)}toHex(f){return yc(this.toBytes(f))}assertValidity(){}static fromCompact(f){return v.fromBytes($r("sig",f),"compact")}static fromDER(f){return v.fromBytes($r("sig",f),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return yc(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return yc(this.toBytes("compact"))}}const b=r.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const f=wp(T),y=T.length*8-c;return y>0?f>>BigInt(y):f},C=r.bits2int_modN||function(T){return o.create(b(T))},N=hh(c);function P(T){return uw("num < 2^"+c,T,vi,N),o.toBytes(T)}function R(T,f){return ia(T,void 0,"message"),f?ia(e(T),void 0,"prehashed message"):T}function O(T,f,y){if(["recovered","canonical"].some(H=>H in y))throw new Error("sign() legacy options not supported");const{lowS:E,prehash:x,extraEntropy:_}=dm(y,g);T=R(T,x);const A=C(T),L=cc(o,f),B=[P(L),P(A)];if(_!=null&&_!==!1){const H=_===!0?n(p.secretKey):_;B.push($r("extraEntropy",H))}const q=ao(...B),D=A;function F(H){const W=b(H);if(!o.isValidNot0(W))return;const ee=o.inv(W),K=t.BASE.multiply(W).toAffine(),G=o.create(K.x);if(G===vi)return;const le=o.create(ee*o.create(D+G*L));if(le===vi)return;let ye=(K.x===G?0:2)|Number(K.y&wc),ve=le;return E&&w(le)&&(ve=o.neg(le),ye^=1),new v(G,ve,ye)}return{seed:q,k2sig:F}}function M(T,f,y={}){T=$r("message",T);const{seed:E,k2sig:x}=O(T,f,y);return dJ(e.outputLen,o.BYTES,s)(E,x)}function j(T){let f;const y=typeof T=="string"||dp(T),E=!y&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!y&&!E)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(E)f=new v(T.r,T.s);else if(y){try{f=v.fromBytes($r("sig",T),"der")}catch(x){if(!(x instanceof hi.Err))throw x}if(!f)try{f=v.fromBytes($r("sig",T),"compact")}catch{return!1}}return f||!1}function k(T,f,y,E={}){const{lowS:x,prehash:_,format:A}=dm(E,g);if(y=$r("publicKey",y),f=R($r("message",f),_),"strict"in E)throw new Error("options.strict was renamed to lowS");const L=A===void 0?j(T):v.fromBytes($r("sig",T),A);if(L===!1)return!1;try{const B=t.fromBytes(y);if(x&&L.hasHighS())return!1;const{r:q,s:D}=L,F=C(f),H=o.inv(D),W=o.create(F*H),ee=o.create(q*H),K=t.BASE.multiplyUnsafe(W).add(B.multiplyUnsafe(ee));return K.is0()?!1:o.create(K.x)===q}catch{return!1}}function $(T,f,y={}){const{prehash:E}=dm(y,g);return f=R(f,E),v.fromBytes(T,"recovered").recoverPublicKey(f).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:p,Point:t,sign:M,verify:k,recoverPublicKey:$,Signature:v,hash:e})}function zJ(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=$o(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function HJ(t){const{CURVE:e,curveOpts:r}=zJ(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function VJ(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,o3(r.Fn.ORDER,r.Fn.BITS))})}function WJ(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=HJ(t),i=jJ(e,r),o=qJ(i,n,s);return VJ(t,o)}function fw(t,e){const r=n=>WJ({...t,hash:n});return{...r(e),create:r}}const g3={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},m3={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},y3={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},KJ=$o(g3.p),GJ=$o(m3.p),YJ=$o(y3.p),ZJ=fw({...g3,Fp:KJ,lowS:!1},gp);fw({...m3,Fp:GJ,lowS:!1},nZ),fw({...y3,Fp:YJ,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},rZ);const JJ=ZJ,w3="base10",Ur="base16",Xr="base64pad",co="base64url",dh="utf8",b3=0,Ii=1,fh=2,XJ=0,w2=1,zl=12,nb=32;function QJ(){const t=hw.utils.randomPrivateKey(),e=hw.getPublicKey(t);return{privateKey:Ye(t,Ur),publicKey:Ye(e,Ur)}}function pw(){const t=Ua(nb);return Ye(t,Ur)}function eX(t,e){const r=hw.getSharedSecret(ut(t,Ur),ut(e,Ur)),n=uJ(yp,r,void 0,void 0,nb);return Ye(n,Ur)}function Sd(t){const e=yp(ut(t,Ur));return Ye(e,Ur)}function qn(t){const e=yp(ut(t,dh));return Ye(e,Ur)}function v3(t){return ut(`${t}`,w3)}function Sa(t){return Number(Ye(t,w3))}function E3(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function _3(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function tX(t){const e=v3(typeof t.type<"u"?t.type:b3);if(Sa(e)===Ii&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ut(t.senderPublicKey,Ur):void 0,n=typeof t.iv<"u"?ut(t.iv,Ur):Ua(zl),s=ut(t.symKey,Ur),i=GN(s,n).encrypt(ut(t.message,dh)),o=I3({type:e,sealed:i,iv:n,senderPublicKey:r});return t.encoding===co?E3(o):o}function rX(t){const e=ut(t.symKey,Ur),{sealed:r,iv:n}=Bu({encoded:t.encoded,encoding:t.encoding}),s=GN(e,n).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Ye(s,dh)}function nX(t,e){const r=v3(fh),n=Ua(zl),s=ut(t,dh),i=I3({type:r,sealed:s,iv:n});return e===co?E3(i):i}function sX(t,e){const{sealed:r}=Bu({encoded:t,encoding:e});return Ye(r,dh)}function I3(t){if(Sa(t.type)===fh)return Ye(Rs([t.type,t.sealed]),Xr);if(Sa(t.type)===Ii){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ye(Rs([t.type,t.senderPublicKey,t.iv,t.sealed]),Xr)}return Ye(Rs([t.type,t.iv,t.sealed]),Xr)}function Bu(t){const e=(t.encoding||Xr)===co?_3(t.encoded):t.encoded,r=ut(e,Xr),n=r.slice(XJ,w2),s=w2;if(Sa(n)===Ii){const c=s+nb,l=c+zl,u=r.slice(s,c),h=r.slice(c,l),d=r.slice(l);return{type:n,sealed:d,iv:h,senderPublicKey:u}}if(Sa(n)===fh){const c=r.slice(s),l=Ua(zl);return{type:n,sealed:c,iv:l}}const i=s+zl,o=r.slice(s,i),a=r.slice(i);return{type:n,sealed:a,iv:o}}function iX(t,e){const r=Bu({encoded:t,encoding:e?.encoding});return S3({type:Sa(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Ye(r.senderPublicKey,Ur):void 0,receiverPublicKey:e?.receiverPublicKey})}function S3(t){const e=t?.type||b3;if(e===Ii){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function b2(t){return t.type===Ii&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function v2(t){return t.type===fh}function oX(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Rs([new Uint8Array([4]),e,r])}function aX(t,e){const[r,n,s]=t.split("."),i=Buffer.from(_3(s),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${r}.${n}`,l=yp(c),u=oX(e);if(!JJ.verify(Rs([o,a]),l,u))throw new Error("Invalid signature");return Cc(t).payload}const cX="irn";function _f(t){return t?.relay||{protocol:cX}}function lc(t){const e=Tx[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var lX=Object.defineProperty,uX=Object.defineProperties,hX=Object.getOwnPropertyDescriptors,E2=Object.getOwnPropertySymbols,dX=Object.prototype.hasOwnProperty,fX=Object.prototype.propertyIsEnumerable,_2=(t,e,r)=>e in t?lX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fm=(t,e)=>{for(var r in e||(e={}))dX.call(e,r)&&_2(t,r,e[r]);if(E2)for(var r of E2(e))fX.call(e,r)&&_2(t,r,e[r]);return t},pX=(t,e)=>uX(t,hX(e));function gX(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(n)){const i=s.replace(n,""),o=t[s];r[i]=o}}),r}function I2(t){if(!t.includes("wc:")){const l=$N(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),s=t.substring(e+1,r).split("@"),i=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:mX(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:gX(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function mX(t){return t.startsWith("//")?t.substring(2):t}function yX(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(s=>{const i=s,o=r+e+i;t[i]&&(n[o]=t[i])}),n}function S2(t){const e=new URLSearchParams,r=fm(fm(pX(fm({},yX(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!==void 0&&e.append(n,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Xh(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var wX=Object.defineProperty,bX=Object.defineProperties,vX=Object.getOwnPropertyDescriptors,C2=Object.getOwnPropertySymbols,EX=Object.prototype.hasOwnProperty,_X=Object.prototype.propertyIsEnumerable,x2=(t,e,r)=>e in t?wX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,IX=(t,e)=>{for(var r in e||(e={}))EX.call(e,r)&&x2(t,r,e[r]);if(C2)for(var r of C2(e))_X.call(e,r)&&x2(t,r,e[r]);return t},SX=(t,e)=>bX(t,vX(e));function Kc(t){const e=[];return t.forEach(r=>{const[n,s]=r.split(":");e.push(`${n}:${s}`)}),e}function CX(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Kc(r.accounts))}),e}function xX(t,e){const r=[];return Object.values(t).forEach(n=>{Kc(n.accounts).includes(e)&&r.push(...n.methods)}),r}function AX(t,e){const r=[];return Object.values(t).forEach(n=>{Kc(n.accounts).includes(e)&&r.push(...n.events)}),r}function vp(t){return t.includes(":")}function uc(t){return vp(t)?t.split(":")[0]:t}function A2(t){var e,r,n;const s={};if(!Bs(t))return s;for(const[i,o]of Object.entries(t)){const a=vp(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],u=uc(i);s[u]=SX(IX({},s[u]),{chains:Us(a,(e=s[u])==null?void 0:e.chains),methods:Us(c,(r=s[u])==null?void 0:r.methods),events:Us(l,(n=s[u])==null?void 0:n.events)})}return s}function $X(t){const e={};return t?.forEach(r=>{var n;const[s,i]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(n=e[s].chains)==null||n.push(`${s}:${i}`)}),e}function $2(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=$X(e);for(const[n,s]of Object.entries(r))s.methods?s.methods=Us(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function NX(t,e){var r,n,s,i,o,a;const c=A2(t),l=A2(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:Us((r=c[d])==null?void 0:r.chains,(n=l[d])==null?void 0:n.chains),methods:Us((s=c[d])==null?void 0:s.methods,(i=l[d])==null?void 0:i.methods),events:Us((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const OX={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},TX={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ne(t,e){const{message:r,code:n}=TX[t];return{message:e?`${r} ${e}`:r,code:n}}function lt(t,e){const{message:r,code:n}=OX[t];return{message:e?`${r} ${e}`:r,code:n}}function Si(t,e){return!!Array.isArray(t)}function Bs(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Lt(t){return typeof t>"u"}function $t(t,e){return e&&Lt(t)?!0:typeof t=="string"&&!!t.trim().length}function sb(t,e){return e&&Lt(t)?!0:typeof t=="number"&&!isNaN(t)}function kX(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),s=Object.keys(r);let i=!0;return sa(s,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Kc(a),h=r[o];(!sa(IN(o,h),u)||!sa(h.methods,c)||!sa(h.events,l))&&(i=!1)}),i):!1}function If(t){return $t(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function PX(t){if($t(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&If(r)}}return!1}function RX(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if($t(t,!1)){if(e(t))return!0;const r=$N(t);return e(r)}}catch{}return!1}function DX(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function UX(t){return t?.topic}function BX(t,e){let r=null;return $t(t?.publicKey,!1)||(r=ne("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function N2(t){let e=!0;return Si(t)?t.length&&(e=t.every(r=>$t(r,!1))):e=!1,e}function LX(t,e,r){let n=null;return Si(e)&&e.length?e.forEach(s=>{n||If(s)||(n=lt("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):If(t)||(n=lt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function MX(t,e,r){let n=null;return Object.entries(t).forEach(([s,i])=>{if(n)return;const o=LX(s,IN(s,i),`${e} ${r}`);o&&(n=o)}),n}function jX(t,e){let r=null;return Si(t)?t.forEach(n=>{r||PX(n)||(r=lt("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=lt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function FX(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const s=jX(n?.accounts,`${e} namespace`);s&&(r=s)}),r}function qX(t,e){let r=null;return N2(t?.methods)?N2(t?.events)||(r=lt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=lt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function C3(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const s=qX(n,`${e}, namespace`);s&&(r=s)}),r}function zX(t,e,r){let n=null;if(t&&Bs(t)){const s=C3(t,e);s&&(n=s);const i=MX(t,e,r);i&&(n=i)}else n=ne("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function pm(t,e){let r=null;if(t&&Bs(t)){const n=C3(t,e);n&&(r=n);const s=FX(t,e);s&&(r=s)}else r=ne("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function x3(t){return $t(t.protocol,!0)}function HX(t,e){let r=!1;return t?t&&Si(t)&&t.length&&t.forEach(n=>{r=x3(n)}):r=!0,r}function VX(t){return typeof t=="number"}function Wr(t){return typeof t<"u"&&typeof t!==null}function WX(t){return!(!t||typeof t!="object"||!t.code||!sb(t.code,!1)||!t.message||!$t(t.message,!1))}function KX(t){return!(Lt(t)||!$t(t.method,!1))}function GX(t){return!(Lt(t)||Lt(t.result)&&Lt(t.error)||!sb(t.id,!1)||!$t(t.jsonrpc,!1))}function YX(t){return!(Lt(t)||!$t(t.name,!1))}function O2(t,e){return!(!If(e)||!CX(t).includes(e))}function ZX(t,e,r){return $t(r,!1)?xX(t,e).includes(r):!1}function JX(t,e,r){return $t(r,!1)?AX(t,e).includes(r):!1}function T2(t,e,r){let n=null;const s=XX(t),i=QX(e),o=Object.keys(s),a=Object.keys(i),c=k2(Object.keys(t)),l=k2(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(n=ne("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),sa(o,a)||(n=ne("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const d=Kc(e[h].accounts);d.includes(h)||(n=ne("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{n||(sa(s[h].methods,i[h].methods)?sa(s[h].events,i[h].events)||(n=ne("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=ne("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function XX(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function k2(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function QX(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:Kc(t[r].accounts)?.forEach(s=>{e[s]={accounts:t[r].accounts.filter(i=>i.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}),e}function eQ(t,e){return sb(t,!1)&&t<=e.max&&t>=e.min}function P2(){const t=lh();return new Promise(e=>{switch(t){case _n.browser:e(tQ());break;case _n.reactNative:e(rQ());break;case _n.node:e(nQ());break;default:e(!0)}})}function tQ(){return Wc()&&navigator?.onLine}async function rQ(){return Ao()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function nQ(){return!0}function sQ(t){switch(lh()){case _n.browser:iQ(t);break;case _n.reactNative:oQ(t);break}}function iQ(t){!Ao()&&Wc()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function oQ(t){Ao()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function aQ(){var t;return Wc()&&Jt.getDocument()?((t=Jt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const gm={};class wl{static get(e){return gm[e]}static set(e,r){gm[e]=r}static delete(e){delete gm[e]}}function cQ(t){const e=ch.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function lQ({publicKey:t,signature:e,payload:r}){var n;const s=gw(r.method),i=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=dQ(r.address),a=r.era==="00"?new Uint8Array([0]):gw(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${hQ(r.tip)}`),h=pQ(u),d=new Uint8Array([0,...t,o,...e,...a,...l,...h,...s]),p=fQ(d.length+1);return new Uint8Array([...p,i,...d])}function uQ(t){const e=gw(t),r=Px.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function gw(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function hQ(t){return t.startsWith("0x")?t.slice(2):t}function dQ(t){const e=ch.decode(t)[0];return e===42?0:e===60?2:1}function fQ(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function pQ(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function gQ(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=cQ(t.transaction.address),n=lQ({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(n).toString("hex");return uQ(s)}function ib({logger:t,name:e}){const r=typeof t=="string"?q$({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}let ob=class extends WA{constructor(e){super(e),this.events=new mt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Nt(e.method,e.params||[],e.id||Nr().toString()),r)}async requestStrict(e,r){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(i){s(i)}this.events.on(`${e.id}`,i=>{dt(i)?s(i.error):n(i.result)});try{await this.connection.send(e,r)}catch(i){s(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),xo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const mQ=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),yQ=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",R2=t=>t.split("?")[0],D2=10,wQ=mQ();let bQ=class{constructor(e){if(this.url=e,this.events=new mt.EventEmitter,this.registering=!1,!nf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Br(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!nf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const s=VA.isReactNative()?void 0:{rejectUnauthorized:!GA(e)},i=new wQ(e,[],s);yQ()?i.onerror=o=>{const a=o;n(this.emitError(a.error))}:i.on("error",o=>{n(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),r(i)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ls(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),s=n.message||n.toString(),i=Oa(e,s);this.events.emit("payload",i)}parseError(e,r=this.url){return O0(e,R2(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>D2&&this.events.setMaxListeners(D2)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${R2(this.url)}`));return this.events.emit("register_error",r),r}};var vQ={};const A3="wc",$3=2,mw="core",js=`${A3}@2:${mw}:`,EQ={logger:"error"},_Q={database:":memory:"},IQ="crypto",U2="client_ed25519_seed",SQ=z.ONE_DAY,CQ="keychain",xQ="0.3",AQ="messages",$Q="0.3",NQ=z.SIX_HOURS,OQ="publisher",N3="irn",TQ="error",O3="wss://relay.walletconnect.org",kQ="relayer",yt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},PQ="_subscription",Tn={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},RQ=.1,yw="2.22.4",nt={link_mode:"link_mode",relay:"relay"},Cd={inbound:"inbound",outbound:"outbound"},DQ="0.3",UQ="WALLETCONNECT_CLIENT_ID",B2="WALLETCONNECT_LINK_MODE_APPS",pn={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},BQ="subscription",LQ="0.3",MQ="pairing",jQ="0.3",bl={wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}},Ko={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Xn={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},FQ="history",qQ="0.3",zQ="expirer",Ln={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},HQ="0.3",VQ="verify-api",WQ="https://verify.walletconnect.com",T3="https://verify.walletconnect.org",Hl=T3,KQ=`${Hl}/v3`,GQ=[WQ,T3],YQ="echo",ZQ="https://echo.walletconnect.com",Cs={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ti={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Qn={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Ro={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Do={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},vl={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},JQ=.1,XQ="event-client",QQ=86400,eee="https://pulse.walletconnect.org/batch";function tee(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,w=0,I=0,S=g.length;I!==S&&g[I]===0;)I++,m++;for(var v=(S-I)*u+1>>>0,b=new Uint8Array(v);I!==S;){for(var C=g[I],N=0,P=v-1;(C!==0||N<w)&&P!==-1;P--,N++)C+=256*b[P]>>>0,b[P]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=N,I++}for(var R=v-w;R!==v&&b[R]===0;)R++;for(var O=c.repeat(m);R<v;++R)O+=t.charAt(b[R]);return O}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var w=0,I=0;g[m]===c;)w++,m++;for(var S=(g.length-m)*l+1>>>0,v=new Uint8Array(S);g[m];){var b=r[g.charCodeAt(m)];if(b===255)return;for(var C=0,N=S-1;(b!==0||C<I)&&N!==-1;N--,C++)b+=a*v[N]>>>0,v[N]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");I=C,m++}if(g[m]!==" "){for(var P=S-I;P!==S&&v[P]===0;)P++;for(var R=new Uint8Array(w+(S-P)),O=w;P!==S;)R[O++]=v[P++];return R}}}function p(g){var m=d(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var ree=tee,nee=ree;const k3=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},see=t=>new TextEncoder().encode(t),iee=t=>new TextDecoder().decode(t);class oee{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class aee{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return P3(this,e)}}class cee{constructor(e){this.decoders=e}or(e){return P3(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const P3=(t,e)=>new cee({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class lee{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new oee(e,r,n),this.decoder=new aee(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ep=({name:t,prefix:e,encode:r,decode:n})=>new lee(t,e,r,n),ph=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=nee(r,e);return Ep({prefix:t,name:e,encode:n,decode:i=>k3(s(i))})},uee=(t,e,r,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},hee=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},pr=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Ep({prefix:e,name:t,encode(s){return hee(s,n,r)},decode(s){return uee(s,n,r,t)}}),dee=Ep({prefix:"\0",name:"identity",encode:t=>iee(t),decode:t=>see(t)});var fee=Object.freeze({__proto__:null,identity:dee});const pee=pr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var gee=Object.freeze({__proto__:null,base2:pee});const mee=pr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var yee=Object.freeze({__proto__:null,base8:mee});const wee=ph({prefix:"9",name:"base10",alphabet:"0123456789"});var bee=Object.freeze({__proto__:null,base10:wee});const vee=pr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Eee=pr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var _ee=Object.freeze({__proto__:null,base16:vee,base16upper:Eee});const Iee=pr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),See=pr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Cee=pr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xee=pr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Aee=pr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$ee=pr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Nee=pr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Oee=pr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Tee=pr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var kee=Object.freeze({__proto__:null,base32:Iee,base32upper:See,base32pad:Cee,base32padupper:xee,base32hex:Aee,base32hexupper:$ee,base32hexpad:Nee,base32hexpadupper:Oee,base32z:Tee});const Pee=ph({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ree=ph({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Dee=Object.freeze({__proto__:null,base36:Pee,base36upper:Ree});const Uee=ph({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Bee=ph({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Lee=Object.freeze({__proto__:null,base58btc:Uee,base58flickr:Bee});const Mee=pr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),jee=pr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Fee=pr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qee=pr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var zee=Object.freeze({__proto__:null,base64:Mee,base64pad:jee,base64url:Fee,base64urlpad:qee});const R3=Array.from(""),Hee=R3.reduce((t,e,r)=>(t[r]=e,t),[]),Vee=R3.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Wee(t){return t.reduce((e,r)=>(e+=Hee[r],e),"")}function Kee(t){const e=[];for(const r of t){const n=Vee[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Gee=Ep({prefix:"",name:"base256emoji",encode:Wee,decode:Kee});var Yee=Object.freeze({__proto__:null,base256emoji:Gee}),Zee=D3,L2=128,Jee=-128,Xee=Math.pow(2,31);function D3(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Xee;)e[r++]=t&255|L2,t/=128;for(;t&Jee;)e[r++]=t&255|L2,t>>>=7;return e[r]=t|0,D3.bytes=r-n+1,e}var Qee=ww,ete=128,M2=127;function ww(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw ww.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&M2)<<s:(o&M2)*Math.pow(2,s),s+=7}while(o>=ete);return ww.bytes=i-n,r}var tte=Math.pow(2,7),rte=Math.pow(2,14),nte=Math.pow(2,21),ste=Math.pow(2,28),ite=Math.pow(2,35),ote=Math.pow(2,42),ate=Math.pow(2,49),cte=Math.pow(2,56),lte=Math.pow(2,63),ute=function(t){return t<tte?1:t<rte?2:t<nte?3:t<ste?4:t<ite?5:t<ote?6:t<ate?7:t<cte?8:t<lte?9:10},hte={encode:Zee,decode:Qee,encodingLength:ute},U3=hte;const j2=(t,e,r=0)=>(U3.encode(t,e,r),e),F2=t=>U3.encodingLength(t),bw=(t,e)=>{const r=e.byteLength,n=F2(t),s=n+F2(r),i=new Uint8Array(s+r);return j2(t,i,0),j2(r,i,n),i.set(e,s),new dte(t,r,e,i)};class dte{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}}const B3=({name:t,code:e,encode:r})=>new fte(t,e,r);class fte{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?bw(this.code,r):r.then(n=>bw(this.code,n))}else throw Error("Unknown type, must be binary type")}}const L3=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),pte=B3({name:"sha2-256",code:18,encode:L3("SHA-256")}),gte=B3({name:"sha2-512",code:19,encode:L3("SHA-512")});var mte=Object.freeze({__proto__:null,sha256:pte,sha512:gte});const M3=0,yte="identity",j3=k3,wte=t=>bw(M3,j3(t)),bte={code:M3,name:yte,encode:j3,digest:wte};var vte=Object.freeze({__proto__:null,identity:bte});new TextEncoder,new TextDecoder;const q2={...fee,...gee,...yee,...bee,..._ee,...kee,...Dee,...Lee,...zee,...Yee};({...mte,...vte});function F3(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Ete(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?F3(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function q3(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const z2=q3("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),mm=q3("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Ete(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),_te={utf8:z2,"utf-8":z2,hex:q2.base16,latin1:mm,ascii:mm,binary:mm,...q2};function Ite(t,e="utf8"){const r=_te[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?F3(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var Ste=Object.defineProperty,Cte=(t,e,r)=>e in t?Ste(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_s=(t,e,r)=>Cte(t,typeof e!="symbol"?e+"":e,r);class xte{constructor(e,r){this.core=e,this.logger=r,_s(this,"keychain",new Map),_s(this,"name",CQ),_s(this,"version",xQ),_s(this,"initialized",!1),_s(this,"storagePrefix",js),_s(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),_s(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),_s(this,"set",async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()}),_s(this,"get",n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:i}=ne("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return s}),_s(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Cn(r,this.name)}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,rw(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?nw(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Ate=Object.defineProperty,$te=(t,e,r)=>e in t?Ate(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qt=(t,e,r)=>$te(t,typeof e!="symbol"?e+"":e,r);class Nte{constructor(e,r,n){this.core=e,this.logger=r,qt(this,"name",IQ),qt(this,"keychain"),qt(this,"randomSessionIdentifier",pw()),qt(this,"initialized",!1),qt(this,"clientId"),qt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),qt(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),qt(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const s=await this.getClientSeed(),i=Fd(s),o=a0(i.publicKey);return this.clientId=o,o}),qt(this,"generateKeyPair",()=>{this.isInitialized();const s=QJ();return this.setPrivateKey(s.publicKey,s.privateKey)}),qt(this,"signJWT",async s=>{this.isInitialized();const i=await this.getClientSeed(),o=Fd(i),a=this.randomSessionIdentifier;return await NC(a,s,SQ,o)}),qt(this,"generateSharedKey",(s,i,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=eX(a,i);return this.setSymKey(c,o)}),qt(this,"setSymKey",async(s,i)=>{this.isInitialized();const o=i||Sd(s);return await this.keychain.set(o,s),o}),qt(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),qt(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),qt(this,"encode",async(s,i,o)=>{this.isInitialized();const a=S3(o),c=Br(i);if(v2(a))return nX(c,o?.encoding);if(b2(a)){const d=a.senderPublicKey,p=a.receiverPublicKey;s=await this.generateSharedKey(d,p)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return tX({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),qt(this,"decode",async(s,i,o)=>{this.isInitialized();const a=iX(i,o);if(v2(a)){const c=sX(i,o?.encoding);return Ls(c)}if(b2(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=rX({symKey:c,encoded:i,encoding:o?.encoding});return Ls(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),qt(this,"getPayloadType",(s,i=Xr)=>{const o=Bu({encoded:s,encoding:i});return Sa(o.type)}),qt(this,"getPayloadSenderPublicKey",(s,i=Xr)=>{const o=Bu({encoded:s,encoding:i});return o.senderPublicKey?Ye(o.senderPublicKey,Ur):void 0}),this.core=e,this.logger=Cn(r,this.name),this.keychain=n||new xte(this.core,this.logger)}get context(){return an(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(U2)}catch{e=pw(),await this.keychain.set(U2,e)}return Ite(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Ote=Object.defineProperty,Tte=Object.defineProperties,kte=Object.getOwnPropertyDescriptors,H2=Object.getOwnPropertySymbols,Pte=Object.prototype.hasOwnProperty,Rte=Object.prototype.propertyIsEnumerable,vw=(t,e,r)=>e in t?Ote(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dte=(t,e)=>{for(var r in e||(e={}))Pte.call(e,r)&&vw(t,r,e[r]);if(H2)for(var r of H2(e))Rte.call(e,r)&&vw(t,r,e[r]);return t},Ute=(t,e)=>Tte(t,kte(e)),hn=(t,e,r)=>vw(t,typeof e!="symbol"?e+"":e,r);class Bte extends UW{constructor(e,r){super(e,r),this.logger=e,this.core=r,hn(this,"messages",new Map),hn(this,"messagesWithoutClientAck",new Map),hn(this,"name",AQ),hn(this,"version",$Q),hn(this,"initialized",!1),hn(this,"storagePrefix",js),hn(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),hn(this,"set",async(n,s,i)=>{this.isInitialized();const o=qn(s);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(n,a),i===Cd.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,Ute(Dte({},c),{[o]:s}))}return await this.persist(),o}),hn(this,"get",n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s}),hn(this,"getWithoutAck",n=>{this.isInitialized();const s={};for(const i of n){const o=this.messagesWithoutClientAck.get(i)||{};s[i]=Object.values(o)}return s}),hn(this,"has",(n,s)=>{this.isInitialized();const i=this.get(n),o=qn(s);return typeof i[o]<"u"}),hn(this,"ack",async(n,s)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;const o=qn(s);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),hn(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Cn(e,this.name),this.core=r}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,rw(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,rw(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?nw(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?nw(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Lte=Object.defineProperty,Mte=Object.defineProperties,jte=Object.getOwnPropertyDescriptors,V2=Object.getOwnPropertySymbols,Fte=Object.prototype.hasOwnProperty,qte=Object.prototype.propertyIsEnumerable,Ew=(t,e,r)=>e in t?Lte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ja=(t,e)=>{for(var r in e||(e={}))Fte.call(e,r)&&Ew(t,r,e[r]);if(V2)for(var r of V2(e))qte.call(e,r)&&Ew(t,r,e[r]);return t},W2=(t,e)=>Mte(t,jte(e)),kn=(t,e,r)=>Ew(t,typeof e!="symbol"?e+"":e,r);class zte extends BW{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,kn(this,"events",new mt.EventEmitter),kn(this,"name",OQ),kn(this,"queue",new Map),kn(this,"publishTimeout",z.toMiliseconds(z.ONE_MINUTE)),kn(this,"initialPublishTimeout",z.toMiliseconds(z.ONE_SECOND*15)),kn(this,"needsTransportRestart",!1),kn(this,"publish",async(n,s,i)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:i}});const h=i?.ttl||NQ,d=i?.prompt||!1,p=i?.tag||0,g=i?.id||Nr().toString(),m=lc(_f().protocol),w={id:g,method:i?.publishMethod||m.publish,params:Ja({topic:n,message:s,ttl:h,prompt:d,tag:p,attestation:i?.attestation},i?.tvf)},I=`Failed to publish payload, please try again. id:${g} tag:${p}`;try{Lt((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),Lt((c=w.params)==null?void 0:c.tag)&&((l=w.params)==null||delete l.tag);const S=new Promise(async v=>{const b=({id:N})=>{var P;((P=w.id)==null?void 0:P.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(yt.publish,b),v())};this.relayer.events.on(yt.publish,b);const C=ks(new Promise((N,P)=>{this.rpcPublish(w,i).then(N).catch(R=>{this.logger.warn(R,R?.message),P(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${p}`);try{await C,this.events.removeListener(yt.publish,b)}catch(N){this.queue.set(g,{request:w,opts:i,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:n,message:s,opts:i}}),await ks(S,this.publishTimeout,I)}catch(S){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(S),(u=i?.internal)!=null&&u.throwOnFailedPublish)throw S}finally{this.queue.delete(g)}}),kn(this,"publishCustom",async n=>{var s,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:u={}}=n,{attestation:h,tvf:d,publishMethod:p,prompt:g,tag:m,ttl:w=z.FIVE_MINUTES}=u,I=u.id||Nr().toString(),S=lc(_f().protocol),v=p||S.publish,b={id:I,method:v,params:Ja(W2(Ja({},l),{ttl:w,prompt:g,tag:m,attestation:h}),d)},C=`Failed to publish custom payload, please try again. id:${I} tag:${m}`;try{Lt((s=b.params)==null?void 0:s.prompt)&&((i=b.params)==null||delete i.prompt),Lt((o=b.params)==null?void 0:o.tag)&&((a=b.params)==null||delete a.tag);const N=new Promise(async P=>{const R=({id:M})=>{var j;((j=b.id)==null?void 0:j.toString())===M.toString()&&(this.removeRequestFromQueue(M),this.relayer.events.removeListener(yt.publish,R),P())};this.relayer.events.on(yt.publish,R);const O=ks(new Promise((M,j)=>{this.rpcPublish(b,u).then(M).catch(k=>{this.logger.warn(k,k?.message),j(k)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${I} tag:${m}`);try{await O,this.events.removeListener(yt.publish,R)}catch(M){this.queue.set(I,{request:b,opts:u,attempt:1}),this.logger.warn(M,M?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:I,payload:l,opts:u}}),await ks(N,this.publishTimeout,C)}catch(N){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(N),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw N}finally{this.queue.delete(I)}}),kn(this,"on",(n,s)=>{this.events.on(n,s)}),kn(this,"once",(n,s)=>{this.events.once(n,s)}),kn(this,"off",(n,s)=>{this.events.off(n,s)}),kn(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.relayer=e,this.logger=Cn(r,this.name),this.registerEventListeners()}get context(){return an(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(yt.publish,Ja(Ja({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const s=e.attempt+1;this.queue.set(r,W2(Ja({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Da.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(yt.connection_stalled);return}this.checkQueue()}),this.relayer.on(yt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Hte=Object.defineProperty,Vte=(t,e,r)=>e in t?Hte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xa=(t,e,r)=>Vte(t,typeof e!="symbol"?e+"":e,r);class Wte{constructor(){Xa(this,"map",new Map),Xa(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Xa(this,"get",e=>this.map.get(e)||[]),Xa(this,"exists",(e,r)=>this.get(e).includes(r)),Xa(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const s=n.filter(i=>i!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Xa(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Kte=Object.defineProperty,Gte=Object.defineProperties,Yte=Object.getOwnPropertyDescriptors,K2=Object.getOwnPropertySymbols,Zte=Object.prototype.hasOwnProperty,Jte=Object.prototype.propertyIsEnumerable,_w=(t,e,r)=>e in t?Kte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,El=(t,e)=>{for(var r in e||(e={}))Zte.call(e,r)&&_w(t,r,e[r]);if(K2)for(var r of K2(e))Jte.call(e,r)&&_w(t,r,e[r]);return t},ym=(t,e)=>Gte(t,Yte(e)),Xe=(t,e,r)=>_w(t,typeof e!="symbol"?e+"":e,r);class Xte extends jW{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Xe(this,"subscriptions",new Map),Xe(this,"topicMap",new Wte),Xe(this,"events",new mt.EventEmitter),Xe(this,"name",BQ),Xe(this,"version",LQ),Xe(this,"pending",new Map),Xe(this,"cached",[]),Xe(this,"initialized",!1),Xe(this,"storagePrefix",js),Xe(this,"subscribeTimeout",z.toMiliseconds(z.ONE_MINUTE)),Xe(this,"initialSubscribeTimeout",z.toMiliseconds(z.ONE_SECOND*15)),Xe(this,"clientId"),Xe(this,"batchSubscribeTopicsLimit",500),Xe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Xe(this,"subscribe",async(n,s)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const o=_f(s),a={topic:n,relay:o,transportType:s?.transportType};(i=s?.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Xe(this,"unsubscribe",async(n,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)}),Xe(this,"isSubscribed",n=>new Promise(s=>{s(this.topicMap.topics.includes(n))})),Xe(this,"isKnownTopic",n=>new Promise(s=>{s(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),Xe(this,"on",(n,s)=>{this.events.on(n,s)}),Xe(this,"once",(n,s)=>{this.events.once(n,s)}),Xe(this,"off",(n,s)=>{this.events.off(n,s)}),Xe(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),Xe(this,"start",async()=>{await this.onConnect()}),Xe(this,"stop",async()=>{await this.onDisconnect()}),Xe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Xe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(s=>{n.push(s)}),await this.batchSubscribe(n)}),Xe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Da.pulse,async()=>{await this.checkPending()}),this.events.on(pn.created,async n=>{const s=pn.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()}),this.events.on(pn.deleted,async n=>{const s=pn.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()})}),this.relayer=e,this.logger=Cn(r,this.name),this.clientId=""}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const s=_f(n);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const i=lt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,n){var s,i;const o=await this.getSubscriptionId(e);if((s=n?.internal)!=null&&s.skipSubscribe)return o;(!n||n?.transportType===nt.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:lc(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{if(n?.transportType===nt.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},z.toMiliseconds(z.ONE_SECOND)),o;const l=new Promise(async h=>{const d=p=>{p.topic===e&&(this.events.removeListener(pn.created,d),h(p.id))};this.events.on(pn.created,d);try{const p=await ks(new Promise((g,m)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w?.message),m(w)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(pn.created,d),h(p)}catch{}}),u=await ks(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(yt.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:lc(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ks(new Promise(s=>{this.relayer.request(n).catch(i=>this.logger.warn(i)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(yt.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:lc(r.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let s;try{s=await await ks(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(yt.connection_stalled)}return s}rpcUnsubscribe(e,r,n){const s={method:lc(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,ym(El({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,El({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,El({},r)),this.topicMap.set(r.topic,e),this.events.emit(pn.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=ne("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(pn.deleted,ym(El({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(pn.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(pn.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=ne("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>ym(El({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await EY(z.toMiliseconds(z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return qn(e+await this.getClientId())}}var Qte=Object.defineProperty,G2=Object.getOwnPropertySymbols,ere=Object.prototype.hasOwnProperty,tre=Object.prototype.propertyIsEnumerable,Iw=(t,e,r)=>e in t?Qte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Y2=(t,e)=>{for(var r in e||(e={}))ere.call(e,r)&&Iw(t,r,e[r]);if(G2)for(var r of G2(e))tre.call(e,r)&&Iw(t,r,e[r]);return t},Me=(t,e,r)=>Iw(t,typeof e!="symbol"?e+"":e,r);class rre extends LW{constructor(e){var r;super(e),Me(this,"protocol","wc"),Me(this,"version",2),Me(this,"core"),Me(this,"logger"),Me(this,"events",new mt.EventEmitter),Me(this,"provider"),Me(this,"messages"),Me(this,"subscriber"),Me(this,"publisher"),Me(this,"name",kQ),Me(this,"transportExplicitlyClosed",!1),Me(this,"initialized",!1),Me(this,"connectionAttemptInProgress",!1),Me(this,"relayUrl"),Me(this,"projectId"),Me(this,"packageName"),Me(this,"bundleId"),Me(this,"hasExperiencedNetworkDisruption",!1),Me(this,"pingTimeout"),Me(this,"heartBeatTimeout",z.toMiliseconds(z.THIRTY_SECONDS+z.FIVE_SECONDS)),Me(this,"reconnectTimeout"),Me(this,"connectPromise"),Me(this,"reconnectInProgress",!1),Me(this,"requestsInFlight",[]),Me(this,"connectTimeout",z.toMiliseconds(z.ONE_SECOND*15)),Me(this,"request",async n=>{var s,i;this.logger.debug("Publishing Request Payload");const o=n.id||Nr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(s=n.params)==null?void 0:s.topic},"relayer.request - publishing...");const a=`${o}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),Me(this,"resetPingTimeout",()=>{mf()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,s,i,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null?void 0:i.terminate)==null||o.call(i)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),Me(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),Me(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(yt.connect)}),Me(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Me(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(yt.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Me(this,"registerProviderListeners",()=>{this.provider.on(Tn.payload,this.onPayloadHandler),this.provider.on(Tn.connect,this.onConnectHandler),this.provider.on(Tn.disconnect,this.onDisconnectHandler),this.provider.on(Tn.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=ib({logger:(r=e.logger)!=null?r:TQ,name:this.name}),this.messages=new Bte(this.logger,e.core),this.subscriber=new Xte(this,this.logger),this.publisher=new zte(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||O3,iY()?this.packageName=F_():oY()&&(this.bundleId=F_()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return an(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:nt.relay},Cd.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,s,i;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(pn.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(pn.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,Y2({internal:{throwOnFailedPublish:o}},r)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await ks(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await P2())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,s)=>n.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const s=St(z.FIVE_MINUTES),i={topic:n,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(yt.message,e),await this.recordMessageEvent(e,Cd.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,s)=>{const i=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(Tn.disconnect,i),await ks(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(Tn.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Tn.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Tn.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const s=n;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,z.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,s,i;if(mf())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ob(new bQ(hY({sdkVersion:yw,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:s}=e;await this.messages.set(n,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,n);return s&&this.logger.warn(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Vc(e)){if(!e.method.endsWith(PQ))return;const r=e.params,{topic:n,message:s,publishedAt:i,attestation:o}=r.data,a={topic:n,message:s,publishedAt:i,transportType:nt.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Y2({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else xo(e)&&this.events.emit(yt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Cd.inbound),this.events.emit(yt.message,e))}async acknowledgePayload(e){const r=xi(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Tn.payload,this.onPayloadHandler),this.provider.off(Tn.connect,this.onConnectHandler),this.provider.off(Tn.disconnect,this.onDisconnectHandler),this.provider.off(Tn.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await P2();sQ(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Da.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&aQ())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(yt.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},z.toMiliseconds(RQ)))))}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function nre(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Z2(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function J2(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const sre="[object RegExp]",ire="[object String]",ore="[object Number]",are="[object Boolean]",X2="[object Arguments]",cre="[object Symbol]",lre="[object Date]",ure="[object Map]",hre="[object Set]",dre="[object Array]",fre="[object Function]",pre="[object ArrayBuffer]",wm="[object Object]",gre="[object Error]",mre="[object DataView]",yre="[object Uint8Array]",wre="[object Uint8ClampedArray]",bre="[object Uint16Array]",vre="[object Uint32Array]",Ere="[object BigUint64Array]",_re="[object Int8Array]",Ire="[object Int16Array]",Sre="[object Int32Array]",Cre="[object BigInt64Array]",xre="[object Float32Array]",Are="[object Float64Array]";function $re(){}function Q2(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Nre(t,e,r){return kl(t,e,void 0,void 0,void 0,void 0,r)}function kl(t,e,r,n,s,i,o){const a=o(t,e,r,n,s,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Vl(t,e,i,o)}return Vl(t,e,i,o)}function Vl(t,e,r,n){if(Object.is(t,e))return!0;let s=J2(t),i=J2(e);if(s===X2&&(s=wm),i===X2&&(i=wm),s!==i)return!1;switch(s){case ire:return t.toString()===e.toString();case ore:{const c=t.valueOf(),l=e.valueOf();return nre(c,l)}case are:case lre:case cre:return Object.is(t.valueOf(),e.valueOf());case sre:return t.source===e.source&&t.flags===e.flags;case fre:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case ure:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!kl(l,e.get(c),c,t,e,r,n))return!1;return!0}case hre:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(p=>kl(h,p,void 0,t,e,r,n));if(d===-1)return!1;l.splice(d,1)}return!0}case dre:case yre:case wre:case bre:case vre:case Ere:case _re:case Ire:case Sre:case Cre:case xre:case Are:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!kl(t[c],e[c],c,t,e,r,n))return!1;return!0}case pre:return t.byteLength!==e.byteLength?!1:Vl(new Uint8Array(t),new Uint8Array(e),r,n);case mre:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Vl(new Uint8Array(t),new Uint8Array(e),r,n);case gre:return t.name===e.name&&t.message===e.message;case wm:{if(!(Vl(t.constructor,e.constructor,r,n)||Q2(t)&&Q2(e)))return!1;const c=[...Object.keys(t),...Z2(t)],l=[...Object.keys(e),...Z2(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!kl(d,p,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function Ore(t,e){return Nre(t,e,$re)}var Tre=Object.defineProperty,eI=Object.getOwnPropertySymbols,kre=Object.prototype.hasOwnProperty,Pre=Object.prototype.propertyIsEnumerable,Sw=(t,e,r)=>e in t?Tre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tI=(t,e)=>{for(var r in e||(e={}))kre.call(e,r)&&Sw(t,r,e[r]);if(eI)for(var r of eI(e))Pre.call(e,r)&&Sw(t,r,e[r]);return t},zr=(t,e,r)=>Sw(t,typeof e!="symbol"?e+"":e,r);class Ba extends MW{constructor(e,r,n,s=js,i=void 0){super(e,r,n,s),this.core=e,this.logger=r,this.name=n,zr(this,"map",new Map),zr(this,"version",DQ),zr(this,"cached",[]),zr(this,"initialized",!1),zr(this,"getKey"),zr(this,"storagePrefix",js),zr(this,"recentlyDeleted",[]),zr(this,"recentlyDeletedLimit",200),zr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Lt(o)?this.map.set(this.getKey(o),o):DX(o)?this.map.set(o.id,o):UX(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),zr(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),zr(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),zr(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>Ore(a[c],o[c]))):this.values)),zr(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=tI(tI({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),zr(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Cn(r,this.name),this.storagePrefix=s,this.getKey=i}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=ne("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:n}=ne("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=ne("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Rre=Object.defineProperty,Dre=(t,e,r)=>e in t?Rre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e,r)=>Dre(t,typeof e!="symbol"?e+"":e,r);class Ure{constructor(e,r){this.core=e,this.logger=r,$e(this,"name",MQ),$e(this,"version",jQ),$e(this,"events",new Hu),$e(this,"pairings"),$e(this,"initialized",!1),$e(this,"storagePrefix",js),$e(this,"ignoredPayloadTypes",[Ii]),$e(this,"registeredMethods",[]),$e(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),$e(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),$e(this,"create",async n=>{this.isInitialized();const s=pw(),i=await this.core.crypto.setSymKey(s),o=St(z.FIVE_MINUTES),a={protocol:N3},c={topic:i,expiry:o,relay:a,active:!1,methods:n?.methods},l=S2({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:s,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(Ko.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n?.transportType,internal:n?.internal}),{topic:i,uri:l}}),$e(this,"pair",async n=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[Cs.pairing_started]}});this.isValidPair(n,s);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=I2(n.uri);s.props.properties.topic=i,s.addTrace(Cs.pairing_uri_validation_success),s.addTrace(Cs.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(i)){if(u=this.pairings.get(i),s.addTrace(Cs.existing_pairing),u.active)throw s.setError(ti.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);s.addTrace(Cs.pairing_not_expired)}const h=c||St(z.FIVE_MINUTES),d={topic:i,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(i,h),await this.pairings.set(i,d),s.addTrace(Cs.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(Ko.create,d),s.addTrace(Cs.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),s.addTrace(Cs.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(ti.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(p){throw s.setError(ti.subscribe_pairing_topic_failure),p}return s.addTrace(Cs.subscribe_pairing_topic_success),d}),$e(this,"activate",async({topic:n})=>{this.isInitialized();const s=St(z.FIVE_MINUTES);this.core.expirer.set(n,s),await this.pairings.update(n,{active:!0,expiry:s})}),$e(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=n;if(this.pairings.keys.includes(s)){const i=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Fo();this.events.once(qe("pairing_ping",i),({error:l})=>{l?c(l):a()}),await o()}}),$e(this,"updateExpiry",async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})}),$e(this,"updateMetadata",async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})}),$e(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),$e(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",lt("USER_DISCONNECTED")),await this.deletePairing(s))}),$e(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:s,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(s);return S2({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),$e(this,"sendRequest",async(n,s,i)=>{const o=Nt(s,i),a=await this.core.crypto.encode(n,o),c=bl[s].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),$e(this,"sendResult",async(n,s,i)=>{const o=xi(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=bl[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),$e(this,"sendError",async(n,s,i)=>{const o=Oa(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=bl[c]?bl[c].res:bl.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),$e(this,"deletePairing",async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,lt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])}),$e(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(s=>Ns(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))}),$e(this,"onRelayEventRequest",async n=>{const{topic:s,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,i);default:return await this.onUnknownRpcMethodRequest(s,i)}}),$e(this,"onRelayEventResponse",async n=>{const{topic:s,payload:i}=n,o=(await this.core.history.get(s,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,i);default:return this.onUnknownRpcMethodResponse(o)}}),$e(this,"onPairingPingRequest",async(n,s)=>{const{id:i}=s;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(Ko.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),$e(this,"onPairingPingResponse",(n,s)=>{const{id:i}=s;setTimeout(()=>{Bt(s)?this.events.emit(qe("pairing_ping",i),{}):dt(s)&&this.events.emit(qe("pairing_ping",i),{error:s.error})},500)}),$e(this,"onPairingDeleteRequest",async(n,s)=>{const{id:i}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Ko.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),$e(this,"onUnknownRpcMethodRequest",async(n,s)=>{const{id:i,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=lt("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),$e(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(lt("WC_METHOD_UNSUPPORTED",n))}),$e(this,"isValidPair",(n,s)=>{var i;if(!Wr(n)){const{message:a}=ne("MISSING_OR_INVALID",`pair() params: ${n}`);throw s.setError(ti.malformed_pairing_uri),new Error(a)}if(!RX(n.uri)){const{message:a}=ne("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw s.setError(ti.malformed_pairing_uri),new Error(a)}const o=I2(n?.uri);if(!((i=o?.relay)!=null&&i.protocol)){const{message:a}=ne("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(ti.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=ne("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(ti.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&z.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(ti.pairing_expired);const{message:a}=ne("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),$e(this,"isValidPing",async n=>{if(!Wr(n)){const{message:i}=ne("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),$e(this,"isValidDisconnect",async n=>{if(!Wr(n)){const{message:i}=ne("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),$e(this,"isValidPairingTopic",async n=>{if(!$t(n,!1)){const{message:s}=ne("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=ne("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(Ns(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=ne("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}}),this.core=e,this.logger=Cn(r,this.name),this.pairings=new Ba(this.core,this.logger,this.name,this.storagePrefix)}get context(){return an(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(yt.message,async e=>{const{topic:r,message:n,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==nt.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const i=await this.core.crypto.decode(r,n);Vc(i)?(this.core.history.set(r,i),await this.onRelayEventRequest({topic:r,payload:i})):xo(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id)),await this.core.relayer.messages.ack(r,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(Ln.expired,async e=>{const{topic:r}=AN(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ko.expire,{topic:r}))})}}var Bre=Object.defineProperty,Lre=(t,e,r)=>e in t?Bre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nr=(t,e,r)=>Lre(t,typeof e!="symbol"?e+"":e,r);class Mre extends DW{constructor(e,r){super(e,r),this.core=e,this.logger=r,nr(this,"records",new Map),nr(this,"events",new mt.EventEmitter),nr(this,"name",FQ),nr(this,"version",qQ),nr(this,"cached",[]),nr(this,"initialized",!1),nr(this,"storagePrefix",js),nr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),nr(this,"set",(n,s,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:i}),this.records.has(s.id))return;const o={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:i,expiry:St(z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Xn.created,o)}),nr(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=dt(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.persist(),this.events.emit(Xn.updated,s))}),nr(this,"get",async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s))),nr(this,"delete",(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(i=>{if(i.topic===n){if(typeof s<"u"&&i.id!==s)return;this.records.delete(i.id),this.events.emit(Xn.deleted,i)}}),this.persist()}),nr(this,"exists",async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1)),nr(this,"on",(n,s)=>{this.events.on(n,s)}),nr(this,"once",(n,s)=>{this.events.once(n,s)}),nr(this,"off",(n,s)=>{this.events.off(n,s)}),nr(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=Cn(r,this.name)}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Nt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=ne("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Xn.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=ne("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Xn.created,e=>{const r=Xn.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Xn.updated,e=>{const r=Xn.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Xn.deleted,e=>{const r=Xn.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Da.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Xn.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}}var jre=Object.defineProperty,Fre=(t,e,r)=>e in t?jre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sr=(t,e,r)=>Fre(t,typeof e!="symbol"?e+"":e,r);class qre extends FW{constructor(e,r){super(e,r),this.core=e,this.logger=r,Sr(this,"expirations",new Map),Sr(this,"events",new mt.EventEmitter),Sr(this,"name",zQ),Sr(this,"version",HQ),Sr(this,"cached",[]),Sr(this,"initialized",!1),Sr(this,"storagePrefix",js),Sr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Sr(this,"has",n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Sr(this,"set",(n,s)=>{this.isInitialized();const i=this.formatTarget(n),o={target:i,expiry:s};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(Ln.created,{target:i,expiration:o})}),Sr(this,"get",n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)}),Sr(this,"del",n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),i=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Ln.deleted,{target:s,expiration:i})}}),Sr(this,"on",(n,s)=>{this.events.on(n,s)}),Sr(this,"once",(n,s)=>{this.events.once(n,s)}),Sr(this,"off",(n,s)=>{this.events.off(n,s)}),Sr(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=Cn(r,this.name)}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return dY(e);if(typeof e=="number")return fY(e);const{message:r}=ne("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ln.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=ne("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=ne("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;z.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Ln.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Da.pulse,()=>this.checkExpirations()),this.events.on(Ln.created,e=>{const r=Ln.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ln.expired,e=>{const r=Ln.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ln.deleted,e=>{const r=Ln.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zre=Object.defineProperty,Hre=(t,e,r)=>e in t?zre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,It=(t,e,r)=>Hre(t,typeof e!="symbol"?e+"":e,r);class Vre extends qW{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,It(this,"name",VQ),It(this,"abortController"),It(this,"isDevEnv"),It(this,"verifyUrlV3",KQ),It(this,"storagePrefix",js),It(this,"version",$3),It(this,"publicKey"),It(this,"fetchPromise"),It(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&z.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),It(this,"register",async s=>{if(!Wc()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const l=Jt.getDocument(),u=this.startAbortTimer(z.ONE_SECOND*5),h=await new Promise((d,p)=>{const g=()=>{window.removeEventListener("message",w),l.body.removeChild(m),p("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const m=l.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",g,{signal:this.abortController.signal});const w=I=>{if(I.data&&typeof I.data=="string")try{const S=JSON.parse(I.data);if(S.type==="verify_attestation"){if(Cc(S.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(m),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",w),d(S.attestation===null?"":S.attestation)}}catch(S){this.logger.warn(S)}};l.body.appendChild(m),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),It(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=s;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(Cc(i).payload.id!==a)return;const l=await this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),It(this,"fetchAttestation",async(s,i)=>{this.logger.debug(`resolving attestation: ${s} from url: ${i}`);const o=this.startAbortTimer(z.ONE_SECOND*5),a=await fetch(`${i}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),It(this,"getVerifyUrl",s=>{let i=s||Hl;return GQ.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${Hl}`),i=Hl),i}),It(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(z.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await i.json()}catch(s){this.logger.warn(s)}}),It(this,"persistPublicKey",async s=>{this.logger.debug(s,"persisting public key to local storage"),await this.store.setItem(this.storeKey,s),this.publicKey=s}),It(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),It(this,"isValidJwtAttestation",async s=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(s,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),It(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),It(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),It(this,"validateAttestation",(s,i)=>{const o=aX(s,i.publicKey),a={hasExpired:z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Cn(r,this.name),this.abortController=new AbortController,this.isDevEnv=K0(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return an(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),z.toMiliseconds(e))}}var Wre=Object.defineProperty,Kre=(t,e,r)=>e in t?Wre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rI=(t,e,r)=>Kre(t,typeof e!="symbol"?e+"":e,r);class Gre extends zW{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,rI(this,"context",YQ),rI(this,"registerDeviceToken",async n=>{const{clientId:s,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${ZQ}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:i,always_raw:a})})}),this.logger=Cn(r,this.context)}}var Yre=Object.defineProperty,nI=Object.getOwnPropertySymbols,Zre=Object.prototype.hasOwnProperty,Jre=Object.prototype.propertyIsEnumerable,Cw=(t,e,r)=>e in t?Yre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_l=(t,e)=>{for(var r in e||(e={}))Zre.call(e,r)&&Cw(t,r,e[r]);if(nI)for(var r of nI(e))Jre.call(e,r)&&Cw(t,r,e[r]);return t},zt=(t,e,r)=>Cw(t,typeof e!="symbol"?e+"":e,r);class Xre extends HW{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,zt(this,"context",XQ),zt(this,"storagePrefix",js),zt(this,"storageVersion",JQ),zt(this,"events",new Map),zt(this,"shouldPersist",!1),zt(this,"init",async()=>{if(!K0())try{const s={eventId:z_(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:CN(this.core.relayer.protocol,this.core.relayer.version,yw)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),zt(this,"createEvent",s=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=z_(),u=this.core.projectId||"",h=Date.now(),d=_l({eventId:l,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),zt(this,"getEvent",s=>{const{eventId:i,topic:o}=s;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return _l(_l({},a),this.setMethods(a.eventId))}),zt(this,"deleteEvent",s=>{const{eventId:i}=s;this.events.delete(i),this.shouldPersist=!0}),zt(this,"setEventListeners",()=>{this.core.heartbeat.on(Da.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{z.fromMiliseconds(Date.now())-z.fromMiliseconds(s.timestamp)>QQ&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),zt(this,"setMethods",s=>({addTrace:i=>this.addTrace(s,i),setError:i=>this.setError(s,i)})),zt(this,"addTrace",(s,i)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(i),this.events.set(s,o),this.shouldPersist=!0)}),zt(this,"setError",(s,i)=>{const o=this.events.get(s);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),zt(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),zt(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(i=>{this.events.set(i.eventId,_l(_l({},i),this.setMethods(i.eventId)))})}catch(s){this.logger.warn(s)}}),zt(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[i,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const i of s)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),zt(this,"sendEvent",async s=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${eee}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${yw}${i}`,{method:"POST",body:JSON.stringify(s)})}),zt(this,"getAppDomain",()=>SN().url),this.logger=Cn(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Qre=Object.defineProperty,sI=Object.getOwnPropertySymbols,ene=Object.prototype.hasOwnProperty,tne=Object.prototype.propertyIsEnumerable,xw=(t,e,r)=>e in t?Qre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iI=(t,e)=>{for(var r in e||(e={}))ene.call(e,r)&&xw(t,r,e[r]);if(sI)for(var r of sI(e))tne.call(e,r)&&xw(t,r,e[r]);return t},et=(t,e,r)=>xw(t,typeof e!="symbol"?e+"":e,r);let rne=class z3 extends TW{constructor(e){var r;super(e),et(this,"protocol",A3),et(this,"version",$3),et(this,"name",mw),et(this,"relayUrl"),et(this,"projectId"),et(this,"customStoragePrefix"),et(this,"events",new mt.EventEmitter),et(this,"logger"),et(this,"heartbeat"),et(this,"relayer"),et(this,"crypto"),et(this,"storage"),et(this,"history"),et(this,"expirer"),et(this,"pairing"),et(this,"verify"),et(this,"echoClient"),et(this,"linkModeSupportedApps"),et(this,"eventClient"),et(this,"initialized",!1),et(this,"logChunkController"),et(this,"on",(a,c)=>this.events.on(a,c)),et(this,"once",(a,c)=>this.events.once(a,c)),et(this,"off",(a,c)=>this.events.off(a,c)),et(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),et(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:nt.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||O3,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=SW({level:typeof e?.logger=="string"&&e.logger?e.logger:EQ.logger,name:mw}),{logger:i,chunkLoggerController:o}=q$({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Cn(i,this.name),this.heartbeat=new nW,this.crypto=new Nte(this,this.logger,e?.keychain),this.history=new Mre(this,this.logger),this.expirer=new qre(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new JS(iI(iI({},_Q),e?.storageOptions)),this.relayer=new rre({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Ure(this,this.logger),this.verify=new Vre(this,this.logger,this.storage),this.echoClient=new Gre(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Xre(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new z3(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(UQ,n),r}get context(){return an(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(B2,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(B2)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&vQ.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const nne=rne,H3="wc",V3=2,W3="client",ab=`${H3}@${V3}:${W3}:`,bm={name:W3,logger:"error"},oI="WALLETCONNECT_DEEPLINK_CHOICE",sne="proposal",aI="Proposal expired",ine="session",Qa=z.SEVEN_DAYS,one="engine",sr={wc_sessionPropose:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1119}}},vm={min:z.FIVE_MINUTES,max:z.SEVEN_DAYS},Is={idle:"IDLE",active:"ACTIVE"},ane={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},cne="request",lne=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],une="wc",hne="auth",dne="authKeys",fne="pairingTopics",pne="requests",_p=`${une}@${1.5}:${hne}:`,xd=`${_p}:PUB_KEY`;var gne=Object.defineProperty,mne=Object.defineProperties,yne=Object.getOwnPropertyDescriptors,cI=Object.getOwnPropertySymbols,wne=Object.prototype.hasOwnProperty,bne=Object.prototype.propertyIsEnumerable,Aw=(t,e,r)=>e in t?gne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,He=(t,e)=>{for(var r in e||(e={}))wne.call(e,r)&&Aw(t,r,e[r]);if(cI)for(var r of cI(e))bne.call(e,r)&&Aw(t,r,e[r]);return t},Cr=(t,e)=>mne(t,yne(e)),Z=(t,e,r)=>Aw(t,typeof e!="symbol"?e+"":e,r);class vne extends GW{constructor(e){super(e),Z(this,"name",one),Z(this,"events",new Hu),Z(this,"initialized",!1),Z(this,"requestQueue",{state:Is.idle,queue:[]}),Z(this,"sessionRequestQueue",{state:Is.idle,queue:[]}),Z(this,"emittedSessionRequests",new _Y({limit:500})),Z(this,"requestQueueDelay",z.ONE_SECOND),Z(this,"expectedPairingMethodMap",new Map),Z(this,"recentlyDeletedMap",new Map),Z(this,"recentlyDeletedLimit",200),Z(this,"relayMessageCache",[]),Z(this,"pendingSessions",new Map),Z(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(sr)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay)))}),Z(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=Cr(He({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=NX(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=n;let u=s,h,d=!1;try{if(u){const N=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=N.active}}catch(N){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),N}if(!u||!d){const{topic:N,uri:P}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=N,h=P}if(!u){const{message:N}=ne("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(N)}const p=await this.client.core.crypto.generateKeyPair(),g=sr.wc_sessionPropose.req.ttl||z.FIVE_MINUTES,m=St(g),w=Cr(He(He({requiredNamespaces:i,optionalNamespaces:o,relays:l??[{protocol:N3}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Kt()}),I=qe("session_connect",w.id),{reject:S,resolve:v,done:b}=Fo(g,aI),C=({id:N})=>{N===w.id&&(this.client.events.off("proposal_expire",C),this.pendingSessions.delete(w.id),this.events.emit(I,{error:{message:aI,code:0}}))};return this.client.events.on("proposal_expire",C),this.events.once(I,({error:N,session:P})=>{this.client.events.off("proposal_expire",C),N?S(N):P&&v(P)}),await this.sendProposeSession({proposal:w,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:w.id}}}),await this.setProposal(w.id,w),{uri:h,approval:b}}),Z(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),Z(this,"approve",async r=>{var n,s,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r?.id)==null?void 0:n.toString(),trace:[Qn.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(O){throw o.setError(Ro.no_internet_connection),O}try{await this.isValidProposalId(r?.id)}catch(O){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Ro.proposal_not_found),O}try{await this.isValidApprove(r)}catch(O){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ro.session_approve_namespace_validation_failure),O}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:m,requiredNamespaces:w,optionalNamespaces:I}=p;let S=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:g});S||(S=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:Qn.session_approve_started,properties:{topic:g,trace:[Qn.session_approve_started,Qn.session_namespaces_validation_success]}}));const v=await this.client.core.crypto.generateKeyPair(),b=m.publicKey,C=await this.client.core.crypto.generateSharedKey(v,b),N=He(He(He({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:v,metadata:this.client.metadata},expiry:St(Qa)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),P=nt.relay;S.addTrace(Qn.subscribing_session_topic);try{await this.client.core.relayer.subscribe(C,{transportType:P,internal:{skipSubscribe:!0}})}catch(O){throw S.setError(Ro.subscribe_session_topic_failure),O}S.addTrace(Qn.subscribe_session_topic_success);const R=Cr(He({},N),{topic:C,requiredNamespaces:w,optionalNamespaces:I,pairingTopic:g,acknowledged:!1,self:N.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:v,transportType:nt.relay});await this.client.session.set(C,R),S.addTrace(Qn.store_session);try{await this.sendApproveSession({sessionTopic:C,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:v},sessionSettleRequest:N,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),S.addTrace(Qn.session_approve_publish_success)}catch(O){throw this.client.logger.error(O),this.client.session.delete(C,lt("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(C),O}return this.client.core.eventClient.deleteEvent({eventId:S.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:m.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(C,St(Qa)),{topic:C,acknowledged:()=>Promise.resolve(this.client.session.get(C))}}),Z(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:s}=r;let i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:s,rpcOpts:sr.wc_sessionPropose.reject}),await this.deleteProposal(n)}),Z(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:s}=r,{done:i,resolve:o,reject:a}=Fo(),c=Kt(),l=Nr().toString(),u=this.client.session.get(n).namespaces;return this.events.once(qe("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:s}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:u}),a(h)}),{acknowledged:i}}),Z(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,s=Kt(),{done:i,resolve:o,reject:a}=Fo();return this.events.once(qe("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,St(Qa)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),Z(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:n,request:s,topic:i,expiry:o=sr.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(i);a?.transportType===nt.relay&&await this.confirmOnlineStateOrThrow();const c=Kt(),l=Nr().toString(),{done:u,resolve:h,reject:d}=Fo(o,"Request expired. Please try again.");this.events.once(qe("session_request",c),({error:w,result:I})=>{w?d(w):h(I)});const p="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:p,params:{request:Cr(He({},s),{expiryTimestamp:St(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),await u();const m={request:Cr(He({},s),{expiryTimestamp:St(o)}),chainId:n};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:p,params:m,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,m)}).catch(I=>d(I)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),w()}),new Promise(async w=>{var I;if(!((I=a.sessionConfig)!=null&&I.disableDeepLink)){const S=await yY(this.client.core.storage,oI);await pY({id:c,topic:i,wcDeepLink:S})}w()}),u()]).then(w=>w[2])}),Z(this,"respond",async r=>{var n,s;this.isInitialized();const i=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((s=(n=r?.response)==null?void 0:n.id)==null?void 0:s.toString()),trace:[Qn.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw i.addTrace(h?.message),i.setError(Ro.session_request_response_validation_failure),h}i.addTrace(Qn.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,l=this.client.session.get(o);l.transportType===nt.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{i.addTrace(Qn.session_request_response_publish_started),Bt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):dt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(r)}catch(h){throw i.addTrace(h?.message),i.setError(Ro.session_request_response_publish_failure),h}}),Z(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:n}=r;if(this.client.session.keys.includes(n)){const s=Kt(),i=Nr().toString(),{done:o,resolve:a,reject:c}=Fo();this.events.once(qe("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),Z(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:s,chainId:i}=r,o=Nr().toString(),a=Kt();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),Z(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:lt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:s}=ne("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(s)}}),Z(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>kX(n,r)))),Z(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),Z(this,"authenticate",async(r,n)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=i?nt.link_mode:nt.relay;o===nt.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:p,nbf:g,methods:m=[],expiry:w}=r,I=[...r.resources||[]],{topic:S,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:S,uri:v}});const b=await this.client.core.crypto.generateKeyPair(),C=Sd(b);if(await Promise.all([this.client.auth.authKeys.set(xd,{responseTopic:C,publicKey:b}),this.client.auth.pairingTopics.set(C,{topic:C,pairingTopic:S})]),await this.client.core.relayer.subscribe(C,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${S}`),m.length>0){const{namespace:_}=_i(a[0]);let A=PZ(_,"request",m);Id(I)&&(A=DZ(A,I.pop())),I.push(A)}const N=w&&w>sr.wc_sessionAuthenticate.req.ttl?w:sr.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:g,resources:I},requester:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:St(N)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},O={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:S,proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:St(sr.wc_sessionPropose.req.ttl),id:Kt()},{done:M,resolve:j,reject:k}=Fo(N,"Request expired"),$=Kt(),T=qe("session_connect",O.id),f=qe("session_request",$),y=async({error:_,session:A})=>{this.events.off(f,E),_?k(_):A&&j({session:A})},E=async _=>{var A,L,B;if(await this.deletePendingAuthRequest($,{message:"fulfilled",code:0}),_.error){const K=lt("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===K.code?void 0:(this.events.off(T,y),k(_.error.message))}await this.deleteProposal(O.id),this.events.off(T,y);const{cacaos:q,responder:D}=_.result,F=[],H=[];for(const K of q){await e2({cacao:K,projectId:this.client.core.projectId})||(this.client.logger.error(K,"Signature verification failed"),k(lt("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:G}=K,le=Id(G.resources),ye=[sw(G.iss)],ve=wf(G.iss);if(le){const Ee=t2(le),Ke=r2(le);F.push(...Ee),ye.push(...Ke)}for(const Ee of ye)H.push(`${Ee}:${ve}`)}const W=await this.client.core.crypto.generateSharedKey(b,D.publicKey);let ee;F.length>0&&(ee={topic:W,acknowledged:!0,self:{publicKey:b,metadata:this.client.metadata},peer:D,controller:D.publicKey,expiry:St(Qa),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:S,namespaces:$2([...new Set(F)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(W,{transportType:o}),await this.client.session.set(W,ee),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:D.metadata}),ee=this.client.session.get(W)),(A=this.client.metadata.redirect)!=null&&A.linkMode&&(L=D.metadata.redirect)!=null&&L.linkMode&&(B=D.metadata.redirect)!=null&&B.universal&&n&&(this.client.core.addLinkModeSupportedApp(D.metadata.redirect.universal),this.client.session.update(W,{transportType:nt.link_mode})),j({auths:q,session:ee})};this.events.once(T,y),this.events.once(f,E);let x;try{if(i){const _=Nt("wc_sessionAuthenticate",P,$);this.client.core.history.set(S,_);const A=await this.client.core.crypto.encode("",_,{type:fh,encoding:co});x=Xh(n,S,A)}else await Promise.all([this.sendRequest({topic:S,method:"wc_sessionAuthenticate",params:P,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:$}),this.sendRequest({topic:S,method:"wc_sessionPropose",params:O,expiry:sr.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:O.id})])}catch(_){throw this.events.off(T,y),this.events.off(f,E),_}return await this.setProposal(O.id,O),await this.setAuthRequest($,{request:Cr(He({},P),{verifyContext:{}}),pairingTopic:S,transportType:o}),{uri:x??v,response:M}}),Z(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:s}=r,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[Do.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw i.setError(vl.no_internet_connection),w}const o=this.getPendingAuthRequest(n);if(!o)throw i.setError(vl.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||nt.relay;a===nt.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Sd(c),h={type:Ii,receiverPublicKey:c,senderPublicKey:l},d=[],p=[];for(const w of s){if(!await e2({cacao:w,projectId:this.client.core.projectId})){i.setError(vl.invalid_cacao);const C=lt("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:u,error:C,encodeOpts:h}),new Error(C.message)}i.addTrace(Do.cacaos_verified);const{p:I}=w,S=Id(I.resources),v=[sw(I.iss)],b=wf(I.iss);if(S){const C=t2(S),N=r2(S);d.push(...C),v.push(...N)}for(const C of v)p.push(`${C}:${b}`)}const g=await this.client.core.crypto.generateSharedKey(l,c);i.addTrace(Do.create_authenticated_session_topic);let m;if(d?.length>0){m={topic:g,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:St(Qa),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:$2([...new Set(d)],[...new Set(p)]),transportType:a},i.addTrace(Do.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(w){throw i.setError(vl.subscribe_authenticated_session_topic_failure),w}i.addTrace(Do.subscribe_authenticated_session_topic_success),await this.client.session.set(g,m),i.addTrace(Do.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(Do.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:n,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw i.setError(vl.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:m}}),Z(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:s}=r,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===nt.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Sd(o),l={type:Ii,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:s,encodeOpts:l,rpcOpts:sr.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),Z(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:s}=r;return zN(n,s)}),Z(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),Z(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),Z(this,"deleteSession",async r=>{var n;const{topic:s,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,lt("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(oI).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,lt("USER_DISCONNECTED"))}),s===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=Is.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),Z(this,"deleteProposal",async(r,n)=>{if(n)try{const s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Ro.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,lt("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),Z(this,"deletePendingSessionRequest",async(r,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==r),s&&(this.sessionRequestQueue.state=Is.idle,this.client.events.emit("session_request_expire",{id:r}))}),Z(this,"deletePendingAuthRequest",async(r,n,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)])}),Z(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),Z(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,St(sr.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),Z(this,"setAuthRequest",async(r,n)=>{const{request:s,pairingTopic:i,transportType:o=nt.relay}=n;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:i,verifyContext:s.verifyContext,transportType:o})}),Z(this,"setPendingSessionRequest",async r=>{const{id:n,topic:s,params:i,verifyContext:o}=r,a=i.request.expiryTimestamp||St(sr.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:s,params:i,verifyContext:o})}),Z(this,"sendRequest",async r=>{const{topic:n,method:s,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:d={}}=r,p=Nt(s,i,c);let g;const m=!!u;try{const S=m?co:Xr;g=await this.client.core.crypto.encode(n,p,{encoding:S})}catch(S){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),S}let w;if(lne.includes(s)){const S=qn(JSON.stringify(p)),v=qn(g);w=await this.client.core.verify.register({id:v,decryptedId:S})}const I=He(He({},sr[s].req),d);if(I.attestation=w,o&&(I.ttl=o),a&&(I.id=a),this.client.core.history.set(n,p),m){const S=Xh(u,n,g);await global.Linking.openURL(S,this.client.name)}else I.tvf=Cr(He({},h),{correlationId:p.id}),l?(I.internal=Cr(He({},I.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,g,I)):this.client.core.relayer.publish(n,g,I).catch(S=>this.client.logger.error(S));return p.id}),Z(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:s}=r,i=Nt("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);const o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:Xr}),a=qn(JSON.stringify(i)),c=qn(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Cr(He({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),Z(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:s,proposal:i,sessionSettleRequest:o,publishOpts:a}=r,c=xi(i.id,s),l=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Xr}),u=Nt("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(n,u,{encoding:Xr});this.client.core.history.set(n,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Cr(He({},a),{publishMethod:"wc_approveSession"})})}),Z(this,"sendResult",async r=>{const{id:n,topic:s,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=xi(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=h?co:Xr;u=await this.client.core.crypto.encode(s,l,Cr(He({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),g}let d,p;try{d=await this.client.core.history.get(s,n);const g=d.request;try{p=this.getTVFParams(n,g.params,i)}catch(m){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${m?.message}`)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${n}) failed`),g}if(h){const g=Xh(c,s,u);await global.Linking.openURL(g,this.client.name)}else{const g=d.request.method,m=sr[g].res;m.tvf=Cr(He({},p),{correlationId:n}),o?(m.internal=Cr(He({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,m)):this.client.core.relayer.publish(s,u,m).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),Z(this,"sendError",async r=>{const{id:n,topic:s,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Oa(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?co:Xr;u=await this.client.core.crypto.encode(s,l,Cr(He({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),p}let d;try{d=await this.client.core.history.get(s,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),p}if(h){const p=Xh(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=a||sr[p].res;this.client.core.relayer.publish(s,u,g)}await this.client.core.history.resolve(l)}),Z(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(s=>{let i=!1;Ns(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ns(s.expiryTimestamp)&&n.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...n.map(s=>this.deleteProposal(s))])}),Z(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),Z(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),Z(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Is.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Is.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Is.idle}),Z(this,"processRequest",async r=>{const{topic:n,payload:s,attestation:i,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:s,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,s);case"wc_sessionPing":return await this.onSessionPingRequest(n,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),Z(this,"onRelayEventResponse",async r=>{const{topic:n,payload:s,transportType:i}=r,o=(await this.client.core.history.get(n,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),Z(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:s}=ne("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),Z(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:s}=r,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(s)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),Z(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:s,attestation:i,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(ti.proposal_listener_not_found)),this.isValidConnect(He({},s.params));const u=a.expiryTimestamp||St(sr.wc_sessionPropose.req.ttl),h=He({id:c,pairingTopic:n,expiryTimestamp:u,attestation:i,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:i,hash:qn(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(Cs.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:sr.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),Z(this,"onSessionProposeResponse",async(r,n,s)=>{const{id:i}=n;if(Bt(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:u,pairingTopic:r,proposalId:i,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(dt(n)){await this.deleteProposal(i);const o=qe("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),Z(this,"onSessionSettleRequest",async(r,n)=>{const{id:s,params:i}=n;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=n.params,p=[...this.pendingSessions.values()].find(w=>w.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(p.proposalId),m=Cr(He(He(He({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:nt.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(qe("session_connect",p.proposalId),{session:m}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:n.id,topic:r,result:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),Z(this,"onSessionSettleResponse",async(r,n)=>{const{id:s}=n;Bt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(qe("session_approve",s),{})):dt(n)&&(await this.client.session.delete(r,lt("USER_DISCONNECTED")),this.events.emit(qe("session_approve",s),{error:n.error}))}),Z(this,"onSessionUpdateRequest",async(r,n)=>{const{params:s,id:i}=n;try{const o=`${r}_session_update`,a=wl.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:r,error:lt("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(He({topic:r},s));try{wl.set(o,i),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:r,result:!0})}catch(c){throw wl.delete(o),c}this.client.events.emit("session_update",{id:i,topic:r,params:s})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),Z(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),Z(this,"onSessionUpdateResponse",(r,n)=>{const{id:s}=n,i=qe("session_update",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bt(n)?this.events.emit(qe("session_update",s),{}):dt(n)&&this.events.emit(qe("session_update",s),{error:n.error})}),Z(this,"onSessionExtendRequest",async(r,n)=>{const{id:s}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,St(Qa)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),Z(this,"onSessionExtendResponse",(r,n)=>{const{id:s}=n,i=qe("session_extend",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bt(n)?this.events.emit(qe("session_extend",s),{}):dt(n)&&this.events.emit(qe("session_extend",s),{error:n.error})}),Z(this,"onSessionPingRequest",async(r,n)=>{const{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),Z(this,"onSessionPingResponse",(r,n)=>{const{id:s}=n,i=qe("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Bt(n)?this.events.emit(qe("session_ping",s),{}):dt(n)&&this.events.emit(qe("session_ping",s),{error:n.error})},500)}),Z(this,"onSessionDeleteRequest",async(r,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(yt.publish,async()=>{i(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:lt("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),Z(this,"onSessionRequest",async r=>{var n,s,i;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:d}=a;try{await this.isValidRequest(He({topic:o},d));const p=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:qn(JSON.stringify(Nt("wc_sessionRequest",d,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),m={id:h,topic:o,params:d,verifyContext:g};await this.setPendingSessionRequest(m),u===nt.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((s=p.peer.metadata.redirect)==null?void 0:s.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),Z(this,"onSessionRequestResponse",(r,n)=>{const{id:s}=n,i=qe("session_request",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bt(n)?this.events.emit(qe("session_request",s),{result:n.result}):dt(n)&&this.events.emit(qe("session_request",s),{error:n.error})}),Z(this,"onSessionEventRequest",async(r,n)=>{const{id:s,params:i}=n;try{const o=`${r}_session_event_${i.event.name}`,a=wl.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(He({topic:r},i)),this.client.events.emit("session_event",{id:s,topic:r,params:i}),wl.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),Z(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:s}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Bt(n)?this.events.emit(qe("session_request",s),{result:n.result}):dt(n)&&this.events.emit(qe("session_request",s),{error:n.error})}),Z(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:s,payload:i,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=i.params,d=await this.getVerifyContext({attestationId:o,hash:qn(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:s,id:i.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:p,pairingTopic:s,transportType:c}),c===nt.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(i.params.requester.metadata,c),p={type:Ii,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:l,encodeOpts:p,rpcOpts:sr.wc_sessionAuthenticate.autoReject,appLink:d})}}),Z(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),Z(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Is.idle,this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay))}),Z(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===r&&i.request.method==="wc_sessionRequest").forEach(i=>{const o=i.request.id,a=qe("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(qe("session_request",i.request.id),{error:n})})}),Z(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Is.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),Z(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Is.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),Z(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:Nt("wc_sessionPropose",Cr(He({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),Z(this,"isValidConnect",async r=>{if(!Wr(r)){const{message:l}=ne("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Lt(n)||await this.isValidPairingTopic(n),!HX(c)){const{message:l}=ne("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(s&&!Lt(s)&&Bs(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(i&&!Lt(i)&&Bs(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),o&&!Lt(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Lt(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),Z(this,"validateNamespaces",(r,n)=>{const s=zX(r,"connect()",n);if(s)throw new Error(s.message)}),Z(this,"isValidApprove",async r=>{if(!Wr(r))throw new Error(ne("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:s,relayProtocol:i,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=pm(s,"approve()");if(l)throw new Error(l.message);const u=T2(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!$t(i,!0)){const{message:h}=ne("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(o&&!Lt(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Lt(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),Z(this,"isValidReject",async r=>{if(!Wr(r)){const{message:i}=ne("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(i)}const{id:n,reason:s}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!WX(s)){const{message:i}=ne("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),Z(this,"isValidSessionSettleRequest",r=>{if(!Wr(r)){const{message:l}=ne("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:n,controller:s,namespaces:i,expiry:o}=r;if(!x3(n)){const{message:l}=ne("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=BX(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=pm(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ns(o)){const{message:l}=ne("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),Z(this,"isValidUpdate",async r=>{if(!Wr(r)){const{message:c}=ne("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:s}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const i=this.client.session.get(n),o=pm(s,"update()");if(o)throw new Error(o.message);const a=T2(i.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),Z(this,"isValidExtend",async r=>{if(!Wr(r)){const{message:s}=ne("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),Z(this,"isValidRequest",async r=>{if(!Wr(r)){const{message:c}=ne("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:s,chainId:i,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!O2(a,i)){const{message:c}=ne("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!KX(s)){const{message:c}=ne("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!ZX(a,i,s.method)){const{message:c}=ne("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!eQ(o,vm)){const{message:c}=ne("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${vm.min} and ${vm.max}`);throw new Error(c)}}),Z(this,"isValidRespond",async r=>{var n;if(!Wr(r)){const{message:a}=ne("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:s,response:i}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(n=r?.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!GX(i)){const{message:a}=ne("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(a)}const o=this.client.pendingRequest.get(i.id);if(o.topic!==s){const{message:a}=ne("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${o.topic}, received topic: ${s}`);throw new Error(a)}}),Z(this,"isValidPing",async r=>{if(!Wr(r)){const{message:s}=ne("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),Z(this,"isValidEmit",async r=>{if(!Wr(r)){const{message:a}=ne("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:s,chainId:i}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!O2(o,i)){const{message:a}=ne("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!YX(s)){const{message:a}=ne("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!JX(o,i,s.name)){const{message:a}=ne("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),Z(this,"isValidDisconnect",async r=>{if(!Wr(r)){const{message:s}=ne("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),Z(this,"isValidAuthenticate",r=>{const{chains:n,uri:s,domain:i,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!$t(s,!1))throw new Error("uri is required parameter");if(!$t(i,!1))throw new Error("domain is required parameter");if(!$t(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>_i(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=_i(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),Z(this,"getVerifyContext",async r=>{const{attestationId:n,hash:s,encryptedId:i,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Hl,validation:"UNKNOWN",origin:o.url||""}};try{if(a===nt.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:s,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),Z(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((s,i)=>{if(s==null){const{message:o}=ne("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[i]}`);throw new Error(o)}})}),Z(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),Z(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(o)}}}),Z(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:s}=ne("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(s)}}),Z(this,"isLinkModeEnabled",(r,n)=>{var s,i,o,a,c,l,u,h,d;return!r||n!==nt.link_mode?!1:((i=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r?.redirect)==null?void 0:u.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((d=r?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),Z(this,"getAppLinkIfEnabled",(r,n)=>{var s;return this.isLinkModeEnabled(r,n)?(s=r?.redirect)==null?void 0:s.universal:void 0}),Z(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=q_(r,"topic")||"",s=decodeURIComponent(q_(r,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:nt.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:s,sessionExists:i})}),Z(this,"registerLinkModeListeners",async()=>{var r;if(K0()||Ao()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await n.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),Z(this,"getTVFParams",(r,n,s)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),Z(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const s=r?.data||((n=r?.[0])==null?void 0:n.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),Z(this,"extractTxHashesFromResult",(r,n)=>{var s;try{if(!n)return[];const i=r.method,o=ane[i];if(i==="sui_signTransaction")return[mZ(n.transactionBytes)];if(i==="near_signTransaction")return[Z_(n)];if(i==="near_signTransactions")return n.map(c=>Z_(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(s=n.tx_json)==null?void 0:s.hash];if(i==="polkadot_signTransaction")return[gQ({transaction:r.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return Si(n)?n.map(c=>J_(c)):[J_(n)];if(i==="cosmos_signDirect")return[wZ(n)];if(i==="wallet_sendCalls")return bZ(n);if(typeof n=="string")return[n];const a=n[o.key];if(Si(a))return i==="solana_signAllTransactions"?a.map(c=>gZ(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn(i,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,s]of Object.entries(r))for(const i of s)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=ne("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(yt.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:s,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(xd)?this.client.auth.authKeys.get(xd):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:i===nt.link_mode?co:Xr});Vc(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:i,encryptedId:qn(n)})):xo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:i}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:i}),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Ln.expired,async e=>{const{topic:r,id:n}=AN(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,ne("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,ne("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ko.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ko.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!$t(e,!1)){const{message:r}=ne("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=ne("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ns(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=ne("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!$t(e,!1)){const{message:r}=ne("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=ne("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ns(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=ne("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=ne("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if($t(e,!1)){const{message:r}=ne("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=ne("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!VX(e)){const{message:r}=ne("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=ne("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ns(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=ne("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class Ene extends Ba{constructor(e,r){super(e,r,sne,ab),this.core=e,this.logger=r}}let _ne=class extends Ba{constructor(e,r){super(e,r,ine,ab),this.core=e,this.logger=r}};class Ine extends Ba{constructor(e,r){super(e,r,cne,ab,n=>n.id),this.core=e,this.logger=r}}class Sne extends Ba{constructor(e,r){super(e,r,dne,_p,()=>xd),this.core=e,this.logger=r}}class Cne extends Ba{constructor(e,r){super(e,r,fne,_p),this.core=e,this.logger=r}}class xne extends Ba{constructor(e,r){super(e,r,pne,_p,n=>n.id),this.core=e,this.logger=r}}var Ane=Object.defineProperty,$ne=(t,e,r)=>e in t?Ane(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Em=(t,e,r)=>$ne(t,typeof e!="symbol"?e+"":e,r);class Nne{constructor(e,r){this.core=e,this.logger=r,Em(this,"authKeys"),Em(this,"pairingTopics"),Em(this,"requests"),this.authKeys=new Sne(this.core,this.logger),this.pairingTopics=new Cne(this.core,this.logger),this.requests=new xne(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var One=Object.defineProperty,Tne=(t,e,r)=>e in t?One(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ne=(t,e,r)=>Tne(t,typeof e!="symbol"?e+"":e,r);let kne=class K3 extends KW{constructor(e){super(e),Ne(this,"protocol",H3),Ne(this,"version",V3),Ne(this,"name",bm.name),Ne(this,"metadata"),Ne(this,"core"),Ne(this,"logger"),Ne(this,"events",new mt.EventEmitter),Ne(this,"engine"),Ne(this,"session"),Ne(this,"proposal"),Ne(this,"pendingRequest"),Ne(this,"auth"),Ne(this,"signConfig"),Ne(this,"on",(n,s)=>this.events.on(n,s)),Ne(this,"once",(n,s)=>this.events.once(n,s)),Ne(this,"off",(n,s)=>this.events.off(n,s)),Ne(this,"removeListener",(n,s)=>this.events.removeListener(n,s)),Ne(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),Ne(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"update",async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"request",async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"find",n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),Ne(this,"authenticate",async(n,s)=>{try{return await this.engine.authenticate(n,s)}catch(i){throw this.logger.error(i.message),i}}),Ne(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),Ne(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||bm.name,this.metadata=cY(e?.metadata),this.signConfig=e?.signConfig;const r=ib({logger:e?.logger||bm.logger,name:this.name});this.logger=r,this.core=e?.core||new nne(e),this.session=new _ne(this.core,this.logger),this.proposal=new Ene(this.core,this.logger),this.pendingRequest=new Ine(this.core,this.logger),this.engine=new vne(this),this.auth=new Nne(this.core,this.logger)}static async init(e){const r=new K3(e);return await r.initialize(),r}get context(){return an(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Pne=kne;var Qh={exports:{}},lI;function Rne(){return lI||(lI=1,(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof $s<"u"&&$s,n=(function(){function i(){this.fetch=!1,this.DOMException=r.DOMException}return i.prototype=r,new i})();(function(i){(function(o){var a=typeof i<"u"&&i||typeof self<"u"&&self||typeof $s<"u"&&$s||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(f){return f&&DataView.prototype.isPrototypeOf(f)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(f){return f&&u.indexOf(Object.prototype.toString.call(f))>-1};function d(f){if(typeof f!="string"&&(f=String(f)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(f)||f==="")throw new TypeError('Invalid character in header field name: "'+f+'"');return f.toLowerCase()}function p(f){return typeof f!="string"&&(f=String(f)),f}function g(f){var y={next:function(){var E=f.shift();return{done:E===void 0,value:E}}};return c.iterable&&(y[Symbol.iterator]=function(){return y}),y}function m(f){this.map={},f instanceof m?f.forEach(function(y,E){this.append(E,y)},this):Array.isArray(f)?f.forEach(function(y){if(y.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+y.length);this.append(y[0],y[1])},this):f&&Object.getOwnPropertyNames(f).forEach(function(y){this.append(y,f[y])},this)}m.prototype.append=function(f,y){f=d(f),y=p(y);var E=this.map[f];this.map[f]=E?E+", "+y:y},m.prototype.delete=function(f){delete this.map[d(f)]},m.prototype.get=function(f){return f=d(f),this.has(f)?this.map[f]:null},m.prototype.has=function(f){return this.map.hasOwnProperty(d(f))},m.prototype.set=function(f,y){this.map[d(f)]=p(y)},m.prototype.forEach=function(f,y){for(var E in this.map)this.map.hasOwnProperty(E)&&f.call(y,this.map[E],E,this)},m.prototype.keys=function(){var f=[];return this.forEach(function(y,E){f.push(E)}),g(f)},m.prototype.values=function(){var f=[];return this.forEach(function(y){f.push(y)}),g(f)},m.prototype.entries=function(){var f=[];return this.forEach(function(y,E){f.push([E,y])}),g(f)},c.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);function w(f){if(!f._noBody){if(f.bodyUsed)return Promise.reject(new TypeError("Already read"));f.bodyUsed=!0}}function I(f){return new Promise(function(y,E){f.onload=function(){y(f.result)},f.onerror=function(){E(f.error)}})}function S(f){var y=new FileReader,E=I(y);return y.readAsArrayBuffer(f),E}function v(f){var y=new FileReader,E=I(y),x=/charset=([A-Za-z0-9_-]+)/.exec(f.type),_=x?x[1]:"utf-8";return y.readAsText(f,_),E}function b(f){for(var y=new Uint8Array(f),E=new Array(y.length),x=0;x<y.length;x++)E[x]=String.fromCharCode(y[x]);return E.join("")}function C(f){if(f.slice)return f.slice(0);var y=new Uint8Array(f.byteLength);return y.set(new Uint8Array(f)),y.buffer}function N(){return this.bodyUsed=!1,this._initBody=function(f){this.bodyUsed=this.bodyUsed,this._bodyInit=f,f?typeof f=="string"?this._bodyText=f:c.blob&&Blob.prototype.isPrototypeOf(f)?this._bodyBlob=f:c.formData&&FormData.prototype.isPrototypeOf(f)?this._bodyFormData=f:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(f)?this._bodyText=f.toString():c.arrayBuffer&&c.blob&&l(f)?(this._bodyArrayBuffer=C(f.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(f)||h(f))?this._bodyArrayBuffer=C(f):this._bodyText=f=Object.prototype.toString.call(f):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof f=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(f)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var f=w(this);if(f)return f;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var f=w(this);return f||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(S);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var f=w(this);if(f)return f;if(this._bodyBlob)return v(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(M)}),this.json=function(){return this.text().then(JSON.parse)},this}var P=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function R(f){var y=f.toUpperCase();return P.indexOf(y)>-1?y:f}function O(f,y){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');y=y||{};var E=y.body;if(f instanceof O){if(f.bodyUsed)throw new TypeError("Already read");this.url=f.url,this.credentials=f.credentials,y.headers||(this.headers=new m(f.headers)),this.method=f.method,this.mode=f.mode,this.signal=f.signal,!E&&f._bodyInit!=null&&(E=f._bodyInit,f.bodyUsed=!0)}else this.url=String(f);if(this.credentials=y.credentials||this.credentials||"same-origin",(y.headers||!this.headers)&&(this.headers=new m(y.headers)),this.method=R(y.method||this.method||"GET"),this.mode=y.mode||this.mode||null,this.signal=y.signal||this.signal||(function(){if("AbortController"in a){var A=new AbortController;return A.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&E)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(E),(this.method==="GET"||this.method==="HEAD")&&(y.cache==="no-store"||y.cache==="no-cache")){var x=/([?&])_=[^&]*/;if(x.test(this.url))this.url=this.url.replace(x,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}O.prototype.clone=function(){return new O(this,{body:this._bodyInit})};function M(f){var y=new FormData;return f.trim().split("&").forEach(function(E){if(E){var x=E.split("="),_=x.shift().replace(/\+/g," "),A=x.join("=").replace(/\+/g," ");y.append(decodeURIComponent(_),decodeURIComponent(A))}}),y}function j(f){var y=new m,E=f.replace(/\r?\n[\t ]+/g," ");return E.split("\r").map(function(x){return x.indexOf(`
`)===0?x.substr(1,x.length):x}).forEach(function(x){var _=x.split(":"),A=_.shift().trim();if(A){var L=_.join(":").trim();try{y.append(A,L)}catch(B){console.warn("Response "+B.message)}}}),y}N.call(O.prototype);function k(f,y){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(y||(y={}),this.type="default",this.status=y.status===void 0?200:y.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=y.statusText===void 0?"":""+y.statusText,this.headers=new m(y.headers),this.url=y.url||"",this._initBody(f)}N.call(k.prototype),k.prototype.clone=function(){return new k(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},k.error=function(){var f=new k(null,{status:200,statusText:""});return f.ok=!1,f.status=0,f.type="error",f};var $=[301,302,303,307,308];k.redirect=function(f,y){if($.indexOf(y)===-1)throw new RangeError("Invalid status code");return new k(null,{status:y,headers:{location:f}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(y,E){this.message=y,this.name=E;var x=Error(y);this.stack=x.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function T(f,y){return new Promise(function(E,x){var _=new O(f,y);if(_.signal&&_.signal.aborted)return x(new o.DOMException("Aborted","AbortError"));var A=new XMLHttpRequest;function L(){A.abort()}A.onload=function(){var D={statusText:A.statusText,headers:j(A.getAllResponseHeaders()||"")};_.url.indexOf("file://")===0&&(A.status<200||A.status>599)?D.status=200:D.status=A.status,D.url="responseURL"in A?A.responseURL:D.headers.get("X-Request-URL");var F="response"in A?A.response:A.responseText;setTimeout(function(){E(new k(F,D))},0)},A.onerror=function(){setTimeout(function(){x(new TypeError("Network request failed"))},0)},A.ontimeout=function(){setTimeout(function(){x(new TypeError("Network request timed out"))},0)},A.onabort=function(){setTimeout(function(){x(new o.DOMException("Aborted","AbortError"))},0)};function B(D){try{return D===""&&a.location.href?a.location.href:D}catch{return D}}if(A.open(_.method,B(_.url),!0),_.credentials==="include"?A.withCredentials=!0:_.credentials==="omit"&&(A.withCredentials=!1),"responseType"in A&&(c.blob?A.responseType="blob":c.arrayBuffer&&(A.responseType="arraybuffer")),y&&typeof y.headers=="object"&&!(y.headers instanceof m||a.Headers&&y.headers instanceof a.Headers)){var q=[];Object.getOwnPropertyNames(y.headers).forEach(function(D){q.push(d(D)),A.setRequestHeader(D,p(y.headers[D]))}),_.headers.forEach(function(D,F){q.indexOf(F)===-1&&A.setRequestHeader(F,D)})}else _.headers.forEach(function(D,F){A.setRequestHeader(F,D)});_.signal&&(_.signal.addEventListener("abort",L),A.onreadystatechange=function(){A.readyState===4&&_.signal.removeEventListener("abort",L)}),A.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return T.polyfill=!0,a.fetch||(a.fetch=T,a.Headers=m,a.Request=O,a.Response=k),o.Headers=m,o.Request=O,o.Response=k,o.fetch=T,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=r.fetch?r:n;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(Qh,Qh.exports)),Qh.exports}var Dne=Rne();const uI=zu(Dne);var Une=Object.defineProperty,Bne=Object.defineProperties,Lne=Object.getOwnPropertyDescriptors,hI=Object.getOwnPropertySymbols,Mne=Object.prototype.hasOwnProperty,jne=Object.prototype.propertyIsEnumerable,dI=(t,e,r)=>e in t?Une(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fI=(t,e)=>{for(var r in e||(e={}))Mne.call(e,r)&&dI(t,r,e[r]);if(hI)for(var r of hI(e))jne.call(e,r)&&dI(t,r,e[r]);return t},pI=(t,e)=>Bne(t,Lne(e));const Fne={Accept:"application/json","Content-Type":"application/json"},qne="POST",gI={headers:Fne,method:qne},mI=10;let G3=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new mt.EventEmitter,this.isAvailable=!1,this.registering=!1,!vE(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Br(e),n=await(await uI(this.url,pI(fI({},gI),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!vE(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Br({id:1,jsonrpc:"2.0",method:"test",params:[]});await uI(e,pI(fI({},gI),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ls(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),s=n.message||n.toString(),i=Oa(e,s);this.events.emit("payload",i)}parseError(e,r=this.url){return O0(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>mI&&this.events.setMaxListeners(mI)}};function cb(t){return t==null||typeof t!="object"&&typeof t!="function"}function Y3(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Z3(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const zne="[object RegExp]",J3="[object String]",X3="[object Number]",Q3="[object Boolean]",eO="[object Arguments]",Hne="[object Symbol]",Vne="[object Date]",Wne="[object Map]",Kne="[object Set]",Gne="[object Array]",Yne="[object ArrayBuffer]",Zne="[object Object]",Jne="[object DataView]",Xne="[object Uint8Array]",Qne="[object Uint8ClampedArray]",ese="[object Uint16Array]",tse="[object Uint32Array]",rse="[object Int8Array]",nse="[object Int16Array]",sse="[object Int32Array]",ise="[object Float32Array]",ose="[object Float64Array]";function lb(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ase(t,e){return hc(t,void 0,t,new Map,e)}function hc(t,e,r,n=new Map,s=void 0){const i=s?.(t,e,r,n);if(i!=null)return i;if(cb(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){const o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=hc(t[a],a,r,n,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;n.set(t,o);for(const[a,c]of t)o.set(a,hc(c,a,r,n,s));return o}if(t instanceof Set){const o=new Set;n.set(t,o);for(const a of t)o.add(hc(a,void 0,r,n,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(lb(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=hc(t[a],a,r,n,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),Go(o,t,r,n,s),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return n.set(t,o),Go(o,t,r,n,s),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return n.set(t,o),Go(o,t,r,n,s),o}if(t instanceof Error){const o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Go(o,t,r,n,s),o}if(typeof t=="object"&&cse(t)){const o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),Go(o,t,r,n,s),o}return t}function Go(t,e,r=t,n,s){const i=[...Object.keys(e),...Y3(e)];for(let o=0;o<i.length;o++){const a=i[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=hc(e[a],a,r,n,s))}}function cse(t){switch(Z3(t)){case eO:case Gne:case Yne:case Jne:case Q3:case Vne:case ise:case ose:case rse:case nse:case sse:case Wne:case X3:case Zne:case zne:case Kne:case J3:case Hne:case Xne:case Qne:case ese:case tse:return!0;default:return!1}}function lse(t,e){return ase(t,(r,n,s,i)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case X3:case J3:case Q3:{const o=new t.constructor(t?.valueOf());return Go(o,t),o}case eO:{const o={};return Go(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function yI(t){return lse(t)}function wI(t){return t!==null&&typeof t=="object"&&Z3(t)==="[object Arguments]"}function bI(t){return typeof t=="object"&&t!==null}function use(){}function hse(t){return lb(t)}function dse(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function fse(t){if(cb(t))return t;if(Array.isArray(t)||lb(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const n=new r(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const n=new r(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(e);return Object.assign(n,t)}return t}function pse(t,...e){const r=e.slice(0,-1),n=e[e.length-1];let s=t;for(let i=0;i<r.length;i++){const o=r[i];s=$w(s,o,n,new Map)}return s}function $w(t,e,r,n){if(cb(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return fse(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}const s=[...Object.keys(e),...Y3(e)];for(let i=0;i<s.length;i++){const o=s[i];let a=e[o],c=t[o];if(wI(a)&&(a={...a}),wI(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=yI(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let d=0;d<h.length;d++){const p=h[d];u[p]=c[p]}c=u}else c=[];const l=r(c,a,o,t,e,n);l!=null?t[o]=l:Array.isArray(a)||bI(c)&&bI(a)?t[o]=$w(c,a,r,n):c==null&&dse(a)?t[o]=$w({},a,r,n):c==null&&hse(a)?t[o]=yI(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function gse(t,...e){return pse(t,...e,use)}const vI="error",mse="wss://relay.walletconnect.org",yse="wc",tO="universal_provider",ed=`${yse}@2:${tO}:`,rO="https://rpc.walletconnect.org/v1/",nO="generic",wse=`${rO}bundler`,bc="call_status",bse=86400,ub={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var vse=Object.defineProperty,Ese=Object.defineProperties,_se=Object.getOwnPropertyDescriptors,EI=Object.getOwnPropertySymbols,Ise=Object.prototype.hasOwnProperty,Sse=Object.prototype.propertyIsEnumerable,_I=(t,e,r)=>e in t?vse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,td=(t,e)=>{for(var r in e||(e={}))Ise.call(e,r)&&_I(t,r,e[r]);if(EI)for(var r of EI(e))Sse.call(e,r)&&_I(t,r,e[r]);return t},Cse=(t,e)=>Ese(t,_se(e));function sO(t,e,r){var n;const s=_i(t);return((n=e.rpcMap)==null?void 0:n[s.reference])||`${rO}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function xse(t){return t.includes(":")?t.split(":")[1]:t}function iO(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function Ase(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const n=[];return r.forEach(s=>{const i=e.namespaces[s].accounts;n.push(...i)}),n}function II(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var n,s;return((n=r?.chains)==null?void 0:n.length)&&((s=r?.chains)==null?void 0:s.length)>0}))}function rd(t={},e={}){const r=II(SI(t)),n=II(SI(e));return gse(r,n)}function SI(t){var e,r,n,s,i;const o={};if(!Bs(t))return o;for(const[a,c]of Object.entries(t)){const l=vp(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],d=c.rpcMap||{},p=uc(a);o[p]=Cse(td(td({},o[p]),c),{chains:Us(l,(e=o[p])==null?void 0:e.chains),methods:Us(u,(r=o[p])==null?void 0:r.methods),events:Us(h,(n=o[p])==null?void 0:n.events)}),(Bs(d)||Bs(((s=o[p])==null?void 0:s.rpcMap)||{}))&&(o[p].rpcMap=td(td({},d),(i=o[p])==null?void 0:i.rpcMap))}return o}function CI(t){return t.includes(":")?t.split(":")[2]:t}function xI(t){const e={};for(const[r,n]of Object.entries(t)){const s=n.methods||[],i=n.events||[],o=n.accounts||[],a=vp(r)?[r]:n.chains?n.chains:iO(n.accounts);e[r]={chains:a,methods:s,events:i,accounts:o}}return e}function _m(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function $se(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const oO={},vc=t=>oO[t],Im=(t,e)=>{oO[t]=e};var Nse=Object.defineProperty,AI=Object.getOwnPropertySymbols,Ose=Object.prototype.hasOwnProperty,Tse=Object.prototype.propertyIsEnumerable,$I=(t,e,r)=>e in t?Nse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,NI=(t,e)=>{for(var r in e||(e={}))Ose.call(e,r)&&$I(t,r,e[r]);if(AI)for(var r of AI(e))Tse.call(e,r)&&$I(t,r,e[r]);return t};const OI="eip155",kse=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],Pse=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,Sm=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,TI=t=>Object.keys(t).filter(e=>kse.includes(e)).reduce((e,r)=>(e[r]=Rse(t[r]),e),{}),Rse=t=>typeof t=="string"&&$se(t)?JSON.parse(t):t,Dse=(t,e,r)=>{const{sessionProperties:n={},scopedProperties:s={}}=t,i={};if(!Bs(s)&&!Bs(n))return;const o=TI(n);for(const a of r){const c=Pse(a);if(!c)continue;i[Sm(c)]=o;const l=s?.[`${OI}:${c}`];if(l){const u=l?.[`${OI}:${c}:${e}`];i[Sm(c)]=NI(NI({},i[Sm(c)]),TI(u||l))}}for(const[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0};var Use=Object.defineProperty,Bse=(t,e,r)=>e in t?Use(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lse=(t,e,r)=>Bse(t,e+"",r);let Cm;class hb{constructor(e){Lse(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Cm||(Cm=new hb(e)),Cm}}var Mse=Object.defineProperty,jse=Object.defineProperties,Fse=Object.getOwnPropertyDescriptors,kI=Object.getOwnPropertySymbols,qse=Object.prototype.hasOwnProperty,zse=Object.prototype.propertyIsEnumerable,PI=(t,e,r)=>e in t?Mse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hse=(t,e)=>{for(var r in e||(e={}))qse.call(e,r)&&PI(t,r,e[r]);if(kI)for(var r of kI(e))zse.call(e,r)&&PI(t,r,e[r]);return t},Vse=(t,e)=>jse(t,Fse(e));async function Wse(t,e){const r=_i(t.result.capabilities.caip345.caip2),n=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(h=>Kse(r.reference,h,e))),i=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!i.length||i.some(h=>!h),a=i.every(h=>h?.status==="0x1"),c=i.every(h=>h?.status==="0x0"),l=i.some(h=>h?.status==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:i,status:u}}async function Kse(t,e,r){return await r(parseInt(t)).request(Nt("eth_getTransactionReceipt",[e]))}async function Gse({sendCalls:t,storage:e}){const r=await e.getItem(bc);await e.setItem(bc,Vse(Hse({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:St(bse)}}))}async function Yse({resultId:t,storage:e}){const r=await e.getItem(bc);if(r){delete r[t],await e.setItem(bc,r);for(const n in r)Ns(r[n].expiry)&&delete r[n];await e.setItem(bc,r)}}async function Zse({resultId:t,storage:e}){const r=await e.getItem(bc),n=r?.[t];if(n&&!Ns(n.expiry))return n;await Yse({resultId:t,storage:e})}var Jse=Object.defineProperty,Xse=Object.defineProperties,Qse=Object.getOwnPropertyDescriptors,RI=Object.getOwnPropertySymbols,eie=Object.prototype.hasOwnProperty,tie=Object.prototype.propertyIsEnumerable,Nw=(t,e,r)=>e in t?Jse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xm=(t,e)=>{for(var r in e||(e={}))eie.call(e,r)&&Nw(t,r,e[r]);if(RI)for(var r of RI(e))tie.call(e,r)&&Nw(t,r,e[r]);return t},Am=(t,e)=>Xse(t,Qse(e)),Uo=(t,e,r)=>Nw(t,typeof e!="symbol"?e+"":e,r);class rie{constructor(e){Uo(this,"name","eip155"),Uo(this,"client"),Uo(this,"chainId"),Uo(this,"namespace"),Uo(this,"httpProviders"),Uo(this,"events"),Uo(this,"storage"),this.namespace=e.namespace,this.events=vc("events"),this.client=vc("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=hb.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(ub.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const n=r||sO(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new ob(new G3(n,vc("disableProviderPing")))}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const s=parseInt(xse(r));e[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=Am(xm({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,n;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const i=parseInt(s,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,n,s,i,o;const a=(n=(r=e.request)==null?void 0:r.params)==null?void 0:n[0],c=((i=(s=e.request)==null?void 0:s.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,d=u?.[h];if(d)return d;let p;try{p=Dse(l,a,c)}catch(m){console.warn("Failed to extract capabilities from session",m)}if(p)return p;const g=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Am(xm({},l.sessionProperties||{}),{capabilities:Am(xm({},u||{}),{[h]:g})})})}catch(m){console.warn("Failed to update session with capabilities",m)}return g}async getCallStatus(e){var r,n,s;const i=this.client.session.get(e.topic),o=(r=i.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await Zse({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await Wse(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var n;const s=new URL(e),i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Nt("eth_getUserOperationReceipt",[(n=r.request.params)==null?void 0:n[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,r){return`${wse}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,n,s;const i=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=i?.id,c=i?.capabilities||{},l=(n=c?.caip345)==null?void 0:n.caip2,u=(s=c?.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await Gse({sendCalls:{request:o,result:i},storage:this.storage}),i}}var nie=Object.defineProperty,sie=(t,e,r)=>e in t?nie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ec=(t,e,r)=>sie(t,typeof e!="symbol"?e+"":e,r);class iie{constructor(e){ec(this,"name",nO),ec(this,"client"),ec(this,"httpProviders"),ec(this,"events"),ec(this,"namespace"),ec(this,"chainId"),this.namespace=e.namespace,this.events=vc("events"),this.client=vc("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const n=this.chainId;this.chainId=e,this.events.emit(ub.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return _i(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const n={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var i,o;const a=_i(s),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(s,c)}),n}getHttpProvider(e){const r=_i(e).reference,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||sO(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new ob(new G3(n,vc("disableProviderPing")))}}var oie=Object.defineProperty,aie=Object.defineProperties,cie=Object.getOwnPropertyDescriptors,DI=Object.getOwnPropertySymbols,lie=Object.prototype.hasOwnProperty,uie=Object.prototype.propertyIsEnumerable,Ow=(t,e,r)=>e in t?oie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Il=(t,e)=>{for(var r in e||(e={}))lie.call(e,r)&&Ow(t,r,e[r]);if(DI)for(var r of DI(e))uie.call(e,r)&&Ow(t,r,e[r]);return t},nd=(t,e)=>aie(t,cie(e)),Pn=(t,e,r)=>Ow(t,typeof e!="symbol"?e+"":e,r);let hie=class aO{constructor(e){Pn(this,"client"),Pn(this,"namespaces"),Pn(this,"optionalNamespaces"),Pn(this,"sessionProperties"),Pn(this,"scopedProperties"),Pn(this,"events",new Hu),Pn(this,"rpcProviders",{}),Pn(this,"session"),Pn(this,"providerOpts"),Pn(this,"logger"),Pn(this,"uri"),Pn(this,"disableProviderPing",!1);var r,n;this.providerOpts=e,this.logger=ib({logger:(r=e.logger)!=null?r:vI,name:(n=this.providerOpts.name)!=null?n:tO}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new aO(e);return await r.initialize(),r}async request(e,r,n){const[s,i]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Il({},e),chainId:`${s}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,r,n,s){const i=new Date().getTime();this.request(e,n,s).then(o=>r(null,xi(i,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:lt("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:s}=await this.client.authenticate(e,r);n&&(this.uri=n,this.events.emit("display_uri",n));const i=await s();if(this.session=i.session,this.session){const o=xI(this.session.namespaces);this.namespaces=rd(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const s=await n();this.session=s;const i=xI(s.namespaces);return this.namespaces=rd(this.namespaces,i),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[n,s]=this.validateChain(e);this.getProvider(n).setDefaultChain(s,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!Si(r))return;for(const n of r)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn(r,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await Pne.init({core:this.providerOpts.core,logger:this.providerOpts.logger||vI,relayUrl:this.providerOpts.relayUrl||mse,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error(n,"Failed to get session"),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>uc(r)))];Im("client",this.client),Im("events",this.events),Im("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const n=Ase(r,this.session);if(n?.length===0)return;const s=iO(n),i=rd(this.namespaces,this.optionalNamespaces),o=nd(Il({},i[r]),{accounts:n,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new rie({namespace:o});break;default:this.rpcProviders[r]=new iie({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:n}=e;n===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:n,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;const{event:i}=n;if(i.name==="accountsChanged"){const o=i.data;o&&Si(o)&&this.events.emit("accountsChanged",o.map(CI))}else if(i.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=uc(o),l=_m(o)!==_m(a)?`${c}:${_m(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var n,s;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:i}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=nd(Il({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",nd(Il({},lt("USER_DISCONNECTED")),{data:e.topic})))}),this.on(ub.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(nd(Il({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[nO]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:n={},sessionProperties:s,scopedProperties:i}=e;this.optionalNamespaces=rd(r,n),this.sessionProperties=s,this.scopedProperties=i}validateChain(e){const[r,n]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(o=>uc(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const s=uc(Object.keys(this.namespaces)[0]),i=this.rpcProviders[s].getDefaultChain();return[s,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:n=!1}){if(!this.namespaces)return;const[s,i]=this.validateChain(e);i&&(this.updateNamespaceChain(s,i),n?(this.events.emit("chainChanged",i),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(s).setDefaultChain(i),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:n}){var s,i;try{if(n===r)return;const o=(i=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:i.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(CI);if(!Si(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,r){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=r):this.namespaces[n]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var n;const s=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${ed}/${e}${s}`,r)}async getFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${ed}/${e}${n}`)}async deleteFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${ed}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const n of r)n.startsWith(ed)&&await this.client.core.storage.removeItem(n)}catch(r){this.logger.warn(r,"Failed to cleanup storage")}}};const UI=2147483648,die={convertEVMChainIdToCoinType(t){if(t>=UI)throw new Error("Invalid chainId");return(UI|t)>>>0}},Rn=it({suggestions:[],loading:!1}),fie={state:Rn,subscribe(t){return cr(Rn,()=>t(Rn))},subscribeKey(t,e){return lr(Rn,t,e)},async resolveName(t){try{return await we.lookupEnsName(t)}catch(e){const r=e;throw new Error(r?.reasons?.[0]?.description||"Error resolving name")}},async isNameRegistered(t){try{return await we.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{Rn.loading=!0,Rn.suggestions=[];const e=await we.getEnsNameSuggestions(t);return Rn.suggestions=e.suggestions||[],Rn.suggestions}catch(e){const r=Wl.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(r)}finally{Rn.loading=!1}},async getNamesForAddress(t){try{if(!U.state.activeCaipNetwork)return[];const r=J.getEnsFromCacheForAddress(t);if(r)return r;const n=await we.reverseLookupEnsName({address:t});return J.updateEnsCache({address:t,ens:n,timestamp:Date.now()}),n}catch(e){const r=Wl.parseEnsApiError(e,"Error fetching names for address");throw new Error(r)}},async registerName(t){const e=U.state.activeCaipNetwork,r=U.getAccountData(e?.chainNamespace)?.address,n=Q.getAuthConnector();if(!e)throw new Error("Network not found");if(!r||!n)throw new Error("Address or auth connector not found");Rn.loading=!0;try{const s=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});me.pushTransactionStack({onCancel(){me.replace("RegisterAccountName")}});const i=await ie.signMessage(s);Rn.loading=!1;const o=e.id;if(!o)throw new Error("Network not found");const a=die.convertEVMChainIdToCoinType(Number(o));await we.registerEnsName({coinType:a,address:r,signature:i,message:s}),U.setAccountProp("profileName",t,e.chainNamespace),J.updateEnsCache({address:r,ens:[{name:t,registered_at:new Date().toISOString(),updated_at:void 0,addresses:{},attributes:[]}],timestamp:Date.now()}),me.replace("RegisterAccountNameSuccess")}catch(s){const i=Wl.parseEnsApiError(s,`Error registering name ${t}`);throw me.replace("RegisterAccountName"),new Error(i)}finally{Rn.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){return t?.reasons?.[0]?.description||e}},Wl=Kn(fie),pie={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},wo={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace(t){return pie[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const r={...t},n=new Set;if(e.methods&&Object.keys(e.methods).forEach(s=>n.add(s)),e.chains&&Object.keys(e.chains).forEach(s=>n.add(s)),e.events&&Object.keys(e.events).forEach(s=>n.add(s)),e.rpcMap&&Object.keys(e.rpcMap).forEach(s=>{const[i]=s.split(":");i&&n.add(i)}),n.forEach(s=>{r[s]||(r[s]=this.createDefaultNamespace(s))}),e.methods&&Object.entries(e.methods).forEach(([s,i])=>{r[s]&&(r[s].methods=i)}),e.chains&&Object.entries(e.chains).forEach(([s,i])=>{r[s]&&(r[s].chains=i)}),e.events&&Object.entries(e.events).forEach(([s,i])=>{r[s]&&(r[s].events=i)}),e.rpcMap){const s=new Set;Object.entries(e.rpcMap).forEach(([i,o])=>{const[a,c]=i.split(":");!a||!c||!r[a]||(r[a].rpcMap||(r[a].rpcMap={}),s.has(a)||(r[a].rpcMap={},s.add(a)),r[a].rpcMap[c]=o)})}return r},createNamespaces(t,e){const r=t.reduce((n,s)=>{const{id:i,chainNamespace:o,rpcUrls:a}=s,c=a.default.http[0];n[o]||(n[o]=this.createDefaultNamespace(o));const l=`${o}:${i}`,u=n[o];switch(u.chains.push(l),l){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":u.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":u.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K");break}return u?.rpcMap&&c&&(u.rpcMap[i]=c),n},{});return this.applyNamespaceOverrides(r,e)},resolveReownName:async t=>{const e=await Wl.resolveName(t);return(Object.values(e?.addresses)||[])[0]?.address||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const r=e.chains||[],n=e.accounts.map(s=>{const[i,o]=s.split(":");return`${i}:${o}`});return Array.from(new Set([...r,...n]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isUserRejectedRequestError(t){try{if(typeof t=="object"&&t!==null){const e=t,r=typeof e.code=="number",n=r&&e.code===wo.RPC_ERROR_CODE.USER_REJECTED_METHODS,s=r&&e.code===wo.RPC_ERROR_CODE.USER_REJECTED;return n||s}return!1}catch{return!1}},isOriginAllowed(t,e,r){for(const n of[...e,...r])if(n.includes("*")){const i=`^${n.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*")}$`;if(new RegExp(i,"u").test(t))return!0}else try{if(new URL(n).origin===t)return!0}catch{if(n===t)return!0}return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:r,onDisconnect:n,onAccountsChanged:s,onChainChanged:i,onDisplayUri:o}){r&&t.on("connect",()=>{const a=wo.getWalletConnectAccounts(t,e);r(a)}),n&&t.on("disconnect",()=>{n()}),s&&t.on("accountsChanged",a=>{try{const c=t.session?.namespaces?.[e]?.accounts||[],l=t.rpcProviders?.[e]?.getDefaultChain(),u=a.map(h=>{const d=c.find(m=>m.includes(`${e}:${l}:${h}`));if(!d)return;const{chainId:p,chainNamespace:g}=or.parseCaipAddress(d);return{address:h,chainId:p,chainNamespace:g}}).filter(h=>h!==void 0);u.length>0&&s(u)}catch(c){console.warn("Failed to parse accounts for namespace on accountsChanged event",e,a,c)}}),i&&t.on("chainChanged",a=>{i(a)}),o&&t.on("display_uri",a=>{o(a)})},getWalletConnectAccounts(t,e){const r=new Set,n=t?.session?.namespaces?.[e]?.accounts?.map(s=>or.parseCaipAddress(s)).filter(({address:s})=>r.has(s.toLowerCase())?!1:(r.add(s.toLowerCase()),!0));return n&&n.length>0?n:[]}},gie=[X.CONNECTOR_ID.AUTH,X.CONNECTOR_ID.WALLET_CONNECT];class mie{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=r=>U.getCaipNetworks(r),this.getConnectorId=r=>Q.getConnectorId(r),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:r}){const n=this.getCaipNetworks().filter(s=>s.chainNamespace===this.namespace).find(s=>s.id.toString()===r?.toString());e&&n&&this.addConnection({connectorId:X.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:n})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:X.CONNECTOR_ID.AUTH,type:"AUTH",name:X.CONNECTOR_NAMES.AUTH,provider:e,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...e){const r=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(n=>r.has(n.id)?!1:(r.add(n.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){const r=new Set;this.availableConnections=[...e,...this.availableConnections].filter(n=>r.has(n.connectorId.toLowerCase())?!1:(r.add(n.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(r=>r.connectorId.toLowerCase()!==e.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,r){U.setAccountProp("status",e,r)}on(e,r){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e)?.add(r)}off(e,r){const n=this.eventListeners.get(e);n&&n.delete(r)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,r){const n=this.eventListeners.get(e);n&&n.forEach(s=>s(r))}async connectWalletConnect(e){try{return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}catch(r){throw wo.isUserRejectedRequestError(r)?new E$(r):r}}async switchNetwork(e){const{caipNetwork:r}=e,n=ct.getProviderId(r.chainNamespace),s=ct.getProvider(r.chainNamespace);if(!s)throw new Error("Provider not found");if(n==="WALLET_CONNECT"){s.setDefaultChain(r.caipNetworkId);return}if(n==="AUTH"){const i=Q.getAuthConnector()?.provider;if(!i)throw new Error("Auth provider not found");const o=Hn(r.chainNamespace);await i.switchNetwork({chainId:r.caipNetworkId});const a=await i.getUser({chainId:r.caipNetworkId,preferredAccountType:o});this.emit("switchNetwork",a)}}getWalletConnectConnector(){const e=this.connectors.find(r=>r.id==="walletConnect");if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,r){if(e.length>0){const{address:n,chainId:s}=ue.getAccount(e[0]),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===s?.toString()),o=this.connectors.find(a=>a.id===r);n&&(this.emit("accountChanged",{address:n,chainId:s,connector:o}),this.addConnection({connectorId:r,accounts:e.map(a=>{const{address:c}=ue.getAccount(a);return{address:c}}),caipNetwork:i}))}}onAccountsChanged(e,r,n=!0){if(e.length>0){const{address:s}=ue.getAccount(e[0]),i=this.getConnection({connectorId:r,connections:this.connections,connectors:this.connectors});s&&this.getConnectorId(X.CHAIN.EVM)?.toLowerCase()===r.toLowerCase()&&this.emit("accountChanged",{address:s,chainId:i?.caipNetwork?.id,connector:i?.connector}),this.addConnection({connectorId:r,accounts:e.map(o=>{const{address:a}=ue.getAccount(o);return{address:a}}),caipNetwork:i?.caipNetwork})}else n&&this.onDisconnect(r)}onDisconnect(e){this.removeProviderListeners(e),this.deleteConnection(e),this.getConnectorId(X.CHAIN.EVM)?.toLowerCase()===e.toLowerCase()&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,r){const n=typeof e=="string"&&e.startsWith("0x")?parseInt(e,16).toString():e.toString(),s=this.getConnection({connectorId:r,connections:this.connections,connectors:this.connectors}),i=this.getCaipNetworks().filter(o=>o.chainNamespace===this.namespace).find(o=>o.id.toString()===n);s&&this.addConnection({connectorId:r,accounts:s.accounts,caipNetwork:i}),this.getConnectorId(X.CHAIN.EVM)?.toLowerCase()===r.toLowerCase()&&this.emit("switchNetwork",{chainId:n})}listenProviderEvents(e,r){if(gie.includes(e))return;const n=o=>this.onAccountsChanged(o,e),s=o=>this.onChainChanged(o,e),i=()=>this.onDisconnect(e);this.providerHandlers[e]||(r.on("disconnect",i),r.on("accountsChanged",n),r.on("chainChanged",s),this.providerHandlers[e]={provider:r,disconnect:i,accountsChanged:n,chainChanged:s})}removeProviderListeners(e){if(this.providerHandlers[e]){const{provider:r,disconnect:n,accountsChanged:s,chainChanged:i}=this.providerHandlers[e];r.removeListener("disconnect",n),r.removeListener("accountsChanged",s),r.removeListener("chainChanged",i),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){const e=this.getConnection({connections:this.connections,connectors:this.connectors});if(e){const[r]=e.accounts;this.emit("accountChanged",{address:r?.address,chainId:e.caipNetwork?.id,connector:e.connector})}}getConnection({address:e,connectorId:r,connections:n,connectors:s}){if(r){const o=n.find(l=>l.connectorId.toLowerCase()===r.toLowerCase());if(!o)return null;const a=s.find(l=>l.id.toLowerCase()===o.connectorId.toLowerCase()),c=e?o.accounts.find(l=>l.address.toLowerCase()===e.toLowerCase()):o.accounts[0];return{...o,account:c,connector:a}}const i=n.find(o=>o.accounts.length>0&&s.some(a=>a.id.toLowerCase()===o.connectorId.toLowerCase()));if(i){const[o]=i.accounts,a=s.find(c=>c.id.toLowerCase()===i.connectorId.toLowerCase());return{...i,account:o,connector:a}}return null}}let Bo=null;const os={getSIWX(){return V.state.siwx},async initializeIfEnabled(t=U.getActiveCaipAddress()){const e=V.state.siwx;if(!(e&&t))return;const[r,n,s]=t.split(":");if(U.checkIfSupportedNetwork(r,`${r}:${n}`))try{if(V.state.remoteFeatures?.emailCapture){const o=U.getAccountData(r)?.user;await Ce.open({view:"DataCapture",data:{email:o?.email??void 0}});return}if(Bo&&await Bo,(await e.getSessions(`${r}:${n}`,s)).length)return;await Ce.open({view:"SIWXSignMessage"})}catch(i){console.error("SIWXUtil:initializeIfEnabled",i),Se.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(i)}),await ie._getClient()?.disconnect().catch(console.error),me.reset("Connect"),Ts.showError("A problem occurred while trying initialize authentication")}},async isAuthenticated(t=U.getActiveCaipAddress()){if(!V.state.siwx||!t)return!0;const{chainNamespace:r,chainId:n,address:s}=or.parseCaipAddress(t),i=`${r}:${n}`;return(await os.getSessions({address:s,caipNetworkId:i})).length>0},async requestSignMessage(){const t=V.state.siwx,e=ue.getPlainAddress(U.getActiveCaipAddress()),r=Fh();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!r)throw new Error("No ActiveCaipNetwork or client found");try{const n=await t.createMessage({chainId:r.caipNetworkId,accountAddress:e}),s=n.toString();let i="";t.signMessage?i=await t.signMessage({message:s,chainId:r.caipNetworkId,accountAddress:e}):(Q.getConnectorId(r.chainNamespace)===X.CONNECTOR_ID.AUTH&&me.pushTransactionStack({}),i=await ie.signMessage(s)||""),await t.addSession({data:n,message:s,signature:i}),U.setLastConnectedSIWECaipNetwork(r),Ce.close(),Se.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(n){(!Ce.state.open||me.state.view==="ApproveTransaction")&&await Ce.open({view:"SIWXSignMessage"}),Ts.showError("Error signing message"),Se.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(n)}),console.error("SWIXUtil:requestSignMessage",n)}},async cancelSignMessage(){try{const t=this.getSIWX();if(t?.getRequired?.()){const r=U.getLastConnectedSIWECaipNetwork();if(r){const n=await t?.getSessions(r?.caipNetworkId,ue.getPlainAddress(U.getActiveCaipAddress())||"");n&&n.length>0?await U.switchActiveNetwork(r):await ie.disconnect()}else await ie.disconnect()}else Ce.close();Ce.close(),Se.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(t){console.error("SIWXUtil:cancelSignMessage",t)}},async getAllSessions(){const t=this.getSIWX(),e=U.getAllRequestedCaipNetworks(),r=[];return await Promise.all(e.map(async n=>{const s=await t?.getSessions(n.caipNetworkId,ue.getPlainAddress(U.getActiveCaipAddress())||"");s&&r.push(...s)})),r},async getSessions(t){const e=V.state.siwx;let r=t?.address;if(!r){const s=U.getActiveCaipAddress();r=ue.getPlainAddress(s)}let n=t?.caipNetworkId;return n||(n=U.getActiveCaipNetwork()?.caipNetworkId),e&&r&&n?e.getSessions(n,r):[]},async isSIWXCloseDisabled(){const t=this.getSIWX();if(t){const e=me.state.view==="ApproveTransaction",r=me.state.view==="SIWXSignMessage";if(e||r)return t.getRequired?.()&&(await this.getSessions()).length===0}return!1},async authConnectorAuthenticate({authConnector:t,chainId:e,socialUri:r,preferredAccountType:n,chainNamespace:s}){const i=os.getSIWX(),o=Fh();if(!i||!s.includes(X.CHAIN.EVM)||V.state.remoteFeatures?.emailCapture){const h=await t.connect({chainId:e,socialUri:r,preferredAccountType:n});return{address:h.address,chainId:h.chainId,accounts:h.accounts}}const a=`${s}:${e}`,c=await i.createMessage({chainId:a,accountAddress:"<<AccountAddress>>"}),l={accountAddress:c.accountAddress,chainId:c.chainId,domain:c.domain,uri:c.uri,version:c.version,nonce:c.nonce,notBefore:c.notBefore,statement:c.statement,resources:c.resources,requestId:c.requestId,issuedAt:c.issuedAt,expirationTime:c.expirationTime,serializedMessage:c.toString()},u=await t.connect({chainId:e,socialUri:r,siwxMessage:l,preferredAccountType:n});return l.accountAddress=u.address,l.serializedMessage=u.message||"",u.signature&&u.message&&await os.addEmbeddedWalletSession(l,u.message,u.signature),U.setLastConnectedSIWECaipNetwork(o),{address:u.address,chainId:u.chainId,accounts:u.accounts}},async addEmbeddedWalletSession(t,e,r){if(Bo)return Bo;const n=os.getSIWX();return n?(Bo=n.addSession({data:t,message:e,signature:r}).finally(()=>{Bo=null}),Bo):Promise.resolve()},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:r}){const n=os.getSIWX(),s=Fh(),i=new Set(e.map(l=>l.split(":")[0]));if(!n||i.size!==1||!i.has("eip155"))return!1;const o=await n.createMessage({chainId:Fh()?.caipNetworkId||"",accountAddress:""}),a=await t.authenticate({nonce:o.nonce,domain:o.domain,uri:o.uri,exp:o.expirationTime,iat:o.issuedAt,nbf:o.notBefore,requestId:o.requestId,version:o.version,resources:o.resources,statement:o.statement,chainId:o.chainId,methods:r,chains:[o.chainId,...e.filter(l=>l!==o.chainId)]});Ts.showLoading("Authenticating...",{autoClose:!1});const c={...a.session.peer.metadata,name:a.session.peer.metadata.name,icon:a.session.peer.metadata.icons?.[0],type:"WALLET_CONNECT"};if(U.setAccountProp("connectedWalletInfo",c,Array.from(i)[0]),a?.auths?.length){const l=a.auths.map(u=>{const h=t.client.formatAuthMessage({request:u.p,iss:u.p.iss});return{data:{...u.p,accountAddress:u.p.iss.split(":").slice(-1).join(""),chainId:u.p.iss.split(":").slice(2,4).join(":"),uri:u.p.aud,version:u.p.version||o.version,expirationTime:u.p.exp,issuedAt:u.p.iat,notBefore:u.p.nbf},message:h,signature:u.s.s,cacao:u}});try{await n.setSessions(l),s&&U.setLastConnectedSIWECaipNetwork(s),Se.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:os.getSIWXEventProperties()})}catch(u){throw console.error("SIWX:universalProviderAuth - failed to set sessions",u),Se.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:os.getSIWXEventProperties(u)}),await t.disconnect().catch(console.error),u}finally{Ts.hide()}}return!0},getSIWXEventProperties(t){const e=U.state.activeChain;if(!e)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:U.state.activeCaipNetwork?.caipNetworkId||"",isSmartAccount:Hn(e)===pi.ACCOUNT_TYPES.SMART_ACCOUNT,message:t?ue.parseError(t):void 0}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}};class yie{constructor({provider:e,namespace:r}){this.id=X.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=U.getCaipNetworks.bind(U),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=r}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const r=this.getCaipNetworks(),n=V.state.universalProviderConfigOverride,s=wo.createNamespaces(r,n);await this.provider.connect({optionalNamespaces:s})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(r=>r.caipNetworkId);return os.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:wie})}}const wie=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],es=it({message:"",variant:"info",open:!1}),bie={state:es,subscribeKey(t,e){return lr(es,t,e)},open(t,e){const{debug:r}=V.state,{code:n,displayMessage:s,debugMessage:i}=t;s&&r&&(es.message=s,es.variant=e,es.open=!0),i&&console.error(typeof i=="function"?i():i,n?{code:n}:void 0)},warn(t,e,r){es.open=!0,es.message=t,es.variant="warning",e&&console.warn(e,r)},close(){es.open=!1,es.message="",es.variant="info"}},dn=Kn(bie),vie={asset:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"},Eie={asset:"0x036CbD53842c5426634e7929541eC2318f3dCF7e"},ri={EIP155:X.CHAIN.EVM,CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH"},_ie={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200","00000008819873e925422c1ff0f99f7c":"b3406e4a-bbfc-44fb-e3a6-89673c78b700"}},Lu={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([r,n])=>{e[`${ri.EIP155}:${r}`]=n}),e},isLowerCaseMatch(t,e){return t?.toLowerCase()===e?.toLowerCase()},getActiveNamespaceConnectedToAuth(){const t=U.state.activeChain;return X.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(e=>Q.getConnectorId(e)===X.CONNECTOR_ID.AUTH&&e===t)},withRetry({conditionFn:t,intervalMs:e,maxRetries:r}){let n=0;return new Promise(s=>{async function i(){return n+=1,await t()?s(!0):n>=r?s(!1):(setTimeout(i,e),null)}i()})},userChainIdToChainNamespace(t){if(typeof t=="number")return X.CHAIN.EVM;const[e]=t.split(":");return e},getOtherAuthNamespaces(t){return t?X.AUTH_CONNECTOR_SUPPORTED_CHAINS.filter(n=>n!==t):[]},getConnectorStorageInfo(t,e){const n=J.getConnections()[e]??[];return{hasDisconnected:J.isConnectorDisconnected(t,e),hasConnected:n.some(s=>Lu.isLowerCaseMatch(s.connectorId,t))}}},Iie=new AbortController,Dn={EmbeddedWalletAbortController:Iie,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"ORIGIN_NOT_ALLOWED"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{code:"APKT001",displayMessage:"Network Not Found",debugMessage:"The specified network is not recognized. Please ensure it is included in the `networks` array of your `createAppKit` configuration."},ORIGIN_NOT_ALLOWED:{code:"APKT002",displayMessage:"Invalid App Configuration",debugMessage:()=>`The origin ${Nl()?window.origin:"unknown"} is not in your allow list. Please update your allowed domains at https://dashboard.reown.com. [PID: ${V.state.projectId}]`},IFRAME_LOAD_FAILED:{code:"APKT003",displayMessage:"Network Error: Wallet Load Failed",debugMessage:()=>"Failed to load the embedded wallet. This may be due to network issues or server downtime. Please check your network connection and try again shortly. Contact support if the issue persists."},IFRAME_REQUEST_TIMEOUT:{code:"APKT004",displayMessage:"Wallet Request Timeout",debugMessage:()=>"The request to the embedded wallet timed out. Please check your network connection and try again shortly. Contact support if the issue persists."},UNVERIFIED_DOMAIN:{code:"APKT005",displayMessage:"Unverified Domain",debugMessage:()=>"Embedded wallet load failed. Ensure your domain is verified in https://dashboard.reown.com."},JWT_TOKEN_NOT_VALID:{code:"APKT006",displayMessage:"Session Expired",debugMessage:"Your session is invalid or expired. Please check your systems date and time settings, then reconnect."},INVALID_PROJECT_ID:{code:"APKT007",displayMessage:"Invalid Project ID",debugMessage:"The specified project ID is invalid. Please visit https://dashboard.reown.com to obtain a valid project ID."},PROJECT_ID_NOT_CONFIGURED:{code:"APKT008",displayMessage:"Project ID Missing",debugMessage:"No project ID is configured. You can create and configure a project ID at https://dashboard.reown.com."},SERVER_ERROR_APP_CONFIGURATION:{code:"APKT009",displayMessage:"Server Error",debugMessage:t=>`Unable to fetch App Configuration. ${t}. Please check your network connection and try again shortly. Contact support if the issue persists.`},RATE_LIMITED_APP_CONFIGURATION:{code:"APKT010",displayMessage:"Rate Limited",debugMessage:"You have been rate limited while retrieving App Configuration. Please wait a few minutes and try again. Contact support if the issue persists."}},ALERT_WARNINGS:{LOCAL_CONFIGURATION_IGNORED:{debugMessage:t=>`[Reown Config Notice] ${t}`},INACTIVE_NAMESPACE_NOT_CONNECTED:{code:"APKTW001",displayMessage:"Inactive Namespace Not Connected",debugMessage:(t,e)=>`An error occurred while connecting an inactive namespace ${t}: "${e}"`},INVALID_EMAIL:{code:"APKTW002",displayMessage:"Invalid Email Address",debugMessage:"Please enter a valid email address"}}},cO={TOKEN_ADDRESSES_BY_SYMBOL:{USDC:{8453:vie.asset,84532:Eie.asset}},getTokenSymbolByAddress(t){if(!t)return;const[e]=Object.entries(cO.TOKEN_ADDRESSES_BY_SYMBOL).find(([r,n])=>Object.values(n).includes(t))??[];return e}};var Sl={exports:{}},BI;function Sie(){if(BI)return Sl.exports;BI=1;const t=Xw();Sl.exports=u;const e=T().console||{},r={mapHttpRequest:P,mapHttpResponse:P,wrapRequestSerializer:R,wrapResponseSerializer:R,wrapErrorSerializer:R,req:P,res:P,err:C,errWithCause:C};function n(f,y){return f==="silent"?1/0:y.levels.values[f]}const s=Symbol("pino.logFuncs"),i=Symbol("pino.hierarchy"),o={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function a(f,y){const E={logger:y,parent:f[i]};y[i]=E}function c(f,y,E){const x={};y.forEach(_=>{x[_]=E[_]?E[_]:e[_]||e[o[_]||"log"]||O}),f[s]=x}function l(f,y){return Array.isArray(f)?f.filter(function(x){return x!=="!stdSerializers.err"}):f===!0?Object.keys(y):!1}function u(f){f=f||{},f.browser=f.browser||{};const y=f.browser.transmit;if(y&&typeof y.send!="function")throw Error("pino: transmit option must have a send function");const E=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const x=f.serializers||{},_=l(f.browser.serialize,x);let A=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(A=!1);const L=Object.keys(f.customLevels||{}),B=["error","fatal","warn","info","debug","trace"].concat(L);typeof E=="function"&&B.forEach(function(G){E[G]=E}),(f.enabled===!1||f.browser.disabled)&&(f.level="silent");const q=f.level||"info",D=Object.create(E);D.log||(D.log=O),c(D,B,E),a({},D),Object.defineProperty(D,"levelVal",{get:H}),Object.defineProperty(D,"level",{get:W,set:ee});const F={transmit:y,serialize:_,asObject:f.browser.asObject,asObjectBindingsOnly:f.browser.asObjectBindingsOnly,formatters:f.browser.formatters,levels:B,timestamp:N(f),messageKey:f.messageKey||"msg",onChild:f.onChild||O};D.levels=h(f),D.level=q,D.isLevelEnabled=function(G){return this.levels.values[G]?this.levels.values[G]>=this.levels.values[this.level]:!1},D.setMaxListeners=D.getMaxListeners=D.emit=D.addListener=D.on=D.prependListener=D.once=D.prependOnceListener=D.removeListener=D.removeAllListeners=D.listeners=D.listenerCount=D.eventNames=D.write=D.flush=O,D.serializers=x,D._serialize=_,D._stdErrSerialize=A,D.child=function(...G){return K.call(this,F,...G)},y&&(D._logEvent=b());function H(){return n(this.level,this)}function W(){return this._level}function ee(G){if(G!=="silent"&&!this.levels.values[G])throw Error("unknown level "+G);this._level=G,g(this,F,D,"error"),g(this,F,D,"fatal"),g(this,F,D,"warn"),g(this,F,D,"info"),g(this,F,D,"debug"),g(this,F,D,"trace"),L.forEach(le=>{g(this,F,D,le)})}function K(G,le,ye){if(!le)throw new Error("missing bindings for child Pino");ye=ye||{},_&&le.serializers&&(ye.serializers=le.serializers);const ve=ye.serializers;if(_&&ve){var Ee=Object.assign({},x,ve),Ke=f.browser.serialize===!0?Object.keys(Ee):_;delete le.serializers,S([le],Ke,Ee,this._stdErrSerialize)}function gr(mr){this._childLevel=(mr._childLevel|0)+1,this.bindings=le,Ee&&(this.serializers=Ee,this._serialize=Ke),y&&(this._logEvent=b([].concat(mr._logEvent.bindings,le)))}gr.prototype=this;const Ot=new gr(this);return a(this,Ot),Ot.child=function(...mr){return K.call(this,G,...mr)},Ot.level=ye.level||this.level,G.onChild(Ot),Ot}return D}function h(f){const y=f.customLevels||{},E=Object.assign({},u.levels.values,y),x=Object.assign({},u.levels.labels,d(y));return{values:E,labels:x}}function d(f){const y={};return Object.keys(f).forEach(function(E){y[f[E]]=E}),y}u.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},u.stdSerializers=r,u.stdTimeFunctions=Object.assign({},{nullTime:M,epochTime:j,unixTime:k,isoTime:$});function p(f){const y=[];f.bindings&&y.push(f.bindings);let E=f[i];for(;E.parent;)E=E.parent,E.logger.bindings&&y.push(E.logger.bindings);return y.reverse()}function g(f,y,E,x){if(Object.defineProperty(f,x,{value:n(f.level,E)>n(x,E)?O:E[s][x],writable:!0,enumerable:!0,configurable:!0}),f[x]===O){if(!y.transmit)return;const A=y.transmit.level||f.level,L=n(A,E);if(n(x,E)<L)return}f[x]=w(f,y,E,x);const _=p(f);_.length!==0&&(f[x]=m(_,f[x]))}function m(f,y){return function(){return y.apply(this,[...f,...arguments])}}function w(f,y,E,x){return(function(_){return function(){const L=y.timestamp(),B=new Array(arguments.length),q=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var D=0;D<B.length;D++)B[D]=arguments[D];var F=!1;if(y.serialize&&(S(B,this._serialize,this.serializers,this._stdErrSerialize),F=!0),y.asObject||y.formatters?_.call(q,...I(this,x,B,L,y)):_.apply(q,B),y.transmit){const H=y.transmit.level||f._level,W=n(H,E),ee=n(x,E);if(ee<W)return;v(this,{ts:L,methodLevel:x,methodValue:ee,transmitValue:E.levels.values[y.transmit.level||f._level],send:y.transmit.send,val:n(f._level,E)},B,F)}}})(f[s][x])}function I(f,y,E,x,_){const{level:A,log:L=H=>H}=_.formatters||{},B=E.slice();let q=B[0];const D={};let F=(f._childLevel|0)+1;if(F<1&&(F=1),x&&(D.time=x),A){const H=A(y,f.levels.values[y]);Object.assign(D,H)}else D.level=f.levels.values[y];if(_.asObjectBindingsOnly){if(q!==null&&typeof q=="object")for(;F--&&typeof B[0]=="object";)Object.assign(D,B.shift());return[L(D),...B]}else{if(q!==null&&typeof q=="object"){for(;F--&&typeof B[0]=="object";)Object.assign(D,B.shift());q=B.length?t(B.shift(),B):void 0}else typeof q=="string"&&(q=t(B.shift(),B));return q!==void 0&&(D[_.messageKey]=q),[L(D)]}}function S(f,y,E,x){for(const _ in f)if(x&&f[_]instanceof Error)f[_]=u.stdSerializers.err(f[_]);else if(typeof f[_]=="object"&&!Array.isArray(f[_])&&y)for(const A in f[_])y.indexOf(A)>-1&&A in E&&(f[_][A]=E[A](f[_][A]))}function v(f,y,E,x=!1){const _=y.send,A=y.ts,L=y.methodLevel,B=y.methodValue,q=y.val,D=f._logEvent.bindings;x||S(E,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=A,f._logEvent.messages=E.filter(function(F){return D.indexOf(F)===-1}),f._logEvent.level.label=L,f._logEvent.level.value=B,_(L,f._logEvent,q),f._logEvent=b(D)}function b(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function C(f){const y={type:f.constructor.name,msg:f.message,stack:f.stack};for(const E in f)y[E]===void 0&&(y[E]=f[E]);return y}function N(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?M:j}function P(){return{}}function R(f){return f}function O(){}function M(){return!1}function j(){return Date.now()}function k(){return Math.round(Date.now()/1e3)}function $(){return new Date(Date.now()).toISOString()}function T(){function f(y){return typeof y<"u"&&y}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return Sl.exports.default=u,Sl.exports.pino=u,Sl.exports}var nc=Sie();const lO=zu(nc),Cie={level:"info"},db=1e3*1024;var xie=Object.defineProperty,Aie=(t,e,r)=>e in t?xie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lo=(t,e,r)=>Aie(t,typeof e!="symbol"?e+"":e,r);let $ie=class{constructor(e){lo(this,"nodeValue"),lo(this,"sizeInBytes"),lo(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},LI=class{constructor(e){lo(this,"lengthInNodes"),lo(this,"sizeInBytes"),lo(this,"head"),lo(this,"tail"),lo(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new $ie(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};var Nie=Object.defineProperty,Oie=(t,e,r)=>e in t?Nie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sd=(t,e,r)=>Oie(t,typeof e!="symbol"?e+"":e,r);let uO=class{constructor(e,r=db){sd(this,"logs"),sd(this,"level"),sd(this,"levelValue"),sd(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=nc.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new LI(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===nc.levels.values.error?console.error(e):r===nc.levels.values.warn?console.warn(e):r===nc.levels.values.debug?console.debug(e):r===nc.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Br({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new LI(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Br({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var Tie=Object.defineProperty,kie=(t,e,r)=>e in t?Tie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pie=(t,e,r)=>kie(t,e+"",r);let Rie=class{constructor(e,r=db){Pie(this,"baseChunkLogger"),this.baseChunkLogger=new uO(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var Die=Object.defineProperty,Uie=(t,e,r)=>e in t?Die(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bie=(t,e,r)=>Uie(t,e+"",r);let Lie=class{constructor(e,r=db){Bie(this,"baseChunkLogger"),this.baseChunkLogger=new uO(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Mie=Object.defineProperty,jie=Object.defineProperties,Fie=Object.getOwnPropertyDescriptors,MI=Object.getOwnPropertySymbols,qie=Object.prototype.hasOwnProperty,zie=Object.prototype.propertyIsEnumerable,jI=(t,e,r)=>e in t?Mie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sf=(t,e)=>{for(var r in e||(e={}))qie.call(e,r)&&jI(t,r,e[r]);if(MI)for(var r of MI(e))zie.call(e,r)&&jI(t,r,e[r]);return t},Cf=(t,e)=>jie(t,Fie(e));function Hie(t){return Cf(Sf({},t),{level:t?.level||Cie.level})}function Vie(t){var e,r;const n=new Rie((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:lO(Cf(Sf({},t.opts),{level:"trace",browser:Cf(Sf({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function Wie(t){var e;const r=new Lie((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:lO(Cf(Sf({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function Kie(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Vie(t):Wie(t)}const Gie={createLogger(t,e="error"){const r=Hie({level:e}),{logger:n}=Kie({opts:r});return n.error=(...s)=>{for(const i of s)if(i instanceof Error){t(i,...s);return}t(void 0,...s)},n}},Yie="rpc.walletconnect.org";function FI(t,e){const r=new URL("https://rpc.walletconnect.org/v1/");return r.searchParams.set("chainId",t),r.searchParams.set("projectId",e),r.toString()}const $m=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","eip155:80094","eip155:80069","eip155:560048","eip155:31","eip155:2818","eip155:57054","eip155:911867","eip155:534351","eip155:1112","eip155:534352","eip155:1111","eip155:146","eip155:130","eip155:1284","eip155:30","eip155:2810","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],sc={extendRpcUrlWithProjectId(t,e){let r=!1;try{r=new URL(t).host===Yie}catch{r=!1}if(r){const n=new URL(t);return n.searchParams.has("projectId")||n.searchParams.set("projectId",e),n.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:X.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${X.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,r){const n=t.rpcUrls?.default?.http?.[0];return $m.includes(e)?FI(e,r):n||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:r,customRpcUrls:n}){const s=this.getChainNamespace(t),i=this.getCaipNetworkId(t),o=t.rpcUrls?.default?.http?.[0],a=this.getDefaultRpcUrl(t,i,r),c=t?.rpcUrls?.chainDefault?.http?.[0]||o,l=n?.[i]?.map(d=>d.url)||[],u=[...l,...a?[a]:[]],h=[...l];return c&&!h.includes(c)&&h.push(c),{...t,chainNamespace:s,caipNetworkId:i,assets:{imageId:_ie.NetworkImageIds[t.id],imageUrl:e?.[t.id]},rpcUrls:{...t.rpcUrls,default:{http:u},chainDefault:{http:h}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:r,customRpcUrls:n}){return t.map(s=>sc.extendCaipNetwork(s,{customNetworkImageUrls:e,customRpcUrls:n,projectId:r}))},getViemTransport(t,e,r){const n=[];return r?.forEach(s=>{n.push(jh(s.url,s.config))}),$m.includes(t.caipNetworkId)&&n.push(jh(FI(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),t?.rpcUrls?.default?.http?.forEach(s=>{n.push(jh(s))}),a_(n)},extendWagmiTransports(t,e,r){if($m.includes(t.caipNetworkId)){const n=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return a_([r,jh(n)])}return r},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:X.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){const e=J.getActiveCaipNetworkId(),r=U.getAllRequestedCaipNetworks(),n=Array.from(U.state.chains?.keys()||[]),s=e?.split(":")[0],i=s?n.includes(s):!1,o=r?.find(c=>c.caipNetworkId===e);return i&&!o&&e?this.getUnsupportedNetwork(e):o||t||r?.[0]}},Zie={ACCOUNT_TABS:[{label:"Tokens"},{label:"Activity"}],VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120},VIEWS_WITH_LEGAL_FOOTER:["Connect","ConnectWallets","OnRampTokenSelect","OnRampFiatSelect","OnRampProviders"],VIEWS_WITH_DEFAULT_FOOTER:["Networks"]},Pl={filterOutDuplicatesByRDNS(t){const e=V.state.enableEIP6963?Q.state.connectors:[],r=J.getRecentWallets(),n=e.map(a=>a.info?.rdns).filter(Boolean),s=r.map(a=>a.rdns).filter(Boolean),i=n.concat(s);if(i.includes("io.metamask.mobile")&&ue.isMobile()){const a=i.indexOf("io.metamask.mobile");i[a]="io.metamask"}return t.filter(a=>!(a?.rdns&&i.includes(String(a.rdns))||!a?.rdns&&e.some(l=>l.name===a.name)))},filterOutDuplicatesByIds(t){const e=Q.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"),r=J.getRecentWallets(),n=e.map(a=>a.explorerId),s=r.map(a=>a.id),i=n.concat(s);return t.filter(a=>!i.includes(a?.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=Q.state,{featuredWalletIds:r}=V.state,n=e.filter(o=>o.type==="ANNOUNCED").reduce((o,a)=>(a.info?.rdns&&(o[a.info.rdns]=!0),o),{});return t.map(o=>({...o,installed:!!o.rdns&&!!n[o.rdns??""]})).sort((o,a)=>{const c=Number(a.installed)-Number(o.installed);if(c!==0)return c;if(r?.length){const l=r.indexOf(o.id),u=r.indexOf(a.id);if(l!==-1&&u!==-1)return l-u;if(l!==-1)return-1;if(u!==-1)return 1}return 0})},getConnectOrderMethod(t,e){const r=t?.connectMethodsOrder||V.state.features?.connectMethodsOrder,n=e||Q.state.connectors;if(r)return r;const{injected:s,announced:i}=Nm.getConnectorsByType(n,de.state.recommended,de.state.featured),o=s.filter(Nm.showConnector),a=i.filter(Nm.showConnector);return o.length||a.length?["wallet","email","social"]:Zie.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&de.state.excludedWallets.some(n=>n.rdns===t.rdns),r=!!t.name&&de.state.excludedWallets.some(n=>Lu.isLowerCaseMatch(n.name,t.name));return e||r},markWalletsWithDisplayIndex(t){return t.map((e,r)=>({...e,display_index:r}))}},Nm={getConnectorsByType(t,e,r){const{customWallets:n}=V.state,s=J.getRecentWallets(),i=Pl.filterOutDuplicateWallets(e),o=Pl.filterOutDuplicateWallets(r),a=t.filter(h=>h.type==="MULTI_CHAIN"),c=t.filter(h=>h.type==="ANNOUNCED"),l=t.filter(h=>h.type==="INJECTED"),u=t.filter(h=>h.type==="EXTERNAL");return{custom:n,recent:s,external:u,multiChain:a,announced:c,injected:l,recommended:i,featured:o}},showConnector(t){const e=t.info?.rdns,r=!!e&&de.state.excludedWallets.some(s=>!!s.rdns&&s.rdns===e),n=!!t.name&&de.state.excludedWallets.some(s=>Lu.isLowerCaseMatch(s.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!ue.isMobile()||ue.isMobile()&&!e&&!ie.checkInstalled())||r||n)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(r||n))},getIsConnectedWithWC(){return Array.from(U.state.chains.values()).some(r=>Q.getConnectorId(r.namespace)===X.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:r,recent:n,announced:s,injected:i,multiChain:o,external:a,overriddenConnectors:c=V.state.features?.connectorTypeOrder??[]}){const u=[{type:"walletConnect",isEnabled:!0},{type:"recent",isEnabled:n.length>0},{type:"injected",isEnabled:[...i,...s,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:r&&r.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(g=>g.isEnabled),h=new Set(u.map(g=>g.type)),d=c.filter(g=>h.has(g)).map(g=>({type:g,isEnabled:!0})),p=u.filter(({type:g})=>!d.some(({type:w})=>w===g));return Array.from(new Set([...d,...p].map(({type:g})=>g)))},sortConnectorsByExplorerWallet(t){return[...t].sort((e,r)=>e.explorerWallet&&r.explorerWallet?(e.explorerWallet.order??0)-(r.explorerWallet.order??0):e.explorerWallet?-1:r.explorerWallet?1:0)},getAuthName({email:t,socialUsername:e,socialProvider:r}){return e?r&&r==="discord"&&e.endsWith("0")?e.slice(0,-1):e:t.length>30?`${t.slice(0,-3)}...`:t},async fetchProviderData(t){try{if(t.name==="Browser Wallet"&&!ue.isMobile())return{accounts:[],chainId:void 0};if(t.id===X.CONNECTOR_ID.AUTH)return{accounts:[],chainId:void 0};const[e,r]=await Promise.all([t.provider?.request({method:"eth_accounts"}),t.provider?.request({method:"eth_chainId"}).then(n=>Number(n))]);return{accounts:e,chainId:r}}catch(e){return console.warn(`Failed to fetch provider data for ${t.name}`,e),{accounts:[],chainId:void 0}}},getFilteredCustomWallets(t){const e=J.getRecentWallets(),r=Q.state.connectors.map(o=>o.info?.rdns).filter(Boolean),n=e.map(o=>o.rdns).filter(Boolean),s=r.concat(n);if(s.includes("io.metamask.mobile")&&ue.isMobile()){const o=s.indexOf("io.metamask.mobile");s[o]="io.metamask"}return t.filter(o=>!s.includes(String(o?.rdns)))},hasWalletConnector(t){return Q.state.connectors.some(e=>e.id===t.id||e.name===t.name)},isWalletCompatibleWithCurrentChain(t){const e=U.state.activeChain;return e&&t.chains?t.chains.some(r=>{const n=r.split(":")[0];return e===n}):!0},getFilteredRecentWallets(){return J.getRecentWallets().filter(r=>!Pl.isExcluded(r)).filter(r=>!this.hasWalletConnector(r)).filter(r=>this.isWalletCompatibleWithCurrentChain(r))},getCappedRecommendedWallets(t){const{connectors:e}=Q.state,{customWallets:r,featuredWalletIds:n}=V.state,s=e.find(S=>S.id==="walletConnect"),i=e.filter(S=>S.type==="INJECTED"||S.type==="ANNOUNCED"||S.type==="MULTI_CHAIN");if(!s&&!i.length&&!r?.length)return[];const o=Vy.isEmailEnabled(),a=Vy.isSocialsEnabled(),c=i.filter(S=>S.name!=="Browser Wallet"),l=n?.length||0,u=r?.length||0,h=c.length||0,d=o?1:0,p=a?1:0,g=l+u+h+d+p,w=Math.max(0,4-g);return w<=0?[]:Pl.filterOutDuplicateWallets(t).slice(0,w)}};const Ad=globalThis,fb=Ad.ShadowRoot&&(Ad.ShadyCSS===void 0||Ad.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,pb=Symbol(),qI=new WeakMap;let hO=class{constructor(e,r,n){if(this._$cssResult$=!0,n!==pb)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=r}get styleSheet(){let e=this.o;const r=this.t;if(fb&&e===void 0){const n=r!==void 0&&r.length===1;n&&(e=qI.get(r)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&qI.set(r,e))}return e}toString(){return this.cssText}};const is=t=>new hO(typeof t=="string"?t:t+"",void 0,pb),uo=(t,...e)=>{const r=t.length===1?t[0]:e.reduce(((n,s,i)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[i+1]),t[0]);return new hO(r,t,pb)},Jie=(t,e)=>{if(fb)t.adoptedStyleSheets=e.map((r=>r instanceof CSSStyleSheet?r:r.styleSheet));else for(const r of e){const n=document.createElement("style"),s=Ad.litNonce;s!==void 0&&n.setAttribute("nonce",s),n.textContent=r.cssText,t.appendChild(n)}},zI=fb?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let r="";for(const n of e.cssRules)r+=n.cssText;return is(r)})(t):t;const{is:Xie,defineProperty:Qie,getOwnPropertyDescriptor:eoe,getOwnPropertyNames:toe,getOwnPropertySymbols:roe,getPrototypeOf:noe}=Object,Ip=globalThis,HI=Ip.trustedTypes,soe=HI?HI.emptyScript:"",ioe=Ip.reactiveElementPolyfillSupport,Kl=(t,e)=>t,Tw={toAttribute(t,e){switch(e){case Boolean:t=t?soe:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let r=t;switch(e){case Boolean:r=t!==null;break;case Number:r=t===null?null:Number(t);break;case Object:case Array:try{r=JSON.parse(t)}catch{r=null}}return r}},dO=(t,e)=>!Xie(t,e),VI={attribute:!0,type:String,converter:Tw,reflect:!1,useDefault:!1,hasChanged:dO};Symbol.metadata??=Symbol("metadata"),Ip.litPropertyMetadata??=new WeakMap;let ic=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,r=VI){if(r.state&&(r.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((r=Object.create(r)).wrapped=!0),this.elementProperties.set(e,r),!r.noAccessor){const n=Symbol(),s=this.getPropertyDescriptor(e,n,r);s!==void 0&&Qie(this.prototype,e,s)}}static getPropertyDescriptor(e,r,n){const{get:s,set:i}=eoe(this.prototype,e)??{get(){return this[r]},set(o){this[r]=o}};return{get:s,set(o){const a=s?.call(this);i?.call(this,o),this.requestUpdate(e,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??VI}static _$Ei(){if(this.hasOwnProperty(Kl("elementProperties")))return;const e=noe(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Kl("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Kl("properties"))){const r=this.properties,n=[...toe(r),...roe(r)];for(const s of n)this.createProperty(s,r[s])}const e=this[Symbol.metadata];if(e!==null){const r=litPropertyMetadata.get(e);if(r!==void 0)for(const[n,s]of r)this.elementProperties.set(n,s)}this._$Eh=new Map;for(const[r,n]of this.elementProperties){const s=this._$Eu(r,n);s!==void 0&&this._$Eh.set(s,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const r=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const s of n)r.unshift(zI(s))}else e!==void 0&&r.push(zI(e));return r}static _$Eu(e,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,r=this.constructor.elementProperties;for(const n of r.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Jie(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,r,n){this._$AK(e,n)}_$ET(e,r){const n=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,n);if(s!==void 0&&n.reflect===!0){const i=(n.converter?.toAttribute!==void 0?n.converter:Tw).toAttribute(r,n.type);this._$Em=e,i==null?this.removeAttribute(s):this.setAttribute(s,i),this._$Em=null}}_$AK(e,r){const n=this.constructor,s=n._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const i=n.getPropertyOptions(s),o=typeof i.converter=="function"?{fromAttribute:i.converter}:i.converter?.fromAttribute!==void 0?i.converter:Tw;this._$Em=s;const a=o.fromAttribute(r,i.type);this[s]=a??this._$Ej?.get(s)??a,this._$Em=null}}requestUpdate(e,r,n){if(e!==void 0){const s=this.constructor,i=this[e];if(n??=s.getPropertyOptions(e),!((n.hasChanged??dO)(i,r)||n.useDefault&&n.reflect&&i===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,n))))return;this.C(e,r,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,r,{useDefault:n,reflect:s,wrapped:i},o){n&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,o??r??this[e]),i!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||n||(r=void 0),this._$AL.set(e,r)),s===!0&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[s,i]of this._$Ep)this[s]=i;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[s,i]of n){const{wrapped:o}=i,a=this[s];o!==!0||this._$AL.has(s)||a===void 0||this.C(s,void 0,i,a)}}let e=!1;const r=this._$AL;try{e=this.shouldUpdate(r),e?(this.willUpdate(r),this._$EO?.forEach((n=>n.hostUpdate?.())),this.update(r)):this._$EM()}catch(n){throw e=!1,this._$EM(),n}e&&this._$AE(r)}willUpdate(e){}_$AE(e){this._$EO?.forEach((r=>r.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((r=>this._$ET(r,this[r]))),this._$EM()}updated(e){}firstUpdated(e){}};ic.elementStyles=[],ic.shadowRootOptions={mode:"open"},ic[Kl("elementProperties")]=new Map,ic[Kl("finalized")]=new Map,ioe?.({ReactiveElement:ic}),(Ip.reactiveElementVersions??=[]).push("2.1.1");const gb=globalThis,xf=gb.trustedTypes,WI=xf?xf.createPolicy("lit-html",{createHTML:t=>t}):void 0,fO="$lit$",ho=`lit$${Math.random().toFixed(9).slice(2)}$`,pO="?"+ho,ooe=`<${pO}>`,Ca=document,Mu=()=>Ca.createComment(""),ju=t=>t===null||typeof t!="object"&&typeof t!="function",mb=Array.isArray,aoe=t=>mb(t)||typeof t?.[Symbol.iterator]=="function",Om=`[ 	
\f\r]`,Cl=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,KI=/-->/g,GI=/>/g,Lo=RegExp(`>|${Om}(?:([^\\s"'>=/]+)(${Om}*=${Om}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),YI=/'/g,ZI=/"/g,gO=/^(?:script|style|textarea|title)$/i,mO=t=>(e,...r)=>({_$litType$:t,strings:e,values:r}),qle=mO(1),zle=mO(2),Lc=Symbol.for("lit-noChange"),Yt=Symbol.for("lit-nothing"),JI=new WeakMap,ca=Ca.createTreeWalker(Ca,129);function yO(t,e){if(!mb(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return WI!==void 0?WI.createHTML(e):e}const coe=(t,e)=>{const r=t.length-1,n=[];let s,i=e===2?"<svg>":e===3?"<math>":"",o=Cl;for(let a=0;a<r;a++){const c=t[a];let l,u,h=-1,d=0;for(;d<c.length&&(o.lastIndex=d,u=o.exec(c),u!==null);)d=o.lastIndex,o===Cl?u[1]==="!--"?o=KI:u[1]!==void 0?o=GI:u[2]!==void 0?(gO.test(u[2])&&(s=RegExp("</"+u[2],"g")),o=Lo):u[3]!==void 0&&(o=Lo):o===Lo?u[0]===">"?(o=s??Cl,h=-1):u[1]===void 0?h=-2:(h=o.lastIndex-u[2].length,l=u[1],o=u[3]===void 0?Lo:u[3]==='"'?ZI:YI):o===ZI||o===YI?o=Lo:o===KI||o===GI?o=Cl:(o=Lo,s=void 0);const p=o===Lo&&t[a+1].startsWith("/>")?" ":"";i+=o===Cl?c+ooe:h>=0?(n.push(l),c.slice(0,h)+fO+c.slice(h)+ho+p):c+ho+(h===-2?a:p)}return[yO(t,i+(t[r]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),n]};class Fu{constructor({strings:e,_$litType$:r},n){let s;this.parts=[];let i=0,o=0;const a=e.length-1,c=this.parts,[l,u]=coe(e,r);if(this.el=Fu.createElement(l,n),ca.currentNode=this.el.content,r===2||r===3){const h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(s=ca.nextNode())!==null&&c.length<a;){if(s.nodeType===1){if(s.hasAttributes())for(const h of s.getAttributeNames())if(h.endsWith(fO)){const d=u[o++],p=s.getAttribute(h).split(ho),g=/([.?@])?(.*)/.exec(d);c.push({type:1,index:i,name:g[2],strings:p,ctor:g[1]==="."?uoe:g[1]==="?"?hoe:g[1]==="@"?doe:Sp}),s.removeAttribute(h)}else h.startsWith(ho)&&(c.push({type:6,index:i}),s.removeAttribute(h));if(gO.test(s.tagName)){const h=s.textContent.split(ho),d=h.length-1;if(d>0){s.textContent=xf?xf.emptyScript:"";for(let p=0;p<d;p++)s.append(h[p],Mu()),ca.nextNode(),c.push({type:2,index:++i});s.append(h[d],Mu())}}}else if(s.nodeType===8)if(s.data===pO)c.push({type:2,index:i});else{let h=-1;for(;(h=s.data.indexOf(ho,h+1))!==-1;)c.push({type:7,index:i}),h+=ho.length-1}i++}}static createElement(e,r){const n=Ca.createElement("template");return n.innerHTML=e,n}}function Mc(t,e,r=t,n){if(e===Lc)return e;let s=n!==void 0?r._$Co?.[n]:r._$Cl;const i=ju(e)?void 0:e._$litDirective$;return s?.constructor!==i&&(s?._$AO?.(!1),i===void 0?s=void 0:(s=new i(t),s._$AT(t,r,n)),n!==void 0?(r._$Co??=[])[n]=s:r._$Cl=s),s!==void 0&&(e=Mc(t,s._$AS(t,e.values),s,n)),e}class loe{constructor(e,r){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:r},parts:n}=this._$AD,s=(e?.creationScope??Ca).importNode(r,!0);ca.currentNode=s;let i=ca.nextNode(),o=0,a=0,c=n[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new gh(i,i.nextSibling,this,e):c.type===1?l=new c.ctor(i,c.name,c.strings,this,e):c.type===6&&(l=new foe(i,this,e)),this._$AV.push(l),c=n[++a]}o!==c?.index&&(i=ca.nextNode(),o++)}return ca.currentNode=Ca,s}p(e){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,r),r+=n.strings.length-2):n._$AI(e[r])),r++}}class gh{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,r,n,s){this.type=2,this._$AH=Yt,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=n,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&e?.nodeType===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=Mc(this,e,r),ju(e)?e===Yt||e==null||e===""?(this._$AH!==Yt&&this._$AR(),this._$AH=Yt):e!==this._$AH&&e!==Lc&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):aoe(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Yt&&ju(this._$AH)?this._$AA.nextSibling.data=e:this.T(Ca.createTextNode(e)),this._$AH=e}$(e){const{values:r,_$litType$:n}=e,s=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Fu.createElement(yO(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===s)this._$AH.p(r);else{const i=new loe(s,this),o=i.u(this.options);i.p(r),this.T(o),this._$AH=i}}_$AC(e){let r=JI.get(e.strings);return r===void 0&&JI.set(e.strings,r=new Fu(e)),r}k(e){mb(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,s=0;for(const i of e)s===r.length?r.push(n=new gh(this.O(Mu()),this.O(Mu()),this,this.options)):n=r[s],n._$AI(i),s++;s<r.length&&(this._$AR(n&&n._$AB.nextSibling,s),r.length=s)}_$AR(e=this._$AA.nextSibling,r){for(this._$AP?.(!1,!0,r);e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}}class Sp{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,r,n,s,i){this.type=1,this._$AH=Yt,this._$AN=void 0,this.element=e,this.name=r,this._$AM=s,this.options=i,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Yt}_$AI(e,r=this,n,s){const i=this.strings;let o=!1;if(i===void 0)e=Mc(this,e,r,0),o=!ju(e)||e!==this._$AH&&e!==Lc,o&&(this._$AH=e);else{const a=e;let c,l;for(e=i[0],c=0;c<i.length-1;c++)l=Mc(this,a[n+c],r,c),l===Lc&&(l=this._$AH[c]),o||=!ju(l)||l!==this._$AH[c],l===Yt?e=Yt:e!==Yt&&(e+=(l??"")+i[c+1]),this._$AH[c]=l}o&&!s&&this.j(e)}j(e){e===Yt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class uoe extends Sp{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Yt?void 0:e}}class hoe extends Sp{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Yt)}}class doe extends Sp{constructor(e,r,n,s,i){super(e,r,n,s,i),this.type=5}_$AI(e,r=this){if((e=Mc(this,e,r,0)??Yt)===Lc)return;const n=this._$AH,s=e===Yt&&n!==Yt||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==Yt&&(n===Yt||s);s&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class foe{constructor(e,r,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Mc(this,e)}}const poe=gb.litHtmlPolyfillSupport;poe?.(Fu,gh),(gb.litHtmlVersions??=[]).push("3.3.1");const goe=(t,e,r)=>{const n=r?.renderBefore??e;let s=n._$litPart$;if(s===void 0){const i=r?.renderBefore??null;n._$litPart$=s=new gh(e.insertBefore(Mu(),i),i,void 0,r??{})}return s._$AI(t),s};const yb=globalThis;class $d extends ic{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=goe(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Lc}}$d._$litElement$=!0,$d.finalized=!0,yb.litElementHydrateSupport?.({LitElement:$d});const moe=yb.litElementPolyfillSupport;moe?.({LitElement:$d});(yb.litElementVersions??=[]).push("4.2.1");const yoe={black:"#202020",white:"#FFFFFF",white010:"rgba(255, 255, 255, 0.1)",accent010:"rgba(9, 136, 240, 0.1)",accent020:"rgba(9, 136, 240, 0.2)",accent030:"rgba(9, 136, 240, 0.3)",accent040:"rgba(9, 136, 240, 0.4)",accent050:"rgba(9, 136, 240, 0.5)",accent060:"rgba(9, 136, 240, 0.6)",accent070:"rgba(9, 136, 240, 0.7)",accent080:"rgba(9, 136, 240, 0.8)",accent090:"rgba(9, 136, 240, 0.9)",accent100:"rgba(9, 136, 240, 1.0)",accentSecondary010:"rgba(199, 185, 148, 0.1)",accentSecondary020:"rgba(199, 185, 148, 0.2)",accentSecondary030:"rgba(199, 185, 148, 0.3)",accentSecondary040:"rgba(199, 185, 148, 0.4)",accentSecondary050:"rgba(199, 185, 148, 0.5)",accentSecondary060:"rgba(199, 185, 148, 0.6)",accentSecondary070:"rgba(199, 185, 148, 0.7)",accentSecondary080:"rgba(199, 185, 148, 0.8)",accentSecondary090:"rgba(199, 185, 148, 0.9)",accentSecondary100:"rgba(199, 185, 148, 1.0)",productWalletKit:"#FFB800",productAppKit:"#FF573B",productCloud:"#0988F0",productDocumentation:"#008847",neutrals050:"#F6F6F6",neutrals100:"#F3F3F3",neutrals200:"#E9E9E9",neutrals300:"#D0D0D0",neutrals400:"#BBB",neutrals500:"#9A9A9A",neutrals600:"#6C6C6C",neutrals700:"#4F4F4F",neutrals800:"#363636",neutrals900:"#2A2A2A",neutrals1000:"#252525",semanticSuccess010:"rgba(48, 164, 107, 0.1)",semanticSuccess020:"rgba(48, 164, 107, 0.2)",semanticSuccess030:"rgba(48, 164, 107, 0.3)",semanticSuccess040:"rgba(48, 164, 107, 0.4)",semanticSuccess050:"rgba(48, 164, 107, 0.5)",semanticSuccess060:"rgba(48, 164, 107, 0.6)",semanticSuccess070:"rgba(48, 164, 107, 0.7)",semanticSuccess080:"rgba(48, 164, 107, 0.8)",semanticSuccess090:"rgba(48, 164, 107, 0.9)",semanticSuccess100:"rgba(48, 164, 107, 1.0)",semanticError010:"rgba(223, 74, 52, 0.1)",semanticError020:"rgba(223, 74, 52, 0.2)",semanticError030:"rgba(223, 74, 52, 0.3)",semanticError040:"rgba(223, 74, 52, 0.4)",semanticError050:"rgba(223, 74, 52, 0.5)",semanticError060:"rgba(223, 74, 52, 0.6)",semanticError070:"rgba(223, 74, 52, 0.7)",semanticError080:"rgba(223, 74, 52, 0.8)",semanticError090:"rgba(223, 74, 52, 0.9)",semanticError100:"rgba(223, 74, 52, 1.0)",semanticWarning010:"rgba(243, 161, 63, 0.1)",semanticWarning020:"rgba(243, 161, 63, 0.2)",semanticWarning030:"rgba(243, 161, 63, 0.3)",semanticWarning040:"rgba(243, 161, 63, 0.4)",semanticWarning050:"rgba(243, 161, 63, 0.5)",semanticWarning060:"rgba(243, 161, 63, 0.6)",semanticWarning070:"rgba(243, 161, 63, 0.7)",semanticWarning080:"rgba(243, 161, 63, 0.8)",semanticWarning090:"rgba(243, 161, 63, 0.9)",semanticWarning100:"rgba(243, 161, 63, 1.0)"},Af={core:{backgroundAccentPrimary:"#0988F0",backgroundAccentCertified:"#C7B994",backgroundWalletKit:"#FFB800",backgroundAppKit:"#FF573B",backgroundCloud:"#0988F0",backgroundDocumentation:"#008847",backgroundSuccess:"rgba(48, 164, 107, 0.20)",backgroundError:"rgba(223, 74, 52, 0.20)",backgroundWarning:"rgba(243, 161, 63, 0.20)",textAccentPrimary:"#0988F0",textAccentCertified:"#C7B994",textWalletKit:"#FFB800",textAppKit:"#FF573B",textCloud:"#0988F0",textDocumentation:"#008847",textSuccess:"#30A46B",textError:"#DF4A34",textWarning:"#F3A13F",borderAccentPrimary:"#0988F0",borderSecondary:"#C7B994",borderSuccess:"#30A46B",borderError:"#DF4A34",borderWarning:"#F3A13F",foregroundAccent010:"rgba(9, 136, 240, 0.1)",foregroundAccent020:"rgba(9, 136, 240, 0.2)",foregroundAccent040:"rgba(9, 136, 240, 0.4)",foregroundAccent060:"rgba(9, 136, 240, 0.6)",foregroundSecondary020:"rgba(199, 185, 148, 0.2)",foregroundSecondary040:"rgba(199, 185, 148, 0.4)",foregroundSecondary060:"rgba(199, 185, 148, 0.6)",iconAccentPrimary:"#0988F0",iconAccentCertified:"#C7B994",iconSuccess:"#30A46B",iconError:"#DF4A34",iconWarning:"#F3A13F",glass010:"rgba(255, 255, 255, 0.1)",zIndex:"9999"},dark:{overlay:"rgba(0, 0, 0, 0.50)",backgroundPrimary:"#202020",backgroundInvert:"#FFFFFF",textPrimary:"#FFFFFF",textSecondary:"#9A9A9A",textTertiary:"#BBBBBB",textInvert:"#202020",borderPrimary:"#2A2A2A",borderPrimaryDark:"#363636",borderSecondary:"#4F4F4F",foregroundPrimary:"#252525",foregroundSecondary:"#2A2A2A",foregroundTertiary:"#363636",iconDefault:"#9A9A9A",iconInverse:"#FFFFFF"},light:{overlay:"rgba(230 , 230, 230, 0.5)",backgroundPrimary:"#FFFFFF",borderPrimaryDark:"#E9E9E9",backgroundInvert:"#202020",textPrimary:"#202020",textSecondary:"#9A9A9A",textTertiary:"#6C6C6C",textInvert:"#FFFFFF",borderPrimary:"#E9E9E9",borderSecondary:"#D0D0D0",foregroundPrimary:"#F3F3F3",foregroundSecondary:"#E9E9E9",foregroundTertiary:"#D0D0D0",iconDefault:"#9A9A9A",iconInverse:"#202020"}},woe={1:"4px",2:"8px",10:"10px",3:"12px",4:"16px",6:"24px",5:"20px",8:"32px",16:"64px",20:"80px",32:"128px",64:"256px",128:"512px",round:"9999px"},boe={0:"0px","01":"2px",1:"4px",2:"8px",3:"12px",4:"16px",5:"20px",6:"24px",7:"28px",8:"32px",9:"36px",10:"40px",12:"48px",14:"56px",16:"64px",20:"80px",32:"128px",64:"256px"},voe={regular:"KHTeka",mono:"KHTekaMono"},Eoe={regular:"400",medium:"500"},_oe={h1:"50px",h2:"44px",h3:"38px",h4:"32px",h5:"26px",h6:"20px",large:"16px",medium:"14px",small:"12px"},Ioe={"h1-regular-mono":{lineHeight:"50px",letterSpacing:"-3px"},"h1-regular":{lineHeight:"50px",letterSpacing:"-1px"},"h1-medium":{lineHeight:"50px",letterSpacing:"-0.84px"},"h2-regular-mono":{lineHeight:"44px",letterSpacing:"-2.64px"},"h2-regular":{lineHeight:"44px",letterSpacing:"-0.88px"},"h2-medium":{lineHeight:"44px",letterSpacing:"-0.88px"},"h3-regular-mono":{lineHeight:"38px",letterSpacing:"-2.28px"},"h3-regular":{lineHeight:"38px",letterSpacing:"-0.76px"},"h3-medium":{lineHeight:"38px",letterSpacing:"-0.76px"},"h4-regular-mono":{lineHeight:"32px",letterSpacing:"-1.92px"},"h4-regular":{lineHeight:"32px",letterSpacing:"-0.32px"},"h4-medium":{lineHeight:"32px",letterSpacing:"-0.32px"},"h5-regular-mono":{lineHeight:"26px",letterSpacing:"-1.56px"},"h5-regular":{lineHeight:"26px",letterSpacing:"-0.26px"},"h5-medium":{lineHeight:"26px",letterSpacing:"-0.26px"},"h6-regular-mono":{lineHeight:"20px",letterSpacing:"-1.2px"},"h6-regular":{lineHeight:"20px",letterSpacing:"-0.6px"},"h6-medium":{lineHeight:"20px",letterSpacing:"-0.6px"},"lg-regular-mono":{lineHeight:"16px",letterSpacing:"-0.96px"},"lg-regular":{lineHeight:"18px",letterSpacing:"-0.16px"},"lg-medium":{lineHeight:"18px",letterSpacing:"-0.16px"},"md-regular-mono":{lineHeight:"14px",letterSpacing:"-0.84px"},"md-regular":{lineHeight:"16px",letterSpacing:"-0.14px"},"md-medium":{lineHeight:"16px",letterSpacing:"-0.14px"},"sm-regular-mono":{lineHeight:"12px",letterSpacing:"-0.72px"},"sm-regular":{lineHeight:"14px",letterSpacing:"-0.12px"},"sm-medium":{lineHeight:"14px",letterSpacing:"-0.12px"}},Soe={"ease-out-power-2":"cubic-bezier(0.23, 0.09, 0.08, 1.13)","ease-out-power-1":"cubic-bezier(0.12, 0.04, 0.2, 1.06)","ease-in-power-2":"cubic-bezier(0.92, -0.13, 0.77, 0.91)","ease-in-power-1":"cubic-bezier(0.88, -0.06, 0.8, 0.96)","ease-inout-power-2":"cubic-bezier(0.77, 0.09, 0.23, 1.13)","ease-inout-power-1":"cubic-bezier(0.88, 0.04, 0.12, 1.06)"},Coe={xl:"400ms",lg:"200ms",md:"125ms",sm:"75ms"},kw={colors:yoe,fontFamily:voe,fontWeight:Eoe,textSize:_oe,typography:Ioe,tokens:{core:Af.core,theme:Af.dark},borderRadius:woe,spacing:boe,durations:Coe,easings:Soe},XI="--apkt",oi={createCSSVariables(t){const e={},r={};function n(i,o,a=""){for(const[c,l]of Object.entries(i)){const u=a?`${a}-${c}`:c;l&&typeof l=="object"&&Object.keys(l).length?(o[c]={},n(l,o[c],u)):typeof l=="string"&&(o[c]=`${XI}-${u}`)}}function s(i,o){for(const[a,c]of Object.entries(i))c&&typeof c=="object"?(o[a]={},s(c,o[a])):typeof c=="string"&&(o[a]=`var(${c})`)}return n(t,e),s(e,r),{cssVariables:e,cssVariablesVarPrefix:r}},assignCSSVariables(t,e){const r={};function n(s,i,o){for(const[a,c]of Object.entries(s)){const l=o?`${o}-${a}`:a,u=i[a];c&&typeof c=="object"?n(c,u,l):typeof u=="string"&&(r[`${XI}-${l}`]=u)}}return n(t,e),r},createRootStyles(t,e){const r={...kw,tokens:{...kw.tokens,theme:t==="light"?Af.light:Af.dark}},{cssVariables:n}=oi.createCSSVariables(r),s=oi.assignCSSVariables(n,r),i=oi.generateW3MVariables(e),o=oi.generateW3MOverrides(e),a=oi.generateScaledVariables(e),c=oi.generateBaseVariables(s),l={...s,...c,...i,...o,...a},u=oi.applyColorMixToVariables(e,l),h={...l,...u};return`:root {${Object.entries(h).map(([p,g])=>`${p}:${g.replace("/[:;{}</>]/g","")};`).join("")}}`},generateW3MVariables(t){if(!t)return{};const e={};return e["--w3m-font-family"]=t["--w3m-font-family"]||"KHTeka",e["--w3m-accent"]=t["--w3m-accent"]||"#0988F0",e["--w3m-color-mix"]=t["--w3m-color-mix"]||"#000",e["--w3m-color-mix-strength"]=`${t["--w3m-color-mix-strength"]||0}%`,e["--w3m-font-size-master"]=t["--w3m-font-size-master"]||"10px",e["--w3m-border-radius-master"]=t["--w3m-border-radius-master"]||"4px",e},generateW3MOverrides(t){if(!t)return{};const e={};if(t["--w3m-accent"]){const r=t["--w3m-accent"];e["--apkt-tokens-core-iconAccentPrimary"]=r,e["--apkt-tokens-core-borderAccentPrimary"]=r,e["--apkt-tokens-core-textAccentPrimary"]=r,e["--apkt-tokens-core-backgroundAccentPrimary"]=r}return t["--w3m-font-family"]&&(e["--apkt-fontFamily-regular"]=t["--w3m-font-family"]),t["--w3m-z-index"]&&(e["--apkt-tokens-core-zIndex"]=`${t["--w3m-z-index"]}`),e},generateScaledVariables(t){if(!t)return{};const e={};if(t["--w3m-font-size-master"]){const r=parseFloat(t["--w3m-font-size-master"].replace("px",""));e["--apkt-textSize-h1"]=`${Number(r)*5}px`,e["--apkt-textSize-h2"]=`${Number(r)*4.4}px`,e["--apkt-textSize-h3"]=`${Number(r)*3.8}px`,e["--apkt-textSize-h4"]=`${Number(r)*3.2}px`,e["--apkt-textSize-h5"]=`${Number(r)*2.6}px`,e["--apkt-textSize-h6"]=`${Number(r)*2}px`,e["--apkt-textSize-large"]=`${Number(r)*1.6}px`,e["--apkt-textSize-medium"]=`${Number(r)*1.4}px`,e["--apkt-textSize-small"]=`${Number(r)*1.2}px`}if(t["--w3m-border-radius-master"]){const r=parseFloat(t["--w3m-border-radius-master"].replace("px",""));e["--apkt-borderRadius-1"]=`${Number(r)}px`,e["--apkt-borderRadius-2"]=`${Number(r)*2}px`,e["--apkt-borderRadius-3"]=`${Number(r)*3}px`,e["--apkt-borderRadius-4"]=`${Number(r)*4}px`,e["--apkt-borderRadius-5"]=`${Number(r)*5}px`,e["--apkt-borderRadius-6"]=`${Number(r)*6}px`,e["--apkt-borderRadius-8"]=`${Number(r)*8}px`,e["--apkt-borderRadius-16"]=`${Number(r)*16}px`,e["--apkt-borderRadius-20"]=`${Number(r)*20}px`,e["--apkt-borderRadius-32"]=`${Number(r)*32}px`,e["--apkt-borderRadius-64"]=`${Number(r)*64}px`,e["--apkt-borderRadius-128"]=`${Number(r)*128}px`}return e},generateColorMixCSS(t,e){if(!t?.["--w3m-color-mix"]||!t["--w3m-color-mix-strength"])return"";const r=t["--w3m-color-mix"],n=t["--w3m-color-mix-strength"];if(!n||n===0)return"";const s=Object.keys(e||{}).filter(o=>{const a=o.includes("-tokens-core-background")||o.includes("-tokens-core-text")||o.includes("-tokens-core-border")||o.includes("-tokens-core-foreground")||o.includes("-tokens-core-icon")||o.includes("-tokens-theme-background")||o.includes("-tokens-theme-text")||o.includes("-tokens-theme-border")||o.includes("-tokens-theme-foreground")||o.includes("-tokens-theme-icon"),c=o.includes("-borderRadius-")||o.includes("-spacing-")||o.includes("-textSize-")||o.includes("-fontFamily-")||o.includes("-fontWeight-")||o.includes("-typography-")||o.includes("-duration-")||o.includes("-ease-")||o.includes("-path-")||o.includes("-width-")||o.includes("-height-")||o.includes("-visual-size-")||o.includes("-modal-width")||o.includes("-cover");return a&&!c});return s.length===0?"":` @supports (background: color-mix(in srgb, white 50%, black)) {
      :root {
        ${s.map(o=>{const a=e?.[o]||"";return a.includes("color-mix")||a.startsWith("#")||a.startsWith("rgb")?`${o}: color-mix(in srgb, ${r} ${n}%, ${a});`:`${o}: color-mix(in srgb, ${r} ${n}%, var(${o}-base, ${a}));`}).join("")}
      }
    }`},generateBaseVariables(t){const e={},r=t["--apkt-tokens-theme-backgroundPrimary"];r&&(e["--apkt-tokens-theme-backgroundPrimary-base"]=r);const n=t["--apkt-tokens-core-backgroundAccentPrimary"];return n&&(e["--apkt-tokens-core-backgroundAccentPrimary-base"]=n),e},applyColorMixToVariables(t,e){const r={};if(e?.["--apkt-tokens-theme-backgroundPrimary"]&&(r["--apkt-tokens-theme-backgroundPrimary"]="var(--apkt-tokens-theme-backgroundPrimary-base)"),e?.["--apkt-tokens-core-backgroundAccentPrimary"]&&(r["--apkt-tokens-core-backgroundAccentPrimary"]="var(--apkt-tokens-core-backgroundAccentPrimary-base)"),!t?.["--w3m-color-mix"]||!t["--w3m-color-mix-strength"])return r;const n=t["--w3m-color-mix"],s=t["--w3m-color-mix-strength"];if(!s||s===0)return r;const i=Object.keys(e||{}).filter(o=>{const a=o.includes("-tokens-core-background")||o.includes("-tokens-core-text")||o.includes("-tokens-core-border")||o.includes("-tokens-core-foreground")||o.includes("-tokens-core-icon")||o.includes("-tokens-theme-background")||o.includes("-tokens-theme-text")||o.includes("-tokens-theme-border")||o.includes("-tokens-theme-foreground")||o.includes("-tokens-theme-icon")||o.includes("-tokens-theme-overlay"),c=o.includes("-borderRadius-")||o.includes("-spacing-")||o.includes("-textSize-")||o.includes("-fontFamily-")||o.includes("-fontWeight-")||o.includes("-typography-")||o.includes("-duration-")||o.includes("-ease-")||o.includes("-path-")||o.includes("-width-")||o.includes("-height-")||o.includes("-visual-size-")||o.includes("-modal-width")||o.includes("-cover");return a&&!c});return i.length===0||i.forEach(o=>{const a=e?.[o]||"";o.endsWith("-base")||(o==="--apkt-tokens-theme-backgroundPrimary"||o==="--apkt-tokens-core-backgroundAccentPrimary"?r[o]=`color-mix(in srgb, ${n} ${s}%, var(${o}-base))`:a.includes("color-mix")||a.startsWith("#")||a.startsWith("rgb")?r[o]=`color-mix(in srgb, ${n} ${s}%, ${a})`:r[o]=`color-mix(in srgb, ${n} ${s}%, var(${o}-base, ${a}))`)}),r}},{cssVariablesVarPrefix:xoe}=oi.createCSSVariables(kw);function Hle(t,...e){return uo(t,...e.map(r=>is(typeof r=="function"?r(xoe):r)))}let Yo,la,Ps,cs,$f;const ni={"KHTeka-500-woff2":"https://fonts.reown.com/KHTeka-Medium.woff2","KHTeka-400-woff2":"https://fonts.reown.com/KHTeka-Regular.woff2","KHTeka-300-woff2":"https://fonts.reown.com/KHTeka-Light.woff2","KHTekaMono-400-woff2":"https://fonts.reown.com/KHTekaMono-Regular.woff2","KHTeka-500-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTeka-400-woff":"https://fonts.reown.com/KHTeka-Regular.woff","KHTeka-300-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTekaMono-400-woff":"https://fonts.reown.com/KHTekaMono-Regular.woff"};function Nf(t,e="dark"){Yo&&document.head.removeChild(Yo),Yo=document.createElement("style"),Yo.textContent=oi.createRootStyles(e,t),document.head.appendChild(Yo)}function Vle(t,e="dark"){if($f=t,la=document.createElement("style"),Ps=document.createElement("style"),cs=document.createElement("style"),la.textContent=Ec(t).core.cssText,Ps.textContent=Ec(t).dark.cssText,cs.textContent=Ec(t).light.cssText,document.head.appendChild(la),document.head.appendChild(Ps),document.head.appendChild(cs),Nf(t,e),Pw(e),!t?.["--w3m-font-family"])for(const[r,n]of Object.entries(ni)){const s=document.createElement("link");s.rel="preload",s.href=n,s.as="font",s.type=r.includes("woff2")?"font/woff2":"font/woff",s.crossOrigin="anonymous",document.head.appendChild(s)}Pw(e)}function Pw(t="dark"){Ps&&cs&&Yo&&(t==="light"?(Nf($f,t),Ps.removeAttribute("media"),cs.media="enabled"):(Nf($f,t),cs.removeAttribute("media"),Ps.media="enabled"))}function Aoe(t){if($f=t,la&&Ps&&cs&&(la.textContent=Ec(t).core.cssText,Ps.textContent=Ec(t).dark.cssText,cs.textContent=Ec(t).light.cssText,t?.["--w3m-font-family"])){const e=t["--w3m-font-family"];la.textContent=la.textContent?.replace("font-family: KHTeka",`font-family: ${e}`),Ps.textContent=Ps.textContent?.replace("font-family: KHTeka",`font-family: ${e}`),cs.textContent=cs.textContent?.replace("font-family: KHTeka",`font-family: ${e}`)}if(Yo){const e=cs?.media==="enabled"?"light":"dark";Nf(t,e)}}function Ec(t){const e=!!t?.["--w3m-font-family"];return{core:uo`
      ${e?uo``:uo`
            @font-face {
              font-family: 'KHTeka';
              src:
                url(${is(ni["KHTeka-400-woff2"])}) format('woff2'),
                url(${is(ni["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
              font-display: swap;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${is(ni["KHTeka-300-woff2"])}) format('woff2'),
                url(${is(ni["KHTeka-300-woff"])}) format('woff');
              font-weight: 300;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTekaMono';
              src:
                url(${is(ni["KHTekaMono-400-woff2"])}) format('woff2'),
                url(${is(ni["KHTekaMono-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${is(ni["KHTeka-400-woff2"])}) format('woff2'),
                url(${is(ni["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }
          `}

      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --apkt-modal-width: 370px;

        --apkt-visual-size-inherit: inherit;
        --apkt-visual-size-sm: 40px;
        --apkt-visual-size-md: 55px;
        --apkt-visual-size-lg: 80px;

        --apkt-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --apkt-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --apkt-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --apkt-width-network-sm: 36px;
        --apkt-width-network-md: 48px;
        --apkt-width-network-lg: 86px;

        --apkt-duration-dynamic: 0ms;
        --apkt-height-network-sm: 40px;
        --apkt-height-network-md: 54px;
        --apkt-height-network-lg: 96px;
      }
    `,dark:uo`
      :root {
      }
    `,light:uo`
      :root {
      }
    `}}const Wle=uo`
  div,
  span,
  iframe,
  a,
  img,
  form,
  button,
  label,
  *::after,
  *::before {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    backface-visibility: hidden;
  }

  :host {
    font-family: var(--apkt-fontFamily-regular);
  }
`,Kle=uo`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;

    will-change: background-color, color, border, box-shadow, width, height, transform, opacity;
    outline: none;
    border: none;
    text-decoration: none;
    transition:
      background-color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      box-shadow var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      width var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      height var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      transform var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      opacity var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      scale var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border-radius var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2);
    will-change:
      background-color, color, border, box-shadow, width, height, transform, opacity, scale,
      border-radius;
  }

  a:active:not([disabled]),
  button:active:not([disabled]) {
    scale: 0.975;
    transform-origin: center;
  }

  button:disabled {
    cursor: default;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`;function $oe(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,n=t.charAt(0),s=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0;const p=l.length;for(;d!==p&&l[d]===0;)d++,u++;const g=(p-d)*i+1>>>0,m=new Uint8Array(g);for(;d!==p;){let S=l[d],v=0;for(let b=g-1;(S!==0||v<h)&&b!==-1;b--,v++)S+=256*m[b]>>>0,m[b]=S%r>>>0,S=S/r>>>0;if(S!==0)throw new Error("Non-zero carry");h=v,d++}let w=g-h;for(;w!==g&&m[w]===0;)w++;let I=n.repeat(u);for(;w<g;++w)I+=t.charAt(m[w]);return I}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===n;)h++,u++;const p=(l.length-u)*s+1>>>0,g=new Uint8Array(p);for(;u<l.length;){const S=l.charCodeAt(u);if(S>255)return;let v=e[S];if(v===255)return;let b=0;for(let C=p-1;(v!==0||b<d)&&C!==-1;C--,b++)v+=r*g[C]>>>0,g[C]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=b,u++}let m=p-d;for(;m!==p&&g[m]===0;)m++;const w=new Uint8Array(h+(p-m));let I=h;for(;m!==p;)w[I++]=g[m++];return w}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Noe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Ooe=$oe(Noe),id={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603};class Toe extends mie{async setUniversalProvider(e){if(!this.namespace)throw new Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new yie({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect(),this.emit("disconnect")}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}return{connections:[]}}syncConnections(){return Promise.resolve()}async getAccounts({namespace:e}){const n=this.provider?.session?.namespaces?.[e]?.accounts?.map(s=>{const[,,i]=s.split(":");return i}).filter((s,i,o)=>o.indexOf(s)===i)||[];return Promise.resolve({accounts:n.map(s=>ue.createAccount(e,s,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){if(!(e.caipNetwork&&Te.BALANCE_SUPPORTED_CHAINS.includes(e.caipNetwork?.chainNamespace))||e.caipNetwork?.testnet)return{balance:"0.00",symbol:e.caipNetwork?.nativeCurrency.symbol||""};const n=U.getAccountData();if(n?.balanceLoading&&e.chainId===U.state.activeCaipNetwork?.id)return{balance:n?.balance||"0.00",symbol:n?.balanceSymbol||""};const i=(await U.fetchTokenBalance()).find(o=>o.chainId===`${e.caipNetwork?.chainNamespace}:${e.chainId}`&&o.symbol===e.caipNetwork?.nativeCurrency.symbol);return{balance:i?.quantity.numeric||"0.00",symbol:i?.symbol||e.caipNetwork?.nativeCurrency.symbol||""}}async signMessage(e){const{provider:r,message:n,address:s}=e;if(!r)throw new Error("UniversalAdapter:signMessage - provider is undefined");let i="";return U.state.activeCaipNetwork?.chainNamespace===X.CHAIN.SOLANA?i=(await r.request({method:"solana_signMessage",params:{message:Ooe.encode(new TextEncoder().encode(n)),pubkey:s}},U.state.activeCaipNetwork?.caipNetworkId)).signature:i=await r.request({method:"personal_sign",params:[n,s]},U.state.activeCaipNetwork?.caipNetworkId),{signature:i}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){const{caipNetwork:r}=e,n=this.getWalletConnectConnector();if(r.chainNamespace===X.CHAIN.EVM)try{await n.provider?.request({method:"wallet_switchEthereumChain",params:[{chainId:s_(r.id)}]})}catch(s){if(s.code===id.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||s.code===id.ERROR_INVALID_CHAIN_ID||s.code===id.ERROR_CODE_DEFAULT||s?.data?.originalError?.code===id.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await n.provider?.request({method:"wallet_addEthereumChain",params:[{chainId:s_(r.id),rpcUrls:[r?.rpcUrls.chainDefault?.http],chainName:r.name,nativeCurrency:r.nativeCurrency,blockExplorerUrls:[r.blockExplorers?.default.url]}]})}catch{throw new Error("Chain is not supported")}}n.provider.setDefaultChain(r.caipNetworkId)}getWalletConnectProvider(){return this.connectors.find(n=>n.type==="WALLET_CONNECT")?.provider}}const koe=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture","payWithExchange","payments","reownAuthentication"],od={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?Te.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(r=>r!=="email"):!1},processFallback:t=>t===void 0?Te.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?Te.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Te.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?Te.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Te.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?Te.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Te.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Te.DEFAULT_REMOTE_FEATURES.reownBranding:!!t},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>t.isEnabled&&(t.config??[]),processFallback:t=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Te.DEFAULT_REMOTE_FEATURES.multiWallet},payWithExchange:{apiFeatureName:"fund_from_exchange",localFeatureName:"payWithExchange",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Te.DEFAULT_REMOTE_FEATURES.payWithExchange},payments:{apiFeatureName:"payments",localFeatureName:"payments",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Te.DEFAULT_REMOTE_FEATURES.payments},reownAuthentication:{apiFeatureName:"reown_authentication",localFeatureName:"reownAuthentication",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>typeof t>"u"?Te.DEFAULT_REMOTE_FEATURES.reownAuthentication:!!t}},Poe={localSettingsOverridden:new Set,getApiConfig(t,e){return e?.find(r=>r.id===t)},addWarning(t,e){if(t!==void 0){const r=od[e],n=r.isLegacy?`"features.${r.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(n)}},processFeature(t,e,r,n,s){const i=od[t],o=e[i.localFeatureName];if(s&&!i.isAvailableOnBasic)return!1;if(n){const a=this.getApiConfig(i.apiFeatureName,r);return a?.config===null?this.processFallbackFeature(t,o):a?.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return od[t].processApi(e)},processFallbackFeature(t,e){return od[t].processFallback(e)},async fetchRemoteFeatures(t){const e=t.basic??!1,r=t.features||{};this.localSettingsOverridden.clear();let n=null,s=!1;try{n=await de.fetchProjectConfig(),s=n!=null}catch(o){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",o)}const i=s&&!e?Te.DEFAULT_REMOTE_FEATURES:Te.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const o of koe){const a=this.processFeature(o,r,n,s,e);Object.assign(i,{[o]:a})}}catch(o){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",o),Te.DEFAULT_REMOTE_FEATURES}if(s&&this.localSettingsOverridden.size>0){const o=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;dn.open({debugMessage:Dn.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(o)},"warning")}return i}};class Roe{constructor(e){this.chainNamespaces=[],this.features={},this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(r,n)=>{if(r){const s=U.getCaipNetworks(r)?.find(a=>a.id===n);if(s)return s;const i=U.getNetworkData(r)?.caipNetwork;return i||U.getRequestedCaipNetworks(r).filter(a=>a.chainNamespace===r)?.[0]}return U.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const r=this.getCaipNetwork();if(r)return r.id},this.getCaipNetworks=r=>U.getCaipNetworks(r),this.getActiveChainNamespace=()=>U.state.activeChain,this.setRequestedCaipNetworks=(r,n)=>{U.setRequestedCaipNetworks(r,n)},this.getApprovedCaipNetworkIds=()=>U.getAllApprovedCaipNetworkIds(),this.getCaipAddress=r=>U.state.activeChain===r||!r?U.state.activeCaipAddress:U.state.chains.get(r)?.accountState?.caipAddress,this.setClientId=r=>{we.setClientId(r)},this.getProvider=r=>ct.getProvider(r),this.getProviderType=r=>ct.getProviderId(r),this.getPreferredAccountType=r=>Hn(r),this.setCaipAddress=(r,n,s=!1)=>{U.setAccountProp("caipAddress",r,n,s),U.setAccountProp("address",ue.getPlainAddress(r),n,s)},this.setBalance=(r,n,s)=>{U.setAccountProp("balance",r,s),U.setAccountProp("balanceSymbol",n,s)},this.setProfileName=(r,n)=>{U.setAccountProp("profileName",r,n)},this.setProfileImage=(r,n)=>{U.setAccountProp("profileImage",r,n)},this.setUser=(r,n)=>{U.setAccountProp("user",r,n)},this.resetAccount=r=>{U.resetAccount(r)},this.setCaipNetwork=r=>{U.setActiveCaipNetwork(r)},this.setCaipNetworkOfNamespace=(r,n)=>{U.setChainNetworkData(n,{caipNetwork:r})},this.setStatus=(r,n)=>{U.setAccountProp("status",r,n),Q.isConnected()?J.setConnectionStatus("connected"):J.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=r=>U.getAccountData(r)?.address,this.setConnectors=r=>{const n=[...Q.state.allConnectors,...r];Q.setConnectors(n)},this.setConnections=(r,n)=>{J.setConnections(r,n),ie.setConnections(r,n)},this.fetchIdentity=r=>we.fetchIdentity(r),this.getReownName=r=>Wl.getNamesForAddress(r),this.getConnectors=()=>Q.getConnectors(),this.getConnectorImage=r=>R$.getConnectorImage(r),this.getConnections=r=>this.remoteFeatures.multiWallet?lf.getConnectionsData(r).connections:(dn.open(X.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=r=>this.remoteFeatures.multiWallet?lf.getConnectionsData(r).recentConnections:(dn.open(X.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async r=>{if(!this.remoteFeatures.multiWallet){dn.open(X.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}await ie.switchConnection(r)},this.deleteConnection=r=>{if(!this.remoteFeatures.multiWallet){dn.open(X.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}J.deleteAddressFromConnection(r),ie.syncStorageConnections()},this.setConnectedWalletInfo=(r,n)=>{const s=ct.getProviderId(n),i=r?{...r,type:s}:void 0;U.setAccountProp("connectedWalletInfo",i,n)},this.getIsConnectedState=()=>!!U.state.activeCaipAddress,this.addAddressLabel=(r,n,s)=>{const i=U.getAccountData(s)?.addressLabels||{};U.setAccountProp("addressLabels",{...i,[r]:n},s)},this.removeAddressLabel=(r,n)=>{const s=U.getAccountData(n)?.addressLabels||{};U.setAccountProp("addressLabels",{...s,[r]:void 0},n)},this.getAddress=r=>{const n=r||U.state.activeChain;return U.getAccountData(n)?.address},this.resetNetwork=r=>{U.resetNetwork(r)},this.addConnector=r=>{Q.addConnector(r)},this.resetWcConnection=()=>{ie.resetWcConnection()},this.setAddressExplorerUrl=(r,n)=>{U.setAccountProp("addressExplorerUrl",r,n)},this.setSmartAccountDeployed=(r,n)=>{U.setAccountProp("smartAccountDeployed",r,n)},this.setPreferredAccountType=(r,n)=>{U.setAccountProp("preferredAccountType",r,n)},this.setEIP6963Enabled=r=>{V.setEIP6963Enabled(r)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,r){const n=e?.map(i=>i.namespace).filter(i=>!!i);if(n?.length)return[...new Set(n)];const s=r?.map(i=>i.chainNamespace);return[...new Set(s)]}async initialize(e){if(this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),V.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),!e.basic&&!e.manualWCControl&&(this.remoteFeatures=await Poe.fetchRemoteFeatures(e)),await de.fetchUsage(),V.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&Yy.setOnrampProviders(this.remoteFeatures.onramp),(V.state.remoteFeatures?.email||Array.isArray(V.state.remoteFeatures?.socials)&&V.state.remoteFeatures?.socials.length>0)&&await this.checkAllowedOrigins(),V.state.features?.reownAuthentication||V.state.remoteFeatures?.reownAuthentication){const{ReownAuthentication:r}=await sf(async()=>{const{ReownAuthentication:s}=await import("./features-OXVK5EBA.js");return{ReownAuthentication:s}},[]),n=V.state.siwx;n instanceof r||(n&&console.warn("ReownAuthentication option is enabled, SIWX configuration will be overridden."),V.setSIWX(new r))}}async openSend(e){const r=e.namespace||U.state.activeChain,n=this.getCaipAddress(r),s=this.getCaipNetwork(r)?.id;if(!n)throw new Error("openSend: caipAddress not found");if(s?.toString()!==e.chainId.toString()){const i=U.getCaipNetworkById(e.chainId,r);if(!i)throw new Error(`openSend: caipNetwork with chainId ${e.chainId} not found`);await this.switchNetwork(i,{throwOnFailure:!0})}try{const i=cO.getTokenSymbolByAddress(e.assetAddress);i&&await de.fetchTokenImages([i])}catch{}return await Ce.open({view:"WalletSend",data:{send:e}}),new Promise((i,o)=>{const a=Ie.subscribeKey("hash",u=>{u&&(l(),i({hash:u}))}),c=Ce.subscribe(u=>{u.open||(l(),o(new Error("Modal closed")))}),l=this.createCleanupHandler([a,c])})}toModalOptions(){function e(n){return n?.view==="Swap"}function r(n){return n?.view==="WalletSend"}return{isSwap:e,isSend:r}}async checkAllowedOrigins(){try{const e=await de.fetchAllowedOrigins();if(!ue.isClient())return;const r=window.location.origin;wo.isOriginAllowed(r,e,X.DEFAULT_ALLOWED_ANCESTORS)||dn.open(Dn.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(e){if(!(e instanceof Error))return;switch(e.message){case"RATE_LIMITED":dn.open(Dn.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{const r=e.cause instanceof Error?e.cause:e;dn.open({displayMessage:Dn.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:Dn.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(r.message)},"error");break}}}}createCleanupHandler(e){return()=>{e.forEach(r=>{try{r()}catch{}})}}sendInitializeEvent(e){const{...r}=e;delete r.adapters,delete r.universalProvider,Se.sendEvent({type:"track",event:"INITIALIZE",properties:{...r,networks:e.networks.map(n=>n.id),siweConfig:{options:e.siweConfig?.options||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initAdapterController(){B$.initialize(this.chainAdapters)}initializeThemeController(e){e.themeMode&&gn.setThemeMode(e.themeMode),e.themeVariables&&gn.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient)throw new Error("ConnectionControllerClient must be set");U.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient});const r=this.getDefaultNetwork();r&&U.setActiveCaipNetwork(r)}initializeConnectionController(e){ie.initialize(e.adapters??[]),ie.setWcBasic(e.basic??!1)}initializeConnectorController(){Q.initialize(this.chainNamespaces)}initializeProjectSettings(e){V.setProjectId(e.projectId),V.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){V.setDebug(e.debug!==!1),V.setEnableWalletGuide(e.enableWalletGuide!==!1),V.setEnableWallets(e.enableWallets!==!1),V.setEIP6963Enabled(e.enableEIP6963!==!1),V.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),V.setEnableReconnect(e.enableReconnect!==!1),V.setEnableMobileFullScreen(e.enableMobileFullScreen===!0),V.setCoinbasePreference(e.coinbasePreference),V.setEnableAuthLogger(e.enableAuthLogger!==!1),V.setCustomRpcUrls(e.customRpcUrls),V.setEnableEmbedded(e.enableEmbedded),V.setAllWallets(e.allWallets),V.setIncludeWalletIds(e.includeWalletIds),V.setExcludeWalletIds(e.excludeWalletIds),V.setFeaturedWalletIds(e.featuredWalletIds),V.setTokens(e.tokens),V.setTermsConditionsUrl(e.termsConditionsUrl),V.setPrivacyPolicyUrl(e.privacyPolicyUrl),V.setCustomWallets(e.customWallets),V.setFeatures(e.features),V.setAllowUnsupportedChain(e.allowUnsupportedChain),V.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),V.setPreferUniversalLinks(e.experimental_preferUniversalLinks),V.setDefaultAccountTypes(e.defaultAccountTypes);const r=this.getDefaultMetaData();if(!e.metadata&&r&&(e.metadata=r),V.setMetadata(e.metadata),V.setDisableAppend(e.disableAppend),V.setEnableEmbedded(e.enableEmbedded),V.setSIWX(e.siwx),this.features=V.state.features??{},!e.projectId){dn.open(Dn.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(e.adapters?.find(s=>s.namespace===X.CHAIN.EVM)&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");V.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){return ue.isClient()?{name:document.getElementsByTagName("title")?.[0]?.textContent||"",description:document.querySelector('meta[property="og:description"]')?.content||"",url:window.location.origin,icons:[document.querySelector('link[rel~="icon"]')?.href||""]}:null}setUnsupportedNetwork(e){const r=this.getActiveChainNamespace();if(r){const n=sc.getUnsupportedNetwork(`${r}:${e}`);U.setActiveCaipNetwork(n)}}getDefaultNetwork(){return sc.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,r){return sc.extendCaipNetwork(e,{customNetworkImageUrls:r.chainImages,projectId:r.projectId})}extendCaipNetworks(e){return sc.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const r=e.networks.find(s=>s.id===e.defaultNetwork?.id);return r?sc.extendCaipNetwork(r,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectConnector(e,r){try{this.setLoading(!0,e);let n={connections:[]};const s=this.getAdapter(e);return(U.state.chains.get(e)?.accountState?.caipAddress||!V.state.enableReconnect)&&s?.disconnect&&(n=await s.disconnect({id:r})),this.setLoading(!1,e),n}catch(n){throw this.setLoading(!1,e),new Error(`Failed to disconnect chains: ${n.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{const e=U.state.activeChain,r=this.getAdapter(e),n=this.getCaipNetwork(e)?.id,s=ie.getConnections(e),i=this.remoteFeatures.multiWallet,o=s.length>0;if(!r)throw new Error("Adapter not found");const a=await r.connectWalletConnect(n);(!o||!i)&&this.close(),this.setClientId(a?.clientId||null),J.setConnectedNamespaces([...U.state.chains.keys()]),await this.syncWalletConnectAccount(),await os.initializeIfEnabled()},connectExternal:async e=>{const r=await this.onConnectExternal(e);return await this.connectInactiveNamespaces(e,r),r?{address:r.address}:void 0},reconnectExternal:async({id:e,info:r,type:n,provider:s})=>{const i=U.state.activeChain,o=this.getAdapter(i);if(!i)throw new Error("reconnectExternal: namespace not found");if(!o)throw new Error("reconnectExternal: adapter not found");o?.reconnect&&(await o?.reconnect({id:e,info:r,type:n,provider:s,chainId:this.getCaipNetwork()?.id}),J.addConnectedNamespace(i),this.syncConnectedWalletInfo(i))},disconnectConnector:async e=>{await this.disconnectConnector(e.namespace,e.id)},disconnect:async e=>{const{id:r,chainNamespace:n,initialDisconnect:s}=e||{},i=n||U.state.activeChain,o=Q.getConnectorId(i),a=r===X.CONNECTOR_ID.AUTH||o===X.CONNECTOR_ID.AUTH,c=r===X.CONNECTOR_ID.WALLET_CONNECT||o===X.CONNECTOR_ID.WALLET_CONNECT;try{const l=Array.from(U.state.chains.keys());let u=n?[n]:l;(c||a)&&(u=l);const h=u.map(async g=>{const m=Q.getConnectorId(g),w=r||m,I=await this.disconnectConnector(g,w);I&&(a&&J.deleteConnectedSocialProvider(),I.connections.forEach(S=>{J.addDisconnectedConnectorId(S.connectorId,g)})),s&&this.onDisconnectNamespace({chainNamespace:g,closeModal:!1})}),d=await Promise.allSettled(h);Ie.resetSend(),ie.resetWcConnection(),os.getSIWX()?.signOutOnDisconnect&&await os.clearSessions(),Q.setFilterByNamespace(void 0),ie.syncStorageConnections();const p=d.filter(g=>g.status==="rejected");if(p.length>0)throw new Error(p.map(g=>g.reason.message).join(", "));Se.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:n||"all"}})}catch(l){throw new Error(`Failed to disconnect chains: ${l.message}`)}},checkInstalled:e=>e?e.some(r=>!!window.ethereum?.[String(r)]):!!window.ethereum,signMessage:async e=>{const r=U.state.activeChain,n=this.getAdapter(U.state.activeChain);if(!r)throw new Error("signMessage: namespace not found");if(!n)throw new Error("signMessage: adapter not found");const s=this.getAddress(r);if(!s)throw new Error("signMessage: address not found");return(await n?.signMessage({message:e,address:s,provider:ct.getProvider(r)}))?.signature||""},sendTransaction:async e=>{const r=e.chainNamespace;if(!r)throw new Error("sendTransaction: namespace not found");if(Te.SEND_SUPPORTED_NAMESPACES.includes(r)){const n=this.getAdapter(r);if(!n)throw new Error("sendTransaction: adapter not found");const s=ct.getProvider(r);return(await n?.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:s}))?.hash||""}return""},estimateGas:async e=>{const r=e.chainNamespace;if(r===X.CHAIN.EVM){const n=this.getAdapter(r);if(!n)throw new Error("estimateGas: adapter is required but got undefined");const s=ct.getProvider(r),i=this.getCaipNetwork();if(!i)throw new Error("estimateGas: caipNetwork is required but got undefined");return(await n?.estimateGas({...e,provider:s,caipNetwork:i}))?.gas||0n}return 0n},getEnsAvatar:async()=>{const e=U.state.activeChain;if(!e)throw new Error("getEnsAvatar: namespace is required but got undefined");const r=this.getAddress(e);if(!r)throw new Error("getEnsAvatar: address not found");return await this.syncIdentity({address:r,chainId:Number(this.getCaipNetwork()?.id),chainNamespace:e}),U.getAccountData()?.profileImage||!1},getEnsAddress:async e=>await wo.resolveReownName(e),writeContract:async e=>{const r=U.state.activeChain,n=this.getAdapter(r);if(!r)throw new Error("writeContract: namespace is required but got undefined");if(!n)throw new Error("writeContract: adapter is required but got undefined");const s=this.getCaipNetwork(),i=this.getCaipAddress(),o=ct.getProvider(r);if(!s||!i)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");return(await n?.writeContract({...e,caipNetwork:s,provider:o,caipAddress:i}))?.hash},parseUnits:(e,r)=>{const n=this.getAdapter(U.state.activeChain);if(!n)throw new Error("parseUnits: adapter is required but got undefined");return n?.parseUnits({value:e,decimals:r})??0n},formatUnits:(e,r)=>{const n=this.getAdapter(U.state.activeChain);if(!n)throw new Error("formatUnits: adapter is required but got undefined");return n?.formatUnits({value:e,decimals:r})??"0"},getCapabilities:async e=>{const r=this.getAdapter(U.state.activeChain);if(!r)throw new Error("getCapabilities: adapter is required but got undefined");return await r?.getCapabilities(e)},grantPermissions:async e=>{const r=this.getAdapter(U.state.activeChain);if(!r)throw new Error("grantPermissions: adapter is required but got undefined");return await r?.grantPermissions(e)},revokePermissions:async e=>{const r=this.getAdapter(U.state.activeChain);if(!r)throw new Error("revokePermissions: adapter is required but got undefined");return r?.revokePermissions?await r.revokePermissions(e):"0x"},walletGetAssets:async e=>{const r=this.getAdapter(U.state.activeChain);if(!r)throw new Error("walletGetAssets: adapter is required but got undefined");return await r?.walletGetAssets(e)??{}},updateBalance:e=>{const r=this.getAddress(e),n=this.getCaipNetwork(e);!n||!r||this.updateNativeBalance(r,n?.id,e)}},ie.setClient(this.connectionControllerClient)}async onConnectExternal(e){const r=U.state.activeChain,n=e.chain||r,s=this.getAdapter(n);let i=!0;if(e.type===ri.CONNECTOR_TYPE_AUTH&&X.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(h=>Q.getConnectorId(h)===X.CONNECTOR_ID.AUTH)&&e.chain!==r&&(i=!1),e.chain&&e.chain!==r&&!e.caipNetwork){const l=this.getCaipNetworks().find(u=>u.chainNamespace===e.chain);l&&i&&this.setCaipNetwork(l)}if(!n)throw new Error("connectExternal: namespace not found");if(!s)throw new Error("connectExternal: adapter not found");const o=this.getCaipNetwork(n),a=e.caipNetwork||o,c=await s.connect({id:e.id,address:e.address,info:e.info,type:e.type,provider:e.provider,socialUri:e.socialUri,chainId:e.caipNetwork?.id||o?.id,rpcUrl:e.caipNetwork?.rpcUrls?.default?.http?.[0]||o?.rpcUrls?.default?.http?.[0]});if(c)return J.addConnectedNamespace(n),this.syncProvider({...c,chainNamespace:n}),this.setStatus("connected",n),this.syncConnectedWalletInfo(n),J.removeDisconnectedConnectorId(e.id,n),{address:c.address,connectedCaipNetwork:a}}async connectInactiveNamespaces(e,r){const n=e.type===ri.CONNECTOR_TYPE_AUTH,s=Lu.getOtherAuthNamespaces(r?.connectedCaipNetwork?.chainNamespace),i=U.state.activeCaipNetwork,o=this.getAdapter(i?.chainNamespace);n&&(await Promise.all(s.map(async a=>{try{const c=ct.getProvider(a),l=this.getCaipNetwork(a);await this.getAdapter(a)?.connect({...e,provider:c,socialUri:void 0,chainId:l?.id,rpcUrl:l?.rpcUrls?.default?.http?.[0]})&&(J.addConnectedNamespace(a),J.removeDisconnectedConnectorId(e.id,a),this.setStatus("connected",a),this.syncConnectedWalletInfo(a))}catch(c){dn.warn(Dn.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.displayMessage,Dn.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.debugMessage(a,c instanceof Error?c.message:void 0),Dn.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.code)}})),i&&await o?.switchNetwork({caipNetwork:i}))}getApprovedCaipNetworksData(){if(ct.getProviderId(U.state.activeChain)===ri.CONNECTOR_TYPE_WALLET_CONNECT){const r=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(r)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){const r=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const s=ct.getProviderId(r);if(e.chainNamespace===U.state.activeChain)await this.getAdapter(r)?.switchNetwork({caipNetwork:e});else if(this.setCaipNetwork(e),s===ri.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const i=this.getAddressByChainNamespace(r);i&&this.syncAccount({address:i,chainId:e.id,chainNamespace:r})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(r=>{const n=r.chains||[],s=r.accounts.map(i=>{const{chainId:o,chainNamespace:a}=or.parseCaipAddress(i);return`${a}:${o}`});return Array.from(new Set([...n,...s]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((r,n)=>{const s=e?.find(i=>i.namespace===n);return s?(s.construct({namespace:n,projectId:this.options?.projectId,networks:this.caipNetworks?.filter(({chainNamespace:i})=>i===n)}),r[n]=s):r[n]=new Toe({namespace:n,networks:this.getCaipNetworks()}),r},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e);const r=this.getAdapter(e);if(!r)throw new Error("adapter not found");await r.syncConnectors(),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)})),this.initAdapterController()}onConnectors(e){this.getAdapter(e)?.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const r=this.getAdapter(e);if(!r)return;const n=J.getConnectionStatus();V.state.enableReconnect===!1?this.setStatus("disconnected",e):n==="connected"?this.setStatus("connecting",e):n==="disconnected"?(J.clearAddressCache(),this.setStatus(n,e)):this.setStatus(n,e),r.on("switchNetwork",({address:s,chainId:i})=>{const o=this.getCaipNetworks().find(l=>l.id.toString()===i.toString()||l.caipNetworkId.toString()===i.toString()),a=U.state.activeChain===e,c=U.state.chains.get(e)?.accountState?.address;if(o){const l=a&&s?s:c;l&&this.syncAccount({address:l,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(i)}),r.on("disconnect",()=>{const s=this.remoteFeatures.multiWallet,i=Array.from(ie.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:e,closeModal:!s||i.length===0})}),r.on("connections",s=>{this.setConnections(s,e)}),r.on("pendingTransactions",()=>{const s=this.getAddress(e),i=U.state.activeCaipNetwork;!s||!i?.id||this.updateNativeBalance(s,i.id,i.chainNamespace)}),r.on("accountChanged",({address:s,chainId:i,connector:o})=>{this.handlePreviousConnectorConnection(o);const a=U.state.activeChain===e;o?.provider&&(this.syncProvider({id:o.id,type:o.type,provider:o?.provider,chainNamespace:e}),this.syncConnectedWalletInfo(e));const c=U.getNetworkData(e)?.caipNetwork?.id,l=i||c;a&&l?this.syncAccount({address:s,chainId:l,chainNamespace:e}):!a&&l?(this.syncAccountInfo(s,l,e),this.syncBalance({address:s,chainId:l,chainNamespace:e})):this.syncAccountInfo(s,i,e),J.addConnectedNamespace(e)})}async handlePreviousConnectorConnection(e){const r=e?.chain,n=e?.id,s=Q.getConnectorId(r),i=V.state.remoteFeatures?.multiWallet,a=r&&n&&s&&s!==n&&!i;try{a&&await ie.disconnect({id:s,namespace:r})}catch(c){console.warn("Error disconnecting previous connector",c)}}async createUniversalProviderForAdapter(e){await this.getUniversalProvider(),this.universalProvider&&await this.chainAdapters?.[e]?.setUniversalProvider?.(this.universalProvider)}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(e=>ie.disconnect({namespace:e,initialDisconnect:!0})))}catch(e){console.error("Error disconnecting existing connections:",e)}}async reconnectWalletConnect(){await this.syncWalletConnectAccount();const e=this.getAddress();this.getCaipAddress()||J.deleteRecentWallet();const r=J.getRecentWallet();Se.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:e,properties:{method:ue.isMobile()?"mobile":"qrcode",name:r?.name||"Unknown",reconnect:!0,view:me.state.view,walletRank:r?.order}})}async syncNamespaceConnection(e){try{e===X.CHAIN.EVM&&ue.isSafeApp()&&Q.setConnectorId(X.CONNECTOR_ID.SAFE,e);const r=Q.getConnectorId(e);switch(this.setStatus("connecting",e),r){case X.CONNECTOR_ID.WALLET_CONNECT:await this.reconnectWalletConnect();break;case X.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(r){console.warn("AppKit couldn't sync existing connection",r),this.setStatus("disconnected",e)}}onDisconnectNamespace(e){const{chainNamespace:r,closeModal:n}=e||{};U.resetAccount(r),U.resetNetwork(r),J.removeConnectedNamespace(r);const s=Array.from(U.state.chains.keys());(r?[r]:s).forEach(o=>J.addDisconnectedConnectorId(Q.getConnectorId(o)||"",o)),Q.removeConnectorId(r),ct.resetChain(r),this.setUser(null,r),this.setStatus("disconnected",r),this.setConnectedWalletInfo(null,r),n!==!1&&Ce.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(e=>{const r=this.getAdapter(e),n=this.getCaipAddress(e),s=this.getCaipNetwork(e);return r?.syncConnections({connectToFirstConnector:!n,caipNetwork:s})}))}async syncAdapterConnection(e){const r=this.getAdapter(e),n=this.getCaipNetwork(e),s=Q.getConnectorId(e),o=Q.getConnectors(e).find(a=>a.id===s);try{if(!r||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!n?.id)throw new Error("CaipNetwork not found");const a=await r?.syncConnection({namespace:e,id:o.id,chainId:n.id,rpcUrl:n?.rpcUrls?.default?.http?.[0]});a?(this.syncProvider({...a,chainNamespace:e}),await this.syncAccount({...a,chainNamespace:e}),this.setStatus("connected",e),Se.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:a.address,properties:{method:"browser",name:o.info?.name||o.name||"Unknown",reconnect:!0,view:me.state.view,walletRank:void 0}})):this.setStatus("disconnected",e)}catch{this.onDisconnectNamespace({chainNamespace:e,closeModal:!1})}}async syncWalletConnectAccount(){const e=Object.keys(this.universalProvider?.session?.namespaces||{}),r=this.chainNamespaces.map(async n=>{const s=this.getAdapter(n);if(!s)return;const i=this.universalProvider?.session?.namespaces?.[n]?.accounts||[],o=U.state.activeCaipNetwork?.id,a=i.find(l=>{const{chainId:u}=or.parseCaipAddress(l);return u===o?.toString()})||i[0];if(a){const l=or.validateCaipAddress(a),{chainId:u,address:h}=or.parseCaipAddress(l);if(ct.setProviderId(n,ri.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&U.state.activeCaipNetwork&&s.namespace!==X.CHAIN.EVM){const d=s.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:U.state.activeCaipNetwork});ct.setProvider(n,d)}else ct.setProvider(n,this.universalProvider);Q.setConnectorId(X.CONNECTOR_ID.WALLET_CONNECT,n),J.addConnectedNamespace(n),await this.syncAccount({address:h,chainId:u,chainNamespace:n})}else e.includes(n)&&this.setStatus("disconnected",n);const c=this.getApprovedCaipNetworksData();this.syncConnectedWalletInfo(n),U.setApprovedCaipNetworksData(n,{approvedCaipNetworkIds:c.approvedCaipNetworkIds,supportsAllNetworks:c.supportsAllNetworks})});await Promise.all(r)}syncProvider({type:e,provider:r,id:n,chainNamespace:s}){ct.setProviderId(s,e),ct.setProvider(s,r),Q.setConnectorId(n,s)}async syncAccount(e){const r=e.chainNamespace===U.state.activeChain,n=U.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:s,chainId:i,chainNamespace:o}=e,{chainId:a}=J.getActiveNetworkProps(),c=n?.id||a,l=U.state.activeCaipNetwork?.name===X.UNSUPPORTED_NETWORK_NAME,u=U.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!u)&&c){let h=this.getCaipNetworks().find(m=>m.id.toString()===c.toString()),d=this.getCaipNetworks().find(m=>m.chainNamespace===o);if(!u&&!h&&!d){const m=this.getApprovedCaipNetworkIds()||[],w=m.find(S=>or.parseCaipNetworkId(S)?.chainId===c.toString()),I=m.find(S=>or.parseCaipNetworkId(S)?.chainNamespace===o);h=this.getCaipNetworks().find(S=>S.caipNetworkId===w),d=this.getCaipNetworks().find(S=>S.caipNetworkId===I||"deprecatedCaipNetworkId"in S&&S.deprecatedCaipNetworkId===I)}const p=h||d;p?.chainNamespace===U.state.activeChain?V.state.enableNetworkSwitch&&!V.state.allowUnsupportedChain&&U.state.activeCaipNetwork?.name===X.UNSUPPORTED_NETWORK_NAME?U.showUnsupportedChainUI():this.setCaipNetwork(p):r||n&&this.setCaipNetworkOfNamespace(n,o),this.syncConnectedWalletInfo(o);const g=this.getAddress(o);Lu.isLowerCaseMatch(s,g)||this.syncAccountInfo(s,p?.id,o),r?await this.syncBalance({address:s,chainId:p?.id,chainNamespace:o}):await this.syncBalance({address:s,chainId:n?.id,chainNamespace:o}),this.syncIdentity({address:s,chainId:i,chainNamespace:o})}}async syncAccountInfo(e,r,n){const s=this.getCaipAddress(n),i=r||s?.split(":")[1];if(!i)return;const o=`${n}:${i}:${e}`;this.setCaipAddress(o,n,!0),await this.syncIdentity({address:e,chainId:i,chainNamespace:n})}async syncReownName(e,r){try{const n=await this.getReownName(e);if(n[0]){const s=n[0];this.setProfileName(s.name,r)}else this.setProfileName(null,r)}catch{this.setProfileName(null,r)}}syncConnectedWalletInfo(e){const r=Q.getConnectorId(e),n=ct.getProviderId(e);if(n===ri.CONNECTOR_TYPE_ANNOUNCED||n===ri.CONNECTOR_TYPE_INJECTED){if(r){const i=this.getConnectors().find(o=>{const a=o.id===r,c=o.info?.rdns===r,l=o.connectors?.some(u=>u.id===r||u.info?.rdns===r);return a||c||!!l});if(i){const{info:o,name:a,imageUrl:c}=i,l=c||this.getConnectorImage(i);this.setConnectedWalletInfo({name:a,icon:l,...o},e)}}}else if(n===ri.CONNECTOR_TYPE_WALLET_CONNECT){const s=ct.getProvider(e);s?.session&&this.setConnectedWalletInfo({...s.session.peer.metadata,name:s.session.peer.metadata.name,icon:s.session.peer.metadata.icons?.[0]},e)}else if(r&&(r===X.CONNECTOR_ID.COINBASE_SDK||r===X.CONNECTOR_ID.COINBASE)){const s=this.getConnectors().find(c=>c.id===r),i=s?.name||"Coinbase Wallet",o=s?.imageUrl||this.getConnectorImage(s),a=s?.info;this.setConnectedWalletInfo({...a,name:i,icon:o},e)}}async syncBalance(e){!y$.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(n=>n.id.toString()===e.chainId?.toString())||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,r,n){const s=this.getAdapter(n),i=U.getCaipNetworkByNamespace(n,r);if(s){const o=await s.getBalance({address:e,chainId:r,caipNetwork:i,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,n),o}}async initializeUniversalAdapter(){const e=Gie.createLogger((s,...i)=>{s&&this.handleAlertError(s),console.error(...i)}),r={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:"",description:this.options?.metadata?this.options?.metadata.description:"",url:this.options?.metadata?this.options?.metadata.url:"",icons:this.options?.metadata?this.options?.metadata.icons:[""]},logger:e};V.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??await hie.init(r);const n=this.universalProvider.disconnect.bind(this.universalProvider);this.universalProvider.disconnect=async()=>{try{return await n()}catch(s){if(s instanceof Error&&s.message.includes("Missing or invalid. Record was recently deleted"))return;throw s}},V.state.enableReconnect===!1&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(e=>{wo.listenWcProvider({universalProvider:this.universalProvider,namespace:e,onDisplayUri:r=>{ie.setUri(r)},onConnect:r=>{const{address:n}=ue.getAccount(r[0]);ie.finalizeWcConnection(n)},onDisconnect:()=>{U.state.noAdapters&&this.resetAccount(e),ie.resetWcConnection()},onChainChanged:r=>{const n=U.state.activeChain,s=n&&Q.state.activeConnectorIds[n]===X.CONNECTOR_ID.WALLET_CONNECT;if(n===e&&(U.state.noAdapters||s)){const i=this.getCaipNetworks().find(a=>a.id.toString()===r.toString()||a.caipNetworkId.toString()===r.toString()),o=this.getCaipNetwork();if(!i){this.setUnsupportedNetwork(r);return}o?.id.toString()!==i?.id.toString()&&o?.chainNamespace===i?.chainNamespace&&this.setCaipNetwork(i)}},onAccountsChanged:r=>{const n=U.state.activeChain,s=n&&Q.state.activeConnectorIds[n]===X.CONNECTOR_ID.WALLET_CONNECT;if(n===e&&(U.state.noAdapters||s)){const i=r?.[0];i&&this.syncAccount({address:i.address,chainId:i.chainId,chainNamespace:i.chainNamespace})}}})})}createUniversalProvider(){return!this.universalProviderInitPromise&&ue.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Se.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}getDisabledCaipNetworks(){const e=U.getAllApprovedCaipNetworkIds(),r=U.getAllRequestedCaipNetworks();return ue.sortRequestedNetworks(e,r).filter(s=>U.isCaipNetworkDisabled(s))}handleAlertError(e){const r=Object.entries(Dn.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[n,s]=r??[],{message:i,alertErrorKey:o}=s??{};if(n&&i&&!this.reportedAlertErrors[n]){const a=Dn.ALERT_ERRORS[o];a&&(dn.open(a,"error"),this.reportedAlertErrors[n]=!0)}}getAdapter(e){if(e)return this.chainAdapters?.[e]}createAdapter(e){if(!e)return;const r=e.namespace;if(!r)return;this.createClients();const n=e;n.namespace=r,n.construct({namespace:r,projectId:this.options?.projectId,networks:this.caipNetworks?.filter(({chainNamespace:s})=>s===r)}),this.chainNamespaces.includes(r)||this.chainNamespaces.push(r),this.chainAdapters&&(this.chainAdapters[r]=n)}async open(e){await this.injectModalUi(),e?.uri&&ie.setUri(e.uri);const{isSwap:r,isSend:n}=this.toModalOptions();return r(e)?Ce.open({...e,data:{swap:e.arguments}}):n(e)&&e.arguments?this.openSend(e.arguments):Ce.open(e)}async close(){await this.injectModalUi(),Ce.close()}setLoading(e,r){Ce.setLoading(e,r)}async disconnect(e){await ie.disconnect({namespace:e})}getSIWX(){return V.state.siwx}getError(){return""}getChainId(){return U.state.activeCaipNetwork?.id}async switchNetwork(e,{throwOnFailure:r=!1}={}){const n=this.getCaipNetworks().find(s=>s.id===e.id);if(!n){dn.open(Dn.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await U.switchActiveNetwork(n,{throwOnFailure:r})}getWalletProvider(){return U.state.activeChain?ct.state.providers[U.state.activeChain]:null}getWalletProviderType(){return ct.getProviderId(U.state.activeChain)}subscribeProviders(e){return ct.subscribeProviders(e)}getThemeMode(){return gn.state.themeMode}getThemeVariables(){return gn.state.themeVariables}setThemeMode(e){gn.setThemeMode(e),Pw(gn.state.themeMode)}setTermsConditionsUrl(e){V.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){V.setPrivacyPolicyUrl(e)}setThemeVariables(e){gn.setThemeVariables(e),Aoe(gn.state.themeVariables)}subscribeTheme(e){return gn.subscribe(e)}subscribeConnections(e){return this.remoteFeatures.multiWallet?ie.subscribe(e):(dn.open(X.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>{})}getWalletInfo(e){return e?U.state.chains.get(e)?.accountState?.connectedWalletInfo:U.getAccountData()?.connectedWalletInfo}getAccount(e){const r=e||U.state.activeChain,n=Q.getAuthConnector(r),s=U.getAccountData(r),i=J.getConnectedConnectorId(U.state.activeChain),o=ie.getConnections(r);if(!r)throw new Error("AppKit:getAccount - namespace is required");const a=o.flatMap(c=>c.accounts.map(({address:l,type:u,publicKey:h})=>ue.createAccount(r,l,u||"eoa",h)));if(s)return{allAccounts:a,caipAddress:s.caipAddress,address:ue.getPlainAddress(s.caipAddress),isConnected:!!s.caipAddress,status:s.status,embeddedWalletInfo:n&&i===X.CONNECTOR_ID.AUTH?{user:s.user?{...s.user,username:J.getConnectedSocialUsername()}:void 0,authProvider:s.socialProvider||"email",accountType:Hn(r),isSmartAccountDeployed:!!s.smartAccountDeployed}:void 0}}subscribeAccount(e,r){const n=()=>{const s=this.getAccount(r);s&&e(s)};r?U.subscribeChainProp("accountState",n,r):U.subscribe(n),Q.subscribe(n)}subscribeNetwork(e){return U.subscribe(({activeCaipNetwork:r})=>{e({caipNetwork:r,chainId:r?.id,caipNetworkId:r?.caipNetworkId})})}subscribeWalletInfo(e,r){return r?U.subscribeChainProp("accountState",n=>e(n?.connectedWalletInfo),r):U.subscribeChainProp("accountState",n=>e(n?.connectedWalletInfo))}subscribeShouldUpdateToAddress(e){U.subscribeChainProp("accountState",r=>e(r?.shouldUpdateToAddress))}subscribeCaipNetworkChange(e){U.subscribeKey("activeCaipNetwork",e)}getState(){return bi.state}getRemoteFeatures(){return V.state.remoteFeatures}subscribeState(e){return bi.subscribe(e)}subscribeRemoteFeatures(e){return V.subscribeKey("remoteFeatures",e)}showErrorMessage(e){Ts.showError(e)}showSuccessMessage(e){Ts.showSuccess(e)}getEvent(){return{...Se.state}}subscribeEvents(e){return Se.subscribe(e)}replace(e){me.replace(e)}redirect(e){me.push(e)}popTransactionStack(e){me.popTransactionStack(e)}isOpen(){return Ce.state.open}isTransactionStackEmpty(){return me.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){V.setFeatures(e)}updateRemoteFeatures(e){V.setRemoteFeatures(e)}updateOptions(e){const n={...V.state||{},...e};V.setOptions(n)}setConnectMethodsOrder(e){V.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){V.setWalletFeaturesOrder(e)}setCollapseWallets(e){V.setCollapseWallets(e)}setSocialsOrder(e){V.setSocialsOrder(e)}getConnectMethodsOrder(){return Pl.getConnectOrderMethod(V.state.features,Q.getConnectors())}addNetwork(e,r){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const n=this.extendCaipNetwork(r,this.options);this.getCaipNetworks().find(s=>s.id===n.id)||U.addNetwork(n)}removeNetwork(e,r){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(s=>s.id===r)&&U.removeNetwork(e,r)}}let QI=!1;class Doe extends Roe{async open(e){Q.isConnected()||await super.open(e)}async close(){if(await super.close(),this.options.manualWCControl){const e=U.getAccountData(this.activeChainNamespace)?.address;ie.finalizeWcConnection(e)}}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!QI&&ue.isClient()){if(await sf(()=>import("./basic-CMOiWqFD.js"),__vite__mapDeps([0,1])),await sf(()=>import("./w3m-modal-DqvS5FEQ.js"),__vite__mapDeps([2,1])),!document.querySelector("w3m-modal")){const r=document.createElement("w3m-modal");!V.state.disableAppend&&!V.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",r)}QI=!0}}}const Uoe="1.8.12";function Boe(t){return new Doe({...t,basic:!0,sdkVersion:`html-core-${Uoe}`})}const Loe=bV({id:1,name:"Ethereum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockTime:12e3,rpcUrls:{default:{http:["https://eth.merkle.io"]}},blockExplorers:{default:{name:"Etherscan",url:"https://etherscan.io",apiUrl:"https://api.etherscan.io/api"}},contracts:{ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:23085558},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:14353601}}});function Gc(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}Gc({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"});Gc({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});Gc({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});Gc({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});Gc({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});Gc({id:"00000008819873e925422c1ff0f99f7c",caipNetworkId:"bip122:00000008819873e925422c1ff0f99f7c",chainNamespace:"bip122",name:"Bitcoin Signet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const Moe="wallet_connect";class joe{wcParams;moduleType;productIcon;productId;productName;productUrl;modal;signClient;initiated;constructor(e){if(this.wcParams=e,this.moduleType=NS.BRIDGE_WALLET,this.productIcon="https://stellar.creit.tech/wallet-icons/walletconnect.png",this.productId=Moe,this.productName="WalletConnect",this.productUrl="https://walletconnect.com/",this.initiated=!1,!e)throw new Error("The WalletConnect modules have required params.");lH.init({projectId:e.projectId,metadata:e.metadata,...e.signClientOptions||{}}).then(r=>{r.on("display_uri",n=>{this.modal.open({uri:n})}),r.on("session_delete",n=>{this.closeSession(n.topic)}),this.signClient=r}),this.modal=Boe({projectId:e.projectId,manualWCControl:!0,enableReconnect:!0,networks:[Loe],featuredWalletIds:["aef3112adf415ec870529e96b4d7b434f13961a079d1ee42c9738217d8adeb91","76a3d548a08cf402f5c7d021f24fd2881d767084b387a5325df88bc3d4b6f21b"],...e.appKitOptions||{}})}async isAvailable(){return!!this.signClient&&!!this.modal}async runChecks(){if(!await this.isAvailable())throw hd(new Error("WalletConnect modules has not been started yet."))}async getAddress(){if(await this.runChecks(),xs.value!==ld.PUBLIC&&xs.value!==ld.TESTNET)throw hd(new Error(`Network ${xs.value} is not supported by WalletConnect.`));const{uri:e,approval:r}=await this.signClient.connect({requiredNamespaces:{stellar:{methods:[eS.SIGN],chains:this.wcParams.allowedChains||[Tm.PUBLIC],events:[]}}});e&&this.modal.open({uri:e});try{const n=await r(),s=n.namespaces.stellar.accounts.map(i=>i.split(":")[2]);return ai.value=[...ai.value,...s.map(i=>({publicKey:i,topic:n.topic}))],this.modal.close(),{address:s[0]}}catch(n){throw this.modal.close(),n}}async signTransaction(e,r){await this.runChecks();const s=ai.value.find(o=>(r?.address||gt.value)===o.publicKey);if(!s)throw hd(new Error("No WalletConnect session found or it expired for the selected address."));const{signedXDR:i}=await this.signClient.request({topic:s.topic,chainId:r?.networkPassphrase===ld.PUBLIC?Tm.PUBLIC:Tm.TESTNET,request:{method:eS.SIGN,params:{xdr:e}}});return{signedTxXdr:i}}async disconnect(){if(!this.signClient)throw new Error("WalletConnect is not running yet");const e=await this.getSessions();for(const r of e)await this.closeSession(r.topic)}async getSessions(){if(!this.signClient)throw new Error("WalletConnect is not running yet");return this.signClient.session.values}async closeSession(e,r){if(!this.signClient)throw new Error("WalletConnect is not running yet");ai.value=ai.value.filter(n=>n.topic!==e),ai.value.length===0&&Jw(),await this.signClient.disconnect({topic:e,reason:{message:r||"Session closed",code:-1}})}async signAuthEntry(){throw{code:-3,message:'WalletConnect does not support the "signAuthEntry" function'}}async signMessage(){throw{code:-3,message:'WalletConnect does not support the "signMessage" function'}}async getNetwork(){throw{code:-3,message:'WalletConnect does not support the "getNetwork" function'}}}var Tm=(function(t){return t.PUBLIC="stellar:pubnet",t.TESTNET="stellar:testnet",t})({}),eS=(function(t){return t.SIGN="stellar_signXDR",t})({});ir.init({theme:FO,modules:new joe({projectId:"48b7bf0dacf7920c182f112b3cc388a8",featuredWalletIds:["76a3d548a08cf402f5c7d021f24fd2881d767084b387a5325df88bc3d4b6f21b"],metadata:{name:"PortalX LITE",description:"PortalX LITE Wallet Connector",icons:["https://legacygold.github.io/portalx-lite-test/icon.png"],url:"https://legacygold.github.io/portalx-lite-test/"}})});const Foe=document.querySelector("#buttonWrapper");ir.createButton(Foe);ir.on(Gi.STATE_UPDATED,t=>{console.log("STATE UPDATED:",t)});ir.on(Gi.DISCONNECT,()=>{console.log("Wallet disconnected.")});const{address:wO}=await ir.authModal();console.log("Connected Stellar Address:",wO);const{signedTxXdr:qoe}=await ir.signTransaction(tx.toXDR(),{networkPassphrase:Networks.PUBLIC,address:wO});console.log("Signed Transaction:",qoe);export{Fh as $,de as A,we as B,Q as C,dn as D,Se as E,B0 as F,U$ as G,Lu as H,lr as I,cr as J,os as K,xoe as L,Ce as M,vH as N,V as O,Zie as P,Vle as Q,me as R,Ts as S,gn as T,dO as U,Tw as V,Pl as W,Lc as X,y$ as Y,pe as Z,sf as _,ue as a,VH as a$,he as a0,ot as a1,n_ as a2,ap as a3,P0 as a4,FH as a5,ZH as a6,s_ as a7,XH as a8,Lce as a9,uV as aA,hV as aB,Zce as aC,Fce as aD,fV as aE,Jce as aF,T$ as aG,gV as aH,Xce as aI,rle as aJ,Qce as aK,tle as aL,ele as aM,D0 as aN,Fl as aO,Vce as aP,nle as aQ,sle as aR,dV as aS,pV as aT,k$ as aU,a_ as aV,IV as aW,jh as aX,Uh as aY,QH as aZ,x$ as a_,qH as aa,YH as ab,HH as ac,$$ as ad,A$ as ae,Wce as af,Mg as ag,zce as ah,KH as ai,da as aj,R0 as ak,Gce as al,cf as am,Yce as an,Tc as ao,mu as ap,N$ as aq,U0 as ar,rV as as,nV as at,sV as au,iV as av,oV as aw,aV as ax,cV as ay,lV as az,ie as b,WH as b0,i_ as b1,Tu as b2,Ou as b3,Nu as b4,Iu as b5,Au as b6,gu as b7,fu as b8,bu as b9,Pc as ba,pu as bb,ra as bc,du as bd,_u as be,Sn as bf,yu as bg,wu as bh,on as bi,Su as bj,kc as bk,vu as bl,$u as bm,tV as bn,xu as bo,Cu as bp,Eu as bq,fa as br,CV as bs,bV as bt,zH as bu,vV as bv,X as c,Hle as d,zn as e,Nm as f,R$ as g,Kle as h,$d as i,Ea as j,fi as k,Te as l,zu as m,zle as n,U as o,sc as p,J as q,Wle as r,Yt as s,uo as t,it as u,Hn as v,Kn as w,qle as x,pi as y,ZV as z};
